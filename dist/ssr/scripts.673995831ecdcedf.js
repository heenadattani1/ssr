(function(Ae,Qe){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=Ae.document?Qe(Ae,!0):function(v){if(!v.document)throw new Error("jQuery requires a window with a document");return Qe(v)}:Qe(Ae)})(typeof window<"u"?window:this,function(Ae,Qe){"use strict";var v=[],$=Object.getPrototypeOf,ae=v.slice,o=v.flat?function(m){return v.flat.call(m)}:function(m){return v.concat.apply([],m)},D=v.push,N=v.indexOf,j={},k=j.toString,O=j.hasOwnProperty,I=O.toString,X=I.call(Object),le={},te=function(m){return"function"==typeof m&&"number"!=typeof m.nodeType&&"function"!=typeof m.item},Be=function(m){return null!=m&&m===m.window},Ie=Ae.document,Se={type:!0,src:!0,nonce:!0,noModule:!0};function Ke(m,b,M){var L,q,J=(M=M||Ie).createElement("script");if(J.text=m,b)for(L in Se)(q=b[L]||b.getAttribute&&b.getAttribute(L))&&J.setAttribute(L,q);M.head.appendChild(J).parentNode.removeChild(J)}function ne(m){return null==m?m+"":"object"==typeof m||"function"==typeof m?j[k.call(m)]||"object":typeof m}var C=function(m,b){return new C.fn.init(m,b)};function wt(m){var b=!!m&&"length"in m&&m.length,M=ne(m);return!te(m)&&!Be(m)&&("array"===M||0===b||"number"==typeof b&&0<b&&b-1 in m)}C.fn=C.prototype={jquery:"3.6.3",constructor:C,length:0,toArray:function(){return ae.call(this)},get:function(m){return null==m?ae.call(this):m<0?this[m+this.length]:this[m]},pushStack:function(m){var b=C.merge(this.constructor(),m);return b.prevObject=this,b},each:function(m){return C.each(this,m)},map:function(m){return this.pushStack(C.map(this,function(b,M){return m.call(b,M,b)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(C.grep(this,function(m,b){return(b+1)%2}))},odd:function(){return this.pushStack(C.grep(this,function(m,b){return b%2}))},eq:function(m){var b=this.length,M=+m+(m<0?b:0);return this.pushStack(0<=M&&M<b?[this[M]]:[])},end:function(){return this.prevObject||this.constructor()},push:D,sort:v.sort,splice:v.splice},C.extend=C.fn.extend=function(){var m,b,M,L,q,J,se=arguments[0]||{},Ve=1,G=arguments.length,x=!1;for("boolean"==typeof se&&(x=se,se=arguments[Ve]||{},Ve++),"object"==typeof se||te(se)||(se={}),Ve===G&&(se=this,Ve--);Ve<G;Ve++)if(null!=(m=arguments[Ve]))for(b in m)L=m[b],"__proto__"!==b&&se!==L&&(x&&L&&(C.isPlainObject(L)||(q=Array.isArray(L)))?(M=se[b],J=q&&!Array.isArray(M)?[]:q||C.isPlainObject(M)?M:{},q=!1,se[b]=C.extend(x,J,L)):void 0!==L&&(se[b]=L));return se},C.extend({expando:"jQuery"+("3.6.3"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(m){throw new Error(m)},noop:function(){},isPlainObject:function(m){var b,M;return!(!m||"[object Object]"!==k.call(m)||(b=$(m))&&("function"!=typeof(M=O.call(b,"constructor")&&b.constructor)||I.call(M)!==X))},isEmptyObject:function(m){var b;for(b in m)return!1;return!0},globalEval:function(m,b,M){Ke(m,{nonce:b&&b.nonce},M)},each:function(m,b){var M,L=0;if(wt(m))for(M=m.length;L<M&&!1!==b.call(m[L],L,m[L]);L++);else for(L in m)if(!1===b.call(m[L],L,m[L]))break;return m},makeArray:function(m,b){var M=b||[];return null!=m&&(wt(Object(m))?C.merge(M,"string"==typeof m?[m]:m):D.call(M,m)),M},inArray:function(m,b,M){return null==b?-1:N.call(b,m,M)},merge:function(m,b){for(var M=+b.length,L=0,q=m.length;L<M;L++)m[q++]=b[L];return m.length=q,m},grep:function(m,b,M){for(var L=[],q=0,J=m.length,se=!M;q<J;q++)!b(m[q],q)!==se&&L.push(m[q]);return L},map:function(m,b,M){var L,q,J=0,se=[];if(wt(m))for(L=m.length;J<L;J++)null!=(q=b(m[J],J,M))&&se.push(q);else for(J in m)null!=(q=b(m[J],J,M))&&se.push(q);return o(se)},guid:1,support:le}),"function"==typeof Symbol&&(C.fn[Symbol.iterator]=v[Symbol.iterator]),C.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(m,b){j["[object "+b+"]"]=b.toLowerCase()});var xt=function(m){var b,M,L,q,J,se,Ve,G,x,B,de,Ee,Ne,bt,ei,Yt,hn,wn,Pn,fn="sizzle"+1*new Date,ki=m.document,Fi=0,rn=0,An=ws(),to=ws(),No=ws(),or=ws(),co=function(pe,Fe){return pe===Fe&&(de=!0),0},Yo={}.hasOwnProperty,Cr=[],ko=Cr.pop,pr=Cr.push,Un=Cr.push,on=Cr.slice,xr=function(pe,Fe){for(var Je=0,It=pe.length;Je<It;Je++)if(pe[Je]===Fe)return Je;return-1},uo="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ln="[\\x20\\t\\r\\n\\f]",Cn="(?:\\\\[\\da-fA-F]{1,6}"+ln+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",sr="\\["+ln+"*("+Cn+")(?:"+ln+"*([*^$|!~]?=)"+ln+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+Cn+"))|)"+ln+"*\\]",Gr=":("+Cn+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+sr+")*)|.*)\\)|)",cr=new RegExp(ln+"+","g"),qr=new RegExp("^"+ln+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ln+"+$","g"),Ko=new RegExp("^"+ln+"*,"+ln+"*"),as=new RegExp("^"+ln+"*([>+~]|"+ln+")"+ln+"*"),Ma=new RegExp(ln+"|>"),sa=new RegExp(Gr),ka=new RegExp("^"+Cn+"$"),$s={ID:new RegExp("^#("+Cn+")"),CLASS:new RegExp("^\\.("+Cn+")"),TAG:new RegExp("^("+Cn+"|[*])"),ATTR:new RegExp("^"+sr),PSEUDO:new RegExp("^"+Gr),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ln+"*(even|odd|(([+-]|)(\\d*)n|)"+ln+"*(?:([+-]|)"+ln+"*(\\d+)|))"+ln+"*\\)|)","i"),bool:new RegExp("^(?:"+uo+")$","i"),needsContext:new RegExp("^"+ln+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ln+"*((?:-\\d)?\\d*)"+ln+"*\\)|)(?=[^-]|$)","i")},Nl=/HTML$/i,Gs=/^(?:input|select|textarea|button)$/i,qs=/^h\d$/i,xs=/^[^{]+\{\s*\[native \w/,aa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,bs=/[+~]/,br=new RegExp("\\\\[\\da-fA-F]{1,6}"+ln+"?|\\\\([^\\r\\n\\f])","g"),xo=function(pe,Fe){var Je="0x"+pe.slice(1)-65536;return Fe||(Je<0?String.fromCharCode(Je+65536):String.fromCharCode(Je>>10|55296,1023&Je|56320))},Ia=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,la=function(pe,Fe){return Fe?"\0"===pe?"\ufffd":pe.slice(0,-1)+"\\"+pe.charCodeAt(pe.length-1).toString(16)+" ":"\\"+pe},ca=function(){Ee()},ua=Uo(function(pe){return!0===pe.disabled&&"fieldset"===pe.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{Un.apply(Cr=on.call(ki.childNodes),ki.childNodes)}catch{Un={apply:Cr.length?function(Fe,Je){pr.apply(Fe,on.call(Je))}:function(Fe,Je){for(var It=Fe.length,nt=0;Fe[It++]=Je[nt++];);Fe.length=It-1}}}function jn(pe,Fe,Je,It){var nt,Vt,Kt,ci,di,Yi,qi,Ni=Fe&&Fe.ownerDocument,dn=Fe?Fe.nodeType:9;if(Je=Je||[],"string"!=typeof pe||!pe||1!==dn&&9!==dn&&11!==dn)return Je;if(!It&&(Ee(Fe),Fe=Fe||Ne,ei)){if(11!==dn&&(di=aa.exec(pe)))if(nt=di[1]){if(9===dn){if(!(Kt=Fe.getElementById(nt)))return Je;if(Kt.id===nt)return Je.push(Kt),Je}else if(Ni&&(Kt=Ni.getElementById(nt))&&Pn(Fe,Kt)&&Kt.id===nt)return Je.push(Kt),Je}else{if(di[2])return Un.apply(Je,Fe.getElementsByTagName(pe)),Je;if((nt=di[3])&&M.getElementsByClassName&&Fe.getElementsByClassName)return Un.apply(Je,Fe.getElementsByClassName(nt)),Je}if(M.qsa&&!or[pe+" "]&&(!Yt||!Yt.test(pe))&&(1!==dn||"object"!==Fe.nodeName.toLowerCase())){if(qi=pe,Ni=Fe,1===dn&&(Ma.test(pe)||as.test(pe))){for((Ni=bs.test(pe)&&Ts(Fe.parentNode)||Fe)===Fe&&M.scope||((ci=Fe.getAttribute("id"))?ci=ci.replace(Ia,la):Fe.setAttribute("id",ci=fn)),Vt=(Yi=se(pe)).length;Vt--;)Yi[Vt]=(ci?"#"+ci:":scope")+" "+Es(Yi[Vt]);qi=Yi.join(",")}try{if(M.cssSupportsSelector&&!CSS.supports("selector(:is("+qi+"))"))throw new Error;return Un.apply(Je,Ni.querySelectorAll(qi)),Je}catch{or(pe,!0)}finally{ci===fn&&Fe.removeAttribute("id")}}}return G(pe.replace(qr,"$1"),Fe,Je,It)}function ws(){var pe=[];return function Fe(Je,It){return pe.push(Je+" ")>L.cacheLength&&delete Fe[pe.shift()],Fe[Je+" "]=It}}function bo(pe){return pe[fn]=!0,pe}function Dr(pe){var Fe=Ne.createElement("fieldset");try{return!!pe(Fe)}catch{return!1}finally{Fe.parentNode&&Fe.parentNode.removeChild(Fe),Fe=null}}function ha(pe,Fe){for(var Je=pe.split("|"),It=Je.length;It--;)L.attrHandle[Je[It]]=Fe}function Zs(pe,Fe){var Je=Fe&&pe,It=Je&&1===pe.nodeType&&1===Fe.nodeType&&pe.sourceIndex-Fe.sourceIndex;if(It)return It;if(Je)for(;Je=Je.nextSibling;)if(Je===Fe)return-1;return pe?1:-1}function Ul(pe){return function(Fe){return"input"===Fe.nodeName.toLowerCase()&&Fe.type===pe}}function Da(pe){return function(Fe){var Je=Fe.nodeName.toLowerCase();return("input"===Je||"button"===Je)&&Fe.type===pe}}function el(pe){return function(Fe){return"form"in Fe?Fe.parentNode&&!1===Fe.disabled?"label"in Fe?"label"in Fe.parentNode?Fe.parentNode.disabled===pe:Fe.disabled===pe:Fe.isDisabled===pe||Fe.isDisabled!==!pe&&ua(Fe)===pe:Fe.disabled===pe:"label"in Fe&&Fe.disabled===pe}}function Io(pe){return bo(function(Fe){return Fe=+Fe,bo(function(Je,It){for(var nt,Vt=pe([],Je.length,Fe),Kt=Vt.length;Kt--;)Je[nt=Vt[Kt]]&&(Je[nt]=!(It[nt]=Je[nt]))})})}function Ts(pe){return pe&&typeof pe.getElementsByTagName<"u"&&pe}for(b in M=jn.support={},J=jn.isXML=function(pe){var Je=pe&&(pe.ownerDocument||pe).documentElement;return!Nl.test(pe&&pe.namespaceURI||Je&&Je.nodeName||"HTML")},Ee=jn.setDocument=function(pe){var Fe,Je,It=pe?pe.ownerDocument||pe:ki;return It!=Ne&&9===It.nodeType&&It.documentElement&&(bt=(Ne=It).documentElement,ei=!J(Ne),ki!=Ne&&(Je=Ne.defaultView)&&Je.top!==Je&&(Je.addEventListener?Je.addEventListener("unload",ca,!1):Je.attachEvent&&Je.attachEvent("onunload",ca)),M.scope=Dr(function(nt){return bt.appendChild(nt).appendChild(Ne.createElement("div")),typeof nt.querySelectorAll<"u"&&!nt.querySelectorAll(":scope fieldset div").length}),M.cssSupportsSelector=Dr(function(){return CSS.supports("selector(*)")&&Ne.querySelectorAll(":is(:jqfake)")&&!CSS.supports("selector(:is(*,:jqfake))")}),M.attributes=Dr(function(nt){return nt.className="i",!nt.getAttribute("className")}),M.getElementsByTagName=Dr(function(nt){return nt.appendChild(Ne.createComment("")),!nt.getElementsByTagName("*").length}),M.getElementsByClassName=xs.test(Ne.getElementsByClassName),M.getById=Dr(function(nt){return bt.appendChild(nt).id=fn,!Ne.getElementsByName||!Ne.getElementsByName(fn).length}),M.getById?(L.filter.ID=function(nt){var Vt=nt.replace(br,xo);return function(Kt){return Kt.getAttribute("id")===Vt}},L.find.ID=function(nt,Vt){if(typeof Vt.getElementById<"u"&&ei){var Kt=Vt.getElementById(nt);return Kt?[Kt]:[]}}):(L.filter.ID=function(nt){var Vt=nt.replace(br,xo);return function(Kt){var ci=typeof Kt.getAttributeNode<"u"&&Kt.getAttributeNode("id");return ci&&ci.value===Vt}},L.find.ID=function(nt,Vt){if(typeof Vt.getElementById<"u"&&ei){var Kt,ci,di,Yi=Vt.getElementById(nt);if(Yi){if((Kt=Yi.getAttributeNode("id"))&&Kt.value===nt)return[Yi];for(di=Vt.getElementsByName(nt),ci=0;Yi=di[ci++];)if((Kt=Yi.getAttributeNode("id"))&&Kt.value===nt)return[Yi]}return[]}}),L.find.TAG=M.getElementsByTagName?function(nt,Vt){return typeof Vt.getElementsByTagName<"u"?Vt.getElementsByTagName(nt):M.qsa?Vt.querySelectorAll(nt):void 0}:function(nt,Vt){var Kt,ci=[],di=0,Yi=Vt.getElementsByTagName(nt);if("*"===nt){for(;Kt=Yi[di++];)1===Kt.nodeType&&ci.push(Kt);return ci}return Yi},L.find.CLASS=M.getElementsByClassName&&function(nt,Vt){if(typeof Vt.getElementsByClassName<"u"&&ei)return Vt.getElementsByClassName(nt)},hn=[],Yt=[],(M.qsa=xs.test(Ne.querySelectorAll))&&(Dr(function(nt){var Vt;bt.appendChild(nt).innerHTML="<a id='"+fn+"'></a><select id='"+fn+"-\r\\' msallowcapture=''><option selected=''></option></select>",nt.querySelectorAll("[msallowcapture^='']").length&&Yt.push("[*^$]="+ln+"*(?:''|\"\")"),nt.querySelectorAll("[selected]").length||Yt.push("\\["+ln+"*(?:value|"+uo+")"),nt.querySelectorAll("[id~="+fn+"-]").length||Yt.push("~="),(Vt=Ne.createElement("input")).setAttribute("name",""),nt.appendChild(Vt),nt.querySelectorAll("[name='']").length||Yt.push("\\["+ln+"*name"+ln+"*="+ln+"*(?:''|\"\")"),nt.querySelectorAll(":checked").length||Yt.push(":checked"),nt.querySelectorAll("a#"+fn+"+*").length||Yt.push(".#.+[+~]"),nt.querySelectorAll("\\\f"),Yt.push("[\\r\\n\\f]")}),Dr(function(nt){nt.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var Vt=Ne.createElement("input");Vt.setAttribute("type","hidden"),nt.appendChild(Vt).setAttribute("name","D"),nt.querySelectorAll("[name=d]").length&&Yt.push("name"+ln+"*[*^$|!~]?="),2!==nt.querySelectorAll(":enabled").length&&Yt.push(":enabled",":disabled"),bt.appendChild(nt).disabled=!0,2!==nt.querySelectorAll(":disabled").length&&Yt.push(":enabled",":disabled"),nt.querySelectorAll("*,:x"),Yt.push(",.*:")})),(M.matchesSelector=xs.test(wn=bt.matches||bt.webkitMatchesSelector||bt.mozMatchesSelector||bt.oMatchesSelector||bt.msMatchesSelector))&&Dr(function(nt){M.disconnectedMatch=wn.call(nt,"*"),wn.call(nt,"[s!='']:x"),hn.push("!=",Gr)}),M.cssSupportsSelector||Yt.push(":has"),Yt=Yt.length&&new RegExp(Yt.join("|")),hn=hn.length&&new RegExp(hn.join("|")),Fe=xs.test(bt.compareDocumentPosition),Pn=Fe||xs.test(bt.contains)?function(nt,Vt){var Kt=9===nt.nodeType&&nt.documentElement||nt,ci=Vt&&Vt.parentNode;return nt===ci||!(!ci||1!==ci.nodeType||!(Kt.contains?Kt.contains(ci):nt.compareDocumentPosition&&16&nt.compareDocumentPosition(ci)))}:function(nt,Vt){if(Vt)for(;Vt=Vt.parentNode;)if(Vt===nt)return!0;return!1},co=Fe?function(nt,Vt){if(nt===Vt)return de=!0,0;var Kt=!nt.compareDocumentPosition-!Vt.compareDocumentPosition;return Kt||(1&(Kt=(nt.ownerDocument||nt)==(Vt.ownerDocument||Vt)?nt.compareDocumentPosition(Vt):1)||!M.sortDetached&&Vt.compareDocumentPosition(nt)===Kt?nt==Ne||nt.ownerDocument==ki&&Pn(ki,nt)?-1:Vt==Ne||Vt.ownerDocument==ki&&Pn(ki,Vt)?1:B?xr(B,nt)-xr(B,Vt):0:4&Kt?-1:1)}:function(nt,Vt){if(nt===Vt)return de=!0,0;var Kt,ci=0,di=nt.parentNode,Yi=Vt.parentNode,qi=[nt],Ni=[Vt];if(!di||!Yi)return nt==Ne?-1:Vt==Ne?1:di?-1:Yi?1:B?xr(B,nt)-xr(B,Vt):0;if(di===Yi)return Zs(nt,Vt);for(Kt=nt;Kt=Kt.parentNode;)qi.unshift(Kt);for(Kt=Vt;Kt=Kt.parentNode;)Ni.unshift(Kt);for(;qi[ci]===Ni[ci];)ci++;return ci?Zs(qi[ci],Ni[ci]):qi[ci]==ki?-1:Ni[ci]==ki?1:0}),Ne},jn.matches=function(pe,Fe){return jn(pe,null,null,Fe)},jn.matchesSelector=function(pe,Fe){if(Ee(pe),M.matchesSelector&&ei&&!or[Fe+" "]&&(!hn||!hn.test(Fe))&&(!Yt||!Yt.test(Fe)))try{var Je=wn.call(pe,Fe);if(Je||M.disconnectedMatch||pe.document&&11!==pe.document.nodeType)return Je}catch{or(Fe,!0)}return 0<jn(Fe,Ne,null,[pe]).length},jn.contains=function(pe,Fe){return(pe.ownerDocument||pe)!=Ne&&Ee(pe),Pn(pe,Fe)},jn.attr=function(pe,Fe){(pe.ownerDocument||pe)!=Ne&&Ee(pe);var Je=L.attrHandle[Fe.toLowerCase()],It=Je&&Yo.call(L.attrHandle,Fe.toLowerCase())?Je(pe,Fe,!ei):void 0;return void 0!==It?It:M.attributes||!ei?pe.getAttribute(Fe):(It=pe.getAttributeNode(Fe))&&It.specified?It.value:null},jn.escape=function(pe){return(pe+"").replace(Ia,la)},jn.error=function(pe){throw new Error("Syntax error, unrecognized expression: "+pe)},jn.uniqueSort=function(pe){var Fe,Je=[],It=0,nt=0;if(de=!M.detectDuplicates,B=!M.sortStable&&pe.slice(0),pe.sort(co),de){for(;Fe=pe[nt++];)Fe===pe[nt]&&(It=Je.push(nt));for(;It--;)pe.splice(Je[It],1)}return B=null,pe},q=jn.getText=function(pe){var Fe,Je="",It=0,nt=pe.nodeType;if(nt){if(1===nt||9===nt||11===nt){if("string"==typeof pe.textContent)return pe.textContent;for(pe=pe.firstChild;pe;pe=pe.nextSibling)Je+=q(pe)}else if(3===nt||4===nt)return pe.nodeValue}else for(;Fe=pe[It++];)Je+=q(Fe);return Je},(L=jn.selectors={cacheLength:50,createPseudo:bo,match:$s,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(pe){return pe[1]=pe[1].replace(br,xo),pe[3]=(pe[3]||pe[4]||pe[5]||"").replace(br,xo),"~="===pe[2]&&(pe[3]=" "+pe[3]+" "),pe.slice(0,4)},CHILD:function(pe){return pe[1]=pe[1].toLowerCase(),"nth"===pe[1].slice(0,3)?(pe[3]||jn.error(pe[0]),pe[4]=+(pe[4]?pe[5]+(pe[6]||1):2*("even"===pe[3]||"odd"===pe[3])),pe[5]=+(pe[7]+pe[8]||"odd"===pe[3])):pe[3]&&jn.error(pe[0]),pe},PSEUDO:function(pe){var Fe,Je=!pe[6]&&pe[2];return $s.CHILD.test(pe[0])?null:(pe[3]?pe[2]=pe[4]||pe[5]||"":Je&&sa.test(Je)&&(Fe=se(Je,!0))&&(Fe=Je.indexOf(")",Je.length-Fe)-Je.length)&&(pe[0]=pe[0].slice(0,Fe),pe[2]=Je.slice(0,Fe)),pe.slice(0,3))}},filter:{TAG:function(pe){var Fe=pe.replace(br,xo).toLowerCase();return"*"===pe?function(){return!0}:function(Je){return Je.nodeName&&Je.nodeName.toLowerCase()===Fe}},CLASS:function(pe){var Fe=An[pe+" "];return Fe||(Fe=new RegExp("(^|"+ln+")"+pe+"("+ln+"|$)"))&&An(pe,function(Je){return Fe.test("string"==typeof Je.className&&Je.className||typeof Je.getAttribute<"u"&&Je.getAttribute("class")||"")})},ATTR:function(pe,Fe,Je){return function(It){var nt=jn.attr(It,pe);return null==nt?"!="===Fe:!Fe||(nt+="","="===Fe?nt===Je:"!="===Fe?nt!==Je:"^="===Fe?Je&&0===nt.indexOf(Je):"*="===Fe?Je&&-1<nt.indexOf(Je):"$="===Fe?Je&&nt.slice(-Je.length)===Je:"~="===Fe?-1<(" "+nt.replace(cr," ")+" ").indexOf(Je):"|="===Fe&&(nt===Je||nt.slice(0,Je.length+1)===Je+"-"))}},CHILD:function(pe,Fe,Je,It,nt){var Vt="nth"!==pe.slice(0,3),Kt="last"!==pe.slice(-4),ci="of-type"===Fe;return 1===It&&0===nt?function(di){return!!di.parentNode}:function(di,Yi,qi){var Ni,dn,ar,Hi,Zi,Wn,zr=Vt!==Kt?"nextSibling":"previousSibling",Vn=di.parentNode,Or=ci&&di.nodeName.toLowerCase(),Pr=!qi&&!ci,lr=!1;if(Vn){if(Vt){for(;zr;){for(Hi=di;Hi=Hi[zr];)if(ci?Hi.nodeName.toLowerCase()===Or:1===Hi.nodeType)return!1;Wn=zr="only"===pe&&!Wn&&"nextSibling"}return!0}if(Wn=[Kt?Vn.firstChild:Vn.lastChild],Kt&&Pr){for(lr=(Zi=(Ni=(dn=(ar=(Hi=Vn)[fn]||(Hi[fn]={}))[Hi.uniqueID]||(ar[Hi.uniqueID]={}))[pe]||[])[0]===Fi&&Ni[1])&&Ni[2],Hi=Zi&&Vn.childNodes[Zi];Hi=++Zi&&Hi&&Hi[zr]||(lr=Zi=0)||Wn.pop();)if(1===Hi.nodeType&&++lr&&Hi===di){dn[pe]=[Fi,Zi,lr];break}}else if(Pr&&(lr=Zi=(Ni=(dn=(ar=(Hi=di)[fn]||(Hi[fn]={}))[Hi.uniqueID]||(ar[Hi.uniqueID]={}))[pe]||[])[0]===Fi&&Ni[1]),!1===lr)for(;(Hi=++Zi&&Hi&&Hi[zr]||(lr=Zi=0)||Wn.pop())&&((ci?Hi.nodeName.toLowerCase()!==Or:1!==Hi.nodeType)||!++lr||(Pr&&((dn=(ar=Hi[fn]||(Hi[fn]={}))[Hi.uniqueID]||(ar[Hi.uniqueID]={}))[pe]=[Fi,lr]),Hi!==di)););return(lr-=nt)===It||lr%It==0&&0<=lr/It}}},PSEUDO:function(pe,Fe){var Je,It=L.pseudos[pe]||L.setFilters[pe.toLowerCase()]||jn.error("unsupported pseudo: "+pe);return It[fn]?It(Fe):1<It.length?(Je=[pe,pe,"",Fe],L.setFilters.hasOwnProperty(pe.toLowerCase())?bo(function(nt,Vt){for(var Kt,ci=It(nt,Fe),di=ci.length;di--;)nt[Kt=xr(nt,ci[di])]=!(Vt[Kt]=ci[di])}):function(nt){return It(nt,0,Je)}):It}},pseudos:{not:bo(function(pe){var Fe=[],Je=[],It=Ve(pe.replace(qr,"$1"));return It[fn]?bo(function(nt,Vt,Kt,ci){for(var di,Yi=It(nt,null,ci,[]),qi=nt.length;qi--;)(di=Yi[qi])&&(nt[qi]=!(Vt[qi]=di))}):function(nt,Vt,Kt){return Fe[0]=nt,It(Fe,null,Kt,Je),Fe[0]=null,!Je.pop()}}),has:bo(function(pe){return function(Fe){return 0<jn(pe,Fe).length}}),contains:bo(function(pe){return pe=pe.replace(br,xo),function(Fe){return-1<(Fe.textContent||q(Fe)).indexOf(pe)}}),lang:bo(function(pe){return ka.test(pe||"")||jn.error("unsupported lang: "+pe),pe=pe.replace(br,xo).toLowerCase(),function(Fe){var Je;do{if(Je=ei?Fe.lang:Fe.getAttribute("xml:lang")||Fe.getAttribute("lang"))return(Je=Je.toLowerCase())===pe||0===Je.indexOf(pe+"-")}while((Fe=Fe.parentNode)&&1===Fe.nodeType);return!1}}),target:function(pe){var Fe=m.location&&m.location.hash;return Fe&&Fe.slice(1)===pe.id},root:function(pe){return pe===bt},focus:function(pe){return pe===Ne.activeElement&&(!Ne.hasFocus||Ne.hasFocus())&&!!(pe.type||pe.href||~pe.tabIndex)},enabled:el(!1),disabled:el(!0),checked:function(pe){var Fe=pe.nodeName.toLowerCase();return"input"===Fe&&!!pe.checked||"option"===Fe&&!!pe.selected},selected:function(pe){return!0===pe.selected},empty:function(pe){for(pe=pe.firstChild;pe;pe=pe.nextSibling)if(pe.nodeType<6)return!1;return!0},parent:function(pe){return!L.pseudos.empty(pe)},header:function(pe){return qs.test(pe.nodeName)},input:function(pe){return Gs.test(pe.nodeName)},button:function(pe){var Fe=pe.nodeName.toLowerCase();return"input"===Fe&&"button"===pe.type||"button"===Fe},text:function(pe){var Fe;return"input"===pe.nodeName.toLowerCase()&&"text"===pe.type&&(null==(Fe=pe.getAttribute("type"))||"text"===Fe.toLowerCase())},first:Io(function(){return[0]}),last:Io(function(pe,Fe){return[Fe-1]}),eq:Io(function(pe,Fe,Je){return[Je<0?Je+Fe:Je]}),even:Io(function(pe,Fe){for(var Je=0;Je<Fe;Je+=2)pe.push(Je);return pe}),odd:Io(function(pe,Fe){for(var Je=1;Je<Fe;Je+=2)pe.push(Je);return pe}),lt:Io(function(pe,Fe,Je){for(var It=Je<0?Je+Fe:Fe<Je?Fe:Je;0<=--It;)pe.push(It);return pe}),gt:Io(function(pe,Fe,Je){for(var It=Je<0?Je+Fe:Je;++It<Fe;)pe.push(It);return pe})}}).pseudos.nth=L.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})L.pseudos[b]=Ul(b);for(b in{submit:!0,reset:!0})L.pseudos[b]=Da(b);function da(){}function Es(pe){for(var Fe=0,Je=pe.length,It="";Fe<Je;Fe++)It+=pe[Fe].value;return It}function Uo(pe,Fe,Je){var It=Fe.dir,nt=Fe.next,Vt=nt||It,Kt=Je&&"parentNode"===Vt,ci=rn++;return Fe.first?function(di,Yi,qi){for(;di=di[It];)if(1===di.nodeType||Kt)return pe(di,Yi,qi);return!1}:function(di,Yi,qi){var Ni,dn,ar,Hi=[Fi,ci];if(qi){for(;di=di[It];)if((1===di.nodeType||Kt)&&pe(di,Yi,qi))return!0}else for(;di=di[It];)if(1===di.nodeType||Kt)if(dn=(ar=di[fn]||(di[fn]={}))[di.uniqueID]||(ar[di.uniqueID]={}),nt&&nt===di.nodeName.toLowerCase())di=di[It]||di;else{if((Ni=dn[Vt])&&Ni[0]===Fi&&Ni[1]===ci)return Hi[2]=Ni[2];if((dn[Vt]=Hi)[2]=pe(di,Yi,qi))return!0}return!1}}function Pa(pe){return 1<pe.length?function(Fe,Je,It){for(var nt=pe.length;nt--;)if(!pe[nt](Fe,Je,It))return!1;return!0}:pe[0]}function pa(pe,Fe,Je,It,nt){for(var Vt,Kt=[],ci=0,di=pe.length,Yi=null!=Fe;ci<di;ci++)(Vt=pe[ci])&&(Je&&!Je(Vt,It,nt)||(Kt.push(Vt),Yi&&Fe.push(ci)));return Kt}function fa(pe,Fe,Je,It,nt,Vt){return It&&!It[fn]&&(It=fa(It)),nt&&!nt[fn]&&(nt=fa(nt,Vt)),bo(function(Kt,ci,di,Yi){var qi,Ni,dn,ar=[],Hi=[],Zi=ci.length,Wn=Kt||function(Or,Pr,lr){for(var io=0,Ss=Pr.length;io<Ss;io++)jn(Or,Pr[io],lr);return lr}(Fe||"*",di.nodeType?[di]:di,[]),zr=!pe||!Kt&&Fe?Wn:pa(Wn,ar,pe,di,Yi),Vn=Je?nt||(Kt?pe:Zi||It)?[]:ci:zr;if(Je&&Je(zr,Vn,di,Yi),It)for(qi=pa(Vn,Hi),It(qi,[],di,Yi),Ni=qi.length;Ni--;)(dn=qi[Ni])&&(Vn[Hi[Ni]]=!(zr[Hi[Ni]]=dn));if(Kt){if(nt||pe){if(nt){for(qi=[],Ni=Vn.length;Ni--;)(dn=Vn[Ni])&&qi.push(zr[Ni]=dn);nt(null,Vn=[],qi,Yi)}for(Ni=Vn.length;Ni--;)(dn=Vn[Ni])&&-1<(qi=nt?xr(Kt,dn):ar[Ni])&&(Kt[qi]=!(ci[qi]=dn))}}else Vn=pa(Vn===ci?Vn.splice(Zi,Vn.length):Vn),nt?nt(null,ci,Vn,Yi):Un.apply(ci,Vn)})}function ma(pe){for(var Fe,Je,It,nt=pe.length,Vt=L.relative[pe[0].type],Kt=Vt||L.relative[" "],ci=Vt?1:0,di=Uo(function(Ni){return Ni===Fe},Kt,!0),Yi=Uo(function(Ni){return-1<xr(Fe,Ni)},Kt,!0),qi=[function(Ni,dn,ar){var Hi=!Vt&&(ar||dn!==x)||((Fe=dn).nodeType?di(Ni,dn,ar):Yi(Ni,dn,ar));return Fe=null,Hi}];ci<nt;ci++)if(Je=L.relative[pe[ci].type])qi=[Uo(Pa(qi),Je)];else{if((Je=L.filter[pe[ci].type].apply(null,pe[ci].matches))[fn]){for(It=++ci;It<nt&&!L.relative[pe[It].type];It++);return fa(1<ci&&Pa(qi),1<ci&&Es(pe.slice(0,ci-1).concat({value:" "===pe[ci-2].type?"*":""})).replace(qr,"$1"),Je,ci<It&&ma(pe.slice(ci,It)),It<nt&&ma(pe=pe.slice(It)),It<nt&&Es(pe))}qi.push(Je)}return Pa(qi)}return da.prototype=L.filters=L.pseudos,L.setFilters=new da,se=jn.tokenize=function(pe,Fe){var Je,It,nt,Vt,Kt,ci,di,Yi=to[pe+" "];if(Yi)return Fe?0:Yi.slice(0);for(Kt=pe,ci=[],di=L.preFilter;Kt;){for(Vt in Je&&!(It=Ko.exec(Kt))||(It&&(Kt=Kt.slice(It[0].length)||Kt),ci.push(nt=[])),Je=!1,(It=as.exec(Kt))&&(Je=It.shift(),nt.push({value:Je,type:It[0].replace(qr," ")}),Kt=Kt.slice(Je.length)),L.filter)!(It=$s[Vt].exec(Kt))||di[Vt]&&!(It=di[Vt](It))||(Je=It.shift(),nt.push({value:Je,type:Vt,matches:It}),Kt=Kt.slice(Je.length));if(!Je)break}return Fe?Kt.length:Kt?jn.error(pe):to(pe,ci).slice(0)},Ve=jn.compile=function(pe,Fe){var Je,It,nt,Vt,Kt,ci,di=[],Yi=[],qi=No[pe+" "];if(!qi){for(Fe||(Fe=se(pe)),Je=Fe.length;Je--;)(qi=ma(Fe[Je]))[fn]?di.push(qi):Yi.push(qi);(qi=No(pe,(It=Yi,Vt=0<(nt=di).length,Kt=0<It.length,ci=function(Ni,dn,ar,Hi,Zi){var Wn,zr,Vn,Or=0,Pr="0",lr=Ni&&[],io=[],Ss=x,As=Ni||Kt&&L.find.TAG("*",Zi),Cs=Fi+=null==Ss?1:Math.random()||.1,ls=As.length;for(Zi&&(x=dn==Ne||dn||Zi);Pr!==ls&&null!=(Wn=As[Pr]);Pr++){if(Kt&&Wn){for(zr=0,dn||Wn.ownerDocument==Ne||(Ee(Wn),ar=!ei);Vn=It[zr++];)if(Vn(Wn,dn||Ne,ar)){Hi.push(Wn);break}Zi&&(Fi=Cs)}Vt&&((Wn=!Vn&&Wn)&&Or--,Ni&&lr.push(Wn))}if(Or+=Pr,Vt&&Pr!==Or){for(zr=0;Vn=nt[zr++];)Vn(lr,io,dn,ar);if(Ni){if(0<Or)for(;Pr--;)lr[Pr]||io[Pr]||(io[Pr]=ko.call(Hi));io=pa(io)}Un.apply(Hi,io),Zi&&!Ni&&0<io.length&&1<Or+nt.length&&jn.uniqueSort(Hi)}return Zi&&(Fi=Cs,x=Ss),lr},Vt?bo(ci):ci))).selector=pe}return qi},G=jn.select=function(pe,Fe,Je,It){var nt,Vt,Kt,ci,di,Yi="function"==typeof pe&&pe,qi=!It&&se(pe=Yi.selector||pe);if(Je=Je||[],1===qi.length){if(2<(Vt=qi[0]=qi[0].slice(0)).length&&"ID"===(Kt=Vt[0]).type&&9===Fe.nodeType&&ei&&L.relative[Vt[1].type]){if(!(Fe=(L.find.ID(Kt.matches[0].replace(br,xo),Fe)||[])[0]))return Je;Yi&&(Fe=Fe.parentNode),pe=pe.slice(Vt.shift().value.length)}for(nt=$s.needsContext.test(pe)?0:Vt.length;nt--&&!L.relative[ci=(Kt=Vt[nt]).type];)if((di=L.find[ci])&&(It=di(Kt.matches[0].replace(br,xo),bs.test(Vt[0].type)&&Ts(Fe.parentNode)||Fe))){if(Vt.splice(nt,1),!(pe=It.length&&Es(Vt)))return Un.apply(Je,It),Je;break}}return(Yi||Ve(pe,qi))(It,Fe,!ei,Je,!Fe||bs.test(pe)&&Ts(Fe.parentNode)||Fe),Je},M.sortStable=fn.split("").sort(co).join("")===fn,M.detectDuplicates=!!de,Ee(),M.sortDetached=Dr(function(pe){return 1&pe.compareDocumentPosition(Ne.createElement("fieldset"))}),Dr(function(pe){return pe.innerHTML="<a href='#'></a>","#"===pe.firstChild.getAttribute("href")})||ha("type|href|height|width",function(pe,Fe,Je){if(!Je)return pe.getAttribute(Fe,"type"===Fe.toLowerCase()?1:2)}),M.attributes&&Dr(function(pe){return pe.innerHTML="<input/>",pe.firstChild.setAttribute("value",""),""===pe.firstChild.getAttribute("value")})||ha("value",function(pe,Fe,Je){if(!Je&&"input"===pe.nodeName.toLowerCase())return pe.defaultValue}),Dr(function(pe){return null==pe.getAttribute("disabled")})||ha(uo,function(pe,Fe,Je){var It;if(!Je)return!0===pe[Fe]?Fe.toLowerCase():(It=pe.getAttributeNode(Fe))&&It.specified?It.value:null}),jn}(Ae);C.find=xt,C.expr=xt.selectors,C.expr[":"]=C.expr.pseudos,C.uniqueSort=C.unique=xt.uniqueSort,C.text=xt.getText,C.isXMLDoc=xt.isXML,C.contains=xt.contains,C.escapeSelector=xt.escape;var Wt=function(m,b,M){for(var L=[],q=void 0!==M;(m=m[b])&&9!==m.nodeType;)if(1===m.nodeType){if(q&&C(m).is(M))break;L.push(m)}return L},Nt=function(m,b){for(var M=[];m;m=m.nextSibling)1===m.nodeType&&m!==b&&M.push(m);return M},fi=C.expr.match.needsContext;function $t(m,b){return m.nodeName&&m.nodeName.toLowerCase()===b.toLowerCase()}var li=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function qt(m,b,M){return te(b)?C.grep(m,function(L,q){return!!b.call(L,q,L)!==M}):b.nodeType?C.grep(m,function(L){return L===b!==M}):"string"!=typeof b?C.grep(m,function(L){return-1<N.call(b,L)!==M}):C.filter(b,m,M)}C.filter=function(m,b,M){var L=b[0];return M&&(m=":not("+m+")"),1===b.length&&1===L.nodeType?C.find.matchesSelector(L,m)?[L]:[]:C.find.matches(m,C.grep(b,function(q){return 1===q.nodeType}))},C.fn.extend({find:function(m){var b,M,L=this.length,q=this;if("string"!=typeof m)return this.pushStack(C(m).filter(function(){for(b=0;b<L;b++)if(C.contains(q[b],this))return!0}));for(M=this.pushStack([]),b=0;b<L;b++)C.find(m,q[b],M);return 1<L?C.uniqueSort(M):M},filter:function(m){return this.pushStack(qt(this,m||[],!1))},not:function(m){return this.pushStack(qt(this,m||[],!0))},is:function(m){return!!qt(this,"string"==typeof m&&fi.test(m)?C(m):m||[],!1).length}});var Ri,Bi=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(C.fn.init=function(m,b,M){var L,q;if(!m)return this;if(M=M||Ri,"string"==typeof m){if(!(L="<"===m[0]&&">"===m[m.length-1]&&3<=m.length?[null,m,null]:Bi.exec(m))||!L[1]&&b)return!b||b.jquery?(b||M).find(m):this.constructor(b).find(m);if(L[1]){if(C.merge(this,C.parseHTML(L[1],(b=b instanceof C?b[0]:b)&&b.nodeType?b.ownerDocument||b:Ie,!0)),li.test(L[1])&&C.isPlainObject(b))for(L in b)te(this[L])?this[L](b[L]):this.attr(L,b[L]);return this}return(q=Ie.getElementById(L[2]))&&(this[0]=q,this.length=1),this}return m.nodeType?(this[0]=m,this.length=1,this):te(m)?void 0!==M.ready?M.ready(m):m(C):C.makeArray(m,this)}).prototype=C.fn,Ri=C(Ie);var mi=/^(?:parents|prev(?:Until|All))/,tn={children:!0,contents:!0,next:!0,prev:!0};function Pt(m,b){for(;(m=m[b])&&1!==m.nodeType;);return m}C.fn.extend({has:function(m){var b=C(m,this),M=b.length;return this.filter(function(){for(var L=0;L<M;L++)if(C.contains(this,b[L]))return!0})},closest:function(m,b){var M,L=0,q=this.length,J=[],se="string"!=typeof m&&C(m);if(!fi.test(m))for(;L<q;L++)for(M=this[L];M&&M!==b;M=M.parentNode)if(M.nodeType<11&&(se?-1<se.index(M):1===M.nodeType&&C.find.matchesSelector(M,m))){J.push(M);break}return this.pushStack(1<J.length?C.uniqueSort(J):J)},index:function(m){return m?"string"==typeof m?N.call(C(m),this[0]):N.call(this,m.jquery?m[0]:m):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(m,b){return this.pushStack(C.uniqueSort(C.merge(this.get(),C(m,b))))},addBack:function(m){return this.add(null==m?this.prevObject:this.prevObject.filter(m))}}),C.each({parent:function(m){var b=m.parentNode;return b&&11!==b.nodeType?b:null},parents:function(m){return Wt(m,"parentNode")},parentsUntil:function(m,b,M){return Wt(m,"parentNode",M)},next:function(m){return Pt(m,"nextSibling")},prev:function(m){return Pt(m,"previousSibling")},nextAll:function(m){return Wt(m,"nextSibling")},prevAll:function(m){return Wt(m,"previousSibling")},nextUntil:function(m,b,M){return Wt(m,"nextSibling",M)},prevUntil:function(m,b,M){return Wt(m,"previousSibling",M)},siblings:function(m){return Nt((m.parentNode||{}).firstChild,m)},children:function(m){return Nt(m.firstChild)},contents:function(m){return null!=m.contentDocument&&$(m.contentDocument)?m.contentDocument:($t(m,"template")&&(m=m.content||m),C.merge([],m.childNodes))}},function(m,b){C.fn[m]=function(M,L){var q=C.map(this,b,M);return"Until"!==m.slice(-5)&&(L=M),L&&"string"==typeof L&&(q=C.filter(L,q)),1<this.length&&(tn[m]||C.uniqueSort(q),mi.test(m)&&q.reverse()),this.pushStack(q)}});var wi=/[^\x20\t\r\n\f]+/g;function ji(m){return m}function pt(m){throw m}function Si(m,b,M,L){var q;try{m&&te(q=m.promise)?q.call(m).done(b).fail(M):m&&te(q=m.then)?q.call(m,b,M):b.apply(void 0,[m].slice(L))}catch(J){M.apply(void 0,[J])}}C.Callbacks=function(m){var M;m="string"==typeof m?(M={},C.each(m.match(wi)||[],function(Ee,Ne){M[Ne]=!0}),M):C.extend({},m);var L,q,J,se,Ve=[],G=[],x=-1,B=function(){for(se=se||m.once,J=L=!0;G.length;x=-1)for(q=G.shift();++x<Ve.length;)!1===Ve[x].apply(q[0],q[1])&&m.stopOnFalse&&(x=Ve.length,q=!1);m.memory||(q=!1),L=!1,se&&(Ve=q?[]:"")},de={add:function(){return Ve&&(q&&!L&&(x=Ve.length-1,G.push(q)),function Ee(Ne){C.each(Ne,function(bt,ei){te(ei)?m.unique&&de.has(ei)||Ve.push(ei):ei&&ei.length&&"string"!==ne(ei)&&Ee(ei)})}(arguments),q&&!L&&B()),this},remove:function(){return C.each(arguments,function(Ee,Ne){for(var bt;-1<(bt=C.inArray(Ne,Ve,bt));)Ve.splice(bt,1),bt<=x&&x--}),this},has:function(Ee){return Ee?-1<C.inArray(Ee,Ve):0<Ve.length},empty:function(){return Ve&&(Ve=[]),this},disable:function(){return se=G=[],Ve=q="",this},disabled:function(){return!Ve},lock:function(){return se=G=[],q||L||(Ve=q=""),this},locked:function(){return!!se},fireWith:function(Ee,Ne){return se||(Ne=[Ee,(Ne=Ne||[]).slice?Ne.slice():Ne],G.push(Ne),L||B()),this},fire:function(){return de.fireWith(this,arguments),this},fired:function(){return!!J}};return de},C.extend({Deferred:function(m){var b=[["notify","progress",C.Callbacks("memory"),C.Callbacks("memory"),2],["resolve","done",C.Callbacks("once memory"),C.Callbacks("once memory"),0,"resolved"],["reject","fail",C.Callbacks("once memory"),C.Callbacks("once memory"),1,"rejected"]],M="pending",L={state:function(){return M},always:function(){return q.done(arguments).fail(arguments),this},catch:function(J){return L.then(null,J)},pipe:function(){var J=arguments;return C.Deferred(function(se){C.each(b,function(Ve,G){var x=te(J[G[4]])&&J[G[4]];q[G[1]](function(){var B=x&&x.apply(this,arguments);B&&te(B.promise)?B.promise().progress(se.notify).done(se.resolve).fail(se.reject):se[G[0]+"With"](this,x?[B]:arguments)})}),J=null}).promise()},then:function(J,se,Ve){var G=0;function x(B,de,Ee,Ne){return function(){var bt=this,ei=arguments,Yt=function(){var wn,Pn;if(!(B<G)){if((wn=Ee.apply(bt,ei))===de.promise())throw new TypeError("Thenable self-resolution");te(Pn=wn&&("object"==typeof wn||"function"==typeof wn)&&wn.then)?Ne?Pn.call(wn,x(G,de,ji,Ne),x(G,de,pt,Ne)):(G++,Pn.call(wn,x(G,de,ji,Ne),x(G,de,pt,Ne),x(G,de,ji,de.notifyWith))):(Ee!==ji&&(bt=void 0,ei=[wn]),(Ne||de.resolveWith)(bt,ei))}},hn=Ne?Yt:function(){try{Yt()}catch(wn){C.Deferred.exceptionHook&&C.Deferred.exceptionHook(wn,hn.stackTrace),G<=B+1&&(Ee!==pt&&(bt=void 0,ei=[wn]),de.rejectWith(bt,ei))}};B?hn():(C.Deferred.getStackHook&&(hn.stackTrace=C.Deferred.getStackHook()),Ae.setTimeout(hn))}}return C.Deferred(function(B){b[0][3].add(x(0,B,te(Ve)?Ve:ji,B.notifyWith)),b[1][3].add(x(0,B,te(J)?J:ji)),b[2][3].add(x(0,B,te(se)?se:pt))}).promise()},promise:function(J){return null!=J?C.extend(J,L):L}},q={};return C.each(b,function(J,se){var Ve=se[2],G=se[5];L[se[1]]=Ve.add,G&&Ve.add(function(){M=G},b[3-J][2].disable,b[3-J][3].disable,b[0][2].lock,b[0][3].lock),Ve.add(se[3].fire),q[se[0]]=function(){return q[se[0]+"With"](this===q?void 0:this,arguments),this},q[se[0]+"With"]=Ve.fireWith}),L.promise(q),m&&m.call(q,q),q},when:function(m){var b=arguments.length,M=b,L=Array(M),q=ae.call(arguments),J=C.Deferred(),se=function(Ve){return function(G){L[Ve]=this,q[Ve]=1<arguments.length?ae.call(arguments):G,--b||J.resolveWith(L,q)}};if(b<=1&&(Si(m,J.done(se(M)).resolve,J.reject,!b),"pending"===J.state()||te(q[M]&&q[M].then)))return J.then();for(;M--;)Si(q[M],se(M),J.reject);return J.promise()}});var mn=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;C.Deferred.exceptionHook=function(m,b){Ae.console&&Ae.console.warn&&m&&mn.test(m.name)&&Ae.console.warn("jQuery.Deferred exception: "+m.message,m.stack,b)},C.readyException=function(m){Ae.setTimeout(function(){throw m})};var Bn=C.Deferred();function yn(){Ie.removeEventListener("DOMContentLoaded",yn),Ae.removeEventListener("load",yn),C.ready()}C.fn.ready=function(m){return Bn.then(m).catch(function(b){C.readyException(b)}),this},C.extend({isReady:!1,readyWait:1,ready:function(m){(!0===m?--C.readyWait:C.isReady)||(C.isReady=!0)!==m&&0<--C.readyWait||Bn.resolveWith(Ie,[C])}}),C.ready.then=Bn.then,"complete"===Ie.readyState||"loading"!==Ie.readyState&&!Ie.documentElement.doScroll?Ae.setTimeout(C.ready):(Ie.addEventListener("DOMContentLoaded",yn),Ae.addEventListener("load",yn));var En=function(m,b,M,L,q,J,se){var Ve=0,G=m.length,x=null==M;if("object"===ne(M))for(Ve in q=!0,M)En(m,b,Ve,M[Ve],!0,J,se);else if(void 0!==L&&(q=!0,te(L)||(se=!0),x&&(se?(b.call(m,L),b=null):(x=b,b=function(B,de,Ee){return x.call(C(B),Ee)})),b))for(;Ve<G;Ve++)b(m[Ve],M,se?L:L.call(m[Ve],Ve,b(m[Ve],M)));return q?m:x?b.call(m):G?b(m[0],M):J},Jn=/^-ms-/,vn=/-([a-z])/g;function Fn(m,b){return b.toUpperCase()}function Ji(m){return m.replace(Jn,"ms-").replace(vn,Fn)}var Nn=function(m){return 1===m.nodeType||9===m.nodeType||!+m.nodeType};function Xi(){this.expando=C.expando+Xi.uid++}Xi.uid=1,Xi.prototype={cache:function(m){var b=m[this.expando];return b||(b={},Nn(m)&&(m.nodeType?m[this.expando]=b:Object.defineProperty(m,this.expando,{value:b,configurable:!0}))),b},set:function(m,b,M){var L,q=this.cache(m);if("string"==typeof b)q[Ji(b)]=M;else for(L in b)q[Ji(L)]=b[L];return q},get:function(m,b){return void 0===b?this.cache(m):m[this.expando]&&m[this.expando][Ji(b)]},access:function(m,b,M){return void 0===b||b&&"string"==typeof b&&void 0===M?this.get(m,b):(this.set(m,b,M),void 0!==M?M:b)},remove:function(m,b){var M,L=m[this.expando];if(void 0!==L){if(void 0!==b)for((M=(b=Array.isArray(b)?b.map(Ji):(b=Ji(b))in L?[b]:b.match(wi)||[]).length);M--;)delete L[b[M]];(void 0===b||C.isEmptyObject(L))&&(m.nodeType?m[this.expando]=void 0:delete m[this.expando])}},hasData:function(m){var b=m[this.expando];return void 0!==b&&!C.isEmptyObject(b)}};var gi=new Xi,Ai=new Xi,lt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Y=/[A-Z]/g;function ue(m,b,M){var L,q;if(void 0===M&&1===m.nodeType)if(L="data-"+b.replace(Y,"-$&").toLowerCase(),"string"==typeof(M=m.getAttribute(L))){try{M="true"===(q=M)||"false"!==q&&("null"===q?null:q===+q+""?+q:lt.test(q)?JSON.parse(q):q)}catch{}Ai.set(m,b,M)}else M=void 0;return M}C.extend({hasData:function(m){return Ai.hasData(m)||gi.hasData(m)},data:function(m,b,M){return Ai.access(m,b,M)},removeData:function(m,b){Ai.remove(m,b)},_data:function(m,b,M){return gi.access(m,b,M)},_removeData:function(m,b){gi.remove(m,b)}}),C.fn.extend({data:function(m,b){var M,L,q,J=this[0],se=J&&J.attributes;if(void 0===m){if(this.length&&(q=Ai.get(J),1===J.nodeType&&!gi.get(J,"hasDataAttrs"))){for(M=se.length;M--;)se[M]&&0===(L=se[M].name).indexOf("data-")&&(L=Ji(L.slice(5)),ue(J,L,q[L]));gi.set(J,"hasDataAttrs",!0)}return q}return"object"==typeof m?this.each(function(){Ai.set(this,m)}):En(this,function(Ve){var G;if(J&&void 0===Ve)return void 0!==(G=Ai.get(J,m))||void 0!==(G=ue(J,m))?G:void 0;this.each(function(){Ai.set(this,m,Ve)})},null,b,1<arguments.length,null,!0)},removeData:function(m){return this.each(function(){Ai.remove(this,m)})}}),C.extend({queue:function(m,b,M){var L;if(m)return L=gi.get(m,b=(b||"fx")+"queue"),M&&(!L||Array.isArray(M)?L=gi.access(m,b,C.makeArray(M)):L.push(M)),L||[]},dequeue:function(m,b){var M=C.queue(m,b=b||"fx"),L=M.length,q=M.shift(),J=C._queueHooks(m,b);"inprogress"===q&&(q=M.shift(),L--),q&&("fx"===b&&M.unshift("inprogress"),delete J.stop,q.call(m,function(){C.dequeue(m,b)},J)),!L&&J&&J.empty.fire()},_queueHooks:function(m,b){var M=b+"queueHooks";return gi.get(m,M)||gi.access(m,M,{empty:C.Callbacks("once memory").add(function(){gi.remove(m,[b+"queue",M])})})}}),C.fn.extend({queue:function(m,b){var M=2;return"string"!=typeof m&&(b=m,m="fx",M--),arguments.length<M?C.queue(this[0],m):void 0===b?this:this.each(function(){var L=C.queue(this,m,b);C._queueHooks(this,m),"fx"===m&&"inprogress"!==L[0]&&C.dequeue(this,m)})},dequeue:function(m){return this.each(function(){C.dequeue(this,m)})},clearQueue:function(m){return this.queue(m||"fx",[])},promise:function(m,b){var M,L=1,q=C.Deferred(),J=this,se=this.length,Ve=function(){--L||q.resolveWith(J,[J])};for("string"!=typeof m&&(b=m,m=void 0),m=m||"fx";se--;)(M=gi.get(J[se],m+"queueHooks"))&&M.empty&&(L++,M.empty.add(Ve));return Ve(),q.promise(b)}});var oe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,$e=new RegExp("^(?:([+-])=|)("+oe+")([a-z%]*)$","i"),Ge=["Top","Right","Bottom","Left"],ot=Ie.documentElement,Rt=function(m){return C.contains(m.ownerDocument,m)},Mt={composed:!0};ot.getRootNode&&(Rt=function(m){return C.contains(m.ownerDocument,m)||m.getRootNode(Mt)===m.ownerDocument});var jt=function(m,b){return"none"===(m=b||m).style.display||""===m.style.display&&Rt(m)&&"none"===C.css(m,"display")};function Lt(m,b,M,L){var q,J,se=20,Ve=L?function(){return L.cur()}:function(){return C.css(m,b,"")},G=Ve(),x=M&&M[3]||(C.cssNumber[b]?"":"px"),B=m.nodeType&&(C.cssNumber[b]||"px"!==x&&+G)&&$e.exec(C.css(m,b));if(B&&B[3]!==x){for(x=x||B[3],B=+(G/=2)||1;se--;)C.style(m,b,B+x),(1-J)*(1-(J=Ve()/G||.5))<=0&&(se=0),B/=J;C.style(m,b,(B*=2)+x),M=M||[]}return M&&(B=+B||+G||0,q=M[1]?B+(M[1]+1)*M[2]:+M[2],L&&(L.unit=x,L.start=B,L.end=q)),q}var yi={};function ve(m,b){for(var M,L,q,J,se,Ve,G,x=[],B=0,de=m.length;B<de;B++)(L=m[B]).style&&(M=L.style.display,b?("none"===M&&(x[B]=gi.get(L,"display")||null,x[B]||(L.style.display="")),""===L.style.display&&jt(L)&&(x[B]=(G=se=J=void 0,se=(q=L).ownerDocument,(G=yi[Ve=q.nodeName])||(J=se.body.appendChild(se.createElement(Ve)),G=C.css(J,"display"),J.parentNode.removeChild(J),"none"===G&&(G="block"),yi[Ve]=G)))):"none"!==M&&(x[B]="none",gi.set(L,"display",M)));for(B=0;B<de;B++)null!=x[B]&&(m[B].style.display=x[B]);return m}C.fn.extend({show:function(){return ve(this,!0)},hide:function(){return ve(this)},toggle:function(m){return"boolean"==typeof m?m?this.show():this.hide():this.each(function(){jt(this)?C(this).show():C(this).hide()})}});var Ce,We,vt=/^(?:checkbox|radio)$/i,Bt=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Xt=/^$|^module$|\/(?:java|ecma)script/i;Ce=Ie.createDocumentFragment().appendChild(Ie.createElement("div")),(We=Ie.createElement("input")).setAttribute("type","radio"),We.setAttribute("checked","checked"),We.setAttribute("name","t"),Ce.appendChild(We),le.checkClone=Ce.cloneNode(!0).cloneNode(!0).lastChild.checked,Ce.innerHTML="<textarea>x</textarea>",le.noCloneChecked=!!Ce.cloneNode(!0).lastChild.defaultValue,Ce.innerHTML="<option></option>",le.option=!!Ce.lastChild;var si={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function W(m,b){var M;return M=typeof m.getElementsByTagName<"u"?m.getElementsByTagName(b||"*"):typeof m.querySelectorAll<"u"?m.querySelectorAll(b||"*"):[],void 0===b||b&&$t(m,b)?C.merge([m],M):M}function ye(m,b){for(var M=0,L=m.length;M<L;M++)gi.set(m[M],"globalEval",!b||gi.get(b[M],"globalEval"))}si.tbody=si.tfoot=si.colgroup=si.caption=si.thead,si.th=si.td,le.option||(si.optgroup=si.option=[1,"<select multiple='multiple'>","</select>"]);var Me=/<|&#?\w+;/;function qe(m,b,M,L,q){for(var J,se,Ve,G,x,B,de=b.createDocumentFragment(),Ee=[],Ne=0,bt=m.length;Ne<bt;Ne++)if((J=m[Ne])||0===J)if("object"===ne(J))C.merge(Ee,J.nodeType?[J]:J);else if(Me.test(J)){for(se=se||de.appendChild(b.createElement("div")),Ve=(Bt.exec(J)||["",""])[1].toLowerCase(),se.innerHTML=(G=si[Ve]||si._default)[1]+C.htmlPrefilter(J)+G[2],B=G[0];B--;)se=se.lastChild;C.merge(Ee,se.childNodes),(se=de.firstChild).textContent=""}else Ee.push(b.createTextNode(J));for(de.textContent="",Ne=0;J=Ee[Ne++];)if(L&&-1<C.inArray(J,L))q&&q.push(J);else if(x=Rt(J),se=W(de.appendChild(J),"script"),x&&ye(se),M)for(B=0;J=se[B++];)Xt.test(J.type||"")&&M.push(J);return de}var gt=/^([^.]*)(?:\.(.+)|)/;function _t(){return!0}function ft(){return!1}function Ut(m,b){return m===function(){try{return Ie.activeElement}catch{}}()==("focus"===b)}function ti(m,b,M,L,q,J){var se,Ve;if("object"==typeof b){for(Ve in"string"!=typeof M&&(L=L||M,M=void 0),b)ti(m,Ve,M,L,b[Ve],J);return m}if(null==L&&null==q?(q=M,L=M=void 0):null==q&&("string"==typeof M?(q=L,L=void 0):(q=L,L=M,M=void 0)),!1===q)q=ft;else if(!q)return m;return 1===J&&(se=q,(q=function(G){return C().off(G),se.apply(this,arguments)}).guid=se.guid||(se.guid=C.guid++)),m.each(function(){C.event.add(this,b,q,L,M)})}function Ci(m,b,M){M?(gi.set(m,b,!1),C.event.add(m,b,{namespace:!1,handler:function(L){var q,J,se=gi.get(this,b);if(1&L.isTrigger&&this[b]){if(se.length)(C.event.special[b]||{}).delegateType&&L.stopPropagation();else if(se=ae.call(arguments),gi.set(this,b,se),q=M(this,b),this[b](),se!==(J=gi.get(this,b))||q?gi.set(this,b,!1):J={},se!==J)return L.stopImmediatePropagation(),L.preventDefault(),J&&J.value}else se.length&&(gi.set(this,b,{value:C.event.trigger(C.extend(se[0],C.Event.prototype),se.slice(1),this)}),L.stopImmediatePropagation())}})):void 0===gi.get(m,b)&&C.event.add(m,b,_t)}C.event={global:{},add:function(m,b,M,L,q){var J,se,Ve,G,x,B,de,Ee,Ne,bt,ei,Yt=gi.get(m);if(Nn(m))for(M.handler&&(M=(J=M).handler,q=J.selector),q&&C.find.matchesSelector(ot,q),M.guid||(M.guid=C.guid++),(G=Yt.events)||(G=Yt.events=Object.create(null)),(se=Yt.handle)||(se=Yt.handle=function(hn){return typeof C<"u"&&C.event.triggered!==hn.type?C.event.dispatch.apply(m,arguments):void 0}),x=(b=(b||"").match(wi)||[""]).length;x--;)Ne=ei=(Ve=gt.exec(b[x])||[])[1],bt=(Ve[2]||"").split(".").sort(),Ne&&(de=C.event.special[Ne]||{},de=C.event.special[Ne=(q?de.delegateType:de.bindType)||Ne]||{},B=C.extend({type:Ne,origType:ei,data:L,handler:M,guid:M.guid,selector:q,needsContext:q&&C.expr.match.needsContext.test(q),namespace:bt.join(".")},J),(Ee=G[Ne])||((Ee=G[Ne]=[]).delegateCount=0,de.setup&&!1!==de.setup.call(m,L,bt,se)||m.addEventListener&&m.addEventListener(Ne,se)),de.add&&(de.add.call(m,B),B.handler.guid||(B.handler.guid=M.guid)),q?Ee.splice(Ee.delegateCount++,0,B):Ee.push(B),C.event.global[Ne]=!0)},remove:function(m,b,M,L,q){var J,se,Ve,G,x,B,de,Ee,Ne,bt,ei,Yt=gi.hasData(m)&&gi.get(m);if(Yt&&(G=Yt.events)){for(x=(b=(b||"").match(wi)||[""]).length;x--;)if(Ne=ei=(Ve=gt.exec(b[x])||[])[1],bt=(Ve[2]||"").split(".").sort(),Ne){for(de=C.event.special[Ne]||{},Ee=G[Ne=(L?de.delegateType:de.bindType)||Ne]||[],Ve=Ve[2]&&new RegExp("(^|\\.)"+bt.join("\\.(?:.*\\.|)")+"(\\.|$)"),se=J=Ee.length;J--;)B=Ee[J],!q&&ei!==B.origType||M&&M.guid!==B.guid||Ve&&!Ve.test(B.namespace)||L&&L!==B.selector&&("**"!==L||!B.selector)||(Ee.splice(J,1),B.selector&&Ee.delegateCount--,de.remove&&de.remove.call(m,B));se&&!Ee.length&&(de.teardown&&!1!==de.teardown.call(m,bt,Yt.handle)||C.removeEvent(m,Ne,Yt.handle),delete G[Ne])}else for(Ne in G)C.event.remove(m,Ne+b[x],M,L,!0);C.isEmptyObject(G)&&gi.remove(m,"handle events")}},dispatch:function(m){var b,M,L,q,J,se,Ve=new Array(arguments.length),G=C.event.fix(m),x=(gi.get(this,"events")||Object.create(null))[G.type]||[],B=C.event.special[G.type]||{};for(Ve[0]=G,b=1;b<arguments.length;b++)Ve[b]=arguments[b];if(G.delegateTarget=this,!B.preDispatch||!1!==B.preDispatch.call(this,G)){for(se=C.event.handlers.call(this,G,x),b=0;(q=se[b++])&&!G.isPropagationStopped();)for(G.currentTarget=q.elem,M=0;(J=q.handlers[M++])&&!G.isImmediatePropagationStopped();)G.rnamespace&&!1!==J.namespace&&!G.rnamespace.test(J.namespace)||(G.handleObj=J,G.data=J.data,void 0!==(L=((C.event.special[J.origType]||{}).handle||J.handler).apply(q.elem,Ve))&&!1===(G.result=L)&&(G.preventDefault(),G.stopPropagation()));return B.postDispatch&&B.postDispatch.call(this,G),G.result}},handlers:function(m,b){var M,L,q,J,se,Ve=[],G=b.delegateCount,x=m.target;if(G&&x.nodeType&&!("click"===m.type&&1<=m.button))for(;x!==this;x=x.parentNode||this)if(1===x.nodeType&&("click"!==m.type||!0!==x.disabled)){for(J=[],se={},M=0;M<G;M++)void 0===se[q=(L=b[M]).selector+" "]&&(se[q]=L.needsContext?-1<C(q,this).index(x):C.find(q,this,null,[x]).length),se[q]&&J.push(L);J.length&&Ve.push({elem:x,handlers:J})}return x=this,G<b.length&&Ve.push({elem:x,handlers:b.slice(G)}),Ve},addProp:function(m,b){Object.defineProperty(C.Event.prototype,m,{enumerable:!0,configurable:!0,get:te(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[m]},set:function(M){Object.defineProperty(this,m,{enumerable:!0,configurable:!0,writable:!0,value:M})}})},fix:function(m){return m[C.expando]?m:new C.Event(m)},special:{load:{noBubble:!0},click:{setup:function(m){var b=this||m;return vt.test(b.type)&&b.click&&$t(b,"input")&&Ci(b,"click",_t),!1},trigger:function(m){var b=this||m;return vt.test(b.type)&&b.click&&$t(b,"input")&&Ci(b,"click"),!0},_default:function(m){var b=m.target;return vt.test(b.type)&&b.click&&$t(b,"input")&&gi.get(b,"click")||$t(b,"a")}},beforeunload:{postDispatch:function(m){void 0!==m.result&&m.originalEvent&&(m.originalEvent.returnValue=m.result)}}}},C.removeEvent=function(m,b,M){m.removeEventListener&&m.removeEventListener(b,M)},C.Event=function(m,b){if(!(this instanceof C.Event))return new C.Event(m,b);m&&m.type?(this.originalEvent=m,this.type=m.type,this.isDefaultPrevented=m.defaultPrevented||void 0===m.defaultPrevented&&!1===m.returnValue?_t:ft,this.target=m.target&&3===m.target.nodeType?m.target.parentNode:m.target,this.currentTarget=m.currentTarget,this.relatedTarget=m.relatedTarget):this.type=m,b&&C.extend(this,b),this.timeStamp=m&&m.timeStamp||Date.now(),this[C.expando]=!0},C.Event.prototype={constructor:C.Event,isDefaultPrevented:ft,isPropagationStopped:ft,isImmediatePropagationStopped:ft,isSimulated:!1,preventDefault:function(){var m=this.originalEvent;this.isDefaultPrevented=_t,m&&!this.isSimulated&&m.preventDefault()},stopPropagation:function(){var m=this.originalEvent;this.isPropagationStopped=_t,m&&!this.isSimulated&&m.stopPropagation()},stopImmediatePropagation:function(){var m=this.originalEvent;this.isImmediatePropagationStopped=_t,m&&!this.isSimulated&&m.stopImmediatePropagation(),this.stopPropagation()}},C.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},C.event.addProp),C.each({focus:"focusin",blur:"focusout"},function(m,b){C.event.special[m]={setup:function(){return Ci(this,m,Ut),!1},trigger:function(){return Ci(this,m),!0},_default:function(M){return gi.get(M.target,m)},delegateType:b}}),C.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(m,b){C.event.special[m]={delegateType:b,bindType:b,handle:function(M){var L,q=M.relatedTarget,J=M.handleObj;return q&&(q===this||C.contains(this,q))||(M.type=J.origType,L=J.handler.apply(this,arguments),M.type=b),L}}}),C.fn.extend({on:function(m,b,M,L){return ti(this,m,b,M,L)},one:function(m,b,M,L){return ti(this,m,b,M,L,1)},off:function(m,b,M){var L,q;if(m&&m.preventDefault&&m.handleObj)return L=m.handleObj,C(m.delegateTarget).off(L.namespace?L.origType+"."+L.namespace:L.origType,L.selector,L.handler),this;if("object"==typeof m){for(q in m)this.off(q,b,m[q]);return this}return!1!==b&&"function"!=typeof b||(M=b,b=void 0),!1===M&&(M=ft),this.each(function(){C.event.remove(this,m,M,b)})}});var xi=/<script|<style|<link/i,pi=/checked\s*(?:[^=]|=\s*.checked.)/i,Ii=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Gi(m,b){return $t(m,"table")&&$t(11!==b.nodeType?b:b.firstChild,"tr")&&C(m).children("tbody")[0]||m}function re(m){return m.type=(null!==m.getAttribute("type"))+"/"+m.type,m}function U(m){return"true/"===(m.type||"").slice(0,5)?m.type=m.type.slice(5):m.removeAttribute("type"),m}function Z(m,b){var M,L,q,J,se,Ve;if(1===b.nodeType){if(gi.hasData(m)&&(Ve=gi.get(m).events))for(q in gi.remove(b,"handle events"),Ve)for(M=0,L=Ve[q].length;M<L;M++)C.event.add(b,q,Ve[q][M]);Ai.hasData(m)&&(J=Ai.access(m),se=C.extend({},J),Ai.set(b,se))}}function me(m,b,M,L){b=o(b);var q,J,se,Ve,G,x,B=0,de=m.length,Ee=de-1,Ne=b[0],bt=te(Ne);if(bt||1<de&&"string"==typeof Ne&&!le.checkClone&&pi.test(Ne))return m.each(function(ei){var Yt=m.eq(ei);bt&&(b[0]=Ne.call(this,ei,Yt.html())),me(Yt,b,M,L)});if(de&&(J=(q=qe(b,m[0].ownerDocument,!1,m,L)).firstChild,1===q.childNodes.length&&(q=J),J||L)){for(Ve=(se=C.map(W(q,"script"),re)).length;B<de;B++)G=q,B!==Ee&&(G=C.clone(G,!0,!0),Ve&&C.merge(se,W(G,"script"))),M.call(m[B],G,B);if(Ve)for(x=se[se.length-1].ownerDocument,C.map(se,U),B=0;B<Ve;B++)Xt.test((G=se[B]).type||"")&&!gi.access(G,"globalEval")&&C.contains(x,G)&&(G.src&&"module"!==(G.type||"").toLowerCase()?C._evalUrl&&!G.noModule&&C._evalUrl(G.src,{nonce:G.nonce||G.getAttribute("nonce")},x):Ke(G.textContent.replace(Ii,""),G,x))}return m}function xe(m,b,M){for(var L,q=b?C.filter(b,m):m,J=0;null!=(L=q[J]);J++)M||1!==L.nodeType||C.cleanData(W(L)),L.parentNode&&(M&&Rt(L)&&ye(W(L,"script")),L.parentNode.removeChild(L));return m}C.extend({htmlPrefilter:function(m){return m},clone:function(m,b,M){var L,q,J,se,Ve,G,x,B=m.cloneNode(!0),de=Rt(m);if(!(le.noCloneChecked||1!==m.nodeType&&11!==m.nodeType||C.isXMLDoc(m)))for(se=W(B),L=0,q=(J=W(m)).length;L<q;L++)Ve=J[L],"input"===(x=(G=se[L]).nodeName.toLowerCase())&&vt.test(Ve.type)?G.checked=Ve.checked:"input"!==x&&"textarea"!==x||(G.defaultValue=Ve.defaultValue);if(b)if(M)for(J=J||W(m),se=se||W(B),L=0,q=J.length;L<q;L++)Z(J[L],se[L]);else Z(m,B);return 0<(se=W(B,"script")).length&&ye(se,!de&&W(m,"script")),B},cleanData:function(m){for(var b,M,L,q=C.event.special,J=0;void 0!==(M=m[J]);J++)if(Nn(M)){if(b=M[gi.expando]){if(b.events)for(L in b.events)q[L]?C.event.remove(M,L):C.removeEvent(M,L,b.handle);M[gi.expando]=void 0}M[Ai.expando]&&(M[Ai.expando]=void 0)}}}),C.fn.extend({detach:function(m){return xe(this,m,!0)},remove:function(m){return xe(this,m)},text:function(m){return En(this,function(b){return void 0===b?C.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=b)})},null,m,arguments.length)},append:function(){return me(this,arguments,function(m){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Gi(this,m).appendChild(m)})},prepend:function(){return me(this,arguments,function(m){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Gi(this,m);b.insertBefore(m,b.firstChild)}})},before:function(){return me(this,arguments,function(m){this.parentNode&&this.parentNode.insertBefore(m,this)})},after:function(){return me(this,arguments,function(m){this.parentNode&&this.parentNode.insertBefore(m,this.nextSibling)})},empty:function(){for(var m,b=0;null!=(m=this[b]);b++)1===m.nodeType&&(C.cleanData(W(m,!1)),m.textContent="");return this},clone:function(m,b){return m=null!=m&&m,b=b??m,this.map(function(){return C.clone(this,m,b)})},html:function(m){return En(this,function(b){var M=this[0]||{},L=0,q=this.length;if(void 0===b&&1===M.nodeType)return M.innerHTML;if("string"==typeof b&&!xi.test(b)&&!si[(Bt.exec(b)||["",""])[1].toLowerCase()]){b=C.htmlPrefilter(b);try{for(;L<q;L++)1===(M=this[L]||{}).nodeType&&(C.cleanData(W(M,!1)),M.innerHTML=b);M=0}catch{}}M&&this.empty().append(b)},null,m,arguments.length)},replaceWith:function(){var m=[];return me(this,arguments,function(b){var M=this.parentNode;C.inArray(this,m)<0&&(C.cleanData(W(this)),M&&M.replaceChild(b,this))},m)}}),C.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(m,b){C.fn[m]=function(M){for(var L,q=[],J=C(M),se=J.length-1,Ve=0;Ve<=se;Ve++)L=Ve===se?this:this.clone(!0),C(J[Ve])[b](L),D.apply(q,L.get());return this.pushStack(q)}});var De=new RegExp("^("+oe+")(?!px)[a-z%]+$","i"),Xe=/^--/,He=function(m){var b=m.ownerDocument.defaultView;return b&&b.opener||(b=Ae),b.getComputedStyle(m)},je=function(m,b,M){var L,q,J={};for(q in b)J[q]=m.style[q],m.style[q]=b[q];for(q in L=M.call(m),b)m.style[q]=J[q];return L},et=new RegExp(Ge.join("|"),"i"),St="[\\x20\\t\\r\\n\\f]",oi=new RegExp("^"+St+"+|((?:^|[^\\\\])(?:\\\\.)*)"+St+"+$","g");function kt(m,b,M){var L,q,J,se,Ve=Xe.test(b),G=m.style;return(M=M||He(m))&&(se=M.getPropertyValue(b)||M[b],Ve&&se&&(se=se.replace(oi,"$1")||void 0),""!==se||Rt(m)||(se=C.style(m,b)),!le.pixelBoxStyles()&&De.test(se)&&et.test(b)&&(L=G.width,q=G.minWidth,J=G.maxWidth,G.minWidth=G.maxWidth=G.width=se,se=M.width,G.width=L,G.minWidth=q,G.maxWidth=J)),void 0!==se?se+"":se}function Mi(m,b){return{get:function(){if(!m())return(this.get=b).apply(this,arguments);delete this.get}}}!function(){function m(){if(x){G.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",x.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ot.appendChild(G).appendChild(x);var B=Ae.getComputedStyle(x);M="1%"!==B.top,Ve=12===b(B.marginLeft),x.style.right="60%",J=36===b(B.right),L=36===b(B.width),x.style.position="absolute",q=12===b(x.offsetWidth/3),ot.removeChild(G),x=null}}function b(B){return Math.round(parseFloat(B))}var M,L,q,J,se,Ve,G=Ie.createElement("div"),x=Ie.createElement("div");x.style&&(x.style.backgroundClip="content-box",x.cloneNode(!0).style.backgroundClip="",le.clearCloneStyle="content-box"===x.style.backgroundClip,C.extend(le,{boxSizingReliable:function(){return m(),L},pixelBoxStyles:function(){return m(),J},pixelPosition:function(){return m(),M},reliableMarginLeft:function(){return m(),Ve},scrollboxSize:function(){return m(),q},reliableTrDimensions:function(){var B,de,Ee,Ne;return null==se&&(B=Ie.createElement("table"),de=Ie.createElement("tr"),Ee=Ie.createElement("div"),B.style.cssText="position:absolute;left:-11111px;border-collapse:separate",de.style.cssText="border:1px solid",de.style.height="1px",Ee.style.height="9px",Ee.style.display="block",ot.appendChild(B).appendChild(de).appendChild(Ee),Ne=Ae.getComputedStyle(de),se=parseInt(Ne.height,10)+parseInt(Ne.borderTopWidth,10)+parseInt(Ne.borderBottomWidth,10)===de.offsetHeight,ot.removeChild(B)),se}}))}();var Ti=["Webkit","Moz","ms"],bi=Ie.createElement("div").style,Di={};function Qi(m){return C.cssProps[m]||Di[m]||(m in bi?m:Di[m]=function(M){for(var L=M[0].toUpperCase()+M.slice(1),q=Ti.length;q--;)if((M=Ti[q]+L)in bi)return M}(m)||m)}var gn=/^(none|table(?!-c[ea]).+)/,Pi={position:"absolute",visibility:"hidden",display:"block"},xn={letterSpacing:"0",fontWeight:"400"};function bn(m,b,M){var L=$e.exec(b);return L?Math.max(0,L[2]-(M||0))+(L[3]||"px"):b}function Yr(m,b,M,L,q,J){var se="width"===b?1:0,Ve=0,G=0;if(M===(L?"border":"content"))return 0;for(;se<4;se+=2)"margin"===M&&(G+=C.css(m,M+Ge[se],!0,q)),L?("content"===M&&(G-=C.css(m,"padding"+Ge[se],!0,q)),"margin"!==M&&(G-=C.css(m,"border"+Ge[se]+"Width",!0,q))):(G+=C.css(m,"padding"+Ge[se],!0,q),"padding"!==M?G+=C.css(m,"border"+Ge[se]+"Width",!0,q):Ve+=C.css(m,"border"+Ge[se]+"Width",!0,q));return!L&&0<=J&&(G+=Math.max(0,Math.ceil(m["offset"+b[0].toUpperCase()+b.slice(1)]-J-G-Ve-.5))||0),G}function Kr(m,b,M){var L=He(m),q=(!le.boxSizingReliable()||M)&&"border-box"===C.css(m,"boxSizing",!1,L),J=q,se=kt(m,b,L),Ve="offset"+b[0].toUpperCase()+b.slice(1);if(De.test(se)){if(!M)return se;se="auto"}return(!le.boxSizingReliable()&&q||!le.reliableTrDimensions()&&$t(m,"tr")||"auto"===se||!parseFloat(se)&&"inline"===C.css(m,"display",!1,L))&&m.getClientRects().length&&(q="border-box"===C.css(m,"boxSizing",!1,L),(J=Ve in m)&&(se=m[Ve])),(se=parseFloat(se)||0)+Yr(m,b,M||(q?"border":"content"),J,L,se)+"px"}function ct(m,b,M,L,q){return new ct.prototype.init(m,b,M,L,q)}C.extend({cssHooks:{opacity:{get:function(m,b){if(b){var M=kt(m,"opacity");return""===M?"1":M}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(m,b,M,L){if(m&&3!==m.nodeType&&8!==m.nodeType&&m.style){var q,J,se,Ve=Ji(b),G=Xe.test(b),x=m.style;if(G||(b=Qi(Ve)),se=C.cssHooks[b]||C.cssHooks[Ve],void 0===M)return se&&"get"in se&&void 0!==(q=se.get(m,!1,L))?q:x[b];"string"==(J=typeof M)&&(q=$e.exec(M))&&q[1]&&(M=Lt(m,b,q),J="number"),null!=M&&M==M&&("number"!==J||G||(M+=q&&q[3]||(C.cssNumber[Ve]?"":"px")),le.clearCloneStyle||""!==M||0!==b.indexOf("background")||(x[b]="inherit"),se&&"set"in se&&void 0===(M=se.set(m,M,L))||(G?x.setProperty(b,M):x[b]=M))}},css:function(m,b,M,L){var q,J,se,Ve=Ji(b);return Xe.test(b)||(b=Qi(Ve)),(se=C.cssHooks[b]||C.cssHooks[Ve])&&"get"in se&&(q=se.get(m,!0,M)),void 0===q&&(q=kt(m,b,L)),"normal"===q&&b in xn&&(q=xn[b]),""===M||M?(J=parseFloat(q),!0===M||isFinite(J)?J||0:q):q}}),C.each(["height","width"],function(m,b){C.cssHooks[b]={get:function(M,L,q){if(L)return!gn.test(C.css(M,"display"))||M.getClientRects().length&&M.getBoundingClientRect().width?Kr(M,b,q):je(M,Pi,function(){return Kr(M,b,q)})},set:function(M,L,q){var J,se=He(M),Ve=!le.scrollboxSize()&&"absolute"===se.position,G=(Ve||q)&&"border-box"===C.css(M,"boxSizing",!1,se),x=q?Yr(M,b,q,G,se):0;return G&&Ve&&(x-=Math.ceil(M["offset"+b[0].toUpperCase()+b.slice(1)]-parseFloat(se[b])-Yr(M,b,"border",!1,se)-.5)),x&&(J=$e.exec(L))&&"px"!==(J[3]||"px")&&(M.style[b]=L,L=C.css(M,b)),bn(0,L,x)}}}),C.cssHooks.marginLeft=Mi(le.reliableMarginLeft,function(m,b){if(b)return(parseFloat(kt(m,"marginLeft"))||m.getBoundingClientRect().left-je(m,{marginLeft:0},function(){return m.getBoundingClientRect().left}))+"px"}),C.each({margin:"",padding:"",border:"Width"},function(m,b){C.cssHooks[m+b]={expand:function(M){for(var L=0,q={},J="string"==typeof M?M.split(" "):[M];L<4;L++)q[m+Ge[L]+b]=J[L]||J[L-2]||J[0];return q}},"margin"!==m&&(C.cssHooks[m+b].set=bn)}),C.fn.extend({css:function(m,b){return En(this,function(M,L,q){var J,se,Ve={},G=0;if(Array.isArray(L)){for(J=He(M),se=L.length;G<se;G++)Ve[L[G]]=C.css(M,L[G],!1,J);return Ve}return void 0!==q?C.style(M,L,q):C.css(M,L)},m,b,1<arguments.length)}}),((C.Tween=ct).prototype={constructor:ct,init:function(m,b,M,L,q,J){this.elem=m,this.prop=M,this.easing=q||C.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=L,this.unit=J||(C.cssNumber[M]?"":"px")},cur:function(){var m=ct.propHooks[this.prop];return m&&m.get?m.get(this):ct.propHooks._default.get(this)},run:function(m){var b,M=ct.propHooks[this.prop];return this.pos=b=this.options.duration?C.easing[this.easing](m,this.options.duration*m,0,1,this.options.duration):m,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),M&&M.set?M.set(this):ct.propHooks._default.set(this),this}}).init.prototype=ct.prototype,(ct.propHooks={_default:{get:function(m){var b;return 1!==m.elem.nodeType||null!=m.elem[m.prop]&&null==m.elem.style[m.prop]?m.elem[m.prop]:(b=C.css(m.elem,m.prop,""))&&"auto"!==b?b:0},set:function(m){C.fx.step[m.prop]?C.fx.step[m.prop](m):1!==m.elem.nodeType||!C.cssHooks[m.prop]&&null==m.elem.style[Qi(m.prop)]?m.elem[m.prop]=m.now:C.style(m.elem,m.prop,m.now+m.unit)}}}).scrollTop=ct.propHooks.scrollLeft={set:function(m){m.elem.nodeType&&m.elem.parentNode&&(m.elem[m.prop]=m.now)}},C.easing={linear:function(m){return m},swing:function(m){return.5-Math.cos(m*Math.PI)/2},_default:"swing"},C.fx=ct.prototype.init,C.fx.step={};var _r,Hn,Lr,_o,Jr=/^(?:toggle|show|hide)$/,Oo=/queueHooks$/;function rs(){Hn&&(!1===Ie.hidden&&Ae.requestAnimationFrame?Ae.requestAnimationFrame(rs):Ae.setTimeout(rs,C.fx.interval),C.fx.tick())}function Eo(){return Ae.setTimeout(function(){_r=void 0}),_r=Date.now()}function Jt(m,b){var M,L=0,q={height:m};for(b=b?1:0;L<4;L+=2-b)q["margin"+(M=Ge[L])]=q["padding"+M]=m;return b&&(q.opacity=q.width=m),q}function nn(m,b,M){for(var L,q=(Vi.tweeners[b]||[]).concat(Vi.tweeners["*"]),J=0,se=q.length;J<se;J++)if(L=q[J].call(M,b,m))return L}function Vi(m,b,M){var L,q,J=0,se=Vi.prefilters.length,Ve=C.Deferred().always(function(){delete G.elem}),G=function(){if(q)return!1;for(var de=_r||Eo(),Ee=Math.max(0,x.startTime+x.duration-de),Ne=1-(Ee/x.duration||0),bt=0,ei=x.tweens.length;bt<ei;bt++)x.tweens[bt].run(Ne);return Ve.notifyWith(m,[x,Ne,Ee]),Ne<1&&ei?Ee:(ei||Ve.notifyWith(m,[x,1,0]),Ve.resolveWith(m,[x]),!1)},x=Ve.promise({elem:m,props:C.extend({},b),opts:C.extend(!0,{specialEasing:{},easing:C.easing._default},M),originalProperties:b,originalOptions:M,startTime:_r||Eo(),duration:M.duration,tweens:[],createTween:function(de,Ee){var Ne=C.Tween(m,x.opts,de,Ee,x.opts.specialEasing[de]||x.opts.easing);return x.tweens.push(Ne),Ne},stop:function(de){var Ee=0,Ne=de?x.tweens.length:0;if(q)return this;for(q=!0;Ee<Ne;Ee++)x.tweens[Ee].run(1);return de?(Ve.notifyWith(m,[x,1,0]),Ve.resolveWith(m,[x,de])):Ve.rejectWith(m,[x,de]),this}}),B=x.props;for(function(de,Ee){var Ne,bt,ei,Yt,hn;for(Ne in de)if(ei=Ee[bt=Ji(Ne)],Yt=de[Ne],Array.isArray(Yt)&&(ei=Yt[1],Yt=de[Ne]=Yt[0]),Ne!==bt&&(de[bt]=Yt,delete de[Ne]),(hn=C.cssHooks[bt])&&"expand"in hn)for(Ne in Yt=hn.expand(Yt),delete de[bt],Yt)Ne in de||(de[Ne]=Yt[Ne],Ee[Ne]=ei);else Ee[bt]=ei}(B,x.opts.specialEasing);J<se;J++)if(L=Vi.prefilters[J].call(x,m,B,x.opts))return te(L.stop)&&(C._queueHooks(x.elem,x.opts.queue).stop=L.stop.bind(L)),L;return C.map(B,nn,x),te(x.opts.start)&&x.opts.start.call(m,x),x.progress(x.opts.progress).done(x.opts.done,x.opts.complete).fail(x.opts.fail).always(x.opts.always),C.fx.timer(C.extend(G,{elem:m,anim:x,queue:x.opts.queue})),x}C.Animation=C.extend(Vi,{tweeners:{"*":[function(m,b){var M=this.createTween(m,b);return Lt(M.elem,m,$e.exec(b),M),M}]},tweener:function(m,b){te(m)?(b=m,m=["*"]):m=m.match(wi);for(var M,L=0,q=m.length;L<q;L++)(Vi.tweeners[M=m[L]]=Vi.tweeners[M]||[]).unshift(b)},prefilters:[function(m,b,M){var L,q,J,se,Ve,G,x,B,de="width"in b||"height"in b,Ee=this,Ne={},bt=m.style,ei=m.nodeType&&jt(m),Yt=gi.get(m,"fxshow");for(L in M.queue||(null==(se=C._queueHooks(m,"fx")).unqueued&&(se.unqueued=0,Ve=se.empty.fire,se.empty.fire=function(){se.unqueued||Ve()}),se.unqueued++,Ee.always(function(){Ee.always(function(){se.unqueued--,C.queue(m,"fx").length||se.empty.fire()})})),b)if(Jr.test(q=b[L])){if(delete b[L],J=J||"toggle"===q,q===(ei?"hide":"show")){if("show"!==q||!Yt||void 0===Yt[L])continue;ei=!0}Ne[L]=Yt&&Yt[L]||C.style(m,L)}if((G=!C.isEmptyObject(b))||!C.isEmptyObject(Ne))for(L in de&&1===m.nodeType&&(M.overflow=[bt.overflow,bt.overflowX,bt.overflowY],null==(x=Yt&&Yt.display)&&(x=gi.get(m,"display")),"none"===(B=C.css(m,"display"))&&(x?B=x:(ve([m],!0),x=m.style.display||x,B=C.css(m,"display"),ve([m]))),("inline"===B||"inline-block"===B&&null!=x)&&"none"===C.css(m,"float")&&(G||(Ee.done(function(){bt.display=x}),null==x&&(x="none"===(B=bt.display)?"":B)),bt.display="inline-block")),M.overflow&&(bt.overflow="hidden",Ee.always(function(){bt.overflow=M.overflow[0],bt.overflowX=M.overflow[1],bt.overflowY=M.overflow[2]})),G=!1,Ne)G||(Yt?"hidden"in Yt&&(ei=Yt.hidden):Yt=gi.access(m,"fxshow",{display:x}),J&&(Yt.hidden=!ei),ei&&ve([m],!0),Ee.done(function(){for(L in ei||ve([m]),gi.remove(m,"fxshow"),Ne)C.style(m,L,Ne[L])})),G=nn(ei?Yt[L]:0,L,Ee),L in Yt||(Yt[L]=G.start,ei&&(G.end=G.start,G.start=0))}],prefilter:function(m,b){b?Vi.prefilters.unshift(m):Vi.prefilters.push(m)}}),C.speed=function(m,b,M){var L=m&&"object"==typeof m?C.extend({},m):{complete:M||!M&&b||te(m)&&m,duration:m,easing:M&&b||b&&!te(b)&&b};return C.fx.off?L.duration=0:"number"!=typeof L.duration&&(L.duration=L.duration in C.fx.speeds?C.fx.speeds[L.duration]:C.fx.speeds._default),null!=L.queue&&!0!==L.queue||(L.queue="fx"),L.old=L.complete,L.complete=function(){te(L.old)&&L.old.call(this),L.queue&&C.dequeue(this,L.queue)},L},C.fn.extend({fadeTo:function(m,b,M,L){return this.filter(jt).css("opacity",0).show().end().animate({opacity:b},m,M,L)},animate:function(m,b,M,L){var q=C.isEmptyObject(m),J=C.speed(b,M,L),se=function(){var Ve=Vi(this,C.extend({},m),J);(q||gi.get(this,"finish"))&&Ve.stop(!0)};return se.finish=se,q||!1===J.queue?this.each(se):this.queue(J.queue,se)},stop:function(m,b,M){var L=function(q){var J=q.stop;delete q.stop,J(M)};return"string"!=typeof m&&(M=b,b=m,m=void 0),b&&this.queue(m||"fx",[]),this.each(function(){var q=!0,J=null!=m&&m+"queueHooks",se=C.timers,Ve=gi.get(this);if(J)Ve[J]&&Ve[J].stop&&L(Ve[J]);else for(J in Ve)Ve[J]&&Ve[J].stop&&Oo.test(J)&&L(Ve[J]);for(J=se.length;J--;)se[J].elem!==this||null!=m&&se[J].queue!==m||(se[J].anim.stop(M),q=!1,se.splice(J,1));!q&&M||C.dequeue(this,m)})},finish:function(m){return!1!==m&&(m=m||"fx"),this.each(function(){var b,M=gi.get(this),L=M[m+"queue"],q=M[m+"queueHooks"],J=C.timers,se=L?L.length:0;for(M.finish=!0,C.queue(this,m,[]),q&&q.stop&&q.stop.call(this,!0),b=J.length;b--;)J[b].elem===this&&J[b].queue===m&&(J[b].anim.stop(!0),J.splice(b,1));for(b=0;b<se;b++)L[b]&&L[b].finish&&L[b].finish.call(this);delete M.finish})}}),C.each(["toggle","show","hide"],function(m,b){var M=C.fn[b];C.fn[b]=function(L,q,J){return null==L||"boolean"==typeof L?M.apply(this,arguments):this.animate(Jt(b,!0),L,q,J)}}),C.each({slideDown:Jt("show"),slideUp:Jt("hide"),slideToggle:Jt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(m,b){C.fn[m]=function(M,L,q){return this.animate(b,M,L,q)}}),C.timers=[],C.fx.tick=function(){var m,b=0,M=C.timers;for(_r=Date.now();b<M.length;b++)(m=M[b])()||M[b]!==m||M.splice(b--,1);M.length||C.fx.stop(),_r=void 0},C.fx.timer=function(m){C.timers.push(m),C.fx.start()},C.fx.interval=13,C.fx.start=function(){Hn||(Hn=!0,rs())},C.fx.stop=function(){Hn=null},C.fx.speeds={slow:600,fast:200,_default:400},C.fn.delay=function(m,b){return m=C.fx&&C.fx.speeds[m]||m,this.queue(b=b||"fx",function(M,L){var q=Ae.setTimeout(M,m);L.stop=function(){Ae.clearTimeout(q)}})},Lr=Ie.createElement("input"),_o=Ie.createElement("select").appendChild(Ie.createElement("option")),Lr.type="checkbox",le.checkOn=""!==Lr.value,le.optSelected=_o.selected,(Lr=Ie.createElement("input")).value="t",Lr.type="radio",le.radioValue="t"===Lr.value;var Qr,hr=C.expr.attrHandle;C.fn.extend({attr:function(m,b){return En(this,C.attr,m,b,1<arguments.length)},removeAttr:function(m){return this.each(function(){C.removeAttr(this,m)})}}),C.extend({attr:function(m,b,M){var L,q,J=m.nodeType;if(3!==J&&8!==J&&2!==J)return typeof m.getAttribute>"u"?C.prop(m,b,M):(1===J&&C.isXMLDoc(m)||(q=C.attrHooks[b.toLowerCase()]||(C.expr.match.bool.test(b)?Qr:void 0)),void 0!==M?null===M?void C.removeAttr(m,b):q&&"set"in q&&void 0!==(L=q.set(m,M,b))?L:(m.setAttribute(b,M+""),M):q&&"get"in q&&null!==(L=q.get(m,b))?L:null==(L=C.find.attr(m,b))?void 0:L)},attrHooks:{type:{set:function(m,b){if(!le.radioValue&&"radio"===b&&$t(m,"input")){var M=m.value;return m.setAttribute("type",b),M&&(m.value=M),b}}}},removeAttr:function(m,b){var M,L=0,q=b&&b.match(wi);if(q&&1===m.nodeType)for(;M=q[L++];)m.removeAttribute(M)}}),Qr={set:function(m,b,M){return!1===b?C.removeAttr(m,M):m.setAttribute(M,M),M}},C.each(C.expr.match.bool.source.match(/\w+/g),function(m,b){var M=hr[b]||C.find.attr;hr[b]=function(L,q,J){var se,Ve,G=q.toLowerCase();return J||(Ve=hr[G],hr[G]=se,se=null!=M(L,q,J)?G:null,hr[G]=Ve),se}});var an=/^(?:input|select|textarea|button)$/i,os=/^(?:a|area)$/i;function jr(m){return(m.match(wi)||[]).join(" ")}function Vr(m){return m.getAttribute&&m.getAttribute("class")||""}function yr(m){return Array.isArray(m)?m:"string"==typeof m&&m.match(wi)||[]}C.fn.extend({prop:function(m,b){return En(this,C.prop,m,b,1<arguments.length)},removeProp:function(m){return this.each(function(){delete this[C.propFix[m]||m]})}}),C.extend({prop:function(m,b,M){var L,q,J=m.nodeType;if(3!==J&&8!==J&&2!==J)return 1===J&&C.isXMLDoc(m)||(q=C.propHooks[b=C.propFix[b]||b]),void 0!==M?q&&"set"in q&&void 0!==(L=q.set(m,M,b))?L:m[b]=M:q&&"get"in q&&null!==(L=q.get(m,b))?L:m[b]},propHooks:{tabIndex:{get:function(m){var b=C.find.attr(m,"tabindex");return b?parseInt(b,10):an.test(m.nodeName)||os.test(m.nodeName)&&m.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),le.optSelected||(C.propHooks.selected={get:function(m){return null},set:function(m){}}),C.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){C.propFix[this.toLowerCase()]=this}),C.fn.extend({addClass:function(m){var b,M,L,q,J,se;return te(m)?this.each(function(Ve){C(this).addClass(m.call(this,Ve,Vr(this)))}):(b=yr(m)).length?this.each(function(){if(L=Vr(this),M=1===this.nodeType&&" "+jr(L)+" "){for(J=0;J<b.length;J++)M.indexOf(" "+(q=b[J])+" ")<0&&(M+=q+" ");se=jr(M),L!==se&&this.setAttribute("class",se)}}):this},removeClass:function(m){var b,M,L,q,J,se;return te(m)?this.each(function(Ve){C(this).removeClass(m.call(this,Ve,Vr(this)))}):arguments.length?(b=yr(m)).length?this.each(function(){if(L=Vr(this),M=1===this.nodeType&&" "+jr(L)+" "){for(J=0;J<b.length;J++)for(q=b[J];-1<M.indexOf(" "+q+" ");)M=M.replace(" "+q+" "," ");se=jr(M),L!==se&&this.setAttribute("class",se)}}):this:this.attr("class","")},toggleClass:function(m,b){var M,L,q,J,se=typeof m,Ve="string"===se||Array.isArray(m);return te(m)?this.each(function(G){C(this).toggleClass(m.call(this,G,Vr(this),b),b)}):"boolean"==typeof b&&Ve?b?this.addClass(m):this.removeClass(m):(M=yr(m),this.each(function(){if(Ve)for(J=C(this),q=0;q<M.length;q++)J.hasClass(L=M[q])?J.removeClass(L):J.addClass(L);else void 0!==m&&"boolean"!==se||((L=Vr(this))&&gi.set(this,"__className__",L),this.setAttribute&&this.setAttribute("class",L||!1===m?"":gi.get(this,"__className__")||""))}))},hasClass:function(m){var b,M,L=0;for(b=" "+m+" ";M=this[L++];)if(1===M.nodeType&&-1<(" "+jr(Vr(M))+" ").indexOf(b))return!0;return!1}});var Dn=/\r/g;C.fn.extend({val:function(m){var b,M,L,q=this[0];return arguments.length?(L=te(m),this.each(function(J){var se;1===this.nodeType&&(null==(se=L?m.call(this,J,C(this).val()):m)?se="":"number"==typeof se?se+="":Array.isArray(se)&&(se=C.map(se,function(Ve){return null==Ve?"":Ve+""})),(b=C.valHooks[this.type]||C.valHooks[this.nodeName.toLowerCase()])&&"set"in b&&void 0!==b.set(this,se,"value")||(this.value=se))})):q?(b=C.valHooks[q.type]||C.valHooks[q.nodeName.toLowerCase()])&&"get"in b&&void 0!==(M=b.get(q,"value"))?M:"string"==typeof(M=q.value)?M.replace(Dn,""):M??"":void 0}}),C.extend({valHooks:{option:{get:function(m){return C.find.attr(m,"value")??jr(C.text(m))}},select:{get:function(m){var b,M,L,q=m.options,J=m.selectedIndex,se="select-one"===m.type,Ve=se?null:[],G=se?J+1:q.length;for(L=J<0?G:se?J:0;L<G;L++)if(((M=q[L]).selected||L===J)&&!M.disabled&&(!M.parentNode.disabled||!$t(M.parentNode,"optgroup"))){if(b=C(M).val(),se)return b;Ve.push(b)}return Ve},set:function(m,b){for(var M,L,q=m.options,J=C.makeArray(b),se=q.length;se--;)((L=q[se]).selected=-1<C.inArray(C.valHooks.option.get(L),J))&&(M=!0);return M||(m.selectedIndex=-1),J}}}}),C.each(["radio","checkbox"],function(){C.valHooks[this]={set:function(m,b){if(Array.isArray(b))return m.checked=-1<C.inArray(C(m).val(),b)}},le.checkOn||(C.valHooks[this].get=function(m){return null===m.getAttribute("value")?"on":m.value})}),le.focusin="onfocusin"in Ae;var ra=/^(?:focusinfocus|focusoutblur)$/,$r=function(m){m.stopPropagation()};C.extend(C.event,{trigger:function(m,b,M,L){var q,J,se,Ve,G,x,B,de,Ee=[M||Ie],Ne=O.call(m,"type")?m.type:m,bt=O.call(m,"namespace")?m.namespace.split("."):[];if(J=de=se=M=M||Ie,3!==M.nodeType&&8!==M.nodeType&&!ra.test(Ne+C.event.triggered)&&(-1<Ne.indexOf(".")&&(Ne=(bt=Ne.split(".")).shift(),bt.sort()),G=Ne.indexOf(":")<0&&"on"+Ne,(m=m[C.expando]?m:new C.Event(Ne,"object"==typeof m&&m)).isTrigger=L?2:3,m.namespace=bt.join("."),m.rnamespace=m.namespace?new RegExp("(^|\\.)"+bt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m.result=void 0,m.target||(m.target=M),b=null==b?[m]:C.makeArray(b,[m]),B=C.event.special[Ne]||{},L||!B.trigger||!1!==B.trigger.apply(M,b))){if(!L&&!B.noBubble&&!Be(M)){for(ra.test((Ve=B.delegateType||Ne)+Ne)||(J=J.parentNode);J;J=J.parentNode)Ee.push(J),se=J;se===(M.ownerDocument||Ie)&&Ee.push(se.defaultView||se.parentWindow||Ae)}for(q=0;(J=Ee[q++])&&!m.isPropagationStopped();)de=J,m.type=1<q?Ve:B.bindType||Ne,(x=(gi.get(J,"events")||Object.create(null))[m.type]&&gi.get(J,"handle"))&&x.apply(J,b),(x=G&&J[G])&&x.apply&&Nn(J)&&(m.result=x.apply(J,b),!1===m.result&&m.preventDefault());return m.type=Ne,L||m.isDefaultPrevented()||B._default&&!1!==B._default.apply(Ee.pop(),b)||!Nn(M)||G&&te(M[Ne])&&!Be(M)&&((se=M[G])&&(M[G]=null),C.event.triggered=Ne,m.isPropagationStopped()&&de.addEventListener(Ne,$r),M[Ne](),m.isPropagationStopped()&&de.removeEventListener(Ne,$r),C.event.triggered=void 0,se&&(M[G]=se)),m.result}},simulate:function(m,b,M){var L=C.extend(new C.Event,M,{type:m,isSimulated:!0});C.event.trigger(L,null,b)}}),C.fn.extend({trigger:function(m,b){return this.each(function(){C.event.trigger(m,b,this)})},triggerHandler:function(m,b){var M=this[0];if(M)return C.event.trigger(m,b,M,!0)}}),le.focusin||C.each({focus:"focusin",blur:"focusout"},function(m,b){var M=function(L){C.event.simulate(b,L.target,C.event.fix(L))};C.event.special[b]={setup:function(){var L=this.ownerDocument||this.document||this,q=gi.access(L,b);q||L.addEventListener(m,M,!0),gi.access(L,b,(q||0)+1)},teardown:function(){var L=this.ownerDocument||this.document||this,q=gi.access(L,b)-1;q?gi.access(L,b,q):(L.removeEventListener(m,M,!0),gi.remove(L,b))}}});var So=Ae.location,Sr={guid:Date.now()},Ro=/\?/;C.parseXML=function(m){var b,M;if(!m||"string"!=typeof m)return null;try{b=(new Ae.DOMParser).parseFromString(m,"text/xml")}catch{}return M=b&&b.getElementsByTagName("parsererror")[0],b&&!M||C.error("Invalid XML: "+(M?C.map(M.childNodes,function(L){return L.textContent}).join("\n"):m)),b};var Bo=/\[\]$/,Zo=/\r?\n/g,Ho=/^(?:submit|button|image|reset|file)$/i,Ao=/^(?:input|select|textarea|keygen)/i;function so(m,b,M,L){var q;if(Array.isArray(b))C.each(b,function(J,se){M||Bo.test(m)?L(m,se):so(m+"["+("object"==typeof se&&null!=se?J:"")+"]",se,M,L)});else if(M||"object"!==ne(b))L(m,b);else for(q in b)so(m+"["+q+"]",b[q],M,L)}C.param=function(m,b){var M,L=[],q=function(J,se){var Ve=te(se)?se():se;L[L.length]=encodeURIComponent(J)+"="+encodeURIComponent(Ve??"")};if(null==m)return"";if(Array.isArray(m)||m.jquery&&!C.isPlainObject(m))C.each(m,function(){q(this.name,this.value)});else for(M in m)so(M,m[M],b,q);return L.join("&")},C.fn.extend({serialize:function(){return C.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var m=C.prop(this,"elements");return m?C.makeArray(m):this}).filter(function(){var m=this.type;return this.name&&!C(this).is(":disabled")&&Ao.test(this.nodeName)&&!Ho.test(m)&&(this.checked||!vt.test(m))}).map(function(m,b){var M=C(this).val();return null==M?null:Array.isArray(M)?C.map(M,function(L){return{name:b.name,value:L.replace(Zo,"\r\n")}}):{name:b.name,value:M.replace(Zo,"\r\n")}}).get()}});var vr=/%20/g,ir=/#.*$/,js=/([?&])_=[^&]*/,yo=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ar=/^(?:GET|HEAD)$/,Ir=/^\/\//,Wo={},ao={},$n="*/".concat("*"),Co=Ie.createElement("a");function vs(m){return function(b,M){"string"!=typeof b&&(M=b,b="*");var L,q=0,J=b.toLowerCase().match(wi)||[];if(te(M))for(;L=J[q++];)"+"===L[0]?(L=L.slice(1)||"*",(m[L]=m[L]||[]).unshift(M)):(m[L]=m[L]||[]).push(M)}}function Xo(m,b,M,L){var q={},J=m===ao;function se(Ve){var G;return q[Ve]=!0,C.each(m[Ve]||[],function(x,B){var de=B(b,M,L);return"string"!=typeof de||J||q[de]?J?!(G=de):void 0:(b.dataTypes.unshift(de),se(de),!1)}),G}return se(b.dataTypes[0])||!q["*"]&&se("*")}function Qn(m,b){var M,L,q=C.ajaxSettings.flatOptions||{};for(M in b)void 0!==b[M]&&((q[M]?m:L||(L={}))[M]=b[M]);return L&&C.extend(!0,m,L),m}Co.href=So.href,C.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:So.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(So.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$n,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":C.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(m,b){return b?Qn(Qn(m,C.ajaxSettings),b):Qn(C.ajaxSettings,m)},ajaxPrefilter:vs(Wo),ajaxTransport:vs(ao),ajax:function(m,b){"object"==typeof m&&(b=m,m=void 0);var M,L,q,J,se,Ve,G,x,B,de,Ee=C.ajaxSetup({},b=b||{}),Ne=Ee.context||Ee,bt=Ee.context&&(Ne.nodeType||Ne.jquery)?C(Ne):C.event,ei=C.Deferred(),Yt=C.Callbacks("once memory"),hn=Ee.statusCode||{},wn={},Pn={},fn="canceled",ki={readyState:0,getResponseHeader:function(rn){var An;if(G){if(!J)for(J={};An=yo.exec(q);)J[An[1].toLowerCase()+" "]=(J[An[1].toLowerCase()+" "]||[]).concat(An[2]);An=J[rn.toLowerCase()+" "]}return null==An?null:An.join(", ")},getAllResponseHeaders:function(){return G?q:null},setRequestHeader:function(rn,An){return null==G&&(rn=Pn[rn.toLowerCase()]=Pn[rn.toLowerCase()]||rn,wn[rn]=An),this},overrideMimeType:function(rn){return null==G&&(Ee.mimeType=rn),this},statusCode:function(rn){var An;if(rn)if(G)ki.always(rn[ki.status]);else for(An in rn)hn[An]=[hn[An],rn[An]];return this},abort:function(rn){var An=rn||fn;return M&&M.abort(An),Fi(0,An),this}};if(ei.promise(ki),Ee.url=((m||Ee.url||So.href)+"").replace(Ir,So.protocol+"//"),Ee.type=b.method||b.type||Ee.method||Ee.type,Ee.dataTypes=(Ee.dataType||"*").toLowerCase().match(wi)||[""],null==Ee.crossDomain){Ve=Ie.createElement("a");try{Ve.href=Ee.url,Ve.href=Ve.href,Ee.crossDomain=Co.protocol+"//"+Co.host!=Ve.protocol+"//"+Ve.host}catch{Ee.crossDomain=!0}}if(Ee.data&&Ee.processData&&"string"!=typeof Ee.data&&(Ee.data=C.param(Ee.data,Ee.traditional)),Xo(Wo,Ee,b,ki),G)return ki;for(B in(x=C.event&&Ee.global)&&0==C.active++&&C.event.trigger("ajaxStart"),Ee.type=Ee.type.toUpperCase(),Ee.hasContent=!Ar.test(Ee.type),L=Ee.url.replace(ir,""),Ee.hasContent?Ee.data&&Ee.processData&&0===(Ee.contentType||"").indexOf("application/x-www-form-urlencoded")&&(Ee.data=Ee.data.replace(vr,"+")):(de=Ee.url.slice(L.length),Ee.data&&(Ee.processData||"string"==typeof Ee.data)&&(L+=(Ro.test(L)?"&":"?")+Ee.data,delete Ee.data),!1===Ee.cache&&(L=L.replace(js,"$1"),de=(Ro.test(L)?"&":"?")+"_="+Sr.guid+++de),Ee.url=L+de),Ee.ifModified&&(C.lastModified[L]&&ki.setRequestHeader("If-Modified-Since",C.lastModified[L]),C.etag[L]&&ki.setRequestHeader("If-None-Match",C.etag[L])),(Ee.data&&Ee.hasContent&&!1!==Ee.contentType||b.contentType)&&ki.setRequestHeader("Content-Type",Ee.contentType),ki.setRequestHeader("Accept",Ee.dataTypes[0]&&Ee.accepts[Ee.dataTypes[0]]?Ee.accepts[Ee.dataTypes[0]]+("*"!==Ee.dataTypes[0]?", "+$n+"; q=0.01":""):Ee.accepts["*"]),Ee.headers)ki.setRequestHeader(B,Ee.headers[B]);if(Ee.beforeSend&&(!1===Ee.beforeSend.call(Ne,ki,Ee)||G))return ki.abort();if(fn="abort",Yt.add(Ee.complete),ki.done(Ee.success),ki.fail(Ee.error),M=Xo(ao,Ee,b,ki)){if(ki.readyState=1,x&&bt.trigger("ajaxSend",[ki,Ee]),G)return ki;Ee.async&&0<Ee.timeout&&(se=Ae.setTimeout(function(){ki.abort("timeout")},Ee.timeout));try{G=!1,M.send(wn,Fi)}catch(rn){if(G)throw rn;Fi(-1,rn)}}else Fi(-1,"No Transport");function Fi(rn,An,to,No){var or,co,Yo,Cr,ko,pr=An;G||(G=!0,se&&Ae.clearTimeout(se),M=void 0,q=No||"",ki.readyState=0<rn?4:0,or=200<=rn&&rn<300||304===rn,to&&(Cr=function(Un,on,xr){for(var uo,ln,Cn,sr,Gr=Un.contents,cr=Un.dataTypes;"*"===cr[0];)cr.shift(),void 0===uo&&(uo=Un.mimeType||on.getResponseHeader("Content-Type"));if(uo)for(ln in Gr)if(Gr[ln]&&Gr[ln].test(uo)){cr.unshift(ln);break}if(cr[0]in xr)Cn=cr[0];else{for(ln in xr){if(!cr[0]||Un.converters[ln+" "+cr[0]]){Cn=ln;break}sr||(sr=ln)}Cn=Cn||sr}if(Cn)return Cn!==cr[0]&&cr.unshift(Cn),xr[Cn]}(Ee,ki,to)),!or&&-1<C.inArray("script",Ee.dataTypes)&&C.inArray("json",Ee.dataTypes)<0&&(Ee.converters["text script"]=function(){}),Cr=function(Un,on,xr,uo){var ln,Cn,sr,Gr,cr,qr={},Ko=Un.dataTypes.slice();if(Ko[1])for(sr in Un.converters)qr[sr.toLowerCase()]=Un.converters[sr];for(Cn=Ko.shift();Cn;)if(Un.responseFields[Cn]&&(xr[Un.responseFields[Cn]]=on),!cr&&uo&&Un.dataFilter&&(on=Un.dataFilter(on,Un.dataType)),cr=Cn,Cn=Ko.shift())if("*"===Cn)Cn=cr;else if("*"!==cr&&cr!==Cn){if(!(sr=qr[cr+" "+Cn]||qr["* "+Cn]))for(ln in qr)if((Gr=ln.split(" "))[1]===Cn&&(sr=qr[cr+" "+Gr[0]]||qr["* "+Gr[0]])){!0===sr?sr=qr[ln]:!0!==qr[ln]&&(Cn=Gr[0],Ko.unshift(Gr[1]));break}if(!0!==sr)if(sr&&Un.throws)on=sr(on);else try{on=sr(on)}catch(as){return{state:"parsererror",error:sr?as:"No conversion from "+cr+" to "+Cn}}}return{state:"success",data:on}}(Ee,Cr,ki,or),or?(Ee.ifModified&&((ko=ki.getResponseHeader("Last-Modified"))&&(C.lastModified[L]=ko),(ko=ki.getResponseHeader("etag"))&&(C.etag[L]=ko)),204===rn||"HEAD"===Ee.type?pr="nocontent":304===rn?pr="notmodified":(pr=Cr.state,co=Cr.data,or=!(Yo=Cr.error))):(Yo=pr,!rn&&pr||(pr="error",rn<0&&(rn=0))),ki.status=rn,ki.statusText=(An||pr)+"",or?ei.resolveWith(Ne,[co,pr,ki]):ei.rejectWith(Ne,[ki,pr,Yo]),ki.statusCode(hn),hn=void 0,x&&bt.trigger(or?"ajaxSuccess":"ajaxError",[ki,Ee,or?co:Yo]),Yt.fireWith(Ne,[ki,pr]),x&&(bt.trigger("ajaxComplete",[ki,Ee]),--C.active||C.event.trigger("ajaxStop")))}return ki},getJSON:function(m,b,M){return C.get(m,b,M,"json")},getScript:function(m,b){return C.get(m,void 0,b,"script")}}),C.each(["get","post"],function(m,b){C[b]=function(M,L,q,J){return te(L)&&(J=J||q,q=L,L=void 0),C.ajax(C.extend({url:M,type:b,dataType:J,data:L,success:q},C.isPlainObject(M)&&M))}}),C.ajaxPrefilter(function(m){var b;for(b in m.headers)"content-type"===b.toLowerCase()&&(m.contentType=m.headers[b]||"")}),C._evalUrl=function(m,b,M){return C.ajax({url:m,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(L){C.globalEval(L,b,M)}})},C.fn.extend({wrapAll:function(m){var b;return this[0]&&(te(m)&&(m=m.call(this[0])),b=C(m,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var M=this;M.firstElementChild;)M=M.firstElementChild;return M}).append(this)),this},wrapInner:function(m){return te(m)?this.each(function(b){C(this).wrapInner(m.call(this,b))}):this.each(function(){var b=C(this),M=b.contents();M.length?M.wrapAll(m):b.append(m)})},wrap:function(m){var b=te(m);return this.each(function(M){C(this).wrapAll(b?m.call(this,M):m)})},unwrap:function(m){return this.parent(m).not("body").each(function(){C(this).replaceWith(this.childNodes)}),this}}),C.expr.pseudos.hidden=function(m){return!C.expr.pseudos.visible(m)},C.expr.pseudos.visible=function(m){return!!(m.offsetWidth||m.offsetHeight||m.getClientRects().length)},C.ajaxSettings.xhr=function(){try{return new Ae.XMLHttpRequest}catch{}};var Vs={0:200,1223:204},Mo=C.ajaxSettings.xhr();le.cors=!!Mo&&"withCredentials"in Mo,le.ajax=Mo=!!Mo,C.ajaxTransport(function(m){var b,M;if(le.cors||Mo&&!m.crossDomain)return{send:function(L,q){var J,se=m.xhr();if(se.open(m.type,m.url,m.async,m.username,m.password),m.xhrFields)for(J in m.xhrFields)se[J]=m.xhrFields[J];for(J in m.mimeType&&se.overrideMimeType&&se.overrideMimeType(m.mimeType),m.crossDomain||L["X-Requested-With"]||(L["X-Requested-With"]="XMLHttpRequest"),L)se.setRequestHeader(J,L[J]);b=function(Ve){return function(){b&&(b=M=se.onload=se.onerror=se.onabort=se.ontimeout=se.onreadystatechange=null,"abort"===Ve?se.abort():"error"===Ve?"number"!=typeof se.status?q(0,"error"):q(se.status,se.statusText):q(Vs[se.status]||se.status,se.statusText,"text"!==(se.responseType||"text")||"string"!=typeof se.responseText?{binary:se.response}:{text:se.responseText},se.getAllResponseHeaders()))}},se.onload=b(),M=se.onerror=se.ontimeout=b("error"),void 0!==se.onabort?se.onabort=M:se.onreadystatechange=function(){4===se.readyState&&Ae.setTimeout(function(){b&&M()})},b=b("abort");try{se.send(m.hasContent&&m.data||null)}catch(Ve){if(b)throw Ve}},abort:function(){b&&b()}}}),C.ajaxPrefilter(function(m){m.crossDomain&&(m.contents.script=!1)}),C.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(m){return C.globalEval(m),m}}}),C.ajaxPrefilter("script",function(m){void 0===m.cache&&(m.cache=!1),m.crossDomain&&(m.type="GET")}),C.ajaxTransport("script",function(m){var b,M;if(m.crossDomain||m.scriptAttrs)return{send:function(L,q){b=C("<script>").attr(m.scriptAttrs||{}).prop({charset:m.scriptCharset,src:m.url}).on("load error",M=function(J){b.remove(),M=null,J&&q("error"===J.type?404:200,J.type)}),Ie.head.appendChild(b[0])},abort:function(){M&&M()}}});var eo,lo=[],vo=/(=)\?(?=&|$)|\?\?/;C.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var m=lo.pop()||C.expando+"_"+Sr.guid++;return this[m]=!0,m}}),C.ajaxPrefilter("json jsonp",function(m,b,M){var L,q,J,se=!1!==m.jsonp&&(vo.test(m.url)?"url":"string"==typeof m.data&&0===(m.contentType||"").indexOf("application/x-www-form-urlencoded")&&vo.test(m.data)&&"data");if(se||"jsonp"===m.dataTypes[0])return L=m.jsonpCallback=te(m.jsonpCallback)?m.jsonpCallback():m.jsonpCallback,se?m[se]=m[se].replace(vo,"$1"+L):!1!==m.jsonp&&(m.url+=(Ro.test(m.url)?"&":"?")+m.jsonp+"="+L),m.converters["script json"]=function(){return J||C.error(L+" was not called"),J[0]},m.dataTypes[0]="json",q=Ae[L],Ae[L]=function(){J=arguments},M.always(function(){void 0===q?C(Ae).removeProp(L):Ae[L]=q,m[L]&&(m.jsonpCallback=b.jsonpCallback,lo.push(L)),J&&te(q)&&q(J[0]),J=q=void 0}),"script"}),le.createHTMLDocument=((eo=Ie.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===eo.childNodes.length),C.parseHTML=function(m,b,M){return"string"!=typeof m?[]:("boolean"==typeof b&&(M=b,b=!1),b||(le.createHTMLDocument?((L=(b=Ie.implementation.createHTMLDocument("")).createElement("base")).href=Ie.location.href,b.head.appendChild(L)):b=Ie),J=!M&&[],(q=li.exec(m))?[b.createElement(q[1])]:(q=qe([m],b,J),J&&J.length&&C(J).remove(),C.merge([],q.childNodes)));var L,q,J},C.fn.load=function(m,b,M){var L,q,J,se=this,Ve=m.indexOf(" ");return-1<Ve&&(L=jr(m.slice(Ve)),m=m.slice(0,Ve)),te(b)?(M=b,b=void 0):b&&"object"==typeof b&&(q="POST"),0<se.length&&C.ajax({url:m,type:q||"GET",dataType:"html",data:b}).done(function(G){J=arguments,se.html(L?C("<div>").append(C.parseHTML(G)).find(L):G)}).always(M&&function(G,x){se.each(function(){M.apply(this,J||[G.responseText,x,G])})}),this},C.expr.pseudos.animated=function(m){return C.grep(C.timers,function(b){return m===b.elem}).length},C.offset={setOffset:function(m,b,M){var L,q,J,se,Ve,G,x=C.css(m,"position"),B=C(m),de={};"static"===x&&(m.style.position="relative"),Ve=B.offset(),J=C.css(m,"top"),G=C.css(m,"left"),("absolute"===x||"fixed"===x)&&-1<(J+G).indexOf("auto")?(se=(L=B.position()).top,q=L.left):(se=parseFloat(J)||0,q=parseFloat(G)||0),te(b)&&(b=b.call(m,M,C.extend({},Ve))),null!=b.top&&(de.top=b.top-Ve.top+se),null!=b.left&&(de.left=b.left-Ve.left+q),"using"in b?b.using.call(m,de):B.css(de)}},C.fn.extend({offset:function(m){if(arguments.length)return void 0===m?this:this.each(function(q){C.offset.setOffset(this,m,q)});var b,M,L=this[0];return L?L.getClientRects().length?{top:(b=L.getBoundingClientRect()).top+(M=L.ownerDocument.defaultView).pageYOffset,left:b.left+M.pageXOffset}:{top:0,left:0}:void 0},position:function(){if(this[0]){var m,b,M,L=this[0],q={top:0,left:0};if("fixed"===C.css(L,"position"))b=L.getBoundingClientRect();else{for(b=this.offset(),M=L.ownerDocument,m=L.offsetParent||M.documentElement;m&&(m===M.body||m===M.documentElement)&&"static"===C.css(m,"position");)m=m.parentNode;m&&m!==L&&1===m.nodeType&&((q=C(m).offset()).top+=C.css(m,"borderTopWidth",!0),q.left+=C.css(m,"borderLeftWidth",!0))}return{top:b.top-q.top-C.css(L,"marginTop",!0),left:b.left-q.left-C.css(L,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var m=this.offsetParent;m&&"static"===C.css(m,"position");)m=m.offsetParent;return m||ot})}}),C.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(m,b){var M="pageYOffset"===b;C.fn[m]=function(L){return En(this,function(q,J,se){var Ve;if(Be(q)?Ve=q:9===q.nodeType&&(Ve=q.defaultView),void 0===se)return Ve?Ve[b]:q[J];Ve?Ve.scrollTo(M?Ve.pageXOffset:se,M?se:Ve.pageYOffset):q[J]=se},m,L,arguments.length)}}),C.each(["top","left"],function(m,b){C.cssHooks[b]=Mi(le.pixelPosition,function(M,L){if(L)return L=kt(M,b),De.test(L)?C(M).position()[b]+"px":L})}),C.each({Height:"height",Width:"width"},function(m,b){C.each({padding:"inner"+m,content:b,"":"outer"+m},function(M,L){C.fn[L]=function(q,J){var se=arguments.length&&(M||"boolean"!=typeof q),Ve=M||(!0===q||!0===J?"margin":"border");return En(this,function(G,x,B){var de;return Be(G)?0===L.indexOf("outer")?G["inner"+m]:G.document.documentElement["client"+m]:9===G.nodeType?(de=G.documentElement,Math.max(G.body["scroll"+m],de["scroll"+m],G.body["offset"+m],de["offset"+m],de["client"+m])):void 0===B?C.css(G,x,Ve):C.style(G,x,B,Ve)},b,se?q:void 0,se)}})}),C.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(m,b){C.fn[b]=function(M){return this.on(b,M)}}),C.fn.extend({bind:function(m,b,M){return this.on(m,null,b,M)},unbind:function(m,b){return this.off(m,null,b)},delegate:function(m,b,M,L){return this.on(b,m,M,L)},undelegate:function(m,b,M){return 1===arguments.length?this.off(m,"**"):this.off(b,m||"**",M)},hover:function(m,b){return this.mouseenter(m).mouseleave(b||m)}}),C.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(m,b){C.fn[b]=function(M,L){return 0<arguments.length?this.on(b,null,M,L):this.trigger(b)}});var oa=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;C.proxy=function(m,b){var M,L,q;if("string"==typeof b&&(M=m[b],b=m,m=M),te(m))return L=ae.call(arguments,2),(q=function(){return m.apply(b||this,L.concat(ae.call(arguments)))}).guid=m.guid=m.guid||C.guid++,q},C.holdReady=function(m){m?C.readyWait++:C.ready(!0)},C.isArray=Array.isArray,C.parseJSON=JSON.parse,C.nodeName=$t,C.isFunction=te,C.isWindow=Be,C.camelCase=Ji,C.type=ne,C.now=Date.now,C.isNumeric=function(m){var b=C.type(m);return("number"===b||"string"===b)&&!isNaN(m-parseFloat(m))},C.trim=function(m){return null==m?"":(m+"").replace(oa,"$1")},"function"==typeof define&&define.amd&&define("jquery",[],function(){return C});var ss=Ae.jQuery,Fo=Ae.$;return C.noConflict=function(m){return Ae.$===C&&(Ae.$=Fo),m&&Ae.jQuery===C&&(Ae.jQuery=ss),C},typeof Qe>"u"&&(Ae.jQuery=Ae.$=C),C}),function(Ae,Qe){"object"==typeof exports&&typeof module<"u"?module.exports=Qe():"function"==typeof define&&define.amd?define(Qe):Ae.Popper=Qe()}(this,function(){"use strict";function Ae(W){return W&&"[object Function]"==={}.toString.call(W)}function Qe(W,ye){if(1!==W.nodeType)return[];var qe=W.ownerDocument.defaultView.getComputedStyle(W,null);return ye?qe[ye]:qe}function v(W){return"HTML"===W.nodeName?W:W.parentNode||W.host}function $(W){if(!W)return document.body;switch(W.nodeName){case"HTML":case"BODY":return W.ownerDocument.body;case"#document":return W.body}var ye=Qe(W);return/(auto|scroll|overlay)/.test(ye.overflow+ye.overflowY+ye.overflowX)?W:$(v(W))}function ae(W){return W&&W.referenceNode?W.referenceNode:W}function o(W){return 11===W?Mt:10===W?jt:Mt||jt}function D(W){if(!W)return document.documentElement;for(var ye=o(10)?document.body:null,Me=W.offsetParent||null;Me===ye&&W.nextElementSibling;)Me=(W=W.nextElementSibling).offsetParent;var qe=Me&&Me.nodeName;return qe&&"BODY"!==qe&&"HTML"!==qe?-1!==["TH","TD","TABLE"].indexOf(Me.nodeName)&&"static"===Qe(Me,"position")?D(Me):Me:W?W.ownerDocument.documentElement:document.documentElement}function j(W){return null===W.parentNode?W:j(W.parentNode)}function k(W,ye){if(!(W&&W.nodeType&&ye&&ye.nodeType))return document.documentElement;var Me=W.compareDocumentPosition(ye)&Node.DOCUMENT_POSITION_FOLLOWING,qe=Me?W:ye,gt=Me?ye:W,_t=document.createRange();_t.setStart(qe,0),_t.setEnd(gt,0);var ft=_t.commonAncestorContainer;if(W!==ft&&ye!==ft||qe.contains(gt))return function N(W){var ye=W.nodeName;return"BODY"!==ye&&("HTML"===ye||D(W.firstElementChild)===W)}(ft)?ft:D(ft);var Ut=j(W);return Ut.host?k(Ut.host,ye):k(W,j(ye).host)}function O(W){var ye=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"top",Me="top"===ye?"scrollTop":"scrollLeft",qe=W.nodeName;if("BODY"===qe||"HTML"===qe){var gt=W.ownerDocument.documentElement,_t=W.ownerDocument.scrollingElement||gt;return _t[Me]}return W[Me]}function I(W,ye){var Me=2<arguments.length&&void 0!==arguments[2]&&arguments[2],qe=O(ye,"top"),gt=O(ye,"left"),_t=Me?-1:1;return W.top+=qe*_t,W.bottom+=qe*_t,W.left+=gt*_t,W.right+=gt*_t,W}function X(W,ye){var Me="x"===ye?"Left":"Top",qe="Left"==Me?"Right":"Bottom";return parseFloat(W["border"+Me+"Width"])+parseFloat(W["border"+qe+"Width"])}function le(W,ye,Me,qe){return oe(ye["offset"+W],ye["scroll"+W],Me["client"+W],Me["offset"+W],Me["scroll"+W],o(10)?parseInt(Me["offset"+W])+parseInt(qe["margin"+("Height"===W?"Top":"Left")])+parseInt(qe["margin"+("Height"===W?"Bottom":"Right")]):0)}function te(W){var ye=W.body,Me=W.documentElement,qe=o(10)&&getComputedStyle(Me);return{height:le("Height",ye,Me,qe),width:le("Width",ye,Me,qe)}}function Be(W){return Ce({},W,{right:W.left+W.width,bottom:W.top+W.height})}function Ie(W){var ye={};try{if(o(10)){ye=W.getBoundingClientRect();var Me=O(W,"top"),qe=O(W,"left");ye.top+=Me,ye.left+=qe,ye.bottom+=Me,ye.right+=qe}else ye=W.getBoundingClientRect()}catch{}var gt={left:ye.left,top:ye.top,width:ye.right-ye.left,height:ye.bottom-ye.top},_t="HTML"===W.nodeName?te(W.ownerDocument):{},ti=W.offsetWidth-(_t.width||W.clientWidth||gt.width),Ci=W.offsetHeight-(_t.height||W.clientHeight||gt.height);if(ti||Ci){var xi=Qe(W);ti-=X(xi,"x"),Ci-=X(xi,"y"),gt.width-=ti,gt.height-=Ci}return Be(gt)}function Se(W,ye){var Me=2<arguments.length&&void 0!==arguments[2]&&arguments[2],qe=o(10),gt="HTML"===ye.nodeName,_t=Ie(W),ft=Ie(ye),Ut=$(W),ti=Qe(ye),Ci=parseFloat(ti.borderTopWidth),xi=parseFloat(ti.borderLeftWidth);Me&&gt&&(ft.top=oe(ft.top,0),ft.left=oe(ft.left,0));var pi=Be({top:_t.top-ft.top-Ci,left:_t.left-ft.left-xi,width:_t.width,height:_t.height});if(pi.marginTop=0,pi.marginLeft=0,!qe&&gt){var Ii=parseFloat(ti.marginTop),Gi=parseFloat(ti.marginLeft);pi.top-=Ci-Ii,pi.bottom-=Ci-Ii,pi.left-=xi-Gi,pi.right-=xi-Gi,pi.marginTop=Ii,pi.marginLeft=Gi}return(qe&&!Me?ye.contains(Ut):ye===Ut&&"BODY"!==Ut.nodeName)&&(pi=I(pi,ye)),pi}function Ke(W){var ye=1<arguments.length&&void 0!==arguments[1]&&arguments[1],Me=W.ownerDocument.documentElement,qe=Se(W,Me),gt=oe(Me.clientWidth,window.innerWidth||0),_t=oe(Me.clientHeight,window.innerHeight||0),ft=ye?0:O(Me),Ut=ye?0:O(Me,"left"),ti={top:ft-qe.top+qe.marginTop,left:Ut-qe.left+qe.marginLeft,width:gt,height:_t};return Be(ti)}function ne(W){var ye=W.nodeName;if("BODY"===ye||"HTML"===ye)return!1;if("fixed"===Qe(W,"position"))return!0;var Me=v(W);return!!Me&&ne(Me)}function mt(W){if(!W||!W.parentElement||o())return document.documentElement;for(var ye=W.parentElement;ye&&"none"===Qe(ye,"transform");)ye=ye.parentElement;return ye||document.documentElement}function C(W,ye,Me,qe){var gt=4<arguments.length&&void 0!==arguments[4]&&arguments[4],_t={top:0,left:0},ft=gt?mt(W):k(W,ae(ye));if("viewport"===qe)_t=Ke(ft,gt);else{var Ut;"scrollParent"===qe?"BODY"===(Ut=$(v(ye))).nodeName&&(Ut=W.ownerDocument.documentElement):Ut="window"===qe?W.ownerDocument.documentElement:qe;var ti=Se(Ut,ft,gt);if("HTML"!==Ut.nodeName||ne(ft))_t=ti;else{var Ci=te(W.ownerDocument),xi=Ci.height,pi=Ci.width;_t.top+=ti.top-ti.marginTop,_t.bottom=xi+ti.top,_t.left+=ti.left-ti.marginLeft,_t.right=pi+ti.left}}var Ii="number"==typeof(Me=Me||0);return _t.left+=Ii?Me:Me.left||0,_t.top+=Ii?Me:Me.top||0,_t.right-=Ii?Me:Me.right||0,_t.bottom-=Ii?Me:Me.bottom||0,_t}function wt(W){return W.width*W.height}function xt(W,ye,Me,qe,gt){var _t=5<arguments.length&&void 0!==arguments[5]?arguments[5]:0;if(-1===W.indexOf("auto"))return W;var ft=C(Me,qe,_t,gt),Ut={top:{width:ft.width,height:ye.top-ft.top},right:{width:ft.right-ye.right,height:ft.height},bottom:{width:ft.width,height:ft.bottom-ye.bottom},left:{width:ye.left-ft.left,height:ft.height}},ti=Object.keys(Ut).map(function(Ii){return Ce({key:Ii},Ut[Ii],{area:wt(Ut[Ii])})}).sort(function(Ii,Gi){return Gi.area-Ii.area}),Ci=ti.filter(function(Ii){return Ii.width>=Me.clientWidth&&Ii.height>=Me.clientHeight}),xi=0<Ci.length?Ci[0].key:ti[0].key,pi=W.split("-")[1];return xi+(pi?"-"+pi:"")}function Wt(W,ye,Me){var qe=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,gt=qe?mt(ye):k(ye,ae(Me));return Se(Me,gt,qe)}function Nt(W){var Me=W.ownerDocument.defaultView.getComputedStyle(W),qe=parseFloat(Me.marginTop||0)+parseFloat(Me.marginBottom||0),gt=parseFloat(Me.marginLeft||0)+parseFloat(Me.marginRight||0);return{width:W.offsetWidth+gt,height:W.offsetHeight+qe}}function fi(W){var ye={left:"right",right:"left",bottom:"top",top:"bottom"};return W.replace(/left|right|bottom|top/g,function(Me){return ye[Me]})}function $t(W,ye,Me){Me=Me.split("-")[0];var qe=Nt(W),gt={width:qe.width,height:qe.height},_t=-1!==["right","left"].indexOf(Me),ft=_t?"top":"left",Ut=_t?"left":"top",ti=_t?"height":"width",Ci=_t?"width":"height";return gt[ft]=ye[ft]+ye[ti]/2-qe[ti]/2,gt[Ut]=Me===Ut?ye[Ut]-qe[Ci]:ye[fi(Ut)],gt}function li(W,ye){return Array.prototype.find?W.find(ye):W.filter(ye)[0]}function Ri(W,ye,Me){var qe=void 0===Me?W:W.slice(0,function qt(W,ye,Me){if(Array.prototype.findIndex)return W.findIndex(function(gt){return gt[ye]===Me});var qe=li(W,function(gt){return gt[ye]===Me});return W.indexOf(qe)}(W,"name",Me));return qe.forEach(function(gt){gt.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var _t=gt.function||gt.fn;gt.enabled&&Ae(_t)&&(ye.offsets.popper=Be(ye.offsets.popper),ye.offsets.reference=Be(ye.offsets.reference),ye=_t(ye,gt))}),ye}function Bi(){if(!this.state.isDestroyed){var W={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};W.offsets.reference=Wt(this.state,this.popper,this.reference,this.options.positionFixed),W.placement=xt(this.options.placement,W.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),W.originalPlacement=W.placement,W.positionFixed=this.options.positionFixed,W.offsets.popper=$t(this.popper,W.offsets.reference,W.placement),W.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",W=Ri(this.modifiers,W),this.state.isCreated?this.options.onUpdate(W):(this.state.isCreated=!0,this.options.onCreate(W))}}function mi(W,ye){return W.some(function(Me){return Me.enabled&&Me.name===ye})}function tn(W){for(var ye=[!1,"ms","Webkit","Moz","O"],Me=W.charAt(0).toUpperCase()+W.slice(1),qe=0;qe<ye.length;qe++){var gt=ye[qe],_t=gt?""+gt+Me:W;if(typeof document.body.style[_t]<"u")return _t}return null}function Pt(){return this.state.isDestroyed=!0,mi(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[tn("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function wi(W){var ye=W.ownerDocument;return ye?ye.defaultView:window}function ji(W,ye,Me,qe){var gt="BODY"===W.nodeName,_t=gt?W.ownerDocument.defaultView:W;_t.addEventListener(ye,Me,{passive:!0}),gt||ji($(_t.parentNode),ye,Me,qe),qe.push(_t)}function pt(W,ye,Me,qe){Me.updateBound=qe,wi(W).addEventListener("resize",Me.updateBound,{passive:!0});var gt=$(W);return ji(gt,"scroll",Me.updateBound,Me.scrollParents),Me.scrollElement=gt,Me.eventsEnabled=!0,Me}function Si(){this.state.eventsEnabled||(this.state=pt(this.reference,0,this.state,this.scheduleUpdate))}function Bn(){this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=function mn(W,ye){return wi(W).removeEventListener("resize",ye.updateBound),ye.scrollParents.forEach(function(Me){Me.removeEventListener("scroll",ye.updateBound)}),ye.updateBound=null,ye.scrollParents=[],ye.scrollElement=null,ye.eventsEnabled=!1,ye}(this.reference,this.state))}function yn(W){return""!==W&&!isNaN(parseFloat(W))&&isFinite(W)}function En(W,ye){Object.keys(ye).forEach(function(Me){var qe="";-1!==["width","height","top","right","bottom","left"].indexOf(Me)&&yn(ye[Me])&&(qe="px"),W.style[Me]=ye[Me]+qe})}function Fn(W,ye,Me){var qe=li(W,function(ft){return ft.name===ye}),gt=!!qe&&W.some(function(ft){return ft.name===Me&&ft.enabled&&ft.order<qe.order});if(!gt){var _t="`"+ye+"`";console.warn("`"+Me+"` modifier is required by "+_t+" modifier in order to work, be sure to include it before "+_t+"!")}return gt}function Nn(W){var ye=1<arguments.length&&void 0!==arguments[1]&&arguments[1],Me=Bt.indexOf(W),qe=Bt.slice(Me+1).concat(Bt.slice(0,Me));return ye?qe.reverse():qe}var lt=Math.min,Y=Math.floor,ue=Math.round,oe=Math.max,$e=typeof window<"u"&&typeof document<"u"&&typeof navigator<"u",Ge=function(){for(var W=["Edge","Trident","Firefox"],ye=0;ye<W.length;ye+=1)if($e&&0<=navigator.userAgent.indexOf(W[ye]))return 1;return 0}(),Rt=$e&&window.Promise?function(W){var ye=!1;return function(){ye||(ye=!0,window.Promise.resolve().then(function(){ye=!1,W()}))}}:function(W){var ye=!1;return function(){ye||(ye=!0,setTimeout(function(){ye=!1,W()},Ge))}},Mt=$e&&!(!window.MSInputMethodContext||!document.documentMode),jt=$e&&/MSIE 10/.test(navigator.userAgent),Lt=function(W,ye){if(!(W instanceof ye))throw new TypeError("Cannot call a class as a function")},yi=function(){function W(ye,Me){for(var qe,gt=0;gt<Me.length;gt++)(qe=Me[gt]).enumerable=qe.enumerable||!1,qe.configurable=!0,"value"in qe&&(qe.writable=!0),Object.defineProperty(ye,qe.key,qe)}return function(ye,Me,qe){return Me&&W(ye.prototype,Me),qe&&W(ye,qe),ye}}(),ve=function(W,ye,Me){return ye in W?Object.defineProperty(W,ye,{value:Me,enumerable:!0,configurable:!0,writable:!0}):W[ye]=Me,W},Ce=Object.assign||function(W){for(var ye,Me=1;Me<arguments.length;Me++)for(var qe in ye=arguments[Me])Object.prototype.hasOwnProperty.call(ye,qe)&&(W[qe]=ye[qe]);return W},We=$e&&/Firefox/i.test(navigator.userAgent),vt=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],Bt=vt.slice(3),si=function(){function W(ye,Me){var qe=this,gt=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};Lt(this,W),this.scheduleUpdate=function(){return requestAnimationFrame(qe.update)},this.update=Rt(this.update.bind(this)),this.options=Ce({},W.Defaults,gt),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=ye&&ye.jquery?ye[0]:ye,this.popper=Me&&Me.jquery?Me[0]:Me,this.options.modifiers={},Object.keys(Ce({},W.Defaults.modifiers,gt.modifiers)).forEach(function(ft){qe.options.modifiers[ft]=Ce({},W.Defaults.modifiers[ft]||{},gt.modifiers?gt.modifiers[ft]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(ft){return Ce({name:ft},qe.options.modifiers[ft])}).sort(function(ft,Ut){return ft.order-Ut.order}),this.modifiers.forEach(function(ft){ft.enabled&&Ae(ft.onLoad)&&ft.onLoad(qe.reference,qe.popper,qe.options,ft,qe.state)}),this.update();var _t=this.options.eventsEnabled;_t&&this.enableEventListeners(),this.state.eventsEnabled=_t}return yi(W,[{key:"update",value:function(){return Bi.call(this)}},{key:"destroy",value:function(){return Pt.call(this)}},{key:"enableEventListeners",value:function(){return Si.call(this)}},{key:"disableEventListeners",value:function(){return Bn.call(this)}}]),W}();return si.Utils=(typeof window>"u"?global:window).PopperUtils,si.placements=vt,si.Defaults={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:{shift:{order:100,enabled:!0,fn:function(W){var ye=W.placement,Me=ye.split("-")[0],qe=ye.split("-")[1];if(qe){var gt=W.offsets,_t=gt.reference,ft=gt.popper,Ut=-1!==["bottom","top"].indexOf(Me),ti=Ut?"left":"top",Ci=Ut?"width":"height",xi={start:ve({},ti,_t[ti]),end:ve({},ti,_t[ti]+_t[Ci]-ft[Ci])};W.offsets.popper=Ce({},ft,xi[qe])}return W}},offset:{order:200,enabled:!0,fn:function Ai(W,ye){var Me,qe=ye.offset,_t=W.offsets,ft=_t.popper,Ut=_t.reference,ti=W.placement.split("-")[0];return Me=yn(+qe)?[+qe,0]:function gi(W,ye,Me,qe){var gt=[0,0],_t=-1!==["right","left"].indexOf(qe),ft=W.split(/(\+|\-)/).map(function(xi){return xi.trim()}),Ut=ft.indexOf(li(ft,function(xi){return-1!==xi.search(/,|\s/)}));ft[Ut]&&-1===ft[Ut].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var ti=/\s*,\s*|\s+/,Ci=-1===Ut?[ft]:[ft.slice(0,Ut).concat([ft[Ut].split(ti)[0]]),[ft[Ut].split(ti)[1]].concat(ft.slice(Ut+1))];return Ci=Ci.map(function(xi,pi){var Ii=(1===pi?!_t:_t)?"height":"width",Gi=!1;return xi.reduce(function(re,U){return""===re[re.length-1]&&-1!==["+","-"].indexOf(U)?(re[re.length-1]=U,Gi=!0,re):Gi?(re[re.length-1]+=U,Gi=!1,re):re.concat(U)},[]).map(function(re){return function Xi(W,ye,Me,qe){var gt=W.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),_t=+gt[1],ft=gt[2];return _t?0===ft.indexOf("%")?Be("%p"===ft?Me:qe)[ye]/100*_t:"vh"===ft||"vw"===ft?("vh"===ft?oe(document.documentElement.clientHeight,window.innerHeight||0):oe(document.documentElement.clientWidth,window.innerWidth||0))/100*_t:_t:W}(re,Ii,ye,Me)})}),Ci.forEach(function(xi,pi){xi.forEach(function(Ii,Gi){yn(Ii)&&(gt[pi]+=Ii*("-"===xi[Gi-1]?-1:1))})}),gt}(qe,ft,Ut,ti),"left"===ti?(ft.top+=Me[0],ft.left-=Me[1]):"right"===ti?(ft.top+=Me[0],ft.left+=Me[1]):"top"===ti?(ft.left+=Me[0],ft.top-=Me[1]):"bottom"===ti&&(ft.left+=Me[0],ft.top+=Me[1]),W.popper=ft,W},offset:0},preventOverflow:{order:300,enabled:!0,fn:function(W,ye){var Me=ye.boundariesElement||D(W.instance.popper);W.instance.reference===Me&&(Me=D(Me));var qe=tn("transform"),gt=W.instance.popper.style,_t=gt.top,ft=gt.left,Ut=gt[qe];gt.top="",gt.left="",gt[qe]="";var ti=C(W.instance.popper,W.instance.reference,ye.padding,Me,W.positionFixed);gt.top=_t,gt.left=ft,gt[qe]=Ut,ye.boundaries=ti;var xi=W.offsets.popper,pi={primary:function(Ii){var Gi=xi[Ii];return xi[Ii]<ti[Ii]&&!ye.escapeWithReference&&(Gi=oe(xi[Ii],ti[Ii])),ve({},Ii,Gi)},secondary:function(Ii){var Gi="right"===Ii?"left":"top",re=xi[Gi];return xi[Ii]>ti[Ii]&&!ye.escapeWithReference&&(re=lt(xi[Gi],ti[Ii]-("right"===Ii?xi.width:xi.height))),ve({},Gi,re)}};return ye.priority.forEach(function(Ii){var Gi=-1===["left","top"].indexOf(Ii)?"secondary":"primary";xi=Ce({},xi,pi[Gi](Ii))}),W.offsets.popper=xi,W},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function(W){var ye=W.offsets,Me=ye.popper,qe=ye.reference,gt=W.placement.split("-")[0],_t=Y,ft=-1!==["top","bottom"].indexOf(gt),Ut=ft?"right":"bottom",ti=ft?"left":"top",Ci=ft?"width":"height";return Me[Ut]<_t(qe[ti])&&(W.offsets.popper[ti]=_t(qe[ti])-Me[Ci]),Me[ti]>_t(qe[Ut])&&(W.offsets.popper[ti]=_t(qe[Ut])),W}},arrow:{order:500,enabled:!0,fn:function(W,ye){var Me;if(!Fn(W.instance.modifiers,"arrow","keepTogether"))return W;var qe=ye.element;if("string"==typeof qe){if(!(qe=W.instance.popper.querySelector(qe)))return W}else if(!W.instance.popper.contains(qe))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),W;var gt=W.placement.split("-")[0],_t=W.offsets,ft=_t.popper,Ut=_t.reference,ti=-1!==["left","right"].indexOf(gt),Ci=ti?"height":"width",xi=ti?"Top":"Left",pi=xi.toLowerCase(),Ii=ti?"left":"top",Gi=ti?"bottom":"right",re=Nt(qe)[Ci];Ut[Gi]-re<ft[pi]&&(W.offsets.popper[pi]-=ft[pi]-(Ut[Gi]-re)),Ut[pi]+re>ft[Gi]&&(W.offsets.popper[pi]+=Ut[pi]+re-ft[Gi]),W.offsets.popper=Be(W.offsets.popper);var U=Ut[pi]+Ut[Ci]/2-re/2,Z=Qe(W.instance.popper),me=parseFloat(Z["margin"+xi]),xe=parseFloat(Z["border"+xi+"Width"]),De=U-W.offsets.popper[pi]-me-xe;return De=oe(lt(ft[Ci]-re,De),0),W.arrowElement=qe,W.offsets.arrow=(ve(Me={},pi,ue(De)),ve(Me,Ii,""),Me),W},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function(W,ye){if(mi(W.instance.modifiers,"inner")||W.flipped&&W.placement===W.originalPlacement)return W;var Me=C(W.instance.popper,W.instance.reference,ye.padding,ye.boundariesElement,W.positionFixed),qe=W.placement.split("-")[0],gt=fi(qe),_t=W.placement.split("-")[1]||"",ft=[];switch(ye.behavior){case"flip":ft=[qe,gt];break;case"clockwise":ft=Nn(qe);break;case"counterclockwise":ft=Nn(qe,!0);break;default:ft=ye.behavior}return ft.forEach(function(Ut,ti){if(qe!==Ut||ft.length===ti+1)return W;qe=W.placement.split("-")[0],gt=fi(qe);var Ci=W.offsets.popper,xi=W.offsets.reference,pi=Y,Ii="left"===qe&&pi(Ci.right)>pi(xi.left)||"right"===qe&&pi(Ci.left)<pi(xi.right)||"top"===qe&&pi(Ci.bottom)>pi(xi.top)||"bottom"===qe&&pi(Ci.top)<pi(xi.bottom),Gi=pi(Ci.left)<pi(Me.left),re=pi(Ci.right)>pi(Me.right),U=pi(Ci.top)<pi(Me.top),Z=pi(Ci.bottom)>pi(Me.bottom),me="left"===qe&&Gi||"right"===qe&&re||"top"===qe&&U||"bottom"===qe&&Z,xe=-1!==["top","bottom"].indexOf(qe),He=!!ye.flipVariations&&(xe&&"start"===_t&&Gi||xe&&"end"===_t&&re||!xe&&"start"===_t&&U||!xe&&"end"===_t&&Z)||!!ye.flipVariationsByContent&&(xe&&"start"===_t&&re||xe&&"end"===_t&&Gi||!xe&&"start"===_t&&Z||!xe&&"end"===_t&&U);(Ii||me||He)&&(W.flipped=!0,(Ii||me)&&(qe=ft[ti+1]),He&&(_t=function Ji(W){return"end"===W?"start":"start"===W?"end":W}(_t)),W.placement=qe+(_t?"-"+_t:""),W.offsets.popper=Ce({},W.offsets.popper,$t(W.instance.popper,W.offsets.reference,W.placement)),W=Ri(W.instance.modifiers,W,"flip"))}),W},behavior:"flip",padding:5,boundariesElement:"viewport",flipVariations:!1,flipVariationsByContent:!1},inner:{order:700,enabled:!1,fn:function(W){var ye=W.placement,Me=ye.split("-")[0],qe=W.offsets,gt=qe.popper,_t=qe.reference,ft=-1!==["left","right"].indexOf(Me),Ut=-1===["top","left"].indexOf(Me);return gt[ft?"left":"top"]=_t[Me]-(Ut?gt[ft?"width":"height"]:0),W.placement=fi(ye),W.offsets.popper=Be(gt),W}},hide:{order:800,enabled:!0,fn:function(W){if(!Fn(W.instance.modifiers,"hide","preventOverflow"))return W;var ye=W.offsets.reference,Me=li(W.instance.modifiers,function(qe){return"preventOverflow"===qe.name}).boundaries;if(ye.bottom<Me.top||ye.left>Me.right||ye.top>Me.bottom||ye.right<Me.left){if(!0===W.hide)return W;W.hide=!0,W.attributes["x-out-of-boundaries"]=""}else{if(!1===W.hide)return W;W.hide=!1,W.attributes["x-out-of-boundaries"]=!1}return W}},computeStyle:{order:850,enabled:!0,fn:function(W,ye){var Me=ye.x,qe=ye.y,gt=W.offsets.popper,_t=li(W.instance.modifiers,function(De){return"applyStyle"===De.name}).gpuAcceleration;void 0!==_t&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var ft,Ut,ti=void 0===_t?ye.gpuAcceleration:_t,Ci=D(W.instance.popper),xi=Ie(Ci),pi={position:gt.position},Ii=function vn(W,ye){var Me=W.offsets,qe=Me.popper,_t=ue,ft=function(Gi){return Gi},Ut=_t(Me.reference.width),ti=_t(qe.width),Ci=-1!==["left","right"].indexOf(W.placement),xi=-1!==W.placement.indexOf("-"),pi=ye?Ci||xi||Ut%2==ti%2?_t:Y:ft,Ii=ye?_t:ft;return{left:pi(Ut%2==1&&ti%2==1&&!xi&&ye?qe.left-1:qe.left),top:Ii(qe.top),bottom:Ii(qe.bottom),right:pi(qe.right)}}(W,2>window.devicePixelRatio||!We),Gi="bottom"===Me?"top":"bottom",re="right"===qe?"left":"right",U=tn("transform");if(Ut="bottom"==Gi?"HTML"===Ci.nodeName?-Ci.clientHeight+Ii.bottom:-xi.height+Ii.bottom:Ii.top,ft="right"==re?"HTML"===Ci.nodeName?-Ci.clientWidth+Ii.right:-xi.width+Ii.right:Ii.left,ti&&U)pi[U]="translate3d("+ft+"px, "+Ut+"px, 0)",pi[Gi]=0,pi[re]=0,pi.willChange="transform";else{var me="right"==re?-1:1;pi[Gi]=Ut*("bottom"==Gi?-1:1),pi[re]=ft*me,pi.willChange=Gi+", "+re}return W.attributes=Ce({},{"x-placement":W.placement},W.attributes),W.styles=Ce({},pi,W.styles),W.arrowStyles=Ce({},W.offsets.arrow,W.arrowStyles),W},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function(W){return En(W.instance.popper,W.styles),function Jn(W,ye){Object.keys(ye).forEach(function(Me){!1===ye[Me]?W.removeAttribute(Me):W.setAttribute(Me,ye[Me])})}(W.instance.popper,W.attributes),W.arrowElement&&Object.keys(W.arrowStyles).length&&En(W.arrowElement,W.arrowStyles),W},onLoad:function(W,ye,Me,qe,gt){var _t=Wt(gt,ye,W,Me.positionFixed),ft=xt(Me.placement,_t,ye,W,Me.modifiers.flip.boundariesElement,Me.modifiers.flip.padding);return ye.setAttribute("x-placement",ft),En(ye,{position:Me.positionFixed?"fixed":"absolute"}),Me},gpuAcceleration:void 0}}},si}),function(Ae,Qe){"object"==typeof exports&&typeof module<"u"?module.exports=Qe(require("@popperjs/core")):"function"==typeof define&&define.amd?define(["@popperjs/core"],Qe):(Ae=typeof globalThis<"u"?globalThis:Ae||self).bootstrap=Qe(Ae.Popper)}(this,function(Ae){"use strict";const v=function Qe(G){if(G&&G.__esModule)return G;const x=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(G)for(const B in G)if("default"!==B){const de=Object.getOwnPropertyDescriptor(G,B);Object.defineProperty(x,B,de.get?de:{enumerable:!0,get:()=>G[B]})}return x.default=G,Object.freeze(x)}(Ae),$="transitionend",ae=G=>{let x=G.getAttribute("data-bs-target");if(!x||"#"===x){let B=G.getAttribute("href");if(!B||!B.includes("#")&&!B.startsWith("."))return null;B.includes("#")&&!B.startsWith("#")&&(B=`#${B.split("#")[1]}`),x=B&&"#"!==B?B.trim():null}return x},o=G=>{const x=ae(G);return x&&document.querySelector(x)?x:null},D=G=>{const x=ae(G);return x?document.querySelector(x):null},N=G=>{G.dispatchEvent(new Event($))},j=G=>!(!G||"object"!=typeof G)&&(void 0!==G.jquery&&(G=G[0]),void 0!==G.nodeType),k=G=>j(G)?G.jquery?G[0]:G:"string"==typeof G&&G.length>0?document.querySelector(G):null,O=G=>{if(!j(G)||0===G.getClientRects().length)return!1;const x="visible"===getComputedStyle(G).getPropertyValue("visibility"),B=G.closest("details:not([open])");if(!B)return x;if(B!==G){const de=G.closest("summary");if(de&&de.parentNode!==B||null===de)return!1}return x},I=G=>!G||G.nodeType!==Node.ELEMENT_NODE||!!G.classList.contains("disabled")||(void 0!==G.disabled?G.disabled:G.hasAttribute("disabled")&&"false"!==G.getAttribute("disabled")),X=G=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof G.getRootNode){const x=G.getRootNode();return x instanceof ShadowRoot?x:null}return G instanceof ShadowRoot?G:G.parentNode?X(G.parentNode):null},le=()=>{},Be=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Ie=[],Se=()=>"rtl"===document.documentElement.dir,Ke=G=>{var x;x=()=>{const B=Be();if(B){const de=G.NAME,Ee=B.fn[de];B.fn[de]=G.jQueryInterface,B.fn[de].Constructor=G,B.fn[de].noConflict=()=>(B.fn[de]=Ee,G.jQueryInterface)}},"loading"===document.readyState?(Ie.length||document.addEventListener("DOMContentLoaded",()=>{for(const B of Ie)B()}),Ie.push(x)):x()},ne=G=>{"function"==typeof G&&G()},mt=(G,x,B=!0)=>{if(!B)return void ne(G);const de=(bt=>{if(!bt)return 0;let{transitionDuration:ei,transitionDelay:Yt}=window.getComputedStyle(bt);const hn=Number.parseFloat(ei),wn=Number.parseFloat(Yt);return hn||wn?(ei=ei.split(",")[0],Yt=Yt.split(",")[0],1e3*(Number.parseFloat(ei)+Number.parseFloat(Yt))):0})(x)+5;let Ee=!1;const Ne=({target:bt})=>{bt===x&&(Ee=!0,x.removeEventListener($,Ne),ne(G))};x.addEventListener($,Ne),setTimeout(()=>{Ee||N(x)},de)},C=(G,x,B,de)=>{const Ee=G.length;let Ne=G.indexOf(x);return-1===Ne?!B&&de?G[Ee-1]:G[0]:(Ne+=B?1:-1,de&&(Ne=(Ne+Ee)%Ee),G[Math.max(0,Math.min(Ne,Ee-1))])},wt=/[^.]*(?=\..*)\.|.*/,xt=/\..*/,Wt=/::\d+$/,Nt={};let fi=1;const $t={mouseenter:"mouseover",mouseleave:"mouseout"},li=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function qt(G,x){return x&&`${x}::${fi++}`||G.uidEvent||fi++}function Ri(G){const x=qt(G);return G.uidEvent=x,Nt[x]=Nt[x]||{},Nt[x]}function Bi(G,x,B=null){return Object.values(G).find(de=>de.callable===x&&de.delegationSelector===B)}function mi(G,x,B){const de="string"==typeof x,Ee=de?B:x||B;let Ne=ji(G);return li.has(Ne)||(Ne=G),[de,Ee,Ne]}function tn(G,x,B,de,Ee){if("string"!=typeof x||!G)return;let[Ne,bt,ei]=mi(x,B,de);var Fi;x in $t&&(Fi=bt,bt=function(rn){if(!rn.relatedTarget||rn.relatedTarget!==rn.delegateTarget&&!rn.delegateTarget.contains(rn.relatedTarget))return Fi.call(this,rn)});const Yt=Ri(G),hn=Yt[ei]||(Yt[ei]={}),wn=Bi(hn,bt,Ne?B:null);if(wn)return void(wn.oneOff=wn.oneOff&&Ee);const Pn=qt(bt,x.replace(wt,"")),fn=Ne?function(ki,Fi,rn){return function An(to){const No=ki.querySelectorAll(Fi);for(let{target:or}=to;or&&or!==this;or=or.parentNode)for(const co of No)if(co===or)return Si(to,{delegateTarget:or}),An.oneOff&&pt.off(ki,to.type,Fi,rn),rn.apply(or,[to])}}(G,B,bt):function(ki,Fi){return function rn(An){return Si(An,{delegateTarget:ki}),rn.oneOff&&pt.off(ki,An.type,Fi),Fi.apply(ki,[An])}}(G,bt);fn.delegationSelector=Ne?B:null,fn.callable=bt,fn.oneOff=Ee,fn.uidEvent=Pn,hn[Pn]=fn,G.addEventListener(ei,fn,Ne)}function Pt(G,x,B,de,Ee){const Ne=Bi(x[B],de,Ee);Ne&&(G.removeEventListener(B,Ne,Boolean(Ee)),delete x[B][Ne.uidEvent])}function wi(G,x,B,de){const Ee=x[B]||{};for(const Ne of Object.keys(Ee))if(Ne.includes(de)){const bt=Ee[Ne];Pt(G,x,B,bt.callable,bt.delegationSelector)}}function ji(G){return G=G.replace(xt,""),$t[G]||G}const pt={on(G,x,B,de){tn(G,x,B,de,!1)},one(G,x,B,de){tn(G,x,B,de,!0)},off(G,x,B,de){if("string"!=typeof x||!G)return;const[Ee,Ne,bt]=mi(x,B,de),ei=bt!==x,Yt=Ri(G),hn=Yt[bt]||{},wn=x.startsWith(".");if(void 0===Ne){if(wn)for(const Pn of Object.keys(Yt))wi(G,Yt,Pn,x.slice(1));for(const Pn of Object.keys(hn)){const fn=Pn.replace(Wt,"");if(!ei||x.includes(fn)){const ki=hn[Pn];Pt(G,Yt,bt,ki.callable,ki.delegationSelector)}}}else{if(!Object.keys(hn).length)return;Pt(G,Yt,bt,Ne,Ee?B:null)}},trigger(G,x,B){if("string"!=typeof x||!G)return null;const de=Be();let Ee=null,Ne=!0,bt=!0,ei=!1;x!==ji(x)&&de&&(Ee=de.Event(x,B),de(G).trigger(Ee),Ne=!Ee.isPropagationStopped(),bt=!Ee.isImmediatePropagationStopped(),ei=Ee.isDefaultPrevented());let Yt=new Event(x,{bubbles:Ne,cancelable:!0});return Yt=Si(Yt,B),ei&&Yt.preventDefault(),bt&&G.dispatchEvent(Yt),Yt.defaultPrevented&&Ee&&Ee.preventDefault(),Yt}};function Si(G,x){for(const[B,de]of Object.entries(x||{}))try{G[B]=de}catch{Object.defineProperty(G,B,{configurable:!0,get:()=>de})}return G}const mn=new Map,Bn={set(G,x,B){mn.has(G)||mn.set(G,new Map);const de=mn.get(G);de.has(x)||0===de.size?de.set(x,B):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(de.keys())[0]}.`)},get:(G,x)=>mn.has(G)&&mn.get(G).get(x)||null,remove(G,x){if(!mn.has(G))return;const B=mn.get(G);B.delete(x),0===B.size&&mn.delete(G)}};function yn(G){if("true"===G)return!0;if("false"===G)return!1;if(G===Number(G).toString())return Number(G);if(""===G||"null"===G)return null;if("string"!=typeof G)return G;try{return JSON.parse(decodeURIComponent(G))}catch{return G}}function En(G){return G.replace(/[A-Z]/g,x=>`-${x.toLowerCase()}`)}const Jn={setDataAttribute(G,x,B){G.setAttribute(`data-bs-${En(x)}`,B)},removeDataAttribute(G,x){G.removeAttribute(`data-bs-${En(x)}`)},getDataAttributes(G){if(!G)return{};const x={},B=Object.keys(G.dataset).filter(de=>de.startsWith("bs")&&!de.startsWith("bsConfig"));for(const de of B){let Ee=de.replace(/^bs/,"");Ee=Ee.charAt(0).toLowerCase()+Ee.slice(1,Ee.length),x[Ee]=yn(G.dataset[de])}return x},getDataAttribute:(G,x)=>yn(G.getAttribute(`data-bs-${En(x)}`))};class vn{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(x){return x=this._mergeConfigObj(x),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}_configAfterMerge(x){return x}_mergeConfigObj(x,B){const de=j(B)?Jn.getDataAttribute(B,"config"):{};return{...this.constructor.Default,..."object"==typeof de?de:{},...j(B)?Jn.getDataAttributes(B):{},..."object"==typeof x?x:{}}}_typeCheckConfig(x,B=this.constructor.DefaultType){for(const Ee of Object.keys(B)){const Ne=B[Ee],bt=x[Ee],ei=j(bt)?"element":null==(de=bt)?`${de}`:Object.prototype.toString.call(de).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(Ne).test(ei))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${Ee}" provided type "${ei}" but expected type "${Ne}".`)}var de}}class Fn extends vn{constructor(x,B){super(),(x=k(x))&&(this._element=x,this._config=this._getConfig(B),Bn.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Bn.remove(this._element,this.constructor.DATA_KEY),pt.off(this._element,this.constructor.EVENT_KEY);for(const x of Object.getOwnPropertyNames(this))this[x]=null}_queueCallback(x,B,de=!0){mt(x,B,de)}_getConfig(x){return x=this._mergeConfigObj(x,this._element),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}static getInstance(x){return Bn.get(k(x),this.DATA_KEY)}static getOrCreateInstance(x,B={}){return this.getInstance(x)||new this(x,"object"==typeof B?B:null)}static get VERSION(){return"5.2.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(x){return`${x}${this.EVENT_KEY}`}}const Ji=(G,x="hide")=>{const de=G.NAME;pt.on(document,`click.dismiss${G.EVENT_KEY}`,`[data-bs-dismiss="${de}"]`,function(Ee){if(["A","AREA"].includes(this.tagName)&&Ee.preventDefault(),I(this))return;const Ne=D(this)||this.closest(`.${de}`);G.getOrCreateInstance(Ne)[x]()})};class Nn extends Fn{static get NAME(){return"alert"}close(){if(pt.trigger(this._element,"close.bs.alert").defaultPrevented)return;this._element.classList.remove("show");const x=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,x)}_destroyElement(){this._element.remove(),pt.trigger(this._element,"closed.bs.alert"),this.dispose()}static jQueryInterface(x){return this.each(function(){const B=Nn.getOrCreateInstance(this);if("string"==typeof x){if(void 0===B[x]||x.startsWith("_")||"constructor"===x)throw new TypeError(`No method named "${x}"`);B[x](this)}})}}Ji(Nn,"close"),Ke(Nn);const Xi='[data-bs-toggle="button"]';class gi extends Fn{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(x){return this.each(function(){const B=gi.getOrCreateInstance(this);"toggle"===x&&B[x]()})}}pt.on(document,"click.bs.button.data-api",Xi,G=>{G.preventDefault();const x=G.target.closest(Xi);gi.getOrCreateInstance(x).toggle()}),Ke(gi);const Ai={find:(G,x=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(x,G)),findOne:(G,x=document.documentElement)=>Element.prototype.querySelector.call(x,G),children:(G,x)=>[].concat(...G.children).filter(B=>B.matches(x)),parents(G,x){const B=[];let de=G.parentNode.closest(x);for(;de;)B.push(de),de=de.parentNode.closest(x);return B},prev(G,x){let B=G.previousElementSibling;for(;B;){if(B.matches(x))return[B];B=B.previousElementSibling}return[]},next(G,x){let B=G.nextElementSibling;for(;B;){if(B.matches(x))return[B];B=B.nextElementSibling}return[]},focusableChildren(G){const x=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(B=>`${B}:not([tabindex^="-"])`).join(",");return this.find(x,G).filter(B=>!I(B)&&O(B))}},lt={endCallback:null,leftCallback:null,rightCallback:null},Y={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class ue extends vn{constructor(x,B){super(),this._element=x,x&&ue.isSupported()&&(this._config=this._getConfig(B),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return lt}static get DefaultType(){return Y}static get NAME(){return"swipe"}dispose(){pt.off(this._element,".bs.swipe")}_start(x){this._supportPointerEvents?this._eventIsPointerPenTouch(x)&&(this._deltaX=x.clientX):this._deltaX=x.touches[0].clientX}_end(x){this._eventIsPointerPenTouch(x)&&(this._deltaX=x.clientX-this._deltaX),this._handleSwipe(),ne(this._config.endCallback)}_move(x){this._deltaX=x.touches&&x.touches.length>1?0:x.touches[0].clientX-this._deltaX}_handleSwipe(){const x=Math.abs(this._deltaX);if(x<=40)return;const B=x/this._deltaX;this._deltaX=0,B&&ne(B>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(pt.on(this._element,"pointerdown.bs.swipe",x=>this._start(x)),pt.on(this._element,"pointerup.bs.swipe",x=>this._end(x)),this._element.classList.add("pointer-event")):(pt.on(this._element,"touchstart.bs.swipe",x=>this._start(x)),pt.on(this._element,"touchmove.bs.swipe",x=>this._move(x)),pt.on(this._element,"touchend.bs.swipe",x=>this._end(x)))}_eventIsPointerPenTouch(x){return this._supportPointerEvents&&("pen"===x.pointerType||"touch"===x.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const oe="next",$e="prev",Ge="left",ot="right",Rt="slid.bs.carousel",Mt="carousel",jt="active",Lt={ArrowLeft:ot,ArrowRight:Ge},yi={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},ve={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Ce extends Fn{constructor(x,B){super(x,B),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Ai.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===Mt&&this.cycle()}static get Default(){return yi}static get DefaultType(){return ve}static get NAME(){return"carousel"}next(){this._slide(oe)}nextWhenVisible(){!document.hidden&&O(this._element)&&this.next()}prev(){this._slide($e)}pause(){this._isSliding&&N(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?pt.one(this._element,Rt,()=>this.cycle()):this.cycle())}to(x){const B=this._getItems();if(x>B.length-1||x<0)return;if(this._isSliding)return void pt.one(this._element,Rt,()=>this.to(x));const de=this._getItemIndex(this._getActive());de!==x&&this._slide(x>de?oe:$e,B[x])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(x){return x.defaultInterval=x.interval,x}_addEventListeners(){this._config.keyboard&&pt.on(this._element,"keydown.bs.carousel",x=>this._keydown(x)),"hover"===this._config.pause&&(pt.on(this._element,"mouseenter.bs.carousel",()=>this.pause()),pt.on(this._element,"mouseleave.bs.carousel",()=>this._maybeEnableCycle())),this._config.touch&&ue.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const B of Ai.find(".carousel-item img",this._element))pt.on(B,"dragstart.bs.carousel",de=>de.preventDefault());this._swipeHelper=new ue(this._element,{leftCallback:()=>this._slide(this._directionToOrder(Ge)),rightCallback:()=>this._slide(this._directionToOrder(ot)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}})}_keydown(x){if(/input|textarea/i.test(x.target.tagName))return;const B=Lt[x.key];B&&(x.preventDefault(),this._slide(this._directionToOrder(B)))}_getItemIndex(x){return this._getItems().indexOf(x)}_setActiveIndicatorElement(x){if(!this._indicatorsElement)return;const B=Ai.findOne(".active",this._indicatorsElement);B.classList.remove(jt),B.removeAttribute("aria-current");const de=Ai.findOne(`[data-bs-slide-to="${x}"]`,this._indicatorsElement);de&&(de.classList.add(jt),de.setAttribute("aria-current","true"))}_updateInterval(){const x=this._activeElement||this._getActive();if(!x)return;const B=Number.parseInt(x.getAttribute("data-bs-interval"),10);this._config.interval=B||this._config.defaultInterval}_slide(x,B=null){if(this._isSliding)return;const de=this._getActive(),Ee=x===oe,Ne=B||C(this._getItems(),de,Ee,this._config.wrap);if(Ne===de)return;const bt=this._getItemIndex(Ne),ei=Pn=>pt.trigger(this._element,Pn,{relatedTarget:Ne,direction:this._orderToDirection(x),from:this._getItemIndex(de),to:bt});if(ei("slide.bs.carousel").defaultPrevented||!de||!Ne)return;const Yt=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(bt),this._activeElement=Ne;const hn=Ee?"carousel-item-start":"carousel-item-end",wn=Ee?"carousel-item-next":"carousel-item-prev";Ne.classList.add(wn),de.classList.add(hn),Ne.classList.add(hn),this._queueCallback(()=>{Ne.classList.remove(hn,wn),Ne.classList.add(jt),de.classList.remove(jt,wn,hn),this._isSliding=!1,ei(Rt)},de,this._isAnimated()),Yt&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Ai.findOne(".active.carousel-item",this._element)}_getItems(){return Ai.find(".carousel-item",this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(x){return Se()?x===Ge?$e:oe:x===Ge?oe:$e}_orderToDirection(x){return Se()?x===$e?Ge:ot:x===$e?ot:Ge}static jQueryInterface(x){return this.each(function(){const B=Ce.getOrCreateInstance(this,x);if("number"!=typeof x){if("string"==typeof x){if(void 0===B[x]||x.startsWith("_")||"constructor"===x)throw new TypeError(`No method named "${x}"`);B[x]()}}else B.to(x)})}}pt.on(document,"click.bs.carousel.data-api","[data-bs-slide], [data-bs-slide-to]",function(G){const x=D(this);if(!x||!x.classList.contains(Mt))return;G.preventDefault();const B=Ce.getOrCreateInstance(x),de=this.getAttribute("data-bs-slide-to");return de?(B.to(de),void B._maybeEnableCycle()):"next"===Jn.getDataAttribute(this,"slide")?(B.next(),void B._maybeEnableCycle()):(B.prev(),void B._maybeEnableCycle())}),pt.on(window,"load.bs.carousel.data-api",()=>{const G=Ai.find('[data-bs-ride="carousel"]');for(const x of G)Ce.getOrCreateInstance(x)}),Ke(Ce);const We="show",vt="collapse",Bt="collapsing",Xt='[data-bs-toggle="collapse"]',si={parent:null,toggle:!0},W={parent:"(null|element)",toggle:"boolean"};class ye extends Fn{constructor(x,B){super(x,B),this._isTransitioning=!1,this._triggerArray=[];const de=Ai.find(Xt);for(const Ee of de){const Ne=o(Ee),bt=Ai.find(Ne).filter(ei=>ei===this._element);null!==Ne&&bt.length&&this._triggerArray.push(Ee)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return si}static get DefaultType(){return W}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let x=[];if(this._config.parent&&(x=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(Ee=>Ee!==this._element).map(Ee=>ye.getOrCreateInstance(Ee,{toggle:!1}))),x.length&&x[0]._isTransitioning||pt.trigger(this._element,"show.bs.collapse").defaultPrevented)return;for(const Ee of x)Ee.hide();const B=this._getDimension();this._element.classList.remove(vt),this._element.classList.add(Bt),this._element.style[B]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const de=`scroll${B[0].toUpperCase()+B.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Bt),this._element.classList.add(vt,We),this._element.style[B]="",pt.trigger(this._element,"shown.bs.collapse")},this._element,!0),this._element.style[B]=`${this._element[de]}px`}hide(){if(this._isTransitioning||!this._isShown()||pt.trigger(this._element,"hide.bs.collapse").defaultPrevented)return;const x=this._getDimension();this._element.style[x]=`${this._element.getBoundingClientRect()[x]}px`,this._element.classList.add(Bt),this._element.classList.remove(vt,We);for(const B of this._triggerArray){const de=D(B);de&&!this._isShown(de)&&this._addAriaAndCollapsedClass([B],!1)}this._isTransitioning=!0,this._element.style[x]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(Bt),this._element.classList.add(vt),pt.trigger(this._element,"hidden.bs.collapse")},this._element,!0)}_isShown(x=this._element){return x.classList.contains(We)}_configAfterMerge(x){return x.toggle=Boolean(x.toggle),x.parent=k(x.parent),x}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const x=this._getFirstLevelChildren(Xt);for(const B of x){const de=D(B);de&&this._addAriaAndCollapsedClass([B],this._isShown(de))}}_getFirstLevelChildren(x){const B=Ai.find(":scope .collapse .collapse",this._config.parent);return Ai.find(x,this._config.parent).filter(de=>!B.includes(de))}_addAriaAndCollapsedClass(x,B){if(x.length)for(const de of x)de.classList.toggle("collapsed",!B),de.setAttribute("aria-expanded",B)}static jQueryInterface(x){const B={};return"string"==typeof x&&/show|hide/.test(x)&&(B.toggle=!1),this.each(function(){const de=ye.getOrCreateInstance(this,B);if("string"==typeof x){if(void 0===de[x])throw new TypeError(`No method named "${x}"`);de[x]()}})}}pt.on(document,"click.bs.collapse.data-api",Xt,function(G){("A"===G.target.tagName||G.delegateTarget&&"A"===G.delegateTarget.tagName)&&G.preventDefault();const x=o(this),B=Ai.find(x);for(const de of B)ye.getOrCreateInstance(de,{toggle:!1}).toggle()}),Ke(ye);const Me="dropdown",qe="ArrowUp",gt="ArrowDown",_t="click.bs.dropdown.data-api",ft="keydown.bs.dropdown.data-api",Ut="show",ti='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Ci=`${ti}.show`,xi=".dropdown-menu",pi=Se()?"top-end":"top-start",Ii=Se()?"top-start":"top-end",Gi=Se()?"bottom-end":"bottom-start",re=Se()?"bottom-start":"bottom-end",U=Se()?"left-start":"right-start",Z=Se()?"right-start":"left-start",me={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},xe={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class De extends Fn{constructor(x,B){super(x,B),this._popper=null,this._parent=this._element.parentNode,this._menu=Ai.next(this._element,xi)[0]||Ai.prev(this._element,xi)[0]||Ai.findOne(xi,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return me}static get DefaultType(){return xe}static get NAME(){return Me}toggle(){return this._isShown()?this.hide():this.show()}show(){if(I(this._element)||this._isShown())return;const x={relatedTarget:this._element};if(!pt.trigger(this._element,"show.bs.dropdown",x).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const B of[].concat(...document.body.children))pt.on(B,"mouseover",le);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Ut),this._element.classList.add(Ut),pt.trigger(this._element,"shown.bs.dropdown",x)}}hide(){!I(this._element)&&this._isShown()&&this._completeHide({relatedTarget:this._element})}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(x){if(!pt.trigger(this._element,"hide.bs.dropdown",x).defaultPrevented){if("ontouchstart"in document.documentElement)for(const B of[].concat(...document.body.children))pt.off(B,"mouseover",le);this._popper&&this._popper.destroy(),this._menu.classList.remove(Ut),this._element.classList.remove(Ut),this._element.setAttribute("aria-expanded","false"),Jn.removeDataAttribute(this._menu,"popper"),pt.trigger(this._element,"hidden.bs.dropdown",x)}}_getConfig(x){if("object"==typeof(x=super._getConfig(x)).reference&&!j(x.reference)&&"function"!=typeof x.reference.getBoundingClientRect)throw new TypeError(`${Me.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return x}_createPopper(){if(void 0===v)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let x=this._element;"parent"===this._config.reference?x=this._parent:j(this._config.reference)?x=k(this._config.reference):"object"==typeof this._config.reference&&(x=this._config.reference);const B=this._getPopperConfig();this._popper=v.createPopper(x,this._menu,B)}_isShown(){return this._menu.classList.contains(Ut)}_getPlacement(){const x=this._parent;if(x.classList.contains("dropend"))return U;if(x.classList.contains("dropstart"))return Z;if(x.classList.contains("dropup-center"))return"top";if(x.classList.contains("dropdown-center"))return"bottom";const B="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return x.classList.contains("dropup")?B?Ii:pi:B?re:Gi}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:x}=this._config;return"string"==typeof x?x.split(",").map(B=>Number.parseInt(B,10)):"function"==typeof x?B=>x(B,this._element):x}_getPopperConfig(){const x={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(Jn.setDataAttribute(this._menu,"popper","static"),x.modifiers=[{name:"applyStyles",enabled:!1}]),{...x,..."function"==typeof this._config.popperConfig?this._config.popperConfig(x):this._config.popperConfig}}_selectMenuItem({key:x,target:B}){const de=Ai.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(Ee=>O(Ee));de.length&&C(de,B,x===gt,!de.includes(B)).focus()}static jQueryInterface(x){return this.each(function(){const B=De.getOrCreateInstance(this,x);if("string"==typeof x){if(void 0===B[x])throw new TypeError(`No method named "${x}"`);B[x]()}})}static clearMenus(x){if(2===x.button||"keyup"===x.type&&"Tab"!==x.key)return;const B=Ai.find(Ci);for(const de of B){const Ee=De.getInstance(de);if(!Ee||!1===Ee._config.autoClose)continue;const Ne=x.composedPath(),bt=Ne.includes(Ee._menu);if(Ne.includes(Ee._element)||"inside"===Ee._config.autoClose&&!bt||"outside"===Ee._config.autoClose&&bt||Ee._menu.contains(x.target)&&("keyup"===x.type&&"Tab"===x.key||/input|select|option|textarea|form/i.test(x.target.tagName)))continue;const ei={relatedTarget:Ee._element};"click"===x.type&&(ei.clickEvent=x),Ee._completeHide(ei)}}static dataApiKeydownHandler(x){const B=/input|textarea/i.test(x.target.tagName),de="Escape"===x.key,Ee=[qe,gt].includes(x.key);if(!Ee&&!de||B&&!de)return;x.preventDefault();const Ne=this.matches(ti)?this:Ai.prev(this,ti)[0]||Ai.next(this,ti)[0]||Ai.findOne(ti,x.delegateTarget.parentNode),bt=De.getOrCreateInstance(Ne);if(Ee)return x.stopPropagation(),bt.show(),void bt._selectMenuItem(x);bt._isShown()&&(x.stopPropagation(),bt.hide(),Ne.focus())}}pt.on(document,ft,ti,De.dataApiKeydownHandler),pt.on(document,ft,xi,De.dataApiKeydownHandler),pt.on(document,_t,De.clearMenus),pt.on(document,"keyup.bs.dropdown.data-api",De.clearMenus),pt.on(document,_t,ti,function(G){G.preventDefault(),De.getOrCreateInstance(this).toggle()}),Ke(De);const Xe=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",He=".sticky-top",je="padding-right",et="margin-right";class St{constructor(){this._element=document.body}getWidth(){const x=document.documentElement.clientWidth;return Math.abs(window.innerWidth-x)}hide(){const x=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,je,B=>B+x),this._setElementAttributes(Xe,je,B=>B+x),this._setElementAttributes(He,et,B=>B-x)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,je),this._resetElementAttributes(Xe,je),this._resetElementAttributes(He,et)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(x,B,de){const Ee=this.getWidth();this._applyManipulationCallback(x,Ne=>{if(Ne!==this._element&&window.innerWidth>Ne.clientWidth+Ee)return;this._saveInitialAttribute(Ne,B);const bt=window.getComputedStyle(Ne).getPropertyValue(B);Ne.style.setProperty(B,`${de(Number.parseFloat(bt))}px`)})}_saveInitialAttribute(x,B){const de=x.style.getPropertyValue(B);de&&Jn.setDataAttribute(x,B,de)}_resetElementAttributes(x,B){this._applyManipulationCallback(x,de=>{const Ee=Jn.getDataAttribute(de,B);null!==Ee?(Jn.removeDataAttribute(de,B),de.style.setProperty(B,Ee)):de.style.removeProperty(B)})}_applyManipulationCallback(x,B){if(j(x))B(x);else for(const de of Ai.find(x,this._element))B(de)}}const kt="mousedown.bs.backdrop",Mi={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Ti={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class bi extends vn{constructor(x){super(),this._config=this._getConfig(x),this._isAppended=!1,this._element=null}static get Default(){return Mi}static get DefaultType(){return Ti}static get NAME(){return"backdrop"}show(x){if(!this._config.isVisible)return void ne(x);this._append();this._getElement().classList.add("show"),this._emulateAnimation(()=>{ne(x)})}hide(x){this._config.isVisible?(this._getElement().classList.remove("show"),this._emulateAnimation(()=>{this.dispose(),ne(x)})):ne(x)}dispose(){this._isAppended&&(pt.off(this._element,kt),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const x=document.createElement("div");x.className=this._config.className,this._config.isAnimated&&x.classList.add("fade"),this._element=x}return this._element}_configAfterMerge(x){return x.rootElement=k(x.rootElement),x}_append(){if(this._isAppended)return;const x=this._getElement();this._config.rootElement.append(x),pt.on(x,kt,()=>{ne(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(x){mt(x,this._getElement(),this._config.isAnimated)}}const Di=".bs.focustrap",Qi="backward",gn={autofocus:!0,trapElement:null},Pi={autofocus:"boolean",trapElement:"element"};class xn extends vn{constructor(x){super(),this._config=this._getConfig(x),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return gn}static get DefaultType(){return Pi}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),pt.off(document,Di),pt.on(document,"focusin.bs.focustrap",x=>this._handleFocusin(x)),pt.on(document,"keydown.tab.bs.focustrap",x=>this._handleKeydown(x)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,pt.off(document,Di))}_handleFocusin(x){const{trapElement:B}=this._config;if(x.target===document||x.target===B||B.contains(x.target))return;const de=Ai.focusableChildren(B);0===de.length?B.focus():this._lastTabNavDirection===Qi?de[de.length-1].focus():de[0].focus()}_handleKeydown(x){"Tab"===x.key&&(this._lastTabNavDirection=x.shiftKey?Qi:"forward")}}const bn="hidden.bs.modal",Yr="show.bs.modal",Kr="modal-open",_r="modal-static",Hn={backdrop:!0,focus:!0,keyboard:!0},Lr={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class _o extends Fn{constructor(x,B){super(x,B),this._dialog=Ai.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new St,this._addEventListeners()}static get Default(){return Hn}static get DefaultType(){return Lr}static get NAME(){return"modal"}toggle(x){return this._isShown?this.hide():this.show(x)}show(x){this._isShown||this._isTransitioning||pt.trigger(this._element,Yr,{relatedTarget:x}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Kr),this._adjustDialog(),this._backdrop.show(()=>this._showElement(x)))}hide(){this._isShown&&!this._isTransitioning&&(pt.trigger(this._element,"hide.bs.modal").defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove("show"),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){for(const x of[window,this._dialog])pt.off(x,".bs.modal");this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new bi({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new xn({trapElement:this._element})}_showElement(x){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const B=Ai.findOne(".modal-body",this._dialog);B&&(B.scrollTop=0),this._element.classList.add("show"),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,pt.trigger(this._element,"shown.bs.modal",{relatedTarget:x})},this._dialog,this._isAnimated())}_addEventListeners(){pt.on(this._element,"keydown.dismiss.bs.modal",x=>{if("Escape"===x.key)return this._config.keyboard?(x.preventDefault(),void this.hide()):void this._triggerBackdropTransition()}),pt.on(window,"resize.bs.modal",()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),pt.on(this._element,"mousedown.dismiss.bs.modal",x=>{pt.one(this._element,"click.dismiss.bs.modal",B=>{this._element===x.target&&this._element===B.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Kr),this._resetAdjustments(),this._scrollBar.reset(),pt.trigger(this._element,bn)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(pt.trigger(this._element,"hidePrevented.bs.modal").defaultPrevented)return;const x=this._element.scrollHeight>document.documentElement.clientHeight,B=this._element.style.overflowY;"hidden"===B||this._element.classList.contains(_r)||(x||(this._element.style.overflowY="hidden"),this._element.classList.add(_r),this._queueCallback(()=>{this._element.classList.remove(_r),this._queueCallback(()=>{this._element.style.overflowY=B},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const x=this._element.scrollHeight>document.documentElement.clientHeight,B=this._scrollBar.getWidth(),de=B>0;if(de&&!x){const Ee=Se()?"paddingLeft":"paddingRight";this._element.style[Ee]=`${B}px`}if(!de&&x){const Ee=Se()?"paddingRight":"paddingLeft";this._element.style[Ee]=`${B}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(x,B){return this.each(function(){const de=_o.getOrCreateInstance(this,x);if("string"==typeof x){if(void 0===de[x])throw new TypeError(`No method named "${x}"`);de[x](B)}})}}pt.on(document,"click.bs.modal.data-api",'[data-bs-toggle="modal"]',function(G){const x=D(this);["A","AREA"].includes(this.tagName)&&G.preventDefault(),pt.one(x,Yr,de=>{de.defaultPrevented||pt.one(x,bn,()=>{O(this)&&this.focus()})});const B=Ai.findOne(".modal.show");B&&_o.getInstance(B).hide(),_o.getOrCreateInstance(x).toggle(this)}),Ji(_o),Ke(_o);const Oo="showing",Eo=".offcanvas.show",Jt="hidePrevented.bs.offcanvas",nn="hidden.bs.offcanvas",Vi={backdrop:!0,keyboard:!0,scroll:!1},Qr={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class hr extends Fn{constructor(x,B){super(x,B),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Vi}static get DefaultType(){return Qr}static get NAME(){return"offcanvas"}toggle(x){return this._isShown?this.hide():this.show(x)}show(x){this._isShown||pt.trigger(this._element,"show.bs.offcanvas",{relatedTarget:x}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new St).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Oo),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add("show"),this._element.classList.remove(Oo),pt.trigger(this._element,"shown.bs.offcanvas",{relatedTarget:x})},this._element,!0))}hide(){this._isShown&&(pt.trigger(this._element,"hide.bs.offcanvas").defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add("hiding"),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove("show","hiding"),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new St).reset(),pt.trigger(this._element,nn)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const x=Boolean(this._config.backdrop);return new bi({className:"offcanvas-backdrop",isVisible:x,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:x?()=>{"static"!==this._config.backdrop?this.hide():pt.trigger(this._element,Jt)}:null})}_initializeFocusTrap(){return new xn({trapElement:this._element})}_addEventListeners(){pt.on(this._element,"keydown.dismiss.bs.offcanvas",x=>{"Escape"===x.key&&(this._config.keyboard?this.hide():pt.trigger(this._element,Jt))})}static jQueryInterface(x){return this.each(function(){const B=hr.getOrCreateInstance(this,x);if("string"==typeof x){if(void 0===B[x]||x.startsWith("_")||"constructor"===x)throw new TypeError(`No method named "${x}"`);B[x](this)}})}}pt.on(document,"click.bs.offcanvas.data-api",'[data-bs-toggle="offcanvas"]',function(G){const x=D(this);if(["A","AREA"].includes(this.tagName)&&G.preventDefault(),I(this))return;pt.one(x,nn,()=>{O(this)&&this.focus()});const B=Ai.findOne(Eo);B&&B!==x&&hr.getInstance(B).hide(),hr.getOrCreateInstance(x).toggle(this)}),pt.on(window,"load.bs.offcanvas.data-api",()=>{for(const G of Ai.find(Eo))hr.getOrCreateInstance(G).show()}),pt.on(window,"resize.bs.offcanvas",()=>{for(const G of Ai.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(G).position&&hr.getOrCreateInstance(G).hide()}),Ji(hr),Ke(hr);const an=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),os=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,jr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,Vr=(G,x)=>{const B=G.nodeName.toLowerCase();return x.includes(B)?!an.has(B)||Boolean(os.test(G.nodeValue)||jr.test(G.nodeValue)):x.filter(de=>de instanceof RegExp).some(de=>de.test(B))},yr={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Dn={allowList:yr,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},ra={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},$r={entry:"(string|element|function|null)",selector:"(string|element)"};class So extends vn{constructor(x){super(),this._config=this._getConfig(x)}static get Default(){return Dn}static get DefaultType(){return ra}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(x=>this._resolvePossibleFunction(x)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(x){return this._checkContent(x),this._config.content={...this._config.content,...x},this}toHtml(){const x=document.createElement("div");x.innerHTML=this._maybeSanitize(this._config.template);for(const[Ee,Ne]of Object.entries(this._config.content))this._setContent(x,Ne,Ee);const B=x.children[0],de=this._resolvePossibleFunction(this._config.extraClass);return de&&B.classList.add(...de.split(" ")),B}_typeCheckConfig(x){super._typeCheckConfig(x),this._checkContent(x.content)}_checkContent(x){for(const[B,de]of Object.entries(x))super._typeCheckConfig({selector:B,entry:de},$r)}_setContent(x,B,de){const Ee=Ai.findOne(de,x);Ee&&((B=this._resolvePossibleFunction(B))?j(B)?this._putElementInTemplate(k(B),Ee):this._config.html?Ee.innerHTML=this._maybeSanitize(B):Ee.textContent=B:Ee.remove())}_maybeSanitize(x){return this._config.sanitize?function(B,de,Ee){if(!B.length)return B;if(Ee&&"function"==typeof Ee)return Ee(B);const Ne=(new window.DOMParser).parseFromString(B,"text/html"),bt=[].concat(...Ne.body.querySelectorAll("*"));for(const ei of bt){const Yt=ei.nodeName.toLowerCase();if(!Object.keys(de).includes(Yt)){ei.remove();continue}const hn=[].concat(...ei.attributes),wn=[].concat(de["*"]||[],de[Yt]||[]);for(const Pn of hn)Vr(Pn,wn)||ei.removeAttribute(Pn.nodeName)}return Ne.body.innerHTML}(x,this._config.allowList,this._config.sanitizeFn):x}_resolvePossibleFunction(x){return"function"==typeof x?x(this):x}_putElementInTemplate(x,B){if(this._config.html)return B.innerHTML="",void B.append(x);B.textContent=x.textContent}}const Sr=new Set(["sanitize","allowList","sanitizeFn"]),Ro="fade",Bo="show",Ho="hide.bs.modal",Ao="hover",vr={AUTO:"auto",TOP:"top",RIGHT:Se()?"left":"right",BOTTOM:"bottom",LEFT:Se()?"right":"left"},ir={allowList:yr,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,0],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},js={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class yo extends Fn{constructor(x,B){if(void 0===v)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(x,B),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return ir}static get DefaultType(){return js}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),pt.off(this._element.closest(".modal"),Ho,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const x=pt.trigger(this._element,this.constructor.eventName("show")),B=(X(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(x.defaultPrevented||!B)return;this._disposePopper();const de=this._getTipElement();this._element.setAttribute("aria-describedby",de.getAttribute("id"));const{container:Ee}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(Ee.append(de),pt.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(de),de.classList.add(Bo),"ontouchstart"in document.documentElement)for(const Ne of[].concat(...document.body.children))pt.on(Ne,"mouseover",le);this._queueCallback(()=>{pt.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!pt.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Bo),"ontouchstart"in document.documentElement)for(const x of[].concat(...document.body.children))pt.off(x,"mouseover",le);this._activeTrigger.click=!1,this._activeTrigger.focus=!1,this._activeTrigger.hover=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),pt.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(x){const B=this._getTemplateFactory(x).toHtml();if(!B)return null;B.classList.remove(Ro,Bo),B.classList.add(`bs-${this.constructor.NAME}-auto`);const de=(Ee=>{do{Ee+=Math.floor(1e6*Math.random())}while(document.getElementById(Ee));return Ee})(this.constructor.NAME).toString();return B.setAttribute("id",de),this._isAnimated()&&B.classList.add(Ro),B}setContent(x){this._newContent=x,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(x){return this._templateFactory?this._templateFactory.changeContent(x):this._templateFactory=new So({...this._config,content:x,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(x){return this.constructor.getOrCreateInstance(x.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Ro)}_isShown(){return this.tip&&this.tip.classList.contains(Bo)}_createPopper(x){const B="function"==typeof this._config.placement?this._config.placement.call(this,x,this._element):this._config.placement,de=vr[B.toUpperCase()];return v.createPopper(this._element,x,this._getPopperConfig(de))}_getOffset(){const{offset:x}=this._config;return"string"==typeof x?x.split(",").map(B=>Number.parseInt(B,10)):"function"==typeof x?B=>x(B,this._element):x}_resolvePossibleFunction(x){return"function"==typeof x?x.call(this._element):x}_getPopperConfig(x){const B={placement:x,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:de=>{this._getTipElement().setAttribute("data-popper-placement",de.state.placement)}}]};return{...B,..."function"==typeof this._config.popperConfig?this._config.popperConfig(B):this._config.popperConfig}}_setListeners(){const x=this._config.trigger.split(" ");for(const B of x)if("click"===B)pt.on(this._element,this.constructor.eventName("click"),this._config.selector,de=>{this._initializeOnDelegatedTarget(de).toggle()});else if("manual"!==B){const de=this.constructor.eventName(B===Ao?"mouseenter":"focusin"),Ee=this.constructor.eventName(B===Ao?"mouseleave":"focusout");pt.on(this._element,de,this._config.selector,Ne=>{const bt=this._initializeOnDelegatedTarget(Ne);bt._activeTrigger["focusin"===Ne.type?"focus":Ao]=!0,bt._enter()}),pt.on(this._element,Ee,this._config.selector,Ne=>{const bt=this._initializeOnDelegatedTarget(Ne);bt._activeTrigger["focusout"===Ne.type?"focus":Ao]=bt._element.contains(Ne.relatedTarget),bt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},pt.on(this._element.closest(".modal"),Ho,this._hideModalHandler)}_fixTitle(){const x=this._element.getAttribute("title");x&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",x),this._element.setAttribute("data-bs-original-title",x),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(x,B){clearTimeout(this._timeout),this._timeout=setTimeout(x,B)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(x){const B=Jn.getDataAttributes(this._element);for(const de of Object.keys(B))Sr.has(de)&&delete B[de];return x={...B,..."object"==typeof x&&x?x:{}},x=this._mergeConfigObj(x),x=this._configAfterMerge(x),this._typeCheckConfig(x),x}_configAfterMerge(x){return x.container=!1===x.container?document.body:k(x.container),"number"==typeof x.delay&&(x.delay={show:x.delay,hide:x.delay}),"number"==typeof x.title&&(x.title=x.title.toString()),"number"==typeof x.content&&(x.content=x.content.toString()),x}_getDelegateConfig(){const x={};for(const B in this._config)this.constructor.Default[B]!==this._config[B]&&(x[B]=this._config[B]);return x.selector=!1,x.trigger="manual",x}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(x){return this.each(function(){const B=yo.getOrCreateInstance(this,x);if("string"==typeof x){if(void 0===B[x])throw new TypeError(`No method named "${x}"`);B[x]()}})}}Ke(yo);const Ar={...yo.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Ir={...yo.DefaultType,content:"(null|string|element|function)"};class Wo extends yo{static get Default(){return Ar}static get DefaultType(){return Ir}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(x){return this.each(function(){const B=Wo.getOrCreateInstance(this,x);if("string"==typeof x){if(void 0===B[x])throw new TypeError(`No method named "${x}"`);B[x]()}})}}Ke(Wo);const ao="click.bs.scrollspy",$n="active",vs={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Xo={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Qn extends Fn{constructor(x,B){super(x,B),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return vs}static get DefaultType(){return Xo}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const x of this._observableSections.values())this._observer.observe(x)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(x){return x.target=k(x.target)||document.body,x.rootMargin=x.offset?`${x.offset}px 0px -30%`:x.rootMargin,"string"==typeof x.threshold&&(x.threshold=x.threshold.split(",").map(B=>Number.parseFloat(B))),x}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(pt.off(this._config.target,ao),pt.on(this._config.target,ao,"[href]",x=>{const B=this._observableSections.get(x.target.hash);if(B){x.preventDefault();const de=this._rootElement||window,Ee=B.offsetTop-this._element.offsetTop;if(de.scrollTo)return void de.scrollTo({top:Ee,behavior:"smooth"});de.scrollTop=Ee}}))}_getNewObserver(){return new IntersectionObserver(B=>this._observerCallback(B),{root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin})}_observerCallback(x){const B=bt=>this._targetLinks.get(`#${bt.target.id}`),de=bt=>{this._previousScrollData.visibleEntryTop=bt.target.offsetTop,this._process(B(bt))},Ee=(this._rootElement||document.documentElement).scrollTop,Ne=Ee>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=Ee;for(const bt of x){if(!bt.isIntersecting){this._activeTarget=null,this._clearActiveClass(B(bt));continue}const ei=bt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Ne&&ei){if(de(bt),!Ee)return}else Ne||ei||de(bt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const x=Ai.find("[href]",this._config.target);for(const B of x){if(!B.hash||I(B))continue;const de=Ai.findOne(B.hash,this._element);O(de)&&(this._targetLinks.set(B.hash,B),this._observableSections.set(B.hash,de))}}_process(x){this._activeTarget!==x&&(this._clearActiveClass(this._config.target),this._activeTarget=x,x.classList.add($n),this._activateParents(x),pt.trigger(this._element,"activate.bs.scrollspy",{relatedTarget:x}))}_activateParents(x){if(x.classList.contains("dropdown-item"))Ai.findOne(".dropdown-toggle",x.closest(".dropdown")).classList.add($n);else for(const B of Ai.parents(x,".nav, .list-group"))for(const de of Ai.prev(B,".nav-link, .nav-item > .nav-link, .list-group-item"))de.classList.add($n)}_clearActiveClass(x){x.classList.remove($n);const B=Ai.find("[href].active",x);for(const de of B)de.classList.remove($n)}static jQueryInterface(x){return this.each(function(){const B=Qn.getOrCreateInstance(this,x);if("string"==typeof x){if(void 0===B[x]||x.startsWith("_")||"constructor"===x)throw new TypeError(`No method named "${x}"`);B[x]()}})}}pt.on(window,"load.bs.scrollspy.data-api",()=>{for(const G of Ai.find('[data-bs-spy="scroll"]'))Qn.getOrCreateInstance(G)}),Ke(Qn);const Vs="ArrowLeft",Mo="ArrowRight",eo="ArrowUp",lo="ArrowDown",vo="active",ss="show",Fo='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',m=`.nav-link:not(.dropdown-toggle), .list-group-item:not(.dropdown-toggle), [role="tab"]:not(.dropdown-toggle), ${Fo}`;class b extends Fn{constructor(x){super(x),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),pt.on(this._element,"keydown.bs.tab",B=>this._keydown(B)))}static get NAME(){return"tab"}show(){const x=this._element;if(this._elemIsActive(x))return;const B=this._getActiveElem(),de=B?pt.trigger(B,"hide.bs.tab",{relatedTarget:x}):null;pt.trigger(x,"show.bs.tab",{relatedTarget:B}).defaultPrevented||de&&de.defaultPrevented||(this._deactivate(B,x),this._activate(x,B))}_activate(x,B){x&&(x.classList.add(vo),this._activate(D(x)),this._queueCallback(()=>{"tab"===x.getAttribute("role")?(x.removeAttribute("tabindex"),x.setAttribute("aria-selected",!0),this._toggleDropDown(x,!0),pt.trigger(x,"shown.bs.tab",{relatedTarget:B})):x.classList.add(ss)},x,x.classList.contains("fade")))}_deactivate(x,B){x&&(x.classList.remove(vo),x.blur(),this._deactivate(D(x)),this._queueCallback(()=>{"tab"===x.getAttribute("role")?(x.setAttribute("aria-selected",!1),x.setAttribute("tabindex","-1"),this._toggleDropDown(x,!1),pt.trigger(x,"hidden.bs.tab",{relatedTarget:B})):x.classList.remove(ss)},x,x.classList.contains("fade")))}_keydown(x){if(![Vs,Mo,eo,lo].includes(x.key))return;x.stopPropagation(),x.preventDefault();const B=[Mo,lo].includes(x.key),de=C(this._getChildren().filter(Ee=>!I(Ee)),x.target,B,!0);de&&(de.focus({preventScroll:!0}),b.getOrCreateInstance(de).show())}_getChildren(){return Ai.find(m,this._parent)}_getActiveElem(){return this._getChildren().find(x=>this._elemIsActive(x))||null}_setInitialAttributes(x,B){this._setAttributeIfNotExists(x,"role","tablist");for(const de of B)this._setInitialAttributesOnChild(de)}_setInitialAttributesOnChild(x){x=this._getInnerElement(x);const B=this._elemIsActive(x),de=this._getOuterElement(x);x.setAttribute("aria-selected",B),de!==x&&this._setAttributeIfNotExists(de,"role","presentation"),B||x.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(x,"role","tab"),this._setInitialAttributesOnTargetPanel(x)}_setInitialAttributesOnTargetPanel(x){const B=D(x);B&&(this._setAttributeIfNotExists(B,"role","tabpanel"),x.id&&this._setAttributeIfNotExists(B,"aria-labelledby",`#${x.id}`))}_toggleDropDown(x,B){const de=this._getOuterElement(x);if(!de.classList.contains("dropdown"))return;const Ee=(Ne,bt)=>{const ei=Ai.findOne(Ne,de);ei&&ei.classList.toggle(bt,B)};Ee(".dropdown-toggle",vo),Ee(".dropdown-menu",ss),de.setAttribute("aria-expanded",B)}_setAttributeIfNotExists(x,B,de){x.hasAttribute(B)||x.setAttribute(B,de)}_elemIsActive(x){return x.classList.contains(vo)}_getInnerElement(x){return x.matches(m)?x:Ai.findOne(m,x)}_getOuterElement(x){return x.closest(".nav-item, .list-group-item")||x}static jQueryInterface(x){return this.each(function(){const B=b.getOrCreateInstance(this);if("string"==typeof x){if(void 0===B[x]||x.startsWith("_")||"constructor"===x)throw new TypeError(`No method named "${x}"`);B[x]()}})}}pt.on(document,"click.bs.tab",Fo,function(G){["A","AREA"].includes(this.tagName)&&G.preventDefault(),I(this)||b.getOrCreateInstance(this).show()}),pt.on(window,"load.bs.tab",()=>{for(const G of Ai.find('.active[data-bs-toggle="tab"], .active[data-bs-toggle="pill"], .active[data-bs-toggle="list"]'))b.getOrCreateInstance(G)}),Ke(b);const M="hide",L="show",q="showing",J={animation:"boolean",autohide:"boolean",delay:"number"},se={animation:!0,autohide:!0,delay:5e3};class Ve extends Fn{constructor(x,B){super(x,B),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return se}static get DefaultType(){return J}static get NAME(){return"toast"}show(){pt.trigger(this._element,"show.bs.toast").defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(M),this._element.classList.add(L,q),this._queueCallback(()=>{this._element.classList.remove(q),pt.trigger(this._element,"shown.bs.toast"),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(pt.trigger(this._element,"hide.bs.toast").defaultPrevented||(this._element.classList.add(q),this._queueCallback(()=>{this._element.classList.add(M),this._element.classList.remove(q,L),pt.trigger(this._element,"hidden.bs.toast")},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(L),super.dispose()}isShown(){return this._element.classList.contains(L)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(x,B){switch(x.type){case"mouseover":case"mouseout":this._hasMouseInteraction=B;break;case"focusin":case"focusout":this._hasKeyboardInteraction=B}if(B)return void this._clearTimeout();const de=x.relatedTarget;this._element===de||this._element.contains(de)||this._maybeScheduleHide()}_setListeners(){pt.on(this._element,"mouseover.bs.toast",x=>this._onInteraction(x,!0)),pt.on(this._element,"mouseout.bs.toast",x=>this._onInteraction(x,!1)),pt.on(this._element,"focusin.bs.toast",x=>this._onInteraction(x,!0)),pt.on(this._element,"focusout.bs.toast",x=>this._onInteraction(x,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(x){return this.each(function(){const B=Ve.getOrCreateInstance(this,x);if("string"==typeof x){if(void 0===B[x])throw new TypeError(`No method named "${x}"`);B[x](this)}})}}return Ji(Ve),Ke(Ve),{Alert:Nn,Button:gi,Carousel:Ce,Collapse:ye,Dropdown:De,Modal:_o,Offcanvas:hr,Popover:Wo,ScrollSpy:Qn,Tab:b,Toast:Ve,Tooltip:yo}}),function(Ae,Qe){"object"==typeof exports&&typeof module<"u"?module.exports=Qe():"function"==typeof define&&define.amd?define(Qe):(Ae=typeof globalThis<"u"?globalThis:Ae||self).mapboxgl=Qe()}(this,function(){"use strict";var Ae,Qe,v;function $(o,D){if(Ae)if(Qe){var N="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ae+")(sharedChunk); ("+Qe+")(sharedChunk); self.onerror = null;",j={};Ae(j),v=D(j),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([N],{type:"text/javascript"})))}else Qe=D;else Ae=D}return $(0,function(o){var D=typeof self<"u"?self:{},N="2.11.1";let j;const k={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==j){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{j=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{j=t}}return j},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},O={supported:!1,testSupport:function(t){!le&&X&&(te?Be(t):I=t)}};let I,X,le=!1,te=!1;function Be(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,X),t.isContextLost())return;O.supported=!0}catch{}t.deleteTexture(e),le=!0}D.document&&(X=D.document.createElement("img"),X.onload=function(){I&&Be(I),I=null,te=!0},X.onerror=function(){le=!0,I=null},X.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ie="01";var Se=Ke;function Ke(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}Ke.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var c=this.sampleCurveDerivativeX(i);if(Math.abs(c)<1e-6)break;i-=a/c}var h=0,p=1;for(i=t,r=0;r<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));r++)t>a?h=i:p=i,i=.5*(p-h)+h;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var ne=mt;function mt(t,e){this.x=t,this.y=e}mt.prototype={clone:function(){return new mt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),a=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},mt.convert=function(t){return t instanceof mt?t:Array.isArray(t)?new mt(t[0],t[1]):t};const C=Math.PI/180,wt=180/Math.PI;function xt(t){return t*C}function Wt(t){return t*wt}const Nt=[[0,0],[1,0],[1,1],[0,1]];function fi(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function $t(t,e,i,r){const a=new Se(t,e,i,r);return function(c){return a.solve(c)}}const li=$t(.25,.1,.25,1);function qt(t,e,i){return Math.min(i,Math.max(e,t))}function Ri(t,e,i){return(i=qt((i-t)/(e-t),0,1))*i*(3-2*i)}function Bi(t,e,i){const r=i-e,a=((t-e)%r+r)%r+e;return a===e?i:a}function mi(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const a=new Array(t.length);let c=null;t.forEach((h,p)=>{e(h,(g,_)=>{g&&(c=g),a[p]=_,0==--r&&i(c,a)})})}function tn(t){const e=[];for(const i in t)e.push(t[i]);return e}function Pt(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let wi=1;function ji(){return wi++}function pt(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Si(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function mn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Bn(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function yn(t,e){return-1!==t.indexOf(e,t.length-e.length)}function En(t,e,i){const r={};for(const a in t)r[a]=e.call(i||this,t[a],a,t);return r}function Jn(t,e,i){const r={};for(const a in t)e.call(i||this,t[a],a,t)&&(r[a]=t[a]);return r}function vn(t){return Array.isArray(t)?t.map(vn):"object"==typeof t&&t?En(t,vn):t}const Fn={};function Ji(t){Fn[t]||(typeof console<"u"&&console.warn(t),Fn[t]=!0)}function Nn(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Xi(t){let e=0;for(let i,r,a=0,c=t.length,h=c-1;a<c;h=a++)i=t[a],r=t[h],e+=(r.x-i.x)*(i.y+r.y);return e}function gi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ai(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,a,c)=>{const h=a||c;return e[r]=!h||h.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let lt=null;function Y(t){if(null==lt){const e=t.navigator?t.navigator.userAgent:null;lt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return lt}function ue(t){try{const e=D[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function oe(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const $e="mapbox-tiles";let Ge,ot,Rt=500,Mt=50;function jt(){try{return D.caches}catch{}}function Lt(){jt()&&!Ge&&(Ge=D.caches.open($e))}function yi(t){const e=t.indexOf("?");if(e<0)return t;const r=function(a){const c=a.indexOf("?");return c>0?a.slice(c+1).split("&"):[]}(t).filter(a=>{const c=a.split("=");return"language"===c[0]||"worldview"===c[0]});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let ve=1/0;const Ce={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ce);class We extends Error{constructor(e,i,r){401===i&&ft(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const vt=gi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===D.location.protocol?D.parent:D).location.href,Bt=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(vt())&&!/^\w+:/.test(i))){if(D.fetch&&D.Request&&D.AbortController&&D.Request.prototype.hasOwnProperty("signal"))return function(r,a){const c=new D.AbortController,h=new D.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:vt(),signal:c.signal});let p=!1,g=!1;const _=(w=h.url).indexOf("sku=")>0&&ft(w);var w;"json"===r.type&&h.headers.set("Accept","application/json");const S=(R,F,H)=>{if(g)return;if(R&&"SecurityError"!==R.message&&Ji(R),F&&H)return A(F);const Q=Date.now();D.fetch(h).then(we=>{if(we.ok){const Oe=_?we.clone():null;return A(we,Oe,Q)}return a(new We(we.statusText,we.status,r.url))}).catch(we=>{20!==we.code&&a(new Error(we.message))})},A=(R,F,H)=>{("arrayBuffer"===r.type?R.arrayBuffer():"json"===r.type?R.json():R.text()).then(Q=>{g||(F&&H&&function(we,Oe,be){if(Lt(),!Ge)return;const ke={status:Oe.status,statusText:Oe.statusText,headers:new D.Headers};Oe.headers.forEach((at,rt)=>ke.headers.set(rt,at));const Ue=Ai(Oe.headers.get("Cache-Control")||"");if(Ue["no-store"])return;Ue["max-age"]&&ke.headers.set("Expires",new Date(be+1e3*Ue["max-age"]).toUTCString());const Pe=ke.headers.get("Expires");Pe&&(new Date(Pe).getTime()-be<42e4||function(at,rt){if(void 0===ot)try{new Response(new ReadableStream),ot=!0}catch{ot=!1}ot?rt(at.body):at.blob().then(rt)}(Oe,at=>{const rt=new D.Response(at,ke);Lt(),Ge&&Ge.then(yt=>yt.put(yi(we.url),rt)).catch(yt=>Ji(yt.message))}))}(h,F,H),p=!0,a(null,Q,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(Q=>{g||a(new Error(Q.message))})};return _?function(R,F){if(Lt(),!Ge)return F(null);const H=yi(R.url);Ge.then(Q=>{Q.match(H).then(we=>{const Oe=function(be){if(!be)return!1;const ke=new Date(be.headers.get("Expires")||0),Ue=Ai(be.headers.get("Cache-Control")||"");return ke>Date.now()&&!Ue["no-cache"]}(we);Q.delete(H),Oe&&Q.put(H,we.clone()),F(null,we,Oe)}).catch(F)}).catch(F)}(h,S):S(null,null),{cancel:()=>{g=!0,p||c.abort()}}}(t,e);if(gi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,a){const c=new D.XMLHttpRequest;c.open(r.method||"GET",r.url,!0),"arrayBuffer"===r.type&&(c.responseType="arraybuffer");for(const h in r.headers)c.setRequestHeader(h,r.headers[h]);return"json"===r.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===r.credentials,c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||0===c.status)&&null!==c.response){let h=c.response;if("json"===r.type)try{h=JSON.parse(c.response)}catch(p){return a(p)}a(null,h,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new We(c.statusText,c.status,r.url))},c.send(r.body),{cancel:()=>c.abort()}}(t,e)},Xt=function(t,e){return Bt(Pt(t,{type:"arrayBuffer"}),e)};function si(t){const e=D.document.createElement("a");return e.href=t,e.protocol===D.document.location.protocol&&e.host===D.document.location.host}const W="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ye,Me;ye=[],Me=0;const qe=function(t,e){if(O.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Me>=k.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ye.push(c),c}Me++;let i=!1;const r=()=>{if(!i)for(i=!0,Me--;ye.length&&Me<k.MAX_PARALLEL_IMAGE_REQUESTS;){const c=ye.shift(),{requestParameters:h,callback:p,cancelled:g}=c;g||(c.cancel=qe(h,p).cancel)}},a=Xt(t,(c,h,p,g)=>{r(),c?e(c):h&&(D.createImageBitmap?function(_,w){const S=new D.Blob([new Uint8Array(_)],{type:"image/png"});D.createImageBitmap(S).then(A=>{w(null,A)}).catch(A=>{w(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(_,w)=>e(_,w,p,g)):function(_,w){const S=new D.Image,A=D.URL;S.onload=()=>{w(null,S),A.revokeObjectURL(S.src),S.onload=null,D.requestAnimationFrame(()=>{S.src=W})},S.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new D.Blob([new Uint8Array(_)],{type:"image/png"});S.src=_.byteLength?A.createObjectURL(R):W}(h,(_,w)=>e(_,w,p,g)))});return{cancel:()=>{a.cancel(),r()}}},gt="NO_ACCESS_TOKEN";function _t(t){return 0===t.indexOf("mapbox:")}function ft(t){return k.API_URL_REGEX.test(t)}function Ut(t){return k.API_STYLE_REGEX.test(t)&&!ti(t)}function ti(t){return k.API_SPRITE_REGEX.test(t)}const Ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xi(t){const e=t.match(Ci);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function pi(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Ii(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(D.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Gi{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Ii(k.ACCESS_TOKEN);let r="";return r=i&&i.u?D.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(Number("0x"+c)))):k.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=ue("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const a=D.localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));const c=D.localStorage.getItem(r);c&&(this.anonId=c)}catch{Ji("Unable to read from LocalStorage")}}saveEventData(){const e=ue("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{D.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&D.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Ji("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,a){if(!k.EVENTS_URL)return;const c=xi(k.EVENTS_URL);c.params.push(`access_token=${a||k.ACCESS_TOKEN||""}`);const h={event:this.type,created:new Date(e).toISOString()},p=i?Pt(h,i):h,g={url:pi(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};var w;this.pendingRequest=(w=_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(a)},Bt(Pt(g,{method:"POST"}),w))}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const re=new class extends Gi{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){k.EVENTS_URL&&k.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>_t(i)||ft(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ii(k.ACCESS_TOKEN),i=e?e.u:k.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;mn(this.anonId)||(this.anonId=pt(),r=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),h=new Date(a),p=(a-this.eventData.lastSuccess)/864e5;r=r||p>=1||p<-1||c.getDate()!==h.getDate()}else r=!0;r?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:Ie,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},U=re.postTurnstileEvent.bind(re),Z=new class extends Gi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,k.EVENTS_URL&&(i||k.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(gt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),mn(this.anonId)||(this.anonId=pt()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:Ie,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},me=Z.postMapLoadEvent.bind(Z),xe=new class extends Gi{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){k.EVENTS_URL&&(t||k.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(a){const c=D.performance.getEntriesByType("resource"),h=D.performance.getEntriesByType("mark"),p=function(A){const R={};if(A)for(const F in A)if("other"!==F)for(const H of A[F]){const Q=`${F}RequestCount`,we=`${F}ResolveRangeMin`,Oe=`${F}ResolveRangeMax`;R[we]=Math.min(R[we]||1/0,H.startTime),R[Oe]=Math.max(R[Oe]||-1/0,H.responseEnd),void 0===R[Q]&&(R[Q]=0),++R[Q]}return R}(function(A,R){const F={};if(A)for(const H of A){const Q=R(H);void 0===F[Q]&&(F[Q]=[]),F[Q].push(H)}return F}(c,oi)),g=D.devicePixelRatio,_=D.navigator.connection||D.navigator.mozConnection||D.navigator.webkitConnection,w={counters:[],metadata:[],attributes:[]},S=(A,R,F)=>{null!=F&&A.push({name:R,value:F.toString()})};for(const A in p)S(w.counters,A,p[A]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(S(w.counters,"interactionRangeMin",a.interactionRange[0]),S(w.counters,"interactionRangeMax",a.interactionRange[1])),h)for(const A of Object.keys(et)){const R=et[A],F=h.find(H=>H.name===R);F&&S(w.counters,R,F.startTime)}return S(w.counters,"visibilityHidden",a.visibilityHidden),S(w.attributes,"style",function(A){if(A)for(const R of A){const F=R.name.split("?")[0];if(Ut(F)){const H=F.split("/").slice(-2);if(2===H.length)return`mapbox://styles/${H[0]}/${H[1]}`}}}(c)),S(w.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),S(w.attributes,"fogEnabled",a.fogEnabled?"true":"false"),S(w.attributes,"projection",a.projection.name),S(w.attributes,"zoom",a.zoom),S(w.metadata,"devicePixelRatio",g),S(w.metadata,"connectionEffectiveType",_?_.effectiveType:void 0),S(w.metadata,"navigatorUserAgent",D.navigator.userAgent),S(w.metadata,"screenWidth",D.screen.width),S(w.metadata,"screenHeight",D.screen.height),S(w.metadata,"windowWidth",D.innerWidth),S(w.metadata,"windowHeight",D.innerHeight),S(w.metadata,"mapWidth",a.width/g),S(w.metadata,"mapHeight",a.height/g),S(w.metadata,"webglRenderer",a.renderer),S(w.metadata,"webglVendor",a.vendor),S(w.metadata,"sdkVersion",N),S(w.metadata,"sdkIdentifier","mapbox-gl-js"),w}(i);for(const a of r.metadata);for(const a of r.counters);for(const a of r.attributes);this.postEvent(e,r,()=>{},t)}},De=xe.postPerformanceEvent.bind(xe),Xe=new class extends Gi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!k.API_URL||!k.SESSION_PATH)return;const a=xi(k.API_URL+k.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${r||k.ACCESS_TOKEN||""}`);const c={url:pi(a),headers:{"Content-Type":"text/plain"}};var p;this.pendingRequest=(p=h=>{this.pendingRequest=null,i(h),this.saveEventData(),this.processRequests(r)},Bt(Pt(c,{method:"GET"}),p))}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,k.SESSION_PATH&&k.API_URL&&(i||k.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(gt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},He=Xe.getSessionAPI.bind(Xe),je=new Set,et={create:"create",load:"load",fullLoad:"fullLoad"},St={mark(t){D.performance.mark(t)},measure(t,e,i){D.performance.measure(t,e,i)}};function oi(t){const e=t.name.split("?")[0];return e.includes("mapbox-gl.js")?"javascript":e.includes("mapbox-gl.css")?"css":k.API_FONTS_REGEX.test(e)?"fontRange":ti(e)?"sprite":Ut(e)?"style":k.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const kt=D.performance;function Mi(t){const e=t?t.url.toString():void 0;return kt.getEntriesByName(e)}let Ti,bi,Di,Qi;const gn={now:()=>void 0!==Di?Di:D.performance.now(),setNow(t){Di=t},restoreNow(){Di=void 0},frame(t){const e=D.requestAnimationFrame(t);return{cancel:()=>D.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;Qi||(Qi=D.document.createElement("canvas"));const a=Qi.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return(i>Qi.width||r>Qi.height)&&(Qi.width=i,Qi.height=r),a.clearRect(-e,-e,i+2*e,r+2*e),a.drawImage(t,0,0,i,r),a.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Ti||(Ti=D.document.createElement("a")),Ti.href=t,Ti.href),get devicePixelRatio(){return D.devicePixelRatio},get prefersReducedMotion(){return!!D.matchMedia&&(null==bi&&(bi=D.matchMedia("(prefers-reduced-motion: reduce)")),bi.matches)}};function Pi(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function xn(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class bn{constructor(e,i={}){Pt(this,i),this.type=e}}class Yr extends bn{constructor(e,i={}){super("error",Pt({error:e},i))}}class Kr{on(e,i){return this._listeners=this._listeners||{},Pi(e,i,this._listeners),this}off(e,i){return xn(e,i,this._listeners),xn(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Pi(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){"string"==typeof e&&(e=new bn(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const a=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const p of a)p.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const p of c)xn(r,p,this._oneTimeListeners),p.call(this,e);const h=this._eventedParent;h&&(Pt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof Yr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function _r(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function Hn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Lr(t){if(Array.isArray(t))return t.map(Lr);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Lr(t[i]);return e}return Hn(t)}class _o extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Jr=_o;class Oo{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,a]of i)this.bindings[r]=a}concat(e){return new Oo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var rs=Oo;const Eo={kind:"null"},Jt={kind:"number"},nn={kind:"string"},Vi={kind:"boolean"},Qr={kind:"color"},hr={kind:"object"},an={kind:"value"},os={kind:"collator"},jr={kind:"formatted"},Vr={kind:"resolvedImage"};function yr(t,e){return{kind:"array",itemType:t,N:e}}function Dn(t){if("array"===t.kind){const e=Dn(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ra=[Eo,Jt,nn,Vi,Qr,jr,hr,yr(an),Vr];function $r(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!$r(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const i of ra)if(!$r(i,e))return null}return`Expected ${Dn(t)} but found ${Dn(e)} instead.`}function So(t,e){return e.some(i=>i.kind===t.kind)}function Sr(t,e){return e.some(i=>"null"===i?null===t:"array"===i?Array.isArray(t):"object"===i?t&&!Array.isArray(t)&&"object"==typeof t:i===typeof t)}var Ro,Bo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Zo(t){return(t=Math.round(t))<0?0:t>255?255:t}function Ho(t){return Zo("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Ao(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function so(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Ro={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Bo)return Bo[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),a=i.indexOf(")");if(-1!==r&&a+1===i.length){var c=i.substr(0,r),h=i.substr(r+1,a-(r+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=Ao(h.pop());case"rgb":return 3!==h.length?null:[Ho(h[0]),Ho(h[1]),Ho(h[2]),p];case"hsla":if(4!==h.length)return null;p=Ao(h.pop());case"hsl":if(3!==h.length)return null;var g=(parseFloat(h[0])%360+360)%360/360,_=Ao(h[1]),w=Ao(h[2]),S=w<=.5?w*(_+1):w+_-w*_,A=2*w-S;return[Zo(255*so(A,S,g+1/3)),Zo(255*so(A,S,g)),Zo(255*so(A,S,g-1/3)),p];default:return null}}return null}}catch{}class vr{constructor(e,i,r,a=1){this.r=e,this.g=i,this.b=r,this.a=a}static parse(e){if(!e)return;if(e instanceof vr)return e;if("string"!=typeof e)return;const i=Ro(e);return i?new vr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${a})`}toArray(){const{r:e,g:i,b:r,a}=this;return 0===a?[0,0,0,0]:[255*e/a,255*i/a,255*r/a,a]}toArray01(){const{r:e,g:i,b:r,a}=this;return 0===a?[0,0,0,0]:[e/a,i/a,r/a,a]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a}=this;return[e,i,r,a]}}vr.black=new vr(0,0,0,1),vr.white=new vr(1,1,1,1),vr.transparent=new vr(0,0,0,0),vr.red=new vr(1,0,0,1),vr.blue=new vr(0,0,1,1);var ir=vr;class js{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yo{constructor(e,i,r,a,c){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=a,this.textColor=c}}class Ar{constructor(e){this.sections=e}static fromString(e){return new Ar([new yo(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ar?e:Ar.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class Ir{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ir({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Wo(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ao(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof ir||t instanceof js||t instanceof Ar||t instanceof Ir)return!0;if(Array.isArray(t)){for(const e of t)if(!ao(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ao(t[e]))return!1;return!0}return!1}function $n(t){if(null===t)return Eo;if("string"==typeof t)return nn;if("boolean"==typeof t)return Vi;if("number"==typeof t)return Jt;if(t instanceof ir)return Qr;if(t instanceof js)return os;if(t instanceof Ar)return jr;if(t instanceof Ir)return Vr;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const a=$n(r);if(i){if(i===a)continue;i=an;break}i=a}return yr(i||an,e)}return hr}function Co(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ir||t instanceof Ar||t instanceof Ir?t.toString():JSON.stringify(t)}class vs{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ao(e[1]))return i.error("invalid value");const r=e[1];let a=$n(r);const c=i.expectedType;return"array"!==a.kind||0!==a.N||!c||"array"!==c.kind||"number"==typeof c.N&&0!==c.N||(a=c),new vs(a,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ir?["rgba"].concat(this.value.toArray()):this.value instanceof Ar?this.value.serialize():this.value}}var Xo=vs,Qn=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Vs={string:nn,number:Jt,boolean:Vi,object:hr};class Mo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,a=1;const c=e[0];if("array"===c){let p,g;if(e.length>2){const _=e[1];if("string"!=typeof _||!(_ in Vs)||"object"===_)return i.error('The item type argument of "array" must be one of string, number, boolean',1);p=Vs[_],a++}else p=an;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);g=e[2],a++}r=yr(p,g)}else r=Vs[c];const h=[];for(;a<e.length;a++){const p=i.parse(e[a],a,an);if(!p)return null;h.push(p)}return new Mo(r,h)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!$r(this.type,$n(r)))return r;if(i===this.args.length-1)throw new Qn(`Expected value to be of type ${Dn(this.type)}, but found ${Dn($n(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){i.push(r.kind);const a=e.N;("number"==typeof a||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(r=>r.serialize()))}}var eo=Mo;class lo{constructor(e){this.type=jr,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return i.error("First argument must be an image or text section.");const a=[];let c=!1;for(let h=1;h<=e.length-1;++h){const p=e[h];if(c&&"object"==typeof p&&!Array.isArray(p)){c=!1;let g=null;if(p["font-scale"]&&(g=i.parse(p["font-scale"],1,Jt),!g))return null;let _=null;if(p["text-font"]&&(_=i.parse(p["text-font"],1,yr(nn)),!_))return null;let w=null;if(p["text-color"]&&(w=i.parse(p["text-color"],1,Qr),!w))return null;const S=a[a.length-1];S.scale=g,S.font=_,S.textColor=w}else{const g=i.parse(e[h],1,an);if(!g)return null;const _=g.type.kind;if("string"!==_&&"value"!==_&&"null"!==_&&"resolvedImage"!==_)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:g,scale:null,font:null,textColor:null})}}return new lo(a)}evaluate(e){return new Ar(this.sections.map(i=>{const r=i.content.evaluate(e);return $n(r)===Vr?new yo("",r,null,null,null):new yo(Co(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class vo{constructor(e){this.type=Vr,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,nn);return r?new vo(r):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),r=Ir.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const oa={"to-boolean":Vi,"to-color":Qr,"to-number":Jt,"to-string":nn};class ss{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return i.error("Expected one argument.");const a=oa[r],c=[];for(let h=1;h<e.length;h++){const p=i.parse(e[h],h,an);if(!p)return null;c.push(p)}return new ss(a,c)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let i,r;for(const a of this.args){if(i=a.evaluate(e),r=null,i instanceof ir)return i;if("string"==typeof i){const c=e.parseColor(i);if(c)return c}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Wo(i[0],i[1],i[2],i[3]),!r))return new ir(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Qn(r||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const r of this.args){if(i=r.evaluate(e),null===i)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Qn(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?Ar.fromString(Co(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Ir.fromString(Co(this.args[0].evaluate(e))):Co(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new lo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new vo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Fo=ss;const m=["Unknown","Point","LineString","Polygon"];var b=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?m[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ir.parse(t)),e}};class M{constructor(e,i,r,a){this.name=e,this.type=i,this._evaluate=r,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],a=M.definitions[r];if(!a)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,p=h.filter(([_])=>!Array.isArray(_)||_.length===e.length-1);let g=null;for(const[_,w]of p){g=new Yo(i.registry,i.path,null,i.scope);const S=[];let A=!1;for(let R=1;R<e.length;R++){const F=e[R],H=Array.isArray(_)?_[R-1]:_.type,Q=g.parse(F,1+S.length,H);if(!Q){A=!0;break}S.push(Q)}if(!A)if(Array.isArray(_)&&_.length!==S.length)g.error(`Expected ${_.length} arguments, but found ${S.length} instead.`);else{for(let R=0;R<S.length;R++){const F=Array.isArray(_)?_[R]:_.type,H=S[R];g.concat(R+1).checkSubtype(F,H.type)}if(0===g.errors.length)return new M(r,c,w,S)}}if(1===p.length)i.errors.push(...g.errors);else{const _=(p.length?p:h).map(([S])=>{return A=S,Array.isArray(A)?`(${A.map(Dn).join(", ")})`:`(${Dn(A.type)}...)`;var A}).join(" | "),w=[];for(let S=1;S<e.length;S++){const A=i.parse(e[S],1+w.length);if(!A)return null;w.push(Dn(A.type))}i.error(`Expected arguments of type ${_}, but found (${w.join(", ")}) instead.`)}return null}static register(e,i){M.definitions=i;for(const r in i)e[r]=M}}var L=M;class q{constructor(e,i,r){this.type=os,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return i.error("Collator options argument must be an object.");const a=i.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Vi);if(!a)return null;const c=i.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Vi);if(!c)return null;let h=null;return r.locale&&(h=i.parse(r.locale,1,nn),!h)?null:new q(a,c,h)}evaluate(e){return new js(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const J=8192;function se(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ve(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function G(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*J),Math.round(r*a*J)]}function x(t,e,i){const r=t[0]-e[0],a=t[1]-e[1],c=t[0]-i[0],h=t[1]-i[1];return r*h-c*a==0&&r*c<=0&&a*h<=0}function B(t,e){let i=!1;for(let h=0,p=e.length;h<p;h++){const g=e[h];for(let _=0,w=g.length;_<w-1;_++){if(x(t,g[_],g[_+1]))return!1;(a=g[_])[1]>(r=t)[1]!=(c=g[_+1])[1]>r[1]&&r[0]<(c[0]-a[0])*(r[1]-a[1])/(c[1]-a[1])+a[0]&&(i=!i)}}var r,a,c;return i}function de(t,e){for(let i=0;i<e.length;i++)if(B(t,e[i]))return!0;return!1}function Ee(t,e,i,r){const a=r[0]-i[0],c=r[1]-i[1],h=(t[0]-i[0])*c-a*(t[1]-i[1]),p=(e[0]-i[0])*c-a*(e[1]-i[1]);return h>0&&p<0||h<0&&p>0}function Ne(t,e,i){for(const _ of i)for(let w=0;w<_.length-1;++w)if((p=[(h=_[w+1])[0]-(c=_[w])[0],h[1]-c[1]])[0]*(g=[(a=e)[0]-(r=t)[0],a[1]-r[1]])[1]-p[1]*g[0]!=0&&Ee(r,a,c,h)&&Ee(c,h,r,a))return!0;var r,a,c,h,p,g;return!1}function bt(t,e){for(let i=0;i<t.length;++i)if(!B(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Ne(t[i],t[i+1],e))return!1;return!0}function ei(t,e){for(let i=0;i<e.length;i++)if(bt(t,e[i]))return!0;return!1}function Yt(t,e,i){const r=[];for(let a=0;a<t.length;a++){const c=[];for(let h=0;h<t[a].length;h++){const p=G(t[a][h],i);se(e,p),c.push(p)}r.push(c)}return r}function hn(t,e,i){const r=[];for(let a=0;a<t.length;a++){const c=Yt(t[a],e,i);r.push(c)}return r}function wn(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const a=.5*r;let c=t[0]-i[0]>a?-r:i[0]-t[0]>a?r:0;0===c&&(c=t[0]-i[2]>a?-r:i[2]-t[0]>a?r:0),t[0]+=c}se(e,t)}function Pn(t,e,i,r){const a=Math.pow(2,r.z)*J,c=[r.x*J,r.y*J],h=[];if(!t)return h;for(const p of t)for(const g of p){const _=[g.x+c[0],g.y+c[1]];wn(_,e,i,a),h.push(_)}return h}function fn(t,e,i,r){const a=Math.pow(2,r.z)*J,c=[r.x*J,r.y*J],h=[];if(!t)return h;for(const g of t){const _=[];for(const w of g){const S=[w.x+c[0],w.y+c[1]];se(e,S),_.push(S)}h.push(_)}if(e[2]-e[0]<=a/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const g of h)for(const _ of g)wn(_,e,i,a)}var p;return h}class ki{constructor(e,i){this.type=Vi,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ao(e[1])){const r=e[1];if("FeatureCollection"===r.type)for(let a=0;a<r.features.length;++a){const c=r.features[a].geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new ki(r,r.features[a].geometry)}else if("Feature"===r.type){const a=r.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new ki(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new ki(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,r){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if("Polygon"===r.type){const p=Yt(r.coordinates,c,h),g=Pn(i.geometry(),a,c,h);if(!Ve(a,c))return!1;for(const _ of g)if(!B(_,p))return!1}if("MultiPolygon"===r.type){const p=hn(r.coordinates,c,h),g=Pn(i.geometry(),a,c,h);if(!Ve(a,c))return!1;for(const _ of g)if(!de(_,p))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,r){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if("Polygon"===r.type){const p=Yt(r.coordinates,c,h),g=fn(i.geometry(),a,c,h);if(!Ve(a,c))return!1;for(const _ of g)if(!bt(_,p))return!1}if("MultiPolygon"===r.type){const p=hn(r.coordinates,c,h),g=fn(i.geometry(),a,c,h);if(!Ve(a,c))return!1;for(const _ of g)if(!ei(_,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Fi=ki;function rn(t){if(t instanceof L&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Fi)return!1;let e=!0;return t.eachChild(i=>{e&&!rn(i)&&(e=!1)}),e}function An(t){if(t instanceof L&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(i=>{e&&!An(i)&&(e=!1)}),e}function to(t,e){if(t instanceof L&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!to(r,e)&&(i=!1)}),i}class No{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new No(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var or=No;class co{constructor(e,i=[],r,a=new rs,c=[]){this.registry=e,this.path=i,this.key=i.map(h=>`[${h}]`).join(""),this.scope=a,this.errors=c,this.expectedType=r}parse(e,i,r,a,c={}){return i?this.concat(i,r,a)._parse(e,c):this._parse(e,c)}_parse(e,i){function r(a,c,h){return"assert"===h?new eo(c,[a]):"coerce"===h?new Fo(c,[a]):a}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if("string"!=typeof a)return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const c=this.registry[a];if(c){let h=c.parse(e,this);if(!h)return null;if(this.expectedType){const p=this.expectedType,g=h.type;if("string"!==p.kind&&"number"!==p.kind&&"boolean"!==p.kind&&"object"!==p.kind&&"array"!==p.kind||"value"!==g.kind)if("color"!==p.kind&&"formatted"!==p.kind&&"resolvedImage"!==p.kind||"value"!==g.kind&&"string"!==g.kind){if(this.checkSubtype(p,g))return null}else h=r(h,p,i.typeAnnotation||"coerce");else h=r(h,p,i.typeAnnotation||"assert")}if(!(h instanceof Xo)&&"resolvedImage"!==h.type.kind&&Cr(h)){const p=new b;try{h=new Xo(h.type,h.evaluate(p))}catch(g){return this.error(g.message),null}}return h}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const a="number"==typeof e?this.path.concat(e):this.path,c=r?this.scope.concat(r):this.scope;return new co(this.registry,a,i||null,c,this.errors)}error(e,...i){const r=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new Jr(r,e))}checkSubtype(e,i){const r=$r(e,i);return r&&this.error(r),r}}var Yo=co;function Cr(t){if(t instanceof or)return Cr(t.boundExpression);if(t instanceof L&&"error"===t.name||t instanceof q||t instanceof Fi)return!1;const e=t instanceof Fo||t instanceof eo;let i=!0;return t.eachChild(r=>{i=e?i&&Cr(r):i&&r instanceof Xo}),!!i&&rn(t)&&to(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ko(t,e){const i=t.length-1;let r,a,c=0,h=i,p=0;for(;c<=h;)if(p=Math.floor((c+h)/2),r=t[p],a=t[p+1],r<=e){if(p===i||e<a)return p;c=p+1}else{if(!(r>e))throw new Qn("Input is not a number.");h=p-1}return 0}class pr{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,c]of r)this.labels.push(a),this.outputs.push(c)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,Jt);if(!r)return null;const a=[];let c=null;i.expectedType&&"value"!==i.expectedType.kind&&(c=i.expectedType);for(let h=1;h<e.length;h+=2){const p=1===h?-1/0:e[h],g=e[h+1],_=h,w=h+1;if("number"!=typeof p)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_);if(a.length&&a[a.length-1][0]>=p)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',_);const S=i.parse(g,w,c);if(!S)return null;c=c||S.type,a.push([p,S])}return new pr(c,r,a)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return r[0].evaluate(e);const c=i.length;return a>=i[c-1]?r[c-1].evaluate(e):r[ko(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Un=pr;function on(t,e,i){return t*(1-i)+e*i}var xr=Object.freeze({__proto__:null,number:on,color:function(t,e,i){return new ir(on(t.r,e.r,i),on(t.g,e.g,i),on(t.b,e.b,i),on(t.a,e.a,i))},array:function(t,e,i){return t.map((r,a)=>on(r,e[a],i))}});const Cn=4/29,sr=6/29,Gr=3*sr*sr,cr=Math.PI/180,qr=180/Math.PI;function Ko(t){return t>.008856451679035631?Math.pow(t,1/3):t/Gr+Cn}function as(t){return t>sr?t*t*t:Gr*(t-Cn)}function Ma(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function sa(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ka(t){const e=sa(t.r),i=sa(t.g),r=sa(t.b),a=Ko((.4124564*e+.3575761*i+.1804375*r)/.95047),c=Ko((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-Ko((.0193339*e+.119192*i+.9503041*r)/1.08883)),alpha:t.a}}function $s(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*as(e),i=.95047*as(i),r=1.08883*as(r),new ir(Ma(3.2404542*i-1.5371385*e-.4985314*r),Ma(-.969266*i+1.8760108*e+.041556*r),Ma(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Nl(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const Gs={forward:ka,reverse:$s,interpolate:function(t,e,i){return{l:on(t.l,e.l,i),a:on(t.a,e.a,i),b:on(t.b,e.b,i),alpha:on(t.alpha,e.alpha,i)}}},qs={forward:function(t){const{l:e,a:i,b:r}=ka(t),a=Math.atan2(r,i)*qr;return{h:a<0?a+360:a,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*cr,i=t.c;return $s({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Nl(t.h,e.h,i),c:on(t.c,e.c,i),l:on(t.l,e.l,i),alpha:on(t.alpha,e.alpha,i)}}};var xs=Object.freeze({__proto__:null,lab:Gs,hcl:qs});class aa{constructor(e,i,r,a,c){this.type=e,this.operator=i,this.interpolation=r,this.input=a,this.labels=[],this.outputs=[];for(const[h,p]of c)this.labels.push(h),this.outputs.push(p)}static interpolationFactor(e,i,r,a){let c=0;if("exponential"===e.name)c=bs(i,e.base,r,a);else if("linear"===e.name)c=bs(i,1,r,a);else if("cubic-bezier"===e.name){const h=e.controlPoints;c=new Se(h[0],h[1],h[2],h[3]).solve(bs(i,1,r,a))}return c}static parse(e,i){let[r,a,c,...h]=e;if(!Array.isArray(a)||0===a.length)return i.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){const _=a[1];if("number"!=typeof _)return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:_}}else{if("cubic-bezier"!==a[0])return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const _=a.slice(1);if(4!==_.length||_.some(w=>"number"!=typeof w||w<0||w>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:_}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(c=i.parse(c,2,Jt),!c)return null;const p=[];let g=null;"interpolate-hcl"===r||"interpolate-lab"===r?g=Qr:i.expectedType&&"value"!==i.expectedType.kind&&(g=i.expectedType);for(let _=0;_<h.length;_+=2){const w=h[_],S=h[_+1],A=_+3,R=_+4;if("number"!=typeof w)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=w)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const F=i.parse(S,R,g);if(!F)return null;g=g||F.type,p.push([w,F])}return"number"===g.kind||"color"===g.kind||"array"===g.kind&&"number"===g.itemType.kind&&"number"==typeof g.N?new aa(g,r,a,c,p):i.error(`Type ${Dn(g)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return r[0].evaluate(e);const c=i.length;if(a>=i[c-1])return r[c-1].evaluate(e);const h=ko(i,a),p=aa.interpolationFactor(this.interpolation,a,i[h],i[h+1]),g=r[h].evaluate(e),_=r[h+1].evaluate(e);return"interpolate"===this.operator?xr[this.type.kind.toLowerCase()](g,_,p):"interpolate-hcl"===this.operator?qs.reverse(qs.interpolate(qs.forward(g),qs.forward(_),p)):Gs.reverse(Gs.interpolate(Gs.forward(g),Gs.forward(_),p))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function bs(t,e,i,r){const a=r-i,c=t-i;return 0===a?0:1===e?c/a:(Math.pow(e,c)-1)/(Math.pow(e,a)-1)}var br=aa;class xo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const a=i.expectedType;a&&"value"!==a.kind&&(r=a);const c=[];for(const p of e.slice(1)){const g=i.parse(p,1+c.length,r,void 0,{typeAnnotation:"omit"});if(!g)return null;r=r||g.type,c.push(g)}const h=a&&c.some(p=>$r(a,p.type));return new xo(h?an:r,c)}evaluate(e){let i,r=null,a=0;for(const c of this.args){if(a++,r=c.evaluate(e),r&&r instanceof Ir&&!r.available&&(i||(i=r),r=null,a===this.args.length))return i;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ia=xo;class la{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let c=1;c<e.length-1;c+=2){const h=e[c];if("string"!=typeof h)return i.error(`Expected string, but found ${typeof h} instead.`,c);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",c);const p=i.parse(e[c+1],c+1);if(!p)return null;r.push([h,p])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return a?new la(r,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var ca=la;class ua{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,Jt),a=i.parse(e[2],2,yr(i.expectedType||an));return r&&a?new ua(a.type.itemType,r,a):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new Qn(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new Qn(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new Qn(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var jn=ua;class ws{constructor(e,i){this.type=Vi,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,an),a=i.parse(e[2],2,an);return r&&a?So(r.type,[Vi,nn,Jt,Eo,an])?new ws(r,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!Sr(i,["boolean","string","number","null"]))throw new Qn(`Expected first argument to be of type boolean, string, number or null, but found ${Dn($n(i))} instead.`);if(!Sr(r,["string","array"]))throw new Qn(`Expected second argument to be of type array or string, but found ${Dn($n(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var bo=ws;class Dr{constructor(e,i,r){this.type=Jt,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,an),a=i.parse(e[2],2,an);if(!r||!a)return null;if(!So(r.type,[Vi,nn,Jt,Eo,an]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Dn(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,Jt);return c?new Dr(r,a,c):null}return new Dr(r,a)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Sr(i,["boolean","string","number","null"]))throw new Qn(`Expected first argument to be of type boolean, string, number or null, but found ${Dn($n(i))} instead.`);if(!Sr(r,["string","array"]))throw new Qn(`Expected second argument to be of type array or string, but found ${Dn($n(r))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return r.indexOf(i,a)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ha=Dr;class Zs{constructor(e,i,r,a,c,h){this.inputType=e,this.type=i,this.input=r,this.cases=a,this.outputs=c,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,a;i.expectedType&&"value"!==i.expectedType.kind&&(a=i.expectedType);const c={},h=[];for(let _=2;_<e.length-1;_+=2){let w=e[_];const S=e[_+1];Array.isArray(w)||(w=[w]);const A=i.concat(_);if(0===w.length)return A.error("Expected at least one branch label.");for(const F of w){if("number"!=typeof F&&"string"!=typeof F)return A.error("Branch labels must be numbers or strings.");if("number"==typeof F&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof F&&Math.floor(F)!==F)return A.error("Numeric branch labels must be integer values.");if(r){if(A.checkSubtype(r,$n(F)))return null}else r=$n(F);if(void 0!==c[String(F)])return A.error("Branch labels must be unique.");c[String(F)]=h.length}const R=i.parse(S,_,a);if(!R)return null;a=a||R.type,h.push(R)}const p=i.parse(e[1],1,an);if(!p)return null;const g=i.parse(e[e.length-1],e.length-1,a);return g?"value"!==p.type.kind&&i.concat(1).checkSubtype(r,p.type)?null:new Zs(r,a,p,c,h,g):null}evaluate(e){const i=this.input.evaluate(e);return($n(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],a={};for(const h of i){const p=a[this.cases[h]];void 0===p?(a[this.cases[h]]=r.length,r.push([this.cases[h],[h]])):r[p][1].push(h)}const c=h=>"number"===this.inputType.kind?Number(h):h;for(const[h,p]of r)e.push(1===p.length?c(p[0]):p.map(c)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}var Ul=Zs;class Da{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const p=i.parse(e[h],h,Vi);if(!p)return null;const g=i.parse(e[h+1],h+1,r);if(!g)return null;a.push([p,g]),r=r||g.type}const c=i.parse(e[e.length-1],e.length-1,r);return c?new Da(r,a,c):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var el=Da;class Io{constructor(e,i,r,a){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,an),a=i.parse(e[2],2,Jt);if(!r||!a)return null;if(!So(r.type,[yr(an),nn,an]))return i.error(`Expected first argument to be of type array or string, but found ${Dn(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,Jt);return c?new Io(r.type,r,a,c):null}return new Io(r.type,r,a)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Sr(i,["string","array"]))throw new Qn(`Expected first argument to be of type array or string, but found ${Dn($n(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(r,a)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ts=Io;function da(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Es(t,e,i,r){return 0===r.compare(e,i)}function Uo(t,e,i){const r="=="!==t&&"!="!==t;return class zf{constructor(c,h,p){this.type=Vi,this.lhs=c,this.rhs=h,this.collator=p,this.hasUntypedArgument="value"===c.type.kind||"value"===h.type.kind}static parse(c,h){if(3!==c.length&&4!==c.length)return h.error("Expected two or three arguments.");const p=c[0];let g=h.parse(c[1],1,an);if(!g)return null;if(!da(p,g.type))return h.concat(1).error(`"${p}" comparisons are not supported for type '${Dn(g.type)}'.`);let _=h.parse(c[2],2,an);if(!_)return null;if(!da(p,_.type))return h.concat(2).error(`"${p}" comparisons are not supported for type '${Dn(_.type)}'.`);if(g.type.kind!==_.type.kind&&"value"!==g.type.kind&&"value"!==_.type.kind)return h.error(`Cannot compare types '${Dn(g.type)}' and '${Dn(_.type)}'.`);r&&("value"===g.type.kind&&"value"!==_.type.kind?g=new eo(_.type,[g]):"value"!==g.type.kind&&"value"===_.type.kind&&(_=new eo(g.type,[_])));let w=null;if(4===c.length){if("string"!==g.type.kind&&"string"!==_.type.kind&&"value"!==g.type.kind&&"value"!==_.type.kind)return h.error("Cannot use collator to compare non-string types.");if(w=h.parse(c[3],3,os),!w)return null}return new zf(g,_,w)}evaluate(c){const h=this.lhs.evaluate(c),p=this.rhs.evaluate(c);if(r&&this.hasUntypedArgument){const g=$n(h),_=$n(p);if(g.kind!==_.kind||"string"!==g.kind&&"number"!==g.kind)throw new Qn(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${g.kind}, ${_.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const g=$n(h),_=$n(p);if("string"!==g.kind||"string"!==_.kind)return e(c,h,p)}return this.collator?i(c,h,p,this.collator.evaluate(c)):e(c,h,p)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(h=>{c.push(h.serialize())}),c}}}const Pa=Uo("==",function(t,e,i){return e===i},Es),pa=Uo("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!Es(0,e,i,r)}),fa=Uo("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),ma=Uo(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),pe=Uo("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),Fe=Uo(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class Je{constructor(e,i,r,a,c,h){this.type=nn,this.number=e,this.locale=i,this.currency=r,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=h}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Jt);if(!r)return null;const a=e[2];if("object"!=typeof a||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=i.parse(a.locale,1,nn),!c))return null;let h=null;if(a.currency&&(h=i.parse(a.currency,1,nn),!h))return null;let p=null;if(a.unit&&(p=i.parse(a.unit,1,nn),!p))return null;let g=null;if(a["min-fraction-digits"]&&(g=i.parse(a["min-fraction-digits"],1,Jt),!g))return null;let _=null;return a["max-fraction-digits"]&&(_=i.parse(a["max-fraction-digits"],1,Jt),!_)?null:new Je(r,c,h,p,g,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class It{constructor(e){this.type=Jt,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?i.error(`Expected argument of type string or array, but found ${Dn(r.type)} instead.`):new It(r):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new Qn(`Expected value to be of type string or array, but found ${Dn($n(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const nt={"==":Pa,"!=":pa,">":ma,"<":fa,">=":Fe,"<=":pe,array:eo,at:jn,boolean:eo,case:el,coalesce:Ia,collator:q,format:lo,image:vo,in:bo,"index-of":ha,interpolate:br,"interpolate-hcl":br,"interpolate-lab":br,length:It,let:ca,literal:Xo,match:Ul,number:eo,"number-format":Je,object:eo,slice:Ts,step:Un,string:eo,"to-boolean":Fo,"to-color":Fo,"to-number":Fo,"to-string":Fo,var:or,within:Fi};function Vt(t,[e,i,r,a]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const c=a?a.evaluate(t):1,h=Wo(e,i,r,c);if(h)throw new Qn(h);return new ir(e/255*c,i/255*c,r/255*c,c)}function Kt(t,e){return t in e}function ci(t,e){const i=e[t];return void 0===i?null:i}function di(t){return{type:t}}L.register(nt,{error:[{kind:"error"},[nn],(t,[e])=>{throw new Qn(e.evaluate(t))}],typeof:[nn,[an],(t,[e])=>Dn($n(e.evaluate(t)))],"to-rgba":[yr(Jt,4),[Qr],(t,[e])=>e.evaluate(t).toArray()],rgb:[Qr,[Jt,Jt,Jt],Vt],rgba:[Qr,[Jt,Jt,Jt,Jt],Vt],has:{type:Vi,overloads:[[[nn],(t,[e])=>Kt(e.evaluate(t),t.properties())],[[nn,hr],(t,[e,i])=>Kt(e.evaluate(t),i.evaluate(t))]]},get:{type:an,overloads:[[[nn],(t,[e])=>ci(e.evaluate(t),t.properties())],[[nn,hr],(t,[e,i])=>ci(e.evaluate(t),i.evaluate(t))]]},"feature-state":[an,[nn],(t,[e])=>ci(e.evaluate(t),t.featureState||{})],properties:[hr,[],t=>t.properties()],"geometry-type":[nn,[],t=>t.geometryType()],id:[an,[],t=>t.id()],zoom:[Jt,[],t=>t.globals.zoom],pitch:[Jt,[],t=>t.globals.pitch||0],"distance-from-center":[Jt,[],t=>t.distanceFromCenter()],"heatmap-density":[Jt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Jt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Jt,[],t=>t.globals.skyRadialProgress||0],accumulated:[an,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Jt,di(Jt),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[Jt,di(Jt),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:Jt,overloads:[[[Jt,Jt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Jt],(t,[e])=>-e.evaluate(t)]]},"/":[Jt,[Jt,Jt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Jt,[Jt,Jt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Jt,[Jt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Jt,[Jt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Jt,[Jt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Jt,[Jt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Jt,[Jt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Jt,[Jt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Jt,[Jt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Jt,[Jt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Jt,[Jt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Jt,[Jt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Jt,di(Jt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Jt,di(Jt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Jt,[Jt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Jt,[Jt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Jt,[Jt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Jt,[Jt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Vi,[nn,an],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Vi,[an],(t,[e])=>t.id()===e.value],"filter-type-==":[Vi,[nn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Vi,[nn,an],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Vi,[an],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[Vi,[nn,an],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[Vi,[an],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[Vi,[nn,an],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Vi,[an],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[Vi,[nn,an],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Vi,[an],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[Vi,[an],(t,[e])=>e.value in t.properties()],"filter-has-id":[Vi,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Vi,[yr(nn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Vi,[yr(an)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Vi,[nn,yr(an)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Vi,[nn,yr(an)],(t,[e,i])=>function(r,a,c,h){for(;c<=h;){const p=c+h>>1;if(a[p]===r)return!0;a[p]>r?h=p-1:c=p+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Vi,overloads:[[[Vi,Vi],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[di(Vi),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Vi,overloads:[[[Vi,Vi],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[di(Vi),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Vi,[Vi],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Vi,[nn],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[nn,[nn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[nn,[nn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[nn,di(an),(t,e)=>e.map(i=>Co(i.evaluate(t))).join("")],"resolved-locale":[nn,[os],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Yi=nt;function qi(t){return{result:"success",value:t}}function Ni(t){return{result:"error",value:t}}function dn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function ar(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Hi(t){return!!t.expression&&t.expression.interpolated}function Zi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Wn(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function zr(t){return t}function Vn(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],a=r||!(r||void 0!==t.property),c=t.type||(Hi(e)?"exponential":"interval");if(i&&((t=_r({},t)).stops&&(t.stops=t.stops.map(_=>[_[0],ir.parse(_[1])])),t.default=ir.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!xs[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,p,g;if("exponential"===c)h=io;else if("interval"===c)h=lr;else if("categorical"===c){h=Pr,p=Object.create(null);for(const _ of t.stops)p[_[0]]=_[1];g=typeof t.stops[0][0]}else{if("identity"!==c)throw new Error(`Unknown function type "${c}"`);h=Ss}if(r){const _={},w=[];for(let R=0;R<t.stops.length;R++){const F=t.stops[R],H=F[0].zoom;void 0===_[H]&&(_[H]={zoom:H,type:t.type,property:t.property,default:t.default,stops:[]},w.push(H)),_[H].stops.push([F[0].value,F[1]])}const S=[];for(const R of w)S.push([_[R].zoom,Vn(_[R],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:br.interpolationFactor.bind(void 0,A),zoomStops:S.map(R=>R[0]),evaluate:({zoom:R},F)=>io({stops:S,base:t.base},e,R).evaluate(R,F)}}if(a){const _="exponential"===c?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:_,interpolationFactor:br.interpolationFactor.bind(void 0,_),zoomStops:t.stops.map(w=>w[0]),evaluate:({zoom:w})=>h(t,e,w,p,g)}}return{kind:"source",evaluate(_,w){const S=w&&w.properties?w.properties[t.property]:void 0;return void 0===S?Or(t.default,e.default):h(t,e,S,p,g)}}}function Or(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Pr(t,e,i,r,a){return Or(typeof i===a?r[i]:void 0,t.default,e.default)}function lr(t,e,i){if("number"!==Zi(i))return Or(t.default,e.default);const r=t.stops.length;if(1===r||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const a=ko(t.stops.map(c=>c[0]),i);return t.stops[a][1]}function io(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==Zi(i))return Or(t.default,e.default);const a=t.stops.length;if(1===a||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];const c=ko(t.stops.map(w=>w[0]),i),h=function(w,S,A,R){const F=R-A,H=w-A;return 0===F?0:1===S?H/F:(Math.pow(S,H)-1)/(Math.pow(S,F)-1)}(i,r,t.stops[c][0],t.stops[c+1][0]),p=t.stops[c][1],g=t.stops[c+1][1];let _=xr[e.type]||zr;if(t.colorSpace&&"rgb"!==t.colorSpace){const w=xs[t.colorSpace];_=(S,A)=>w.reverse(w.interpolate(w.forward(S),w.forward(A),h))}return"function"==typeof p.evaluate?{evaluate(...w){const S=p.evaluate.apply(void 0,w),A=g.evaluate.apply(void 0,w);if(void 0!==S&&void 0!==A)return _(S,A,h)}}:_(p,g,h)}function Ss(t,e,i){return"color"===e.type?i=ir.parse(i):"formatted"===e.type?i=Ar.fromString(i.toString()):"resolvedImage"===e.type?i=Ir.fromString(i.toString()):Zi(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),Or(i,t.default,e.default)}class As{constructor(e,i){var r;this.expression=e,this._warningHistory={},this._evaluator=new b,this._defaultValue=i?"color"===(r=i).type&&(Wn(r.default)||Array.isArray(r.default))?new ir(0,0,0,0):"color"===r.type?ir.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,r,a,c,h,p,g){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=g||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,a,c,h,p,g){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=g||null;try{const _=this.expression.evaluate(this._evaluator);if(null==_||"number"==typeof _&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Qn(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Cs(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Yi}function ls(t,e){const i=new Yo(Yi,[],e?function(a){const c={color:Qr,string:nn,number:Jt,enum:nn,boolean:Vi,formatted:jr,resolvedImage:Vr};return"array"===a.type?yr(c[a.value]||an,a.length):c[a.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?qi(new As(r,e)):Ni(i.errors)}class tl{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!An(i.expression)}evaluateWithoutErrorHandling(e,i,r,a,c,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,a,c,h)}evaluate(e,i,r,a,c,h){return this._styleExpression.evaluate(e,i,r,a,c,h)}}class il{constructor(e,i,r,a){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent="camera"!==e&&!An(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,r,a,c,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,a,c,h)}evaluate(e,i,r,a,c,h){return this._styleExpression.evaluate(e,i,r,a,c,h)}interpolationFactor(e,i,r){return this.interpolationType?br.interpolationFactor(this.interpolationType,e,i,r):0}}function La(t,e){if("error"===(t=ls(t,e)).result)return t;const i=t.value.expression,r=rn(i);if(!r&&!dn(e))return Ni([new Jr("","data expressions not supported")]);const a=to(i,["zoom","pitch","distance-from-center"]);if(!a&&!ar(e))return Ni([new Jr("","zoom expressions not supported")]);const c=za(i);return c||a?c instanceof Jr?Ni([c]):c instanceof br&&!Hi(e)?Ni([new Jr("",'"interpolate" expressions cannot be used with this property')]):qi(c?new il(r?"camera":"composite",t.value,c.labels,c instanceof br?c.interpolation:void 0):new tl(r?"constant":"source",t.value)):Ni([new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class cs{constructor(e,i){this._parameters=e,this._specification=i,_r(this,Vn(this._parameters,this._specification))}static deserialize(e){return new cs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function za(t){let e=null;if(t instanceof ca)e=za(t.result);else if(t instanceof Ia){for(const i of t.args)if(e=za(i),e)break}else(t instanceof Un||t instanceof br)&&t.input instanceof L&&"zoom"===t.input.name&&(e=t);return e instanceof Jr||t.eachChild(i=>{const r=za(i);r instanceof Jr?e=r:!e&&r?e=new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ui{constructor(e,i,r,a){this.message=(e?`${e}: `:"")+r,a&&(this.identifier=a),null!=i&&i.__line__&&(this.line=i.__line__)}}function wo(t){const e=t.key,i=t.value,r=t.valueSpec||{},a=t.objectElementValidators||{},c=t.style,h=t.styleSpec;let p=[];const g=Zi(i);if("object"!==g)return[new ui(e,i,`object expected, ${g} found`)];for(const _ in i){const w=_.split(".")[0],S=r[w]||r["*"];let A;a[w]?A=a[w]:r[w]?A=Zr:a["*"]?A=a["*"]:r["*"]&&(A=Zr),A?p=p.concat(A({key:(e&&`${e}.`)+_,value:i[_],valueSpec:S,style:c,styleSpec:h,object:i,objectKey:_},i)):p.push(new ui(e,i[_],`unknown property "${_}"`))}for(const _ in r)a[_]||r[_].required&&void 0===r[_].default&&void 0===i[_]&&p.push(new ui(e,i,`missing required property "${_}"`));return p}function jl(t){const e=t.value,i=t.valueSpec,r=t.style,a=t.styleSpec,c=t.key,h=t.arrayElementValidator||Zr;if("array"!==Zi(e))return[new ui(c,e,`array expected, ${Zi(e)} found`)];if(i.length&&e.length!==i.length)return[new ui(c,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ui(c,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let p={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};a.$version<7&&(p.function=i.function),"object"===Zi(i.value)&&(p=i.value);let g=[];for(let _=0;_<e.length;_++)g=g.concat(h({array:e,arrayIndex:_,value:e[_],valueSpec:p,style:r,styleSpec:a,key:`${c}[${_}]`}));return g}function Rc(t){const e=t.key,i=t.value,r=t.valueSpec;let a=Zi(i);if("number"===a&&i!=i&&(a="NaN"),"number"!==a)return[new ui(e,i,`number expected, ${a} found`)];if("minimum"in r){let c=r.minimum;if("array"===Zi(r.minimum)&&(c=r.minimum[t.arrayIndex]),i<c)return[new ui(e,i,`${i} is less than the minimum value ${c}`)]}if("maximum"in r){let c=r.maximum;if("array"===Zi(r.maximum)&&(c=r.maximum[t.arrayIndex]),i>c)return[new ui(e,i,`${i} is greater than the maximum value ${c}`)]}return[]}function Vl(t){const e=t.valueSpec,i=Hn(t.value.type);let r,a,c,h={};const p="categorical"!==i&&void 0===t.value.property,g=!p,_="array"===Zi(t.value.stops)&&"array"===Zi(t.value.stops[0])&&"object"===Zi(t.value.stops[0][0]),w=wo({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(R){if("identity"===i)return[new ui(R.key,R.value,'identity function may not have a "stops" property')];let F=[];const H=R.value;return F=F.concat(jl({key:R.key,value:H,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:S})),"array"===Zi(H)&&0===H.length&&F.push(new ui(R.key,H,"array must have at least one stop")),F},default:function(R){return Zr({key:R.key,value:R.value,valueSpec:e,style:R.style,styleSpec:R.styleSpec})}}});return"identity"===i&&p&&w.push(new ui(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||w.push(new ui(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!Hi(t.valueSpec)&&w.push(new ui(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(g&&!dn(t.valueSpec)?w.push(new ui(t.key,t.value,"property functions not supported")):p&&!ar(t.valueSpec)&&w.push(new ui(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!_||void 0!==t.value.property||w.push(new ui(t.key,t.value,'"property" property is required')),w;function S(R){let F=[];const H=R.value,Q=R.key;if("array"!==Zi(H))return[new ui(Q,H,`array expected, ${Zi(H)} found`)];if(2!==H.length)return[new ui(Q,H,`array length 2 expected, length ${H.length} found`)];if(_){if("object"!==Zi(H[0]))return[new ui(Q,H,`object expected, ${Zi(H[0])} found`)];if(void 0===H[0].zoom)return[new ui(Q,H,"object stop key must have zoom")];if(void 0===H[0].value)return[new ui(Q,H,"object stop key must have value")];const we=Hn(H[0].zoom);if("number"!=typeof we)return[new ui(Q,H[0].zoom,"stop zoom values must be numbers")];if(c&&c>we)return[new ui(Q,H[0].zoom,"stop zoom values must appear in ascending order")];we!==c&&(c=we,a=void 0,h={}),F=F.concat(wo({key:`${Q}[0]`,value:H[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Rc,value:A}}))}else F=F.concat(A({key:`${Q}[0]`,value:H[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},H));return Cs(Lr(H[1]))?F.concat([new ui(`${Q}[1]`,H[1],"expressions are not allowed in function stops.")]):F.concat(Zr({key:`${Q}[1]`,value:H[1],valueSpec:e,style:R.style,styleSpec:R.styleSpec}))}function A(R,F){const H=Zi(R.value),Q=Hn(R.value),we=null!==R.value?R.value:F;if(r){if(H!==r)return[new ui(R.key,we,`${H} stop domain type must match previous stop domain type ${r}`)]}else r=H;if("number"!==H&&"string"!==H&&"boolean"!==H&&"number"!=typeof Q&&"string"!=typeof Q&&"boolean"!=typeof Q)return[new ui(R.key,we,"stop domain value must be a number, string, or boolean")];if("number"!==H&&"categorical"!==i){let Oe=`number expected, ${H} found`;return dn(e)&&void 0===i&&(Oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ui(R.key,we,Oe)]}return"categorical"!==i||"number"!==H||"number"==typeof Q&&isFinite(Q)&&Math.floor(Q)===Q?"categorical"!==i&&"number"===H&&"number"==typeof Q&&"number"==typeof a&&void 0!==a&&Q<a?[new ui(R.key,we,"stop domain values must appear in ascending order")]:(a=Q,"categorical"===i&&Q in h?[new ui(R.key,we,"stop domain values must be unique")]:(h[Q]=!0,[])):[new ui(R.key,we,`integer expected, found ${String(Q)}`)]}}function us(t){const e=("property"===t.expressionContext?La:ls)(Lr(t.value),t.valueSpec);if("error"===e.result)return e.value.map(r=>new ui(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new ui(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!An(i))return[new ui(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Bc(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!to(i,["zoom","feature-state"]))return[new ui(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!rn(i))return[new ui(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bc(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)i.delete(a);if(0===i.size)return[];const r=[];return t instanceof L&&i.has(t.name)?[new ui(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(a=>{r.push(...Bc(a,e))}),r)}function nl(t){const e=t.key,i=t.value,r=t.valueSpec,a=[];return Array.isArray(r.values)?-1===r.values.indexOf(Hn(i))&&a.push(new ui(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(Hn(i))&&a.push(new ui(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),a}function $l(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!$l(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function rl(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$l(t)||(t=sl(t));const i=t;let r=!0;try{r=function(_){if(!hs(_))return _;let w=Lr(_);return Oa(w),w=Fc(w),w}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const a=ct[`filter_${e}`],c=ls(r,a);let h=null;if("error"===c.result)throw new Error(c.value.map(_=>`${_.key}: ${_.message}`).join(", "));h=(_,w,S)=>c.value.evaluate(_,w,{},S);let p=null,g=null;if(r!==i){const _=ls(i,a);if("error"===_.result)throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,S,A,R,F)=>_.value.evaluate(w,S,{},A,void 0,void 0,R,F),g=!rn(_.value.expression)}return{filter:h,dynamicFilter:p||void 0,needGeometry:Nc(r),needFeature:!!g}}function Fc(t){if(!Array.isArray(t))return t;const e=function(i){if(To.has(i[0]))for(let r=1;r<i.length;r++)if(hs(i[r]))return!0;return i}(t);return!0===e?e:e.map(i=>Fc(i))}function Oa(t){let e=!1;const i=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||hs(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||hs(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||hs(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)Oa(t[r])}function hs(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<t.length;i++)if(hs(t[i]))return!0;return!1}const To=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ol(t,e){return t<e?-1:t>e?1:0}function Nc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Nc(t[e]))return!0;return!1}function sl(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Gl(t[1],t[2],"=="):"!="===e?ll(Gl(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Gl(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(sl))):"all"===e?["all"].concat(t.slice(1).map(sl)):"none"===e?["all"].concat(t.slice(1).map(sl).map(ll)):"in"===e?Uc(t[1],t.slice(2)):"!in"===e?ll(Uc(t[1],t.slice(2))):"has"===e?al(t[1]):"!has"===e?ll(al(t[1])):"within"!==e||t;var i}function Gl(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Uc(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(ol)]]:["filter-in-small",t,["literal",e]]}}function al(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ll(t){return["!",t]}function Ra(t){return $l(Lr(t.value))?us(_r({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):jc(t)}function jc(t){const e=t.value,i=t.key;if("array"!==Zi(e))return[new ui(i,e,`array expected, ${Zi(e)} found`)];const r=t.styleSpec;let a,c=[];if(e.length<1)return[new ui(i,e,"filter array must have at least 1 element")];switch(c=c.concat(nl({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),Hn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Hn(e[1])&&c.push(new ui(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&c.push(new ui(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=Zi(e[1]),"string"!==a&&c.push(new ui(`${i}[1]`,e[1],`string expected, ${a} found`)));for(let h=2;h<e.length;h++)a=Zi(e[h]),"$type"===Hn(e[1])?c=c.concat(nl({key:`${i}[${h}]`,value:e[h],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&c.push(new ui(`${i}[${h}]`,e[h],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let h=1;h<e.length;h++)c=c.concat(jc({key:`${i}[${h}]`,value:e[h],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=Zi(e[1]),2!==e.length?c.push(new ui(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==a&&c.push(new ui(`${i}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=Zi(e[1]),2!==e.length?c.push(new ui(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==a&&c.push(new ui(`${i}[1]`,e[1],`object expected, ${a} found`))}return c}function Vc(t,e){const i=t.key,r=t.style,a=t.styleSpec,c=t.value,h=t.objectKey,p=a[`${e}_${t.layerType}`];if(!p)return[];const g=h.match(/^(.*)-transition$/);if("paint"===e&&g&&p[g[1]]&&p[g[1]].transition)return Zr({key:i,value:c,valueSpec:a.transition,style:r,styleSpec:a});const _=t.valueSpec||p[h];if(!_)return[new ui(i,c,`unknown property "${h}"`)];let w;if("string"===Zi(c)&&dn(_)&&!_.tokens&&(w=/^{([^}]+)}$/.exec(c)))return[new ui(i,c,`"${h}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(w[1])} }\`.`)];const S=[];return"symbol"===t.layerType&&("text-field"===h&&r&&!r.glyphs&&S.push(new ui(i,c,'use of "text-field" requires a style "glyphs" property')),"text-font"===h&&Wn(Lr(c))&&"identity"===Hn(c.type)&&S.push(new ui(i,c,'"text-font" does not support identity functions'))),S.concat(Zr({key:t.key,value:c,valueSpec:_,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:h}))}function cl(t){return Vc(t,"paint")}function $c(t){return Vc(t,"layout")}function ql(t){let e=[];const i=t.value,r=t.key,a=t.style,c=t.styleSpec;i.type||i.ref||e.push(new ui(r,i,'either "type" or "ref" is required'));let h=Hn(i.type);const p=Hn(i.ref);if(i.id){const g=Hn(i.id);for(let _=0;_<t.arrayIndex;_++){const w=a.layers[_];Hn(w.id)===g&&e.push(new ui(r,i.id,`duplicate layer id "${i.id}", previously used at line ${w.id.__line__}`))}}if("ref"in i){let g;["type","source","source-layer","filter","layout"].forEach(_=>{_ in i&&e.push(new ui(r,i[_],`"${_}" is prohibited for ref layers`))}),a.layers.forEach(_=>{Hn(_.id)===p&&(g=_)}),g?g.ref?e.push(new ui(r,i.ref,"ref cannot reference another ref layer")):h=Hn(g.type):"string"==typeof p&&e.push(new ui(r,i.ref,`ref layer "${p}" not found`))}else if("background"!==h&&"sky"!==h)if(i.source){const g=a.sources&&a.sources[i.source],_=g&&Hn(g.type);g?"vector"===_&&"raster"===h?e.push(new ui(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===_&&"raster"!==h?e.push(new ui(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==_||i["source-layer"]?"raster-dem"===_&&"hillshade"!==h?e.push(new ui(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==h||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===_&&g.lineMetrics||e.push(new ui(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ui(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ui(r,i.source,`source "${i.source}" not found`))}else e.push(new ui(r,i,'missing required property "source"'));return e=e.concat(wo({key:r,value:i,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zr({key:`${r}.type`,value:i.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:g=>Ra(_r({layerType:h},g)),layout:g=>wo({layer:i,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":_=>$c(_r({layerType:h},_))}}),paint:g=>wo({layer:i,key:g.key,value:g.value,valueSpec:{},style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":_=>cl(_r({layerType:h},_))}})}})),e}function Hs(t){const e=t.value,i=t.key,r=Zi(e);return"string"!==r?[new ui(i,e,`string expected, ${r} found`)]:[]}const Gc={promoteId:function({key:t,value:e}){if("string"===Zi(e))return Hs({key:t,value:e});{const i=[];for(const r in e)i.push(...Hs({key:`${t}.${r}`,value:e[r]}));return i}}};function ul(t){const e=t.value,i=t.key,r=t.styleSpec,a=t.style;if(!e.type)return[new ui(i,e,'"type" is required')];const c=Hn(e.type);let h;switch(c){case"vector":case"raster":case"raster-dem":return h=wo({key:i,value:e,valueSpec:r[`source_${c.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:Gc}),h;case"geojson":if(h=wo({key:i,value:e,valueSpec:r.source_geojson,style:a,styleSpec:r,objectElementValidators:Gc}),e.cluster)for(const p in e.clusterProperties){const[g,_]=e.clusterProperties[p],w="string"==typeof g?[g,["accumulated"],["get",p]]:g;h.push(...us({key:`${i}.${p}.map`,value:_,expressionContext:"cluster-map"})),h.push(...us({key:`${i}.${p}.reduce`,value:w,expressionContext:"cluster-reduce"}))}return h;case"video":return wo({key:i,value:e,valueSpec:r.source_video,style:a,styleSpec:r});case"image":return wo({key:i,value:e,valueSpec:r.source_image,style:a,styleSpec:r});case"canvas":return[new ui(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nl({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:r})}}function Ba(t){const e=t.value,i=t.styleSpec,r=i.light,a=t.style;let c=[];const h=Zi(e);if(void 0===e)return c;if("object"!==h)return c=c.concat([new ui("light",e,`object expected, ${h} found`)]),c;for(const p in e){const g=p.match(/^(.*)-transition$/);c=c.concat(g&&r[g[1]]&&r[g[1]].transition?Zr({key:p,value:e[p],valueSpec:i.transition,style:a,styleSpec:i}):r[p]?Zr({key:p,value:e[p],valueSpec:r[p],style:a,styleSpec:i}):[new ui(p,e[p],`unknown property "${p}"`)])}return c}function Zl(t){const e=t.value,i=t.key,r=t.style,a=t.styleSpec,c=a.terrain;let h=[];const p=Zi(e);if(void 0===e)return h;if("object"!==p)return h=h.concat([new ui("terrain",e,`object expected, ${p} found`)]),h;for(const g in e){const _=g.match(/^(.*)-transition$/);h=h.concat(_&&c[_[1]]&&c[_[1]].transition?Zr({key:g,value:e[g],valueSpec:a.transition,style:r,styleSpec:a}):c[g]?Zr({key:g,value:e[g],valueSpec:c[g],style:r,styleSpec:a}):[new ui(g,e[g],`unknown property "${g}"`)])}if(e.source){const g=r.sources&&r.sources[e.source],_=g&&Hn(g.type);g?"raster-dem"!==_&&h.push(new ui(i,e.source,`terrain cannot be used with a source of type ${String(_)}, it only be used with a "raster-dem" source type`)):h.push(new ui(i,e.source,`source "${e.source}" not found`))}else h.push(new ui(i,e,'terrain is missing required property "source"'));return h}function qc(t){const e=t.value,i=t.style,r=t.styleSpec,a=r.fog;let c=[];const h=Zi(e);if(void 0===e)return c;if("object"!==h)return c=c.concat([new ui("fog",e,`object expected, ${h} found`)]),c;for(const p in e){const g=p.match(/^(.*)-transition$/);c=c.concat(g&&a[g[1]]&&a[g[1]].transition?Zr({key:p,value:e[p],valueSpec:r.transition,style:i,styleSpec:r}):a[p]?Zr({key:p,value:e[p],valueSpec:a[p],style:i,styleSpec:r}):[new ui(p,e[p],`unknown property "${p}"`)])}return c}const Hl={"*":()=>[],array:jl,boolean:function(t){const e=t.value,i=t.key,r=Zi(e);return"boolean"!==r?[new ui(i,e,`boolean expected, ${r} found`)]:[]},number:Rc,color:function(t){const e=t.key,i=t.value,r=Zi(i);return"string"!==r?[new ui(e,i,`color expected, ${r} found`)]:null===Ro(i)?[new ui(e,i,`color expected, "${i}" found`)]:[]},enum:nl,filter:Ra,function:Vl,layer:ql,object:wo,source:ul,light:Ba,terrain:Zl,fog:qc,string:Hs,formatted:function(t){return 0===Hs(t).length?[]:us(t)},resolvedImage:function(t){return 0===Hs(t).length?[]:us(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,a=t.style;let c=[];const h=Zi(e);if("object"===h)for(const p in e)c=c.concat(Zr({key:p,value:e[p],valueSpec:r[p],style:a,styleSpec:i}));else"string"!==h&&(c=c.concat([new ui("projection",e,`object or string expected, ${h} found`)]));return c}};function Zr(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&Wn(Hn(e))?Vl(t):i.expression&&Cs(Lr(e))?us(t):i.type&&Hl[i.type]?Hl[i.type](t):wo(_r({},t,{valueSpec:i.type?r[i.type]:i}))}function Wl(t){const e=t.value,i=t.key,r=Hs(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new ui(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new ui(i,e,'"glyphs" url must include a "{range}" token'))),r}function Zc(t,e=ct){return ds(Zr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Wl,"*":()=>[]}}))}const Zu=t=>ds(cl(t)),Hu=t=>ds($c(t));function ds(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Xl(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new Yr(new Error(r.message))),i=!0;return i}var ga=Jo;function Jo(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var c=0;c<this.d*this.d;c++){var h=a[3+c],p=a[3+c+1];r.push(h===p?null:a.subarray(h,p))}var g=a[3+r.length+1];this.keys=a.subarray(a[3+r.length],g),this.bboxes=a.subarray(g),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var _=0;_<this.d*this.d;_++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var w=i/e*t;this.min=-w,this.max=t+w}Jo.prototype.insert=function(t,e,i,r,a){this._forEachCell(e,i,r,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(a)},Jo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Jo.prototype._insertCell=function(t,e,i,r,a,c){this.cells[a].push(c)},Jo.prototype.query=function(t,e,i,r,a){var c=this.min,h=this.max;if(t<=c&&e<=c&&h<=i&&h<=r&&!a)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(t,e,i,r,this._queryCell,p,{},a),p},Jo.prototype._queryCell=function(t,e,i,r,a,c,h,p){var g=this.cells[a];if(null!==g)for(var _=this.keys,w=this.bboxes,S=0;S<g.length;S++){var A=g[S];if(void 0===h[A]){var R=4*A;(p?p(w[R+0],w[R+1],w[R+2],w[R+3]):t<=w[R+2]&&e<=w[R+3]&&i>=w[R+0]&&r>=w[R+1])?(h[A]=!0,c.push(_[A])):h[A]=!1}}},Jo.prototype._forEachCell=function(t,e,i,r,a,c,h,p){for(var g=this._convertToCellCoord(t),_=this._convertToCellCoord(e),w=this._convertToCellCoord(i),S=this._convertToCellCoord(r),A=g;A<=w;A++)for(var R=_;R<=S;R++){var F=this.d*R+A;if((!p||p(this._convertFromCellCoord(A),this._convertFromCellCoord(R),this._convertFromCellCoord(A+1),this._convertFromCellCoord(R+1)))&&a.call(this,t,e,i,r,F,c,h,p))return}},Jo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Jo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Jo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var c=e,h=0;h<t.length;h++){var p=t[h];a[3+h]=c,a.set(p,c),c+=p.length}return a[3+t.length]=c,a.set(this.keys,c),a[3+t.length+1]=c+=this.keys.length,a.set(this.bboxes,c),c+=this.bboxes.length,a.buffer};const hl={};function hi(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),hl[e]={klass:t,omit:i.omit||[]}}hi(Object,"Object"),ga.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},ga.deserialize=function(t){return new ga(t.buffer)},Object.defineProperty(ga,"name",{value:"Grid"}),hi(ga,"Grid"),hi(ir,"Color"),hi(Error,"Error"),hi(We,"AJAXError"),hi(Ir,"ResolvedImage"),hi(cs,"StylePropertyFunction"),hi(As,"StyleExpression",{omit:["_evaluator"]}),hi(il,"ZoomDependentExpression"),hi(tl,"ZoomConstantExpression"),hi(L,"CompoundExpression",{omit:["_evaluate"]});for(const t in Yi)hl[Yi[t]._classRegistryKey]||hi(Yi[t],`Expression${t}`);function Hc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Wc(t){return D.ImageBitmap&&t instanceof D.ImageBitmap}function Fa(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Hc(t)||Wc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof D.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Fa(r,e));return i}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const c in t)t.hasOwnProperty(c)&&(hl[r].omit.indexOf(c)>=0||(a[c]=Fa(t[c],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(a.$name=r),a}throw new Error("can't serialize object of type "+typeof t)}function Ms(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Hc(t)||Wc(t)||ArrayBuffer.isView(t)||t instanceof D.ImageData)return t;if(Array.isArray(t))return t.map(Ms);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=hl[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const a of Object.keys(t))"$name"!==a&&(r[a]=Ms(t[a]));return r}throw new Error("can't deserialize object of type "+typeof t)}class Xc{constructor(){this.first=!0}update(e,i){const r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))}}const Yc=t=>t>=1536&&t<=1791,Na=t=>t>=1872&&t<=1919,Kc=t=>t>=2208&&t<=2303,Yl=t=>t>=11904&&t<=12031,Jc=t=>t>=12032&&t<=12255,Kl=t=>t>=12272&&t<=12287,Ua=t=>t>=12288&&t<=12351,dl=t=>t>=12352&&t<=12447,ja=t=>t>=12448&&t<=12543,pl=t=>t>=12544&&t<=12591,fl=t=>t>=12704&&t<=12735,Qc=t=>t>=12736&&t<=12783,eu=t=>t>=12784&&t<=12799,Jl=t=>t>=12800&&t<=13055,tu=t=>t>=13056&&t<=13311,iu=t=>t>=13312&&t<=19903,Ql=t=>t>=19968&&t<=40959,ml=t=>t>=40960&&t<=42127,nu=t=>t>=42128&&t<=42191,ru=t=>t>=44032&&t<=55215,ou=t=>t>=63744&&t<=64255,ec=t=>t>=64336&&t<=65023,su=t=>t>=65040&&t<=65055,gl=t=>t>=65072&&t<=65103,Va=t=>t>=65104&&t<=65135,l=t=>t>=65136&&t<=65279,n=t=>t>=65280&&t<=65519;function s(t){for(const e of t)if(f(e.charCodeAt(0)))return!0;return!1}function u(t){for(const e of t)if(!d(e.charCodeAt(0)))return!1;return!0}function d(t){return!(Yc(t)||Na(t)||Kc(t)||ec(t)||l(t))}function f(t){return!(746!==t&&747!==t&&(t<4352||!(fl(t)||pl(t)||gl(t)&&!(t>=65097&&t<=65103)||ou(t)||tu(t)||Yl(t)||Qc(t)||!(!Ua(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||iu(t)||Ql(t)||Jl(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||ru(t)||dl(t)||Kl(t)||(e=>e>=12688&&e<=12703)(t)||Jc(t)||eu(t)||ja(t)&&12540!==t||!(!n(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Va(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||su(t)||(e=>e>=19904&&e<=19967)(t)||ml(t)||nu(t))));var e}function y(t){return!(f(t)||(e=t,(i=e)>=128&&i<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(i=>i>=8192&&i<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&9251!==e||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ua(e)||ja(e)||(i=>i>=57344&&i<=63743)(e)||gl(e)||Va(e)||n(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,i}function T(t){return t>=1424&&t<=2303||ec(t)||l(t)}function E(t,e){return!(!e&&T(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=t,i>=6016&&i<=6143));var i}function P(t){for(const e of t)if(T(e.charCodeAt(0)))return!0;return!1}const z="deferred",V="loading",K="loaded";let fe=null,ie="unavailable",ge=null;const ce=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(ie="error"),fe&&fe(t)};function ee(){_e.fire(new bn("pluginStateChange",{pluginStatus:ie,pluginURL:ge}))}const _e=new Kr,he=function(){return ie},Le=function(){if(ie!==z||!ge)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ie=V,ee(),ge&&Xt({url:ge},t=>{t?ce(t):(ie=K,ee())})},ze={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ie===K||null!=ze.applyArabicShaping,isLoading:()=>ie===V,setState(t){ie=t.pluginStatus,ge=t.pluginURL},isParsed:()=>null!=ze.applyArabicShaping&&null!=ze.processBidirectionalText&&null!=ze.processStyledBidirectionalText,getPluginURL:()=>ge};class Te{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Xc,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,r){for(const a of i)if(!E(a.charCodeAt(0),r))return!1;return!0}(e,ze.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*i}}}class Re{constructor(e,i){this.property=e,this.value=i,this.expression=function(r,a){if(Wn(r))return new cs(r,a);if(Cs(r)){const c=La(r,a);if("error"===c.result)throw new Error(c.value.map(h=>`${h.key}: ${h.message}`).join(", "));return c.value}{let c=r;return"string"==typeof r&&"color"===a.type&&(c=ir.parse(r)),{kind:"constant",evaluate:()=>c}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class tt{constructor(e){this.property=e,this.value=new Re(e,void 0)}transitioned(e,i){return new st(this.property,this.value,i,Pt({},e.transition,this.transition),e.now)}untransitioned(){return new st(this.property,this.value,null,{},0)}}class ut{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return vn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new tt(this._values[e].property)),this._values[e].value=new Re(this._values[e].property,null===i?void 0:vn(i))}getTransition(e){return vn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new tt(this._values[e].property)),this._values[e].transition=vn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r);const a=this.getTransition(i);void 0!==a&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const r=new zt(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].transitioned(e,i._values[a]);return r}untransitioned(){const e=new zt(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class st{constructor(e,i,r,a,c){const h=a.delay||0,p=a.duration||0;c=c||0,this.property=e,this.value=i,this.begin=c+h,this.end=this.begin+p,e.specification.transition&&(a.delay||a.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const a=e.now||0,c=this.value.possiblyEvaluate(e,i,r),h=this.prior;if(h){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return h.possiblyEvaluate(e,i,r);{const p=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,r),c,fi(p))}}return c}}class zt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const a=new Et(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,r);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return vn(this._values[e].value)}setValue(e,i){this._values[e]=new Re(this._values[e].property,null===i?void 0:vn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const a=new Et(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,r);return a}}class At{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,r,a){return this.property.evaluate(this.value,this.parameters,e,i,r,a)}}class Et{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class it{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const a=xr[this.specification.type];return a?a(e,i,r):e}}class Ze{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,a){return new At(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},r,a)}:e.expression,i)}interpolate(e,i,r){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new At(this,{kind:"constant",value:void 0},e.parameters);const a=xr[this.specification.type];return a?new At(this,{kind:"constant",value:a(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,a,c,h){return"constant"===e.kind?e.value:e.evaluate(i,r,a,c,h)}}class ni extends Ze{possiblyEvaluate(e,i,r,a){if(void 0===e.value)return new At(this,{kind:"constant",value:void 0},i);if("constant"===e.expression.kind){const c=e.expression.evaluate(i,null,{},r,a),h="resolvedImage"===e.property.specification.type&&"string"!=typeof c?c.name:c,p=this._calculate(h,h,h,i);return new At(this,{kind:"constant",value:p},i)}if("camera"===e.expression.kind){const c=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new At(this,{kind:"constant",value:c},i)}return new At(this,e.expression,i)}evaluate(e,i,r,a,c,h){if("source"===e.kind){const p=e.evaluate(i,r,a,c,h);return this._calculate(p,p,p,i)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},r,a),e.evaluate({zoom:Math.floor(i.zoom)},r,a),e.evaluate({zoom:Math.floor(i.zoom)+1},r,a),i):e.value}_calculate(e,i,r,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:i,other:r}:{from:r,to:i,other:e}}interpolate(e){return e}}class Gt{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,a){if(void 0!==e.value){if("constant"===e.expression.kind){const c=e.expression.evaluate(i,null,{},r,a);return this._calculate(c,c,c,i)}return this._calculate(e.expression.evaluate(new Te(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Te(Math.floor(i.zoom),i)),e.expression.evaluate(new Te(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,r,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:r,to:i}}interpolate(e){return e}}class Qt{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,a){return!!e.expression.evaluate(i,null,{},r,a)}interpolate(){return!1}}class Zt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Te(0,{});for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new Re(a,void 0),h=this.defaultTransitionablePropertyValues[r]=new tt(a);this.defaultTransitioningPropertyValues[r]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate(i)}}}function vi(t,e){return 256*(t=qt(Math.floor(t),0,255))+qt(Math.floor(e),0,255)}hi(Ze,"DataDrivenProperty"),hi(it,"DataConstantProperty"),hi(ni,"CrossFadedDataDrivenProperty"),hi(Gt,"CrossFadedProperty"),hi(Qt,"ColorRampProperty");const Ui={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Li{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ei{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ht(t,e=1){let i=0,r=0;return{members:t.map(a=>{const c=Ui[a.type].BYTES_PER_ELEMENT,h=i=Wi(i,Math.max(e,c)),p=a.components||1;return r=Math.max(r,c),i+=c*p,{name:a.name,type:a.type,components:p,offset:h}}),size:Wi(i,Math.max(r,e)),alignment:e}}function Wi(t,e){return Math.ceil(t/e)*e}class cn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=r,e}}cn.prototype.bytesPerElement=4,hi(cn,"StructArrayLayout2i4");class Ln extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const c=3*e;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=a,e}}Ln.prototype.bytesPerElement=6,hi(Ln,"StructArrayLayout3i6");class zn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=r,this.int16[h+2]=a,this.int16[h+3]=c,e}}zn.prototype.bytesPerElement=8,hi(zn,"StructArrayLayout4i8");class kn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,a,c,h,p)}emplace(e,i,r,a,c,h,p,g){const _=6*e,w=12*e,S=3*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.uint8[w+4]=a,this.uint8[w+5]=c,this.uint8[w+6]=h,this.uint8[w+7]=p,this.float32[S+2]=g,e}}kn.prototype.bytesPerElement=12,hi(kn,"StructArrayLayout2i4ub1f12");class Mr extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const h=4*e;return this.float32[h+0]=i,this.float32[h+1]=r,this.float32[h+2]=a,this.float32[h+3]=c,e}}Mr.prototype.bytesPerElement=16,hi(Mr,"StructArrayLayout4f16");class no extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p,g,_,w){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,r,a,c,h,p,g,_,w)}emplace(e,i,r,a,c,h,p,g,_,w,S){const A=10*e;return this.uint16[A+0]=i,this.uint16[A+1]=r,this.uint16[A+2]=a,this.uint16[A+3]=c,this.uint16[A+4]=h,this.uint16[A+5]=p,this.uint16[A+6]=g,this.uint16[A+7]=_,this.uint16[A+8]=w,this.uint16[A+9]=S,e}}no.prototype.bytesPerElement=20,hi(no,"StructArrayLayout10ui20");class Qo extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,r,a,c,h,p,g)}emplace(e,i,r,a,c,h,p,g,_){const w=8*e;return this.uint16[w+0]=i,this.uint16[w+1]=r,this.uint16[w+2]=a,this.uint16[w+3]=c,this.uint16[w+4]=h,this.uint16[w+5]=p,this.uint16[w+6]=g,this.uint16[w+7]=_,e}}Qo.prototype.bytesPerElement=16,hi(Qo,"StructArrayLayout8ui16");class Xn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,a,c,h)}emplace(e,i,r,a,c,h,p){const g=6*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=a,this.int16[g+3]=c,this.int16[g+4]=h,this.int16[g+5]=p,e}}Xn.prototype.bytesPerElement=12,hi(Xn,"StructArrayLayout6i12");class nr extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p,g,_,w,S,A){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,r,a,c,h,p,g,_,w,S,A)}emplace(e,i,r,a,c,h,p,g,_,w,S,A,R){const F=12*e;return this.int16[F+0]=i,this.int16[F+1]=r,this.int16[F+2]=a,this.int16[F+3]=c,this.uint16[F+4]=h,this.uint16[F+5]=p,this.uint16[F+6]=g,this.uint16[F+7]=_,this.int16[F+8]=w,this.int16[F+9]=S,this.int16[F+10]=A,this.int16[F+11]=R,e}}nr.prototype.bytesPerElement=24,hi(nr,"StructArrayLayout4i4ui4i24");class Mn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,a,c,h)}emplace(e,i,r,a,c,h,p){const g=10*e,_=5*e;return this.int16[g+0]=i,this.int16[g+1]=r,this.int16[g+2]=a,this.float32[_+2]=c,this.float32[_+3]=h,this.float32[_+4]=p,e}}Mn.prototype.bytesPerElement=20,hi(Mn,"StructArrayLayout3i3f20");class fr extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}fr.prototype.bytesPerElement=4,hi(fr,"StructArrayLayout1ul4");class Hr extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p,g,_,w,S,A,R){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,r,a,c,h,p,g,_,w,S,A,R)}emplace(e,i,r,a,c,h,p,g,_,w,S,A,R,F){const H=20*e,Q=10*e;return this.int16[H+0]=i,this.int16[H+1]=r,this.int16[H+2]=a,this.int16[H+3]=c,this.int16[H+4]=h,this.float32[Q+3]=p,this.float32[Q+4]=g,this.float32[Q+5]=_,this.float32[Q+6]=w,this.int16[H+14]=S,this.uint32[Q+8]=A,this.uint16[H+18]=R,this.uint16[H+19]=F,e}}Hr.prototype.bytesPerElement=40,hi(Hr,"StructArrayLayout5i4f1i1ul2ui40");class Gn extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,r,a,c,h,p)}emplace(e,i,r,a,c,h,p,g){const _=8*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=a,this.int16[_+4]=c,this.int16[_+5]=h,this.int16[_+6]=p,this.int16[_+7]=g,e}}Gn.prototype.bytesPerElement=16,hi(Gn,"StructArrayLayout3i2i2i16");class ho extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,a,c)}emplace(e,i,r,a,c,h){const p=4*e,g=8*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=a,this.int16[g+6]=c,this.int16[g+7]=h,e}}ho.prototype.bytesPerElement=16,hi(ho,"StructArrayLayout2f1f2i16");class Ws extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const h=12*e,p=3*e;return this.uint8[h+0]=i,this.uint8[h+1]=r,this.float32[p+1]=a,this.float32[p+2]=c,e}}Ws.prototype.bytesPerElement=12,hi(Ws,"StructArrayLayout2ub2f12");class jo extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const c=3*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=a,e}}jo.prototype.bytesPerElement=12,hi(jo,"StructArrayLayout3f12");class ro extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const c=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=a,e}}ro.prototype.bytesPerElement=6,hi(ro,"StructArrayLayout3ui6");class _a extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p,g,_,w,S,A,R,F,H,Q,we,Oe,be,ke,Ue){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,i,r,a,c,h,p,g,_,w,S,A,R,F,H,Q,we,Oe,be,ke,Ue)}emplace(e,i,r,a,c,h,p,g,_,w,S,A,R,F,H,Q,we,Oe,be,ke,Ue,Pe){const at=30*e,rt=15*e,yt=60*e;return this.int16[at+0]=i,this.int16[at+1]=r,this.int16[at+2]=a,this.float32[rt+2]=c,this.float32[rt+3]=h,this.uint16[at+8]=p,this.uint16[at+9]=g,this.uint32[rt+5]=_,this.uint32[rt+6]=w,this.uint32[rt+7]=S,this.uint16[at+16]=A,this.uint16[at+17]=R,this.uint16[at+18]=F,this.float32[rt+10]=H,this.float32[rt+11]=Q,this.uint8[yt+48]=we,this.uint8[yt+49]=Oe,this.uint8[yt+50]=be,this.uint32[rt+13]=ke,this.int16[at+28]=Ue,this.uint8[yt+58]=Pe,e}}_a.prototype.bytesPerElement=60,hi(_a,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ks extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c,h,p,g,_,w,S,A,R,F,H,Q,we,Oe,be,ke,Ue,Pe,at,rt,yt,Ot,ht,Tt,Ct,Dt){const Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,e,i,r,a,c,h,p,g,_,w,S,A,R,F,H,Q,we,Oe,be,ke,Ue,Pe,at,rt,yt,Ot,ht,Tt,Ct,Dt)}emplace(e,i,r,a,c,h,p,g,_,w,S,A,R,F,H,Q,we,Oe,be,ke,Ue,Pe,at,rt,yt,Ot,ht,Tt,Ct,Dt,Ft){const dt=38*e,ii=19*e;return this.int16[dt+0]=i,this.int16[dt+1]=r,this.int16[dt+2]=a,this.float32[ii+2]=c,this.float32[ii+3]=h,this.int16[dt+8]=p,this.int16[dt+9]=g,this.int16[dt+10]=_,this.int16[dt+11]=w,this.int16[dt+12]=S,this.int16[dt+13]=A,this.uint16[dt+14]=R,this.uint16[dt+15]=F,this.uint16[dt+16]=H,this.uint16[dt+17]=Q,this.uint16[dt+18]=we,this.uint16[dt+19]=Oe,this.uint16[dt+20]=be,this.uint16[dt+21]=ke,this.uint16[dt+22]=Ue,this.uint16[dt+23]=Pe,this.uint16[dt+24]=at,this.uint16[dt+25]=rt,this.uint16[dt+26]=yt,this.uint16[dt+27]=Ot,this.uint16[dt+28]=ht,this.uint32[ii+15]=Tt,this.float32[ii+16]=Ct,this.float32[ii+17]=Dt,this.float32[ii+18]=Ft,e}}ks.prototype.bytesPerElement=76,hi(ks,"StructArrayLayout3i2f6i15ui1ul3f76");class Rr extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Rr.prototype.bytesPerElement=4,hi(Rr,"StructArrayLayout1f4");class es extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,c){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,r,a,c)}emplace(e,i,r,a,c,h){const p=5*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=a,this.float32[p+3]=c,this.float32[p+4]=h,e}}es.prototype.bytesPerElement=20,hi(es,"StructArrayLayout5f20");class Is extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,a)}emplace(e,i,r,a,c){const h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=r,this.uint16[h+3]=a,this.uint16[h+4]=c,e}}Is.prototype.bytesPerElement=12,hi(Is,"StructArrayLayout1ul3ui12");class Vo extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=r,e}}Vo.prototype.bytesPerElement=4,hi(Vo,"StructArrayLayout2ui4");class tc extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}tc.prototype.bytesPerElement=2,hi(tc,"StructArrayLayout1ui2");class au extends Ei{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=r,e}}au.prototype.bytesPerElement=8,hi(au,"StructArrayLayout2f8");class Kh extends Li{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Kh.prototype.size=12;class Jh extends Xn{get(e){return new Kh(this,e)}}hi(Jh,"FillExtrusionExtArray");class Qh extends Li{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Qh.prototype.size=40;class Wu extends Hr{get(e){return new Qh(this,e)}}hi(Wu,"CollisionBoxArray");class ed extends Li{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ed.prototype.size=60;class td extends _a{get(e){return new ed(this,e)}}hi(td,"PlacedSymbolArray");class id extends Li{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}id.prototype.size=76;class nd extends ks{get(e){return new id(this,e)}}hi(nd,"SymbolInstanceArray");class rd extends Rr{getoffsetX(e){return this.float32[1*e+0]}}hi(rd,"GlyphOffsetArray");class od extends Ln{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}hi(od,"SymbolLineVertexArray");class sd extends Li{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sd.prototype.size=12;class ad extends Is{get(e){return new sd(this,e)}}hi(ad,"FeatureIndexArray");class ld extends Li{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ld.prototype.size=4;class cd extends Vo{get(e){return new ld(this,e)}}hi(cd,"FillExtrusionCentroidArray");class ud extends Li{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ud.prototype.size=12;class hd extends Xn{get(e){return new ud(this,e)}}hi(hd,"CircleGlobeExtArray");const Of=Ht([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Rf=Ht([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var _l={exports:{}},fd={exports:function(t,e){var i,r,a,c,h,p,g,_;for(r=t.length-(i=3&t.length),a=e,h=3432918353,p=461845907,_=0;_<r;)g=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24,++_,a=27492+(65535&(c=5*(65535&(a=(a^=g=(65535&(g=(g=(65535&g)*h+(((g>>>16)*h&65535)<<16)&4294967295)<<15|g>>>17))*p+(((g>>>16)*p&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(g=0,i){case 3:g^=(255&t.charCodeAt(_+2))<<16;case 2:g^=(255&t.charCodeAt(_+1))<<8;case 1:a^=g=(65535&(g=(g=(65535&(g^=255&t.charCodeAt(_)))*h+(((g>>>16)*h&65535)<<16)&4294967295)<<15|g>>>17))*p+(((g>>>16)*p&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0}}.exports,Bf={exports:function(t,e){for(var i,r=t.length,a=e^r,c=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(i>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++c;switch(r){case 3:a^=(255&t.charCodeAt(c+2))<<16;case 2:a^=(255&t.charCodeAt(c+1))<<8;case 1:a=1540483477*(65535&(a^=255&t.charCodeAt(c)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0}}.exports;_l.exports=fd,_l.exports.murmur3=fd,_l.exports.murmur2=Bf;class lu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,r,a){this.ids.push(md(e)),this.positions.push(i,r,a)}getPositions(e){const i=md(e);let r=0,a=this.ids.length-1;for(;r<a;){const h=r+a>>1;this.ids[h]>=i?a=h:r=h+1}const c=[];for(;this.ids[r]===i;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c}static serialize(e,i){const r=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Xu(r,a,0,r.length-1),i&&i.push(r.buffer,a.buffer),{ids:r,positions:a}}static deserialize(e){const i=new lu;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function md(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:_l.exports(String(t))}function Xu(t,e,i,r){for(;i<r;){const a=t[i+r>>1];let c=i-1,h=r+1;for(;;){do{c++}while(t[c]<a);do{h--}while(t[h]>a);if(c>=h)break;cu(t,c,h),cu(e,3*c,3*h),cu(e,3*c+1,3*h+1),cu(e,3*c+2,3*h+2)}h-i<r-h?(Xu(t,e,i,h),i=h+1):(Xu(t,e,h+1,r),r=h)}}function cu(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}hi(lu,"FeaturePositionMap");class Xs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class uu extends Xs{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class gd extends Xs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class _d extends Xs{constructor(e){super(e),this.current=ir.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Ff=new Float32Array(16),Nf=new Float32Array(9),Uf=new Float32Array(4);function Yu(t){return[vi(255*t.r,255*t.g),vi(255*t.b,255*t.a)]}class ic{constructor(e,i,r){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=r}setUniform(e,i,r,a,c){i.set(e,c,a.constantOr(this.value))}getBinding(e,i){return"color"===this.type?new _d(e):new uu(e)}}class yl{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,r,a,c){const h="u_pattern_to"===c||"u_dash_to"===c?this.patternTo:"u_pattern_from"===c||"u_dash_from"===c?this.patternFrom:"u_pixel_ratio_to"===c?this.pixelRatioTo:"u_pixel_ratio_from"===c?this.pixelRatioFrom:null;h&&i.set(e,c,h)}getBinding(e,i){return"u_pattern_from"===i||"u_pattern_to"===i||"u_dash_from"===i||"u_dash_to"===i?new gd(e):new uu(e)}}class Ys{constructor(e,i,r,a){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,r,a,c,h){const p=this.paintVertexArray.length,g=this.expression.evaluate(new Te(0),i,{},c,a,h);this.paintVertexArray.resize(e),this._setPaintValue(p,e,g)}updatePaintArray(e,i,r,a,c){const h=this.expression.evaluate({zoom:0},r,a,void 0,c);this._setPaintValue(e,i,h)}_setPaintValue(e,i,r){if("color"===this.type){const a=Yu(r);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ps{constructor(e,i,r,a,c,h){this.expression=e,this.uniformNames=i.map(p=>`u_${p}_t`),this.type=r,this.useIntegerZoom=a,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,r,a,c,h){const p=this.expression.evaluate(new Te(this.zoom),i,{},c,a,h),g=this.expression.evaluate(new Te(this.zoom+1),i,{},c,a,h),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,p,g)}updatePaintArray(e,i,r,a,c){const h=this.expression.evaluate({zoom:this.zoom},r,a,void 0,c),p=this.expression.evaluate({zoom:this.zoom+1},r,a,void 0,c);this._setPaintValue(e,i,h,p)}_setPaintValue(e,i,r,a){if("color"===this.type){const c=Yu(r),h=Yu(a);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,c[0],c[1],h[0],h[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,r,a);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,a,c){const h=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=qt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(e,c,p)}getBinding(e,i){return new uu(e)}}class ya{constructor(e,i,r,a,c,h,p){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=c,this.layerId=p,this.paintVertexAttributes=("array"===r?Rf:Of).members;for(let g=0;g<i.length;++g);this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(e,i,r){const a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,a,c,h){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],h)}_setPaintValues(e,i,r,a){if(!a||!r)return;const{min:c,mid:h,max:p}=r,g=a[c],_=a[h],w=a[p];if(g&&_&&w)for(let S=e;S<i;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,_,g),this._setPaintValue(this.zoomOutPaintVertexArray,S,_,w)}_setPaintValue(e,i,r,a){e.emplace(i,r.tl[0],r.tl[1],r.br[0],r.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],r.pixelRatio,a.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class va{constructor(e,i,r=(()=>!0)){this.binders={},this._buffers=[];const a=[];for(const c in e.paint._values){if(!r(c))continue;const h=e.paint.get(c);if(!(h instanceof At&&dn(h.property.specification)))continue;const p=Vf(c,e.type),g=h.value,_=h.property.specification.type,w=h.property.useIntegerZoom,S=h.property.specification["property-type"],A="cross-faded"===S||"cross-faded-data-driven"===S,R="line-dasharray"===String(c)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==g.kind||R)if("source"===g.kind||R||A){const F=yd(c,_,"source");this.binders[c]=A?new ya(g,p,_,w,i,F,e.id):new Ys(g,p,_,F),a.push(`/a_${c}`)}else{const F=yd(c,_,"composite");this.binders[c]=new ps(g,p,_,w,i,F),a.push(`/z_${c}`)}else this.binders[c]=A?new yl(g.value,p):new ic(g.value,p,_),a.push(`/u_${c}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ys||i instanceof ps?i.maxValue:0}populatePaintArrays(e,i,r,a,c,h){for(const p in this.binders){const g=this.binders[p];(g instanceof Ys||g instanceof ps||g instanceof ya)&&g.populatePaintArray(e,i,r,a,c,h)}}setConstantPatternPositions(e,i){for(const r in this.binders){const a=this.binders[r];a instanceof yl&&a.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,r,a,c,h){let p=!1;for(const g in e){const _=i.getPositions(g);for(const w of _){const S=r.feature(w.index);for(const A in this.binders){const R=this.binders[A];if((R instanceof Ys||R instanceof ps||R instanceof ya)&&!0===R.expression.isStateDependent){const F=a.paint.get(A);R.expression=F.value,R.updatePaintArray(w.start,w.end,S,e[g],c,h),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof ic||r instanceof yl)&&e.push(...r.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Ys||r instanceof ps||r instanceof ya)for(let a=0;a<r.paintVertexAttributes.length;a++)e.push(r.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof ic||r instanceof yl||r instanceof ps)for(const a of r.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof ic||a instanceof yl||a instanceof ps)for(const c of a.uniformNames)i.push({name:c,property:r,binding:a.getBinding(e,c)})}return i}setUniforms(e,i,r,a,c){for(const{name:h,property:p,binding:g}of r)this.binders[p].setUniform(e,g,c,a.get(p),h)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const r=this.binders[i];if(e&&r instanceof ya){const a=2===e.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(r instanceof Ys||r instanceof ps)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof Ys||r instanceof ps||r instanceof ya)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ys||i instanceof ps||i instanceof ya)&&i.destroy()}}}class $a{constructor(e,i,r=(()=>!0)){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new va(a,i,r);this.needsUpload=!1,this._featureMap=new lu,this._bufferOffset=0}populatePaintArrays(e,i,r,a,c,h,p){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,i,a,c,h,p);void 0!==i.id&&this._featureMap.add(i.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,a,c){for(const h of r)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(e,this._featureMap,i,h,a,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const jf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Vf(t,e){return jf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const $f={"line-pattern":{source:no,composite:no},"fill-pattern":{source:no,composite:no},"fill-extrusion-pattern":{source:no,composite:no},"line-dasharray":{source:Qo,composite:Qo}},Gf={color:{source:au,composite:Mr},number:{source:Rr,composite:au}};function yd(t,e,i){const r=$f[t];return r&&r[i]||Gf[e][i]}hi(ic,"ConstantBinder"),hi(yl,"CrossFadedConstantBinder"),hi(Ys,"SourceExpressionBinder"),hi(ya,"CrossFadedCompositeBinder"),hi(ps,"CompositeExpressionBinder"),hi(va,"ProgramConfiguration",{omit:["_buffers"]}),hi($a,"ProgramConfigurationSet");const hu="-transition";class fs extends Kr{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new Ye(i.layout)),i.paint)){this._transitionablePaint=new ut(i.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Et(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){null!=i&&this._validate(Hu,`layers.${this.id}.layout.${e}`,e,i,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return yn(e,hu)?this._transitionablePaint.getTransition(e.slice(0,-hu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(null!=i&&this._validate(Zu,`layers.${this.id}.paint.${e}`,e,i,r))return!1;if(yn(e,hu))return this._transitionablePaint.setTransition(e.slice(0,-hu.length),i||void 0),!1;{const a=this._transitionablePaint._values[e],c="cross-faded-data-driven"===a.property.specification["property-type"],h=a.value.isDataDriven(),p=a.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const g=this._transitionablePaint._values[e].value;return g.isDataDriven()||h||c||this._handleOverridablePaintPropertyUpdate(e,p,g)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Jn(e,(i,r)=>!(void 0===i||"layout"===r&&!Object.keys(i).length||"paint"===r&&!Object.keys(i).length))}_validate(e,i,r,a,c={}){return(!c||!1!==c.validate)&&Xl(this,e.call(Zc,{key:i,layerType:this.type,objectKey:r,value:a,styleSpec:ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof At&&dn(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=rl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const qf=Ht([{name:"a_pos",components:2,type:"Int16"}],4),Zf=Ht([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class wr{constructor(e=[]){this.segments=e}prepareSegment(e,i,r,a){let c=this.segments[this.segments.length-1];return e>wr.MAX_VERTEX_ARRAY_LENGTH&&Ji(`Max vertices per segment is ${wr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>wr.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==a&&(c.sortKey=a),this.segments.push(c)),c}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,a){return new wr([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:a,vaos:{},sortKey:0}])}}wr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hi(wr,"SegmentVector");var $i=8192;class xa{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Sn?new Sn(e.lng,e.lat):Sn.convert(e),this}setSouthWest(e){return this._sw=e instanceof Sn?new Sn(e.lng,e.lat):Sn.convert(e),this}extend(e){const i=this._sw,r=this._ne;let a,c;if(e instanceof Sn)a=e,c=e;else{if(!(e instanceof xa))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(xa.convert(e)):this.extend(Sn.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(Sn.convert(e)):this;if(a=e._sw,c=e._ne,!a||!c)return this}return i||r?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),r.lng=Math.max(c.lng,r.lng),r.lat=Math.max(c.lat,r.lat)):(this._sw=new Sn(a.lng,a.lat),this._ne=new Sn(c.lng,c.lat)),this}getCenter(){return new Sn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Sn(this.getWest(),this.getNorth())}getSouthEast(){return new Sn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=Sn.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&a}static convert(e){return!e||e instanceof xa?e:new xa(e)}}const du=6371008.8;class Sn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Sn(Bi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,a=e.lat*i,c=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return du*Math.acos(Math.min(c,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new xa(new Sn(this.lng-r,this.lat-i),new Sn(this.lng+r,this.lat+i))}static convert(e){if(e instanceof Sn)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Sn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Sn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vd=2*Math.PI*du;function Ku(t){return vd*Math.cos(t*Math.PI/180)}function Ds(t){return(180+t)/360}function Ps(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ts(t,e){return t/Ku(e)}function $o(t){return 360*t-180}function Wr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function xd(t,e){return t*Ku(Wr(e))}const Ls=85.051129;function bd(t){return 1/Math.cos(t*Math.PI/180)}class vl{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=Sn.convert(e);return new vl(Ds(r.lng),Ps(r.lat),ts(i,r.lat))}toLngLat(){return new Sn($o(this.x),Wr(this.y))}toAltitude(){return xd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/vd*bd(Wr(this.y))}}function Ju(t,e,i,r,a,c,h,p,g){const _=(e+r)/2,w=(i+a)/2,S=new ne(_,w);p(S),function(A,R,F,H,Q,we){const Oe=F-Q,be=H-we;return Math.abs((H-R)*Oe-(F-A)*be)/Math.hypot(Oe,be)}(S.x,S.y,c.x,c.y,h.x,h.y)>=g?(Ju(t,e,i,_,w,c,S,p,g),Ju(t,_,w,r,a,S,h,p,g)):t.push(h)}function wd(t,e,i){let r=t[0],a=r.x,c=r.y;e(r);const h=[r];for(let p=1;p<t.length;p++){const g=t[p],{x:_,y:w}=g;e(g),Ju(h,a,c,_,w,r,g,e,i),a=_,c=w,r=g}return h}function Qu(t,e,i,r){if(r(e,i)){const a=e.add(i)._mult(.5);Qu(t,e,a,r),Qu(t,a,i,r)}else t.push(i)}function Hf(t,e){let i=t[0];const r=[i];for(let a=1;a<t.length;a++){const c=t[a];Qu(r,i,c,e),i=c}return r}const eh=Math.pow(2,14)-1,Td=-eh-1;function Wf(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=qt(i,Td,eh),t.y=qt(r,Td,eh),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&Ji("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ks(t,e,i){const r=t.loadGeometry(),a=t.extent,c=$i/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:p,x:g,y:_,projection:w}=i,S=A=>{const R=$o((e.x+A.x/a)/h),F=Wr((e.y+A.y/a)/h),H=w.project(R,F);A.x=(H.x*p-g)*a,A.y=(H.y*p-_)*a};for(let A=0;A<r.length;A++)if(1!==t.type)r[A]=wd(r[A],S,1);else{const R=[];for(const F of r[A])F.x<0||F.x>=a||F.y<0||F.y>=a||(S(F),R.push(F));r[A]=R}}for(const h of r)for(const p of h)Wf(p,c);return r}function Ga(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ks(t):[]}}function pu(t,e,i,r,a){t.emplaceBack(2*e+(r+1)/2,2*i+(a+1)/2)}function fu(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class th{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new cn,this.indexArray=new ro,this.segments=new wr,this.programConfigurations=new $a(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,a){const c=this.layers[0],h=[];let p=null;"circle"===c.type&&(p=c.layout.get("circle-sort-key"));for(const{feature:_,id:w,index:S,sourceLayerIndex:A}of e){const R=this.layers[0]._featureFilter.needGeometry,F=Ga(_,R);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),F,r))continue;const H=p?p.evaluate(F,{},r):void 0,Q={id:w,properties:_.properties,type:_.type,sourceLayerIndex:A,index:S,geometry:R?F.geometry:Ks(_,r,a),patterns:{},sortKey:H};h.push(Q)}p&&h.sort((_,w)=>_.sortKey-w.sortKey);let g=null;"globe"===a.projection.name&&(this.globeExtVertexArray=new hd,g=a.projection);for(const _ of h){const{geometry:w,index:S,sourceLayerIndex:A}=_,R=e[S].feature;this.addFeature(_,w,S,i.availableImages,r,g),i.featureIndex.insert(R,w,S,A,this.index)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Zf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,a,c,h){for(const p of i)for(const g of p){const _=g.x,w=g.y;if(_<0||_>=$i||w<0||w>=$i)continue;if(h){const R=h.projectTilePoint(_,w,c),F=h.upVector(c,_,w),H=this.globeExtVertexArray;fu(H,R,F),fu(H,R,F),fu(H,R,F),fu(H,R,F)}const S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=S.vertexLength;pu(this.layoutVertexArray,_,w,-1,-1),pu(this.layoutVertexArray,_,w,1,-1),pu(this.layoutVertexArray,_,w,1,1),pu(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},a,c)}}function Ed(t,e){for(let i=0;i<t.length;i++)if(qa(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(qa(t,e[i]))return!0;return!!ih(t,e)}function Xf(t,e,i){return!!qa(t,e)||!!nh(e,t,i)}function Sd(t,e){if(1===t.length)return Cd(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let a=0;a<r.length;a++)if(qa(t,r[a]))return!0}for(let i=0;i<t.length;i++)if(Cd(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ih(t,e[i]))return!0;return!1}function Yf(t,e,i){if(t.length>1){if(ih(t,e))return!0;for(let r=0;r<e.length;r++)if(nh(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(nh(t[r],e,i))return!0;return!1}function ih(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],a=t[i+1];for(let c=0;c<e.length-1;c++)if(Kf(r,a,e[c],e[c+1]))return!0}return!1}function Kf(t,e,i,r){return Nn(t,i,r)!==Nn(e,i,r)&&Nn(t,e,i)!==Nn(t,e,r)}function nh(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let a=1;a<e.length;a++)if(Ad(t,e[a-1],e[a])<r)return!0;return!1}function Ad(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function Cd(t,e){let i,r,a,c=!1;for(let h=0;h<t.length;h++){i=t[h];for(let p=0,g=i.length-1;p<i.length;g=p++)r=i[p],a=i[g],r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(c=!c)}return c}function qa(t,e){let i=!1;for(let r=0,a=t.length-1;r<t.length;a=r++){const c=t[r],h=t[a];c.y>e.y!=h.y>e.y&&e.x<(h.x-c.x)*(e.y-c.y)/(h.y-c.y)+c.x&&(i=!i)}return i}function Md(t,e,i,r,a){for(const h of t)if(e<=h.x&&i<=h.y&&r>=h.x&&a>=h.y)return!0;const c=[new ne(e,i),new ne(e,a),new ne(r,a),new ne(r,i)];if(t.length>2)for(const h of c)if(qa(t,h))return!0;for(let h=0;h<t.length-1;h++)if(Jf(t[h],t[h+1],c))return!0;return!1}function Jf(t,e,i){const r=i[0],a=i[2];if(t.x<r.x&&e.x<r.x||t.x>a.x&&e.x>a.x||t.y<r.y&&e.y<r.y||t.y>a.y&&e.y>a.y)return!1;const c=Nn(t,e,i[0]);return c!==Nn(t,e,i[1])||c!==Nn(t,e,i[2])||c!==Nn(t,e,i[3])}function xl(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function mu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function kd(t,e,i,r,a){if(!e[0]&&!e[1])return t;const c=ne.convert(e)._mult(a);"viewport"===i&&c._rotate(-r);const h=[];for(let p=0;p<t.length;p++)h.push(t[p].sub(c));return h}function Id(t,e,i,r){const a=ne.convert(t)._mult(r);return"viewport"===e&&a._rotate(-i),a}hi(th,"CircleBucket",{omit:["layers"]});const Qf=new Zt({"circle-sort-key":new Ze(ct.layout_circle["circle-sort-key"])});var em={paint:new Zt({"circle-radius":new Ze(ct.paint_circle["circle-radius"]),"circle-color":new Ze(ct.paint_circle["circle-color"]),"circle-blur":new Ze(ct.paint_circle["circle-blur"]),"circle-opacity":new Ze(ct.paint_circle["circle-opacity"]),"circle-translate":new it(ct.paint_circle["circle-translate"]),"circle-translate-anchor":new it(ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ze(ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ze(ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ze(ct.paint_circle["circle-stroke-opacity"])}),layout:Qf},gu=1e-6,Do=typeof Float32Array<"u"?Float32Array:Array;function Dd(){var t=new Do(9);return Do!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Pd(t,e,i){var r=e[0],a=e[1],c=e[2],h=e[3],p=e[4],g=e[5],_=e[6],w=e[7],S=e[8],A=i[0],R=i[1],F=i[2],H=i[3],Q=i[4],we=i[5],Oe=i[6],be=i[7],ke=i[8];return t[0]=A*r+R*h+F*_,t[1]=A*a+R*p+F*w,t[2]=A*c+R*g+F*S,t[3]=H*r+Q*h+we*_,t[4]=H*a+Q*p+we*w,t[5]=H*c+Q*g+we*S,t[6]=Oe*r+be*h+ke*_,t[7]=Oe*a+be*p+ke*w,t[8]=Oe*c+be*g+ke*S,t}function zs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rh(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],h=e[4],p=e[5],g=e[6],_=e[7],w=e[8],S=e[9],A=e[10],R=e[11],F=e[12],H=e[13],Q=e[14],we=e[15],Oe=i*p-r*h,be=i*g-a*h,ke=i*_-c*h,Ue=r*g-a*p,Pe=r*_-c*p,at=a*_-c*g,rt=w*H-S*F,yt=w*Q-A*F,Ot=w*we-R*F,ht=S*Q-A*H,Tt=S*we-R*H,Ct=A*we-R*Q,Dt=Oe*Ct-be*Tt+ke*ht+Ue*Ot-Pe*yt+at*rt;return Dt?(t[0]=(p*Ct-g*Tt+_*ht)*(Dt=1/Dt),t[1]=(a*Tt-r*Ct-c*ht)*Dt,t[2]=(H*at-Q*Pe+we*Ue)*Dt,t[3]=(A*Pe-S*at-R*Ue)*Dt,t[4]=(g*Ot-h*Ct-_*yt)*Dt,t[5]=(i*Ct-a*Ot+c*yt)*Dt,t[6]=(Q*ke-F*at-we*be)*Dt,t[7]=(w*at-A*ke+R*be)*Dt,t[8]=(h*Tt-p*Ot+_*rt)*Dt,t[9]=(r*Ot-i*Tt-c*rt)*Dt,t[10]=(F*Pe-H*ke+we*Oe)*Dt,t[11]=(S*ke-w*Pe-R*Oe)*Dt,t[12]=(p*yt-h*ht-g*rt)*Dt,t[13]=(i*ht-r*yt+a*rt)*Dt,t[14]=(H*be-F*Ue-Q*Oe)*Dt,t[15]=(w*Ue-S*be+A*Oe)*Dt,t):null}function bl(t,e,i){var r=e[0],a=e[1],c=e[2],h=e[3],p=e[4],g=e[5],_=e[6],w=e[7],S=e[8],A=e[9],R=e[10],F=e[11],H=e[12],Q=e[13],we=e[14],Oe=e[15],be=i[0],ke=i[1],Ue=i[2],Pe=i[3];return t[0]=be*r+ke*p+Ue*S+Pe*H,t[1]=be*a+ke*g+Ue*A+Pe*Q,t[2]=be*c+ke*_+Ue*R+Pe*we,t[3]=be*h+ke*w+Ue*F+Pe*Oe,t[4]=(be=i[4])*r+(ke=i[5])*p+(Ue=i[6])*S+(Pe=i[7])*H,t[5]=be*a+ke*g+Ue*A+Pe*Q,t[6]=be*c+ke*_+Ue*R+Pe*we,t[7]=be*h+ke*w+Ue*F+Pe*Oe,t[8]=(be=i[8])*r+(ke=i[9])*p+(Ue=i[10])*S+(Pe=i[11])*H,t[9]=be*a+ke*g+Ue*A+Pe*Q,t[10]=be*c+ke*_+Ue*R+Pe*we,t[11]=be*h+ke*w+Ue*F+Pe*Oe,t[12]=(be=i[12])*r+(ke=i[13])*p+(Ue=i[14])*S+(Pe=i[15])*H,t[13]=be*a+ke*g+Ue*A+Pe*Q,t[14]=be*c+ke*_+Ue*R+Pe*we,t[15]=be*h+ke*w+Ue*F+Pe*Oe,t}function nc(t,e,i){var r,a,c,h,p,g,_,w,S,A,R,F,H=i[0],Q=i[1],we=i[2];return e===t?(t[12]=e[0]*H+e[4]*Q+e[8]*we+e[12],t[13]=e[1]*H+e[5]*Q+e[9]*we+e[13],t[14]=e[2]*H+e[6]*Q+e[10]*we+e[14],t[15]=e[3]*H+e[7]*Q+e[11]*we+e[15]):(a=e[1],c=e[2],h=e[3],p=e[4],g=e[5],_=e[6],w=e[7],S=e[8],A=e[9],R=e[10],F=e[11],t[0]=r=e[0],t[1]=a,t[2]=c,t[3]=h,t[4]=p,t[5]=g,t[6]=_,t[7]=w,t[8]=S,t[9]=A,t[10]=R,t[11]=F,t[12]=r*H+p*Q+S*we+e[12],t[13]=a*H+g*Q+A*we+e[13],t[14]=c*H+_*Q+R*we+e[14],t[15]=h*H+w*Q+F*we+e[15]),t}function Za(t,e,i){var r=i[0],a=i[1],c=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function oh(t,e,i){var r=Math.sin(i),a=Math.cos(i),c=e[4],h=e[5],p=e[6],g=e[7],_=e[8],w=e[9],S=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*a+_*r,t[5]=h*a+w*r,t[6]=p*a+S*r,t[7]=g*a+A*r,t[8]=_*a-c*r,t[9]=w*a-h*r,t[10]=S*a-p*r,t[11]=A*a-g*r,t}function _u(t,e,i){var r=Math.sin(i),a=Math.cos(i),c=e[0],h=e[1],p=e[2],g=e[3],_=e[8],w=e[9],S=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a-_*r,t[1]=h*a-w*r,t[2]=p*a-S*r,t[3]=g*a-A*r,t[8]=c*r+_*a,t[9]=h*r+w*a,t[10]=p*r+S*a,t[11]=g*r+A*a,t}function Ld(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zd(t,e,i){var r,a,c,h=i[0],p=i[1],g=i[2],_=Math.hypot(h,p,g);return _<gu?null:(h*=_=1/_,p*=_,g*=_,r=Math.sin(e),a=Math.cos(e),t[0]=h*h*(c=1-a)+a,t[1]=p*h*c+g*r,t[2]=g*h*c-p*r,t[3]=0,t[4]=h*p*c-g*r,t[5]=p*p*c+a,t[6]=g*p*c+h*r,t[7]=0,t[8]=h*g*c+p*r,t[9]=p*g*c-h*r,t[10]=g*g*c+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var tm=bl;function sh(){var t=new Do(3);return Do!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Od(t){var e=new Do(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function rc(t){return Math.hypot(t[0],t[1],t[2])}function wl(t,e,i){var r=new Do(3);return r[0]=t,r[1]=e,r[2]=i,r}function Js(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ah(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Rd(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function oc(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function sc(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Go(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ac(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function po(t,e){var i=e[0],r=e[1],a=e[2],c=i*i+r*r+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t}function is(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function lh(t,e,i){var r=e[0],a=e[1],c=e[2],h=i[0],p=i[1],g=i[2];return t[0]=a*g-c*p,t[1]=c*h-r*g,t[2]=r*p-a*h,t}function Tr(t,e,i){var r=e[0],a=e[1],c=e[2],h=i[3]*r+i[7]*a+i[11]*c+i[15];return t[0]=(i[0]*r+i[4]*a+i[8]*c+i[12])/(h=h||1),t[1]=(i[1]*r+i[5]*a+i[9]*c+i[13])/h,t[2]=(i[2]*r+i[6]*a+i[10]*c+i[14])/h,t}function Bd(t,e,i){var r=i[0],a=i[1],c=i[2],h=e[0],p=e[1],g=e[2],_=a*g-c*p,w=c*h-r*g,S=r*p-a*h,A=a*S-c*w,R=c*_-r*S,F=r*w-a*_,H=2*i[3];return w*=H,S*=H,R*=2,F*=2,t[0]=h+(_*=H)+(A*=2),t[1]=p+w+R,t[2]=g+S+F,t}var lc,ms=ah,im=Rd,nm=rc;function Fd(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Nd(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],h=i*i+r*r+a*a+c*c;return h>0&&(h=1/Math.sqrt(h)),t[0]=i*h,t[1]=r*h,t[2]=a*h,t[3]=c*h,t}function Ha(t,e,i){var r=e[0],a=e[1],c=e[2],h=e[3];return t[0]=i[0]*r+i[4]*a+i[8]*c+i[12]*h,t[1]=i[1]*r+i[5]*a+i[9]*c+i[13]*h,t[2]=i[2]*r+i[6]*a+i[10]*c+i[14]*h,t[3]=i[3]*r+i[7]*a+i[11]*c+i[15]*h,t}function Ud(){var t=new Do(4);return Do!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function jd(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Vd(t,e,i){i*=.5;var r=e[0],a=e[1],c=e[2],h=e[3],p=Math.sin(i),g=Math.cos(i);return t[0]=r*g+h*p,t[1]=a*g+c*p,t[2]=c*g-a*p,t[3]=h*g-r*p,t}function $d(t,e,i){i*=.5;var r=e[0],a=e[1],c=e[2],h=e[3],p=Math.sin(i),g=Math.cos(i);return t[0]=r*g-c*p,t[1]=a*g+h*p,t[2]=c*g+r*p,t[3]=h*g-a*p,t}sh(),lc=new Do(4),Do!=Float32Array&&(lc[0]=0,lc[1]=0,lc[2]=0,lc[3]=0);var rm=Nd;sh(),wl(1,0,0),wl(0,1,0),Ud(),Ud(),Dd();class ch{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const a=is(i,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return r[0]=this.pos[0]+this.dir[0]*c,r[1]=this.pos[1]+this.dir[1]*c,r[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,i,r){if(H=(R=this.pos)[0],Q=R[1],we=R[2],Oe=(F=e)[0],be=F[1],ke=F[2],Math.abs(H-Oe)<=gu*Math.max(1,Math.abs(H),Math.abs(Oe))&&Math.abs(Q-be)<=gu*Math.max(1,Math.abs(Q),Math.abs(be))&&Math.abs(we-ke)<=gu*Math.max(1,Math.abs(we),Math.abs(ke))||0===i)return r[0]=r[1]=r[2]=0,!1;var R,F,H,Q,we,Oe,be,ke;const[a,c,h]=this.dir,p=this.pos[0]-e[0],g=this.pos[1]-e[1],_=this.pos[2]-e[2],w=a*a+c*c+h*h,S=2*(p*a+g*c+_*h),A=S*S-4*w*(p*p+g*g+_*_-i*i);if(A<0){const R=Math.max(-S/2,0),F=p+a*R,H=g+c*R,Q=_+h*R,we=Math.hypot(F,H,Q);return r[0]=F*i/we,r[1]=H*i/we,r[2]=Q*i/we,!1}{const R=(-S-Math.sqrt(A))/(2*w);if(R<0){const F=Math.hypot(p,g,_);return r[0]=p*i/F,r[1]=g*i/F,r[2]=_*i/F,!1}return r[0]=p+a*R,r[1]=g+c*R,r[2]=_+h*R,!0}}}class uh{constructor(e,i,r,a,c){this.TL=e,this.TR=i,this.BR=r,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(e,i,r){const a=[-1,1,1],c=[1,1,1],h=[1,-1,1],p=[-1,-1,1],g=Tr(a,a,e),_=Tr(c,c,e),w=Tr(h,h,e),S=Tr(p,p,e);return new uh(g,_,w,S,i/r)}}class hh{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,r,a){const c=Math.pow(2,r),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(g=>{const _=Ha([],g,e),w=1/_[3]/i*c;return(S=_)[0]=(A=_)[0]*(R=[w,w,a?1/_[3]:w,w])[0],S[1]=A[1]*R[1],S[2]=A[2]*R[2],S[3]=A[3]*R[3],S;var S,A,R}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(g=>{const _=po([],lh([],ms([],h[g[0]],h[g[1]]),ms([],h[g[2]],h[g[1]]))),w=-is(_,h[g[1]]);return _.concat(w)});return new hh(h,p)}}class fo{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const a of e)oc(i,i,a),sc(r,r,a);return new fo(i,r)}static applyTransform(e,i){const r=e.getCorners();for(let a=0;a<r.length;++a)Tr(r[a],r[a],i);return fo.fromPoints(r)}constructor(e,i){this.min=e,this.max=i,this.center=Go([],Js([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=Od(this.min),a=Od(this.max);for(let c=0;c<i.length;c++)r[c]=i[c]?this.min[c]:this.center[c],a[c]=i[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new fo(r,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let r=!0;for(let a=0;a<e.planes.length;a++){const c=e.planes[a];let h=0;for(let p=0;p<i.length;p++)h+=is(c,i[p])+c[3]>=0;if(0===h)return 0;h!==i.length&&(r=!1)}if(r)return 2;for(let a=0;a<3;a++){let c=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let p=0;p<e.points.length;p++){const g=e.points[p][a]-this.min[a];c=Math.min(c,g),h=Math.max(h,g)}if(h<0||c>this.max[a]-this.min[a])return 0}return 1}}function Gd(t,e,i,r,a,c,h,p,g){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(g*=t.pixelToTileUnitsFactor);const _=t.tileID.canonical,w=i.projection.upVectorScale(_,i.center.lat,i.worldSize).metersToTile;for(const S of e)for(const A of S){const R=A.add(p),F=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(R.x,R.y,!0):0,H=i.projection.projectTilePoint(R.x,R.y,_);if(F>0){const be=i.projection.upVector(_,R.x,R.y);H.x+=be[0]*w*F,H.y+=be[1]*w*F,H.z+=be[2]*w*F}const Q=c?R:om(H.x,H.y,H.z,r),we=c?t.tilespaceRays.map(be=>am(be,F)):t.queryGeometry.screenGeometry,Oe=Ha([],[H.x,H.y,H.z,1],r);if(!h&&c?g*=Oe[3]/i.cameraToCenterDistance:h&&!c&&(g*=i.cameraToCenterDistance/Oe[3]),c){const be=Wr((A.y/$i+_.y)/(1<<_.z));g/=i.projection.pixelsPerMeter(be,1)/ts(1,be)}if(Xf(we,Q,g))return!0}return!1}function om(t,e,i,r){const a=Ha([],[t,e,i,1],r);return new ne(a[0]/a[3],a[1]/a[3])}const qd=wl(0,0,0),sm=wl(0,0,1);function am(t,e){const i=sh();return qd[2]=e,t.intersectsPlane(qd,sm,i),new ne(i[0],i[1])}class Zd extends th{}function Hd(t,{width:e,height:i},r,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*r)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=a,t}function Wd(t,e,i){const{width:r,height:a}=e;r===t.width&&a===t.height||(dh(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,a)},i),t.width=r,t.height=a,t.data=e.data)}function dh(t,e,i,r,a,c){if(0===a.width||0===a.height)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const h=t.data,p=e.data;for(let g=0;g<a.height;g++){const _=((i.y+g)*t.width+i.x)*c,w=((r.y+g)*e.width+r.x)*c;for(let S=0;S<a.width*c;S++)p[w+S]=h[_+S]}return e}hi(Zd,"HeatmapBucket",{omit:["layers"]});class Qs{constructor(e,i){Hd(this,e,1,i)}resize(e){Wd(this,new Qs(e),1)}clone(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,a,c){dh(e,i,r,a,c,1)}}class Po{constructor(e,i){Hd(this,e,4,i)}resize(e){Wd(this,new Po(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Po({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,a,c){dh(e,i,r,a,c,4)}}hi(Qs,"AlphaImage"),hi(Po,"RGBAImage");var lm={paint:new Zt({"heatmap-radius":new Ze(ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ze(ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qt(ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(ct.paint_heatmap["heatmap-opacity"])})};function ph(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,a=t.image||new Po({width:i,height:r}),c=(h,p,g)=>{e[t.evaluationKey]=g;const _=t.expression.evaluate(e);a.data[h+p+0]=Math.floor(255*_.r/_.a),a.data[h+p+1]=Math.floor(255*_.g/_.a),a.data[h+p+2]=Math.floor(255*_.b/_.a),a.data[h+p+3]=Math.floor(255*_.a)};if(t.clips)for(let h=0,p=0;h<r;++h,p+=4*i)for(let g=0,_=0;g<i;g++,_+=4){const w=g/(i-1),{start:S,end:A}=t.clips[h];c(p,_,S*(1-w)+A*w)}else for(let h=0,p=0;h<i;h++,p+=4)c(0,p,h/(i-1));return a}var cm={paint:new Zt({"hillshade-illumination-direction":new it(ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(ct.paint_hillshade["hillshade-accent-color"])})};const um=Ht([{name:"a_pos",components:2,type:"Int16"}],4),{members:hm}=um;var cc={exports:{}};function yu(t,e,i){i=i||2;var r,a,c,h,p,g,_,w=e&&e.length,S=w?e[0]*i:t.length,A=Xd(t,0,S,i,!0),R=[];if(!A||A.next===A.prev)return R;if(w&&(A=function(H,Q,we,Oe){var be,ke,Ue,Pe=[];for(be=0,ke=Q.length;be<ke;be++)(Ue=Xd(H,Q[be]*Oe,be<ke-1?Q[be+1]*Oe:H.length,Oe,!1))===Ue.next&&(Ue.steiner=!0),Pe.push(vm(Ue));for(Pe.sort(gm),be=0;be<Pe.length;be++)we=_m(Pe[be],we);return we}(t,e,A,i)),t.length>80*i){r=c=t[0],a=h=t[1];for(var F=i;F<S;F+=i)(p=t[F])<r&&(r=p),(g=t[F+1])<a&&(a=g),p>c&&(c=p),g>h&&(h=g);_=0!==(_=Math.max(c-r,h-a))?32767/_:0}return uc(A,R,i,r,a,_,0),R}function Xd(t,e,i,r,a){var c,h;if(a===gh(t,e,i,r)>0)for(c=e;c<i;c+=r)h=Jd(c,t[c],t[c+1],h);else for(c=i-r;c>=e;c-=r)h=Jd(c,t[c],t[c+1],h);return h&&vu(h,h.next)&&(dc(h),h=h.next),h}function Wa(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!vu(r,r.next)&&0!==mr(r.prev,r,r.next))r=r.next;else{if(dc(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function uc(t,e,i,r,a,c,h){if(t){!h&&c&&function(w,S,A,R){var F=w;do{0===F.z&&(F.z=fh(F.x,F.y,S,A,R)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next}while(F!==w);F.prevZ.nextZ=null,F.prevZ=null,function(H){var Q,we,Oe,be,ke,Ue,Pe,at,rt=1;do{for(we=H,H=null,ke=null,Ue=0;we;){for(Ue++,Oe=we,Pe=0,Q=0;Q<rt&&(Pe++,Oe=Oe.nextZ);Q++);for(at=rt;Pe>0||at>0&&Oe;)0!==Pe&&(0===at||!Oe||we.z<=Oe.z)?(be=we,we=we.nextZ,Pe--):(be=Oe,Oe=Oe.nextZ,at--),ke?ke.nextZ=be:H=be,be.prevZ=ke,ke=be;we=Oe}ke.nextZ=null,rt*=2}while(Ue>1)}(F)}(t,r,a,c);for(var p,g,_=t;t.prev!==t.next;)if(p=t.prev,g=t.next,c?pm(t,r,a,c):dm(t))e.push(p.i/i|0),e.push(t.i/i|0),e.push(g.i/i|0),dc(t),t=g.next,_=g.next;else if((t=g)===_){h?1===h?uc(t=fm(Wa(t),e,i),e,i,r,a,c,2):2===h&&mm(t,e,i,r,a,c):uc(Wa(t),e,i,r,a,c,1);break}}}function dm(t){var e=t.prev,i=t,r=t.next;if(mr(e,i,r)>=0)return!1;for(var a=e.x,c=i.x,h=r.x,p=e.y,g=i.y,_=r.y,w=a<c?a<h?a:h:c<h?c:h,S=p<g?p<_?p:_:g<_?g:_,A=a>c?a>h?a:h:c>h?c:h,R=p>g?p>_?p:_:g>_?g:_,F=r.next;F!==e;){if(F.x>=w&&F.x<=A&&F.y>=S&&F.y<=R&&Tl(a,p,c,g,h,_,F.x,F.y)&&mr(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function pm(t,e,i,r){var a=t.prev,c=t,h=t.next;if(mr(a,c,h)>=0)return!1;for(var p=a.x,g=c.x,_=h.x,w=a.y,S=c.y,A=h.y,R=p<g?p<_?p:_:g<_?g:_,F=w<S?w<A?w:A:S<A?S:A,H=p>g?p>_?p:_:g>_?g:_,Q=w>S?w>A?w:A:S>A?S:A,we=fh(R,F,e,i,r),Oe=fh(H,Q,e,i,r),be=t.prevZ,ke=t.nextZ;be&&be.z>=we&&ke&&ke.z<=Oe;){if(be.x>=R&&be.x<=H&&be.y>=F&&be.y<=Q&&be!==a&&be!==h&&Tl(p,w,g,S,_,A,be.x,be.y)&&mr(be.prev,be,be.next)>=0||(be=be.prevZ,ke.x>=R&&ke.x<=H&&ke.y>=F&&ke.y<=Q&&ke!==a&&ke!==h&&Tl(p,w,g,S,_,A,ke.x,ke.y)&&mr(ke.prev,ke,ke.next)>=0))return!1;ke=ke.nextZ}for(;be&&be.z>=we;){if(be.x>=R&&be.x<=H&&be.y>=F&&be.y<=Q&&be!==a&&be!==h&&Tl(p,w,g,S,_,A,be.x,be.y)&&mr(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;ke&&ke.z<=Oe;){if(ke.x>=R&&ke.x<=H&&ke.y>=F&&ke.y<=Q&&ke!==a&&ke!==h&&Tl(p,w,g,S,_,A,ke.x,ke.y)&&mr(ke.prev,ke,ke.next)>=0)return!1;ke=ke.nextZ}return!0}function fm(t,e,i){var r=t;do{var a=r.prev,c=r.next.next;!vu(a,c)&&Yd(a,r,r.next,c)&&hc(a,c)&&hc(c,a)&&(e.push(a.i/i|0),e.push(r.i/i|0),e.push(c.i/i|0),dc(r),dc(r.next),r=t=c),r=r.next}while(r!==t);return Wa(r)}function mm(t,e,i,r,a,c){var h=t;do{for(var p=h.next.next;p!==h.prev;){if(h.i!==p.i&&xm(h,p)){var g=Kd(h,p);return h=Wa(h,h.next),g=Wa(g,g.next),uc(h,e,i,r,a,c,0),void uc(g,e,i,r,a,c,0)}p=p.next}h=h.next}while(h!==t)}function gm(t,e){return t.x-e.x}function _m(t,e){var i=function(a,c){var h,p=c,g=a.x,_=a.y,w=-1/0;do{if(_<=p.y&&_>=p.next.y&&p.next.y!==p.y){var S=p.x+(_-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(S<=g&&S>w&&(w=S,h=p.x<p.next.x?p:p.next,S===g))return h}p=p.next}while(p!==c);if(!h)return null;var A,R=h,F=h.x,H=h.y,Q=1/0;p=h;do{g>=p.x&&p.x>=F&&g!==p.x&&Tl(_<H?g:w,_,F,H,_<H?w:g,_,p.x,p.y)&&(A=Math.abs(_-p.y)/(g-p.x),hc(p,a)&&(A<Q||A===Q&&(p.x>h.x||p.x===h.x&&ym(h,p)))&&(h=p,Q=A)),p=p.next}while(p!==R);return h}(t,e);if(!i)return e;var r=Kd(i,t);return Wa(r,r.next),Wa(i,i.next)}function ym(t,e){return mr(t.prev,t,e.prev)<0&&mr(e.next,t,t.next)<0}function fh(t,e,i,r,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vm(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Tl(t,e,i,r,a,c,h,p){return(a-h)*(e-p)>=(t-h)*(c-p)&&(t-h)*(r-p)>=(i-h)*(e-p)&&(i-h)*(c-p)>=(a-h)*(r-p)}function xm(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==r.i&&a.next.i!==r.i&&Yd(a,a.next,i,r))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(hc(t,e)&&hc(e,t)&&function(i,r){var a=i,c=!1,h=(i.x+r.x)/2,p=(i.y+r.y)/2;do{a.y>p!=a.next.y>p&&a.next.y!==a.y&&h<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next}while(a!==i);return c}(t,e)&&(mr(t.prev,t,e.prev)||mr(t,e.prev,e))||vu(t,e)&&mr(t.prev,t,t.next)>0&&mr(e.prev,e,e.next)>0)}function mr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function vu(t,e){return t.x===e.x&&t.y===e.y}function Yd(t,e,i,r){var a=bu(mr(t,e,i)),c=bu(mr(t,e,r)),h=bu(mr(i,r,t)),p=bu(mr(i,r,e));return a!==c&&h!==p||!(0!==a||!xu(t,i,e))||!(0!==c||!xu(t,r,e))||!(0!==h||!xu(i,t,r))||!(0!==p||!xu(i,e,r))}function xu(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function bu(t){return t>0?1:t<0?-1:0}function hc(t,e){return mr(t.prev,t,t.next)<0?mr(t,e,t.next)>=0&&mr(t,t.prev,e)>=0:mr(t,e,t.prev)<0||mr(t,t.next,e)<0}function Kd(t,e){var i=new mh(t.i,t.x,t.y),r=new mh(e.i,e.x,e.y),a=t.next,c=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,r.next=i,i.prev=r,c.next=r,r.prev=c,r}function Jd(t,e,i,r){var a=new mh(t,e,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function dc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mh(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gh(t,e,i,r){for(var a=0,c=e,h=i-r;c<i;c+=r)a+=(t[h]-t[c])*(t[c+1]+t[h+1]),h=c;return a}function bm(t,e,i,r,a){Qd(t,e,i||0,r||t.length-1,a||wm)}function Qd(t,e,i,r,a){for(;r>i;){if(r-i>600){var c=r-i+1,h=e-i+1,p=Math.log(c),g=.5*Math.exp(2*p/3),_=.5*Math.sqrt(p*g*(c-g)/c)*(h-c/2<0?-1:1);Qd(t,e,Math.max(i,Math.floor(e-h*g/c+_)),Math.min(r,Math.floor(e+(c-h)*g/c+_)),a)}var w=t[e],S=i,A=r;for(pc(t,i,e),a(t[r],w)>0&&pc(t,i,r);S<A;){for(pc(t,S,A),S++,A--;a(t[S],w)<0;)S++;for(;a(t[A],w)>0;)A--}0===a(t[i],w)?pc(t,i,A):pc(t,++A,r),A<=e&&(i=A+1),e<=A&&(r=A-1)}}function pc(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function wm(t,e){return t<e?-1:t>e?1:0}function _h(t,e){const i=t.length;if(i<=1)return[t];const r=[];let a,c;for(let h=0;h<i;h++){const p=Xi(t[h]);0!==p&&(t[h].area=Math.abs(p),void 0===c&&(c=p<0),c===p<0?(a&&r.push(a),a=[t[h]]):a.push(t[h]))}if(a&&r.push(a),e>1)for(let h=0;h<r.length;h++)r[h].length<=e||(bm(r[h],e,1,r[h].length-1,Tm),r[h]=r[h].slice(0,e));return r}function Tm(t,e){return e.area-t.area}function yh(t,e,i){const r=i.patternDependencies;let a=!1;for(const c of e){const h=c.paint.get(`${t}-pattern`);h.isConstant()||(a=!0);const p=h.constantOr(null);p&&(a=!0,r[p.to]=!0,r[p.from]=!0)}return a}function vh(t,e,i,r,a){const c=a.patternDependencies;for(const h of e){const p=h.paint.get(`${t}-pattern`).value;if("constant"!==p.kind){let g=p.evaluate({zoom:r-1},i,{},a.availableImages),_=p.evaluate({zoom:r},i,{},a.availableImages),w=p.evaluate({zoom:r+1},i,{},a.availableImages);g=g&&g.name?g.name:g,_=_&&_.name?_.name:_,w=w&&w.name?w.name:w,c[g]=!0,c[_]=!0,c[w]=!0,i.patterns[h.id]={min:g,mid:_,max:w}}}return i}cc.exports=yu,cc.exports.default=yu,yu.deviation=function(t,e,i,r){var a=e&&e.length,c=Math.abs(gh(t,0,a?e[0]*i:t.length,i));if(a)for(var h=0,p=e.length;h<p;h++)c-=Math.abs(gh(t,e[h]*i,h<p-1?e[h+1]*i:t.length,i));var g=0;for(h=0;h<r.length;h+=3){var _=r[h]*i,w=r[h+1]*i,S=r[h+2]*i;g+=Math.abs((t[_]-t[S])*(t[w+1]-t[_+1])-(t[_]-t[w])*(t[S+1]-t[_+1]))}return 0===c&&0===g?0:Math.abs((g-c)/c)},yu.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,a=0;a<t.length;a++){for(var c=0;c<t[a].length;c++)for(var h=0;h<e;h++)i.vertices.push(t[a][c][h]);a>0&&i.holes.push(r+=t[a-1].length)}return i};class wu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cn,this.indexArray=new ro,this.indexArray2=new Vo,this.programConfigurations=new $a(e.layers,e.zoom),this.segments=new wr,this.segments2=new wr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,a){this.hasPattern=yh("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:p,id:g,index:_,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,A=Ga(p,S);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),A,r))continue;const R=c?c.evaluate(A,{},r,i.availableImages):void 0,F={id:g,properties:p.properties,type:p.type,sourceLayerIndex:w,index:_,geometry:S?A.geometry:Ks(p,r,a),patterns:{},sortKey:R};h.push(F)}c&&h.sort((p,g)=>p.sortKey-g.sortKey);for(const p of h){const{geometry:g,index:_,sourceLayerIndex:w}=p;if(this.hasPattern){const S=vh("fill",this.layers,p,this.zoom,i);this.patternFeatures.push(S)}else this.addFeature(p,g,_,r,{},i.availableImages);i.featureIndex.insert(e[_].feature,g,_,w,this.index)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}addFeatures(e,i,r,a,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,a,c,h=[]){for(const p of _h(i,500)){let g=0;for(const F of p)g+=F.length;const _=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),w=_.vertexLength,S=[],A=[];for(const F of p){if(0===F.length)continue;F!==p[0]&&A.push(S.length/2);const H=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Q=H.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Q+F.length-1,Q),S.push(F[0].x),S.push(F[0].y);for(let we=1;we<F.length;we++)this.layoutVertexArray.emplaceBack(F[we].x,F[we].y),this.indexArray2.emplaceBack(Q+we-1,Q+we),S.push(F[we].x),S.push(F[we].y);H.vertexLength+=F.length,H.primitiveLength+=F.length}const R=cc.exports(S,A);for(let F=0;F<R.length;F+=3)this.indexArray.emplaceBack(w+R[F],w+R[F+1],w+R[F+2]);_.vertexLength+=g,_.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,h,a)}}hi(wu,"FillBucket",{omit:["layers","patternFeatures"]});const Em=new Zt({"fill-sort-key":new Ze(ct.layout_fill["fill-sort-key"])});var Sm={paint:new Zt({"fill-antialias":new it(ct.paint_fill["fill-antialias"]),"fill-opacity":new Ze(ct.paint_fill["fill-opacity"]),"fill-color":new Ze(ct.paint_fill["fill-color"]),"fill-outline-color":new Ze(ct.paint_fill["fill-outline-color"]),"fill-translate":new it(ct.paint_fill["fill-translate"]),"fill-translate-anchor":new it(ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new ni(ct.paint_fill["fill-pattern"])}),layout:Em};const Am=Ht([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Cm=Ht([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Mm=Ht([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:km}=Am;var Tu={},Im=ne,ep=El;function El(t,e,i,r,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=a,t.readFields(Dm,this,e)}function Dm(t,e,i){1==t?e.id=i.readVarint():2==t?function(r,a){for(var c=r.readVarint()+r.pos;r.pos<c;){var h=a._keys[r.readVarint()],p=a._values[r.readVarint()];a.properties[h]=p}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Pm(t){for(var e,i,r=0,a=0,c=t.length,h=c-1;a<c;h=a++)r+=((i=t[h]).x-(e=t[a]).x)*(e.y+i.y);return r}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,a=0,c=0,h=0,p=[];t.pos<i;){if(a<=0){var g=t.readVarint();r=7&g,a=g>>3}if(a--,1===r||2===r)c+=t.readSVarint(),h+=t.readSVarint(),1===r&&(e&&p.push(e),e=[]),e.push(new Im(c,h));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&p.push(e),p},El.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,a=0,c=0,h=1/0,p=-1/0,g=1/0,_=-1/0;t.pos<e;){if(r<=0){var w=t.readVarint();i=7&w,r=w>>3}if(r--,1===i||2===i)(a+=t.readSVarint())<h&&(h=a),a>p&&(p=a),(c+=t.readSVarint())<g&&(g=c),c>_&&(_=c);else if(7!==i)throw new Error("unknown command "+i)}return[h,g,p,_]},El.prototype.toGeoJSON=function(t,e,i){var r,a,c=this.extent*Math.pow(2,i),h=this.extent*t,p=this.extent*e,g=this.loadGeometry(),_=El.types[this.type];function w(R){for(var F=0;F<R.length;F++){var H=R[F];R[F]=[360*(H.x+h)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+p)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(r=0;r<g.length;r++)S[r]=g[r][0];w(g=S);break;case 2:for(r=0;r<g.length;r++)w(g[r]);break;case 3:for(g=function(R){var F=R.length;if(F<=1)return[R];for(var H,Q,we=[],Oe=0;Oe<F;Oe++){var be=Pm(R[Oe]);0!==be&&(void 0===Q&&(Q=be<0),Q===be<0?(H&&we.push(H),H=[R[Oe]]):H.push(R[Oe]))}return H&&we.push(H),we}(g),r=0;r<g.length;r++)for(a=0;a<g[r].length;a++)w(g[r][a])}1===g.length?g=g[0]:_="Multi"+_;var A={type:"Feature",geometry:{type:_,coordinates:g},properties:this.properties};return"id"in this&&(A.id=this.id),A};var Lm=ep,tp=ip;function ip(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(zm,this,e),this.length=this._features.length}function zm(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(r){for(var a=null,c=r.readVarint()+r.pos;r.pos<c;){var h=r.readVarint()>>3;a=1===h?r.readString():2===h?r.readFloat():3===h?r.readDouble():4===h?r.readVarint64():5===h?r.readVarint():6===h?r.readSVarint():7===h?r.readBoolean():null}return a}(i))}ip.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Lm(this._pbf,e,this.extent,this._keys,this._values)};var Om=tp;function Rm(t,e,i){if(3===t){var r=new Om(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var xh=Tu.VectorTile=function(t,e){this.layers=t.readFields(Rm,{},e)},Eu=Tu.VectorTileFeature=ep;function Su(t,e,i,r){const a=[],c=0===r?(h,p,g,_,w,S)=>{h.push(new ne(S,g+(S-p)/(_-p)*(w-g)))}:(h,p,g,_,w,S)=>{h.push(new ne(p+(S-g)/(w-g)*(_-p),S))};for(const h of t){const p=[];for(const g of h){if(g.length<=2)continue;const _=[];for(let A=0;A<g.length-1;A++){const R=g[A].x,F=g[A].y,H=g[A+1].x,Q=g[A+1].y,we=0===r?R:F,Oe=0===r?H:Q;we<e?Oe>e&&c(_,R,F,H,Q,e):we>i?Oe<i&&c(_,R,F,H,Q,i):_.push(g[A]),Oe<e&&we>=e&&c(_,R,F,H,Q,e),Oe>i&&we<=i&&c(_,R,F,H,Q,i)}let w=g[g.length-1];const S=0===r?w.x:w.y;S>=e&&S<=i&&_.push(w),_.length&&(w=_[_.length-1],_[0].x===w.x&&_[0].y===w.y||_.push(_[0]),p.push(_))}p.length&&a.push(p)}return a}Tu.VectorTileLayer=tp;const Bm=Eu.types,Fm=Math.pow(2,13);function fc(t,e,i,r,a,c,h,p){t.emplaceBack((e<<1)+h,(i<<1)+c,(Math.floor(r*Fm)<<1)+a,Math.round(p))}function mc(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class np{constructor(){this.acc=new ne(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ne(e.x,e.y),this.max=new ne(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,a=this.max;e.x<r.x?r.x=e.x:e.x>a.x&&(a.x=e.x),e.y<r.y?r.y=e.y:e.y>a.y&&(a.y=e.y),((0===e.x||e.x===$i)&&e.x===i.x)!=((0===e.y||e.y===$i)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,on(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>$i!=e.x>$i&&this.addBorderIntersection(1,on(i.y,e.y,($i-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,on(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>$i!=e.y>$i&&this.addBorderIntersection(3,on(i.x,e.x,($i-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((i,r)=>i+r.edges,0);return 0!==e?this.acc.div(e)._round():new ne(0,0)}span(){return new ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class gc{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new zn,this.centroidVertexArray=new cd,this.indexArray=new ro,this.programConfigurations=new $a(e.layers,e.zoom),this.segments=new wr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,r,a){this.features=[],this.hasPattern=yh("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(c){const h=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*h/(h*h+1)/$i/(1<<c.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:h,index:p,sourceLayerIndex:g}of e){const _=this.layers[0]._featureFilter.needGeometry,w=Ga(c,_);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),w,r))continue;const S={id:h,sourceLayerIndex:g,index:p,geometry:_?w.geometry:Ks(c,r,a),properties:c.properties,type:c.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(vh("fill-extrusion",this.layers,S,this.zoom,i)):this.addFeature(S,S.geometry,p,r,{},i.availableImages,a),i.featureIndex.insert(c,S.geometry,p,g,this.index,A)}this.sortBorders()}addFeatures(e,i,r,a,c){for(const h of this.features){const{geometry:p}=h;this.addFeature(h,p,h.index,i,r,a,c)}this.sortBorders()}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,km),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Mm.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Cm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,a,c,h,p){const g=[new ne(0,0),new ne($i,$i)],_=p.projection,w="globe"===_.name,S=this.enableTerrain&&!w?new np:null,A="Polygon"===Bm[e.type];w&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Jh);const R=_h(i,500);for(let we=R.length-1;we>=0;we--){const Oe=R[we];(0===Oe.length||(F=Oe[0]).every(be=>be.x<=0)||F.every(be=>be.x>=$i)||F.every(be=>be.y<=0)||F.every(be=>be.y>=$i))&&R.splice(we,1)}var F;let H;if(w)H=up(R,g,a);else{H=[];for(const we of R)H.push({polygon:we,bounds:g})}const Q=A?this.edgeRadius:0;for(const{polygon:we,bounds:Oe}of H){let be=0,ke=0;for(const Pe of we)A&&!Pe[0].equals(Pe[Pe.length-1])&&Pe.push(Pe[0]),ke+=A?Pe.length-1:Pe.length;const Ue=this.segments.prepareSegment((A?5:4)*ke,this.layoutVertexArray,this.indexArray);if(A){const Pe=[],at=[];be=Ue.vertexLength;for(const yt of we){let Ot,ht;yt.length&&yt!==we[0]&&at.push(Pe.length/2),Ot=yt[1].sub(yt[0])._perp()._unit();for(let Tt=1;Tt<yt.length;Tt++){const Ct=yt[Tt],Dt=yt[Tt===yt.length-1?1:Tt+1];let{x:Ft,y:dt}=Ct;if(Q){ht=Dt.sub(Ct)._perp()._unit();const ii=Ot.add(ht)._unit(),zi=Q*Math.min(4,1/(Ot.x*ii.x+Ot.y*ii.y));Ft+=zi*ii.x,dt+=zi*ii.y,Ot=ht}fc(this.layoutVertexArray,Ft,dt,0,0,1,1,0),Ue.vertexLength++,Pe.push(Ct.x,Ct.y),w&&mc(this.layoutVertexExtArray,_.projectTilePoint(Ft,dt,a),_.upVector(a,Ft,dt))}}const rt=cc.exports(Pe,at);for(let yt=0;yt<rt.length;yt+=3)this.indexArray.emplaceBack(be+rt[yt],be+rt[yt+2],be+rt[yt+1]),Ue.primitiveLength++}for(const Pe of we){S&&Pe.length&&S.startRing(Pe[0]);let at,rt,yt,Ot=Pe.length>4&&ap(Pe[Pe.length-2],Pe[0],Pe[1]),ht=Q?Nm(Pe[Pe.length-2],Pe[0],Pe[1],Q):0;rt=Pe[1].sub(Pe[0])._perp()._unit();let Tt=!0;for(let Ct=1,Dt=0;Ct<Pe.length;Ct++){let Ft=Pe[Ct-1],dt=Pe[Ct];const ii=Pe[Ct===Pe.length-1?1:Ct+1];if(S&&A&&S.currentPolyCount.top++,sp(dt,Ft,Oe)){Q&&(rt=ii.sub(dt)._perp()._unit(),Tt=!Tt);continue}S&&S.append(dt,Ft);const zi=dt.sub(Ft)._perp(),ai=zi.x/(Math.abs(zi.x)+Math.abs(zi.y)),_i=zi.y>0?1:0,ri=Ft.dist(dt);if(Dt+ri>32768&&(Dt=0),Q){yt=ii.sub(dt)._perp()._unit();let _n=op(Ft,dt,ii,rp(rt,yt),Q);isNaN(_n)&&(_n=0);const Ki=dt.sub(Ft)._unit();Ft=Ft.add(Ki.mult(ht))._round(),dt=dt.add(Ki.mult(-_n))._round(),ht=_n,rt=yt}const Oi=Ue.vertexLength,en=Pe.length>4&&ap(Ft,dt,ii);let sn=lp(Dt,Ot,Tt);if(fc(this.layoutVertexArray,Ft.x,Ft.y,ai,_i,0,0,sn),fc(this.layoutVertexArray,Ft.x,Ft.y,ai,_i,0,1,sn),Dt+=ri,sn=lp(Dt,en,!Tt),Ot=en,fc(this.layoutVertexArray,dt.x,dt.y,ai,_i,0,0,sn),fc(this.layoutVertexArray,dt.x,dt.y,ai,_i,0,1,sn),Ue.vertexLength+=4,this.indexArray.emplaceBack(Oi+0,Oi+1,Oi+2),this.indexArray.emplaceBack(Oi+1,Oi+3,Oi+2),Ue.primitiveLength+=2,Q){const _n=be+(1===Ct?Pe.length-2:Ct-2),Ki=1===Ct?be:_n+1;if(this.indexArray.emplaceBack(Oi+1,_n,Oi+3),this.indexArray.emplaceBack(_n,Ki,Oi+3),Ue.primitiveLength+=2,void 0===at&&(at=Oi),!sp(ii,Pe[Ct],Oe)){const er=Ct===Pe.length-1?at:Ue.vertexLength;this.indexArray.emplaceBack(Oi+2,Oi+3,er),this.indexArray.emplaceBack(Oi+3,er+1,er),this.indexArray.emplaceBack(Oi+3,Ki,er+1),Ue.primitiveLength+=3}Tt=!Tt}if(w){const _n=this.layoutVertexExtArray,Ki=_.projectTilePoint(Ft.x,Ft.y,a),er=_.projectTilePoint(dt.x,dt.y,a),un=_.upVector(a,Ft.x,Ft.y),pn=_.upVector(a,dt.x,dt.y);mc(_n,Ki,un),mc(_n,Ki,un),mc(_n,er,pn),mc(_n,er,pn)}}A&&(be+=Pe.length-1)}}if(S&&S.polyCount.length>0){if(S.borders){S.vertexArrayOffset=this.centroidVertexArray.length;const we=S.borders,Oe=this.featuresOnBorder.push(S)-1;for(let be=0;be<4;be++)we[be][0]!==Number.MAX_VALUE&&this.borders[be].push(Oe)}this.encodeCentroid(S.borders?void 0:S.centroid(),S)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,h,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,i,r=!0){let a,c;if(e)if(0!==e.y){const p=i.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(p.x/10)),c=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(p.y/10))}else a=Math.ceil(7*(e.x+450)),c=0;else a=0,c=+r;let h=r?this.centroidVertexArray.length:i.vertexArrayOffset;for(const p of i.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*p.edges+p.top);for(let g=0;g<p.top;g++)this.centroidVertexArray.emplace(h++,a,c);for(let g=0;g<2*p.edges;g++)this.centroidVertexArray.emplace(h++,0,c),this.centroidVertexArray.emplace(h++,a,c)}}}function rp(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Nm(t,e,i,r){const a=e.sub(t)._perp()._unit(),c=i.sub(e)._perp()._unit();return op(t,e,i,rp(a,c),r)}function op(t,e,i,r,a){const c=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,a*c/r)}function sp(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function ap(t,e,i){if(t.x<0||t.x>=$i||e.x<0||e.x>=$i||i.x<0||i.x>=$i)return!1;const r=i.sub(e),a=r.perp(),c=t.sub(e);return(r.x*c.x+r.y*c.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function lp(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function cp(){const t=Math.PI/32,e=Math.tan(t),i=du;return i*Math.sqrt(1+2*e*e)-i}function up(t,e,i){const r=1<<i.z,a=$o(i.x/r),c=$o((i.x+1)/r),h=Wr(i.y/r),p=Wr((i.y+1)/r);return function(g,_,w,S,A=0,R){const F=[];if(!g.length||!w||!S)return F;const H=(Pe,at)=>{for(const rt of Pe)F.push({polygon:rt,bounds:at})},Q=Math.ceil(Math.log2(w)),we=Math.ceil(Math.log2(S)),Oe=Q-we,be=[];for(let Pe=0;Pe<Math.abs(Oe);Pe++)be.push(Oe>0?0:1);for(let Pe=0;Pe<Math.min(Q,we);Pe++)be.push(0),be.push(1);let ke=g;if(ke=Su(ke,_[0].y-A,_[1].y+A,1),ke=Su(ke,_[0].x-A,_[1].x+A,0),!ke.length)return F;const Ue=[];for(be.length?Ue.push({polygons:ke,bounds:_,depth:0}):H(ke,_);Ue.length;){const Pe=Ue.pop(),at=Pe.depth,rt=be[at],yt=Pe.bounds[0],Ot=Pe.bounds[1],ht=0===rt?yt.x:yt.y,Tt=0===rt?Ot.x:Ot.y,Ct=R?R(rt,ht,Tt):.5*(ht+Tt),Dt=Su(Pe.polygons,ht-A,Ct+A,rt),Ft=Su(Pe.polygons,Ct-A,Tt+A,rt);if(Dt.length){const dt=[yt,new ne(0===rt?Ct:Ot.x,1===rt?Ct:Ot.y)];be.length>at+1?Ue.push({polygons:Dt,bounds:dt,depth:at+1}):H(Dt,dt)}if(Ft.length){const dt=[new ne(0===rt?Ct:yt.x,1===rt?Ct:yt.y),Ot];be.length>at+1?Ue.push({polygons:Ft,bounds:dt,depth:at+1}):H(Ft,dt)}}return F}(t,e,Math.ceil((c-a)/11.25),Math.ceil((h-p)/11.25),1,(g,_,w)=>{if(0===g)return.5*(_+w);{const S=Wr((i.y+_/$i)/r);return(Ps(.5*(Wr((i.y+w/$i)/r)+S))*r-i.y)*$i}})}hi(gc,"FillExtrusionBucket",{omit:["layers","features"]}),hi(np,"PartMetadata");const Um=new Zt({"fill-extrusion-edge-radius":new it(ct["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var jm={paint:new Zt({"fill-extrusion-opacity":new it(ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ze(ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ni(ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ze(ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ze(ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new it(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new it(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Um};function hp(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Au{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=_c(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=(h=this.y,p=this.z,g=hp(256*(c=this.x),256*(h=Math.pow(2,p)-h-1),p),_=hp(256*(c+1),256*(h+1),p),g[0]+","+g[1]+","+_[0]+","+_[1]),a=function(c,h,p){let g,_="";for(let w=c;w>0;w--)g=1<<w-1,_+=(h&g?1:0)+(p&g?2:0);return _}(this.z,this.x,this.y);var c,h,p,g,_;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dp{constructor(e,i){this.wrap=e,this.canonical=i,this.key=_c(e,i.z,i.z,i.x,i.y)}}class mo{constructor(e,i,r,a,c){this.overscaledZ=e,this.wrap=i,this.canonical=new Au(r,+a,+c),this.key=0===i&&e===r?this.canonical.key:_c(i,e,r,a,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new mo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mo(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return _c(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return _c(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new mo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,a=2*this.canonical.y;return[new mo(i,this.wrap,i,r,a),new mo(i,this.wrap,i,r+1,a),new mo(i,this.wrap,i,r,a+1),new mo(i,this.wrap,i,r+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new mo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new mo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _c(t,e,i,r,a){const c=1<<Math.min(i,22);let h=c*(a%c)+r%c;return t&&i<22&&(h+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}hi(Au,"CanonicalTileID"),hi(mo,"OverscaledTileID",{omit:["projMatrix"]});class Sl extends ne{constructor(e,i,r){super(e,i),this.z=r}}function yc(t,e){return t.x*e.x+t.y*e.y}function pp(t,e){if(1===t.length){let i=0;const r=e[i++];let a;for(;!a||r.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const c=e[i],h=t[0],p=a.sub(r),g=c.sub(r),_=h.sub(r),w=yc(p,p),S=yc(p,g),A=yc(g,g),R=yc(_,p),F=yc(_,g),H=w*A-S*S,Q=(A*R-S*F)/H,we=(w*F-S*R)/H,Oe=r.z*(1-Q-we)+a.z*Q+c.z*we;if(isFinite(Oe))return Oe}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function fp(t,e,i,r,a,c,h,p){const g=h*a.getElevationAt(t,e,!0,!0),_=0!==c[0],w=_?0===c[1]?h*(c[0]/7-450):h*function(S,A,R){const F=Math.floor(A[0]/8),H=Math.floor(A[1]/8),Q=10*(A[0]-8*F),we=10*(A[1]-8*H),Oe=S.getElevationAt(F,H,!0,!0),be=S.getMeterToDEM(R),ke=Math.floor(.5*(Q*be-1)),Ue=Math.floor(.5*(we*be-1)),Pe=S.tileCoordToPixel(F,H),at=2*ke+1,rt=2*Ue+1,yt=(zi=at,ai=rt,[(Ft=S).getElevationAtPixel(dt=Pe.x-ke,ii=Pe.y-Ue,!0),Ft.getElevationAtPixel(dt+ai,ii,!0),Ft.getElevationAtPixel(dt,ii+ai,!0),Ft.getElevationAtPixel(dt+zi,ii+ai,!0)]),Ot=Math.abs(yt[0]-yt[1]),ht=Math.abs(yt[2]-yt[3]),Tt=Math.abs(yt[0]-yt[2])+Math.abs(yt[1]-yt[3]),Ct=Math.min(.25,.5*be*(Ot+ht)/at),Dt=Math.min(.25,.5*be*Tt/rt);var Ft,dt,ii,zi,ai;return Oe+Math.max(Ct*Q,Dt*we)}(a,c,p):g;return{base:g+(0===i)?-1:i,top:_?Math.max(w+r,g+i+2):g+r}}const Vm=Ht([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$m}=Vm,Gm=Ht([{name:"a_packed",components:4,type:"Float32"}]),{members:qm}=Gm,Zm=Eu.types,Hm=Math.cos(Math.PI/180*37.5);class Cu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new kn,this.layoutVertexArray2=new Mr,this.indexArray=new ro,this.programConfigurations=new $a(e.layers,e.zoom),this.segments=new wr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,a){this.hasPattern=yh("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),h=[];for(const{feature:w,id:S,index:A,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,H=Ga(w,F);if(!this.layers[0]._featureFilter.filter(new Te(this.zoom),H,r))continue;const Q=c?c.evaluate(H,{},r):void 0,we={id:S,properties:w.properties,type:w.type,sourceLayerIndex:R,index:A,geometry:F?H.geometry:Ks(w,r,a),patterns:{},sortKey:Q};h.push(we)}c&&h.sort((w,S)=>w.sortKey-S.sortKey);const{lineAtlas:p,featureIndex:g}=i,_=this.addConstantDashes(p);for(const w of h){const{geometry:S,index:A,sourceLayerIndex:R}=w;if(_&&this.addFeatureDashes(w,p),this.hasPattern){const F=vh("line",this.layers,w,this.zoom,i);this.patternFeatures.push(F)}else this.addFeature(w,S,A,r,p.positions,i.availableImages);g.insert(e[A].feature,S,A,R,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const a=r.paint.get("line-dasharray").value,c=r.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==c.kind)i=!0;else{const h=c.value,p=a.value;if(!p)continue;e.addDash(p.from,h),e.addDash(p.to,h),p.other&&e.addDash(p.other,h)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if("constant"===c.kind&&"constant"===h.kind)continue;let p,g,_,w,S,A;if("constant"===c.kind){const Q=c.value;if(!Q)continue;p=Q.other||Q.to,g=Q.to,_=Q.from}else p=c.evaluate({zoom:r-1},e),g=c.evaluate({zoom:r},e),_=c.evaluate({zoom:r+1},e);"constant"===h.kind?w=S=A=h.value:(w=h.evaluate({zoom:r-1},e),S=h.evaluate({zoom:r},e),A=h.evaluate({zoom:r+1},e)),i.addDash(p,w),i.addDash(g,S),i.addDash(_,A);const R=i.getKey(p,w),F=i.getKey(g,S),H=i.getKey(_,A);e.patterns[a.id]={min:R,mid:F,max:H}}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}addFeatures(e,i,r,a,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$m),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,a,c,h){const p=this.layers[0].layout,g=p.get("line-join").evaluate(e,{}),_=p.get("line-cap").evaluate(e,{}),w=p.get("line-miter-limit"),S=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of i)this.addLine(A,e,g,_,w,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,h,a)}addLine(e,i,r,a,c,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let we=0;we<e.length-1;we++)this.totalDistance+=e[we].dist(e[we+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p="Polygon"===Zm[i.type];let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let _=0;for(;_<g-1&&e[_].equals(e[_+1]);)_++;if(g<(p?3:2))return;"bevel"===r&&(c=1.05);const w=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let A,R,F,H,Q;this.e1=this.e2=-1,p&&(A=e[g-2],Q=e[_].sub(A)._unit()._perp());for(let we=_;we<g;we++){if(F=we===g-1?p?e[_+1]:void 0:e[we+1],F&&e[we].equals(F))continue;Q&&(H=Q),A&&(R=A),A=e[we],Q=F?F.sub(A)._unit()._perp():H,H=H||Q;let Oe=H.add(Q);0===Oe.x&&0===Oe.y||Oe._unit();const be=H.x*Q.x+H.y*Q.y,ke=Oe.x*Q.x+Oe.y*Q.y,Ue=0!==ke?1/ke:1/0,Pe=2*Math.sqrt(2-2*ke),at=ke<Hm&&R&&F,rt=H.x*Q.y-H.y*Q.x>0;if(at&&we>_){const ht=A.dist(R);if(ht>2*w){const Tt=A.sub(A.sub(R)._mult(w/ht)._round());this.updateDistance(R,Tt),this.addCurrentVertex(Tt,H,0,0,S),R=Tt}}const yt=R&&F;let Ot=yt?r:p?"butt":a;if(yt&&"round"===Ot&&(Ue<h?Ot="miter":Ue<=2&&(Ot="fakeround")),"miter"===Ot&&Ue>c&&(Ot="bevel"),"bevel"===Ot&&(Ue>2&&(Ot="flipbevel"),Ue<c&&(Ot="miter")),R&&this.updateDistance(R,A),"miter"===Ot)Oe._mult(Ue),this.addCurrentVertex(A,Oe,0,0,S);else if("flipbevel"===Ot){if(Ue>100)Oe=Q.mult(-1);else{const ht=Ue*H.add(Q).mag()/H.sub(Q).mag();Oe._perp()._mult(ht*(rt?-1:1))}this.addCurrentVertex(A,Oe,0,0,S),this.addCurrentVertex(A,Oe.mult(-1),0,0,S)}else if("bevel"===Ot||"fakeround"===Ot){const ht=-Math.sqrt(Ue*Ue-1),Tt=rt?ht:0,Ct=rt?0:ht;if(R&&this.addCurrentVertex(A,H,Tt,Ct,S),"fakeround"===Ot){const Dt=Math.round(180*Pe/Math.PI/20);for(let Ft=1;Ft<Dt;Ft++){let dt=Ft/Dt;if(.5!==dt){const zi=dt-.5;dt+=dt*zi*(dt-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*zi*zi+(.848013+be*(.215638*be-1.06021)))}const ii=Q.sub(H)._mult(dt)._add(H)._unit()._mult(rt?-1:1);this.addHalfVertex(A,ii.x,ii.y,!1,rt,0,S)}}F&&this.addCurrentVertex(A,Q,-Tt,-Ct,S)}else if("butt"===Ot)this.addCurrentVertex(A,Oe,0,0,S);else if("square"===Ot){const ht=R?1:-1;R||this.addCurrentVertex(A,Oe,ht,ht,S),this.addCurrentVertex(A,Oe,0,0,S),R&&this.addCurrentVertex(A,Oe,ht,ht,S)}else"round"===Ot&&(R&&(this.addCurrentVertex(A,H,0,0,S),this.addCurrentVertex(A,H,1,1,S,!0)),F&&(this.addCurrentVertex(A,Q,-1,-1,S,!0),this.addCurrentVertex(A,Q,0,0,S)));if(at&&we<g-1){const ht=A.dist(F);if(ht>2*w){const Tt=A.add(F.sub(A)._mult(w/ht)._round());this.updateDistance(A,Tt),this.addCurrentVertex(Tt,Q,0,0,S),A=Tt}}}}addCurrentVertex(e,i,r,a,c,h=!1){const p=i.y*a-i.x,g=-i.y-i.x*a;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,h,!1,r,c),this.addHalfVertex(e,p,g,h,!0,-a,c)}addHalfVertex({x:e,y:i},r,a,c,h,p,g){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(i<<1)+(h?1:0),Math.round(63*r)+128,Math.round(63*a)+128,1+(0===p?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const _=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),g.primitiveLength++),h?this.e2=_:this.e1=_}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}hi(Cu,"LineBucket",{omit:["layers","patternFeatures"]});const Wm=new Zt({"line-cap":new Ze(ct.layout_line["line-cap"]),"line-join":new Ze(ct.layout_line["line-join"]),"line-miter-limit":new it(ct.layout_line["line-miter-limit"]),"line-round-limit":new it(ct.layout_line["line-round-limit"]),"line-sort-key":new Ze(ct.layout_line["line-sort-key"])});var mp={paint:new Zt({"line-opacity":new Ze(ct.paint_line["line-opacity"]),"line-color":new Ze(ct.paint_line["line-color"]),"line-translate":new it(ct.paint_line["line-translate"]),"line-translate-anchor":new it(ct.paint_line["line-translate-anchor"]),"line-width":new Ze(ct.paint_line["line-width"]),"line-gap-width":new Ze(ct.paint_line["line-gap-width"]),"line-offset":new Ze(ct.paint_line["line-offset"]),"line-blur":new Ze(ct.paint_line["line-blur"]),"line-dasharray":new ni(ct.paint_line["line-dasharray"]),"line-pattern":new ni(ct.paint_line["line-pattern"]),"line-gradient":new Qt(ct.paint_line["line-gradient"]),"line-trim-offset":new it(ct.paint_line["line-trim-offset"])}),layout:Wm};const gp=new class extends Ze{possiblyEvaluate(t,e){return e=new Te(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=Pt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(mp.paint.properties["line-width"].specification);function _p(t,e){return e>0?e+2*t:t}gp.useIntegerZoom=!0;const Xm=Ht([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ym=Ht([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Km=Ht([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ht([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jm=Ht([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Qm=Ht([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ht([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yp=Ht([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eg=Ht([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ht([{name:"triangle",components:3,type:"Uint16"}]),Ht([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ht([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ht([{type:"Float32",name:"offsetX"}]),Ht([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Os=128;function bh(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Te(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:r,interpolationType:a}=i;let c=0;for(;c<r.length&&r[c]<=t;)c++;c=Math.max(0,c-1);let h=c;for(;h<r.length&&r[h]<t+1;)h++;h=Math.min(r.length-1,h);const p=r[c],g=r[h];return"composite"===i.kind?{kind:"composite",minZoom:p,maxZoom:g,interpolationType:a}:{kind:"camera",minZoom:p,maxZoom:g,minSize:i.evaluate(new Te(p)),maxSize:i.evaluate(new Te(g)),interpolationType:a}}}function Mu(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:a}){return"source"===t.kind?r/Os:"composite"===t.kind?on(r/Os,a/Os,i):e}function Al(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:a,minZoom:c,maxZoom:h}=t,p=a?qt(br.interpolationFactor(a,e,c,h),0,1):0;"camera"===t.kind?r=on(t.minSize,t.maxSize,p):i=p}return{uSizeT:i,uSize:r}}var tg=Object.freeze({__proto__:null,getSizeData:bh,evaluateSizeForFeature:Mu,evaluateSizeForZoom:Al,SIZE_PACK_FACTOR:Os});function ig(t,e,i){return t.sections.forEach(r=>{r.text=function(a,c,h){const p=c.layout.get("text-transform").evaluate(h,{});return"uppercase"===p?a=a.toLocaleUpperCase():"lowercase"===p&&(a=a.toLocaleLowerCase()),ze.applyArabicShaping&&(a=ze.applyArabicShaping(a)),a}(r.text,e,i)}),t}const vc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function ng(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function rg(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var xc=qn,vp=function(t,e,i,r,a){var c,h,p=8*a-r-1,g=(1<<p)-1,_=g>>1,w=-7,S=i?a-1:0,A=i?-1:1,R=t[e+S];for(S+=A,c=R&(1<<-w)-1,R>>=-w,w+=p;w>0;c=256*c+t[e+S],S+=A,w-=8);for(h=c&(1<<-w)-1,c>>=-w,w+=r;w>0;h=256*h+t[e+S],S+=A,w-=8);if(0===c)c=1-_;else{if(c===g)return h?NaN:1/0*(R?-1:1);h+=Math.pow(2,r),c-=_}return(R?-1:1)*h*Math.pow(2,c-r)},xp=function(t,e,i,r,a,c){var h,p,g,_=8*c-a-1,w=(1<<_)-1,S=w>>1,A=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,R=r?0:c-1,F=r?1:-1,H=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,h=w):(h=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-h))<1&&(h--,g*=2),(e+=h+S>=1?A/g:A*Math.pow(2,1-S))*g>=2&&(h++,g/=2),h+S>=w?(p=0,h=w):h+S>=1?(p=(e*g-1)*Math.pow(2,a),h+=S):(p=e*Math.pow(2,S-1)*Math.pow(2,a),h=0));a>=8;t[i+R]=255&p,R+=F,p/=256,a-=8);for(h=h<<a|p,_+=a;_>0;t[i+R]=255&h,R+=F,h/=256,_-=8);t[i+R-F]|=128*H};function qn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}qn.Varint=0,qn.Fixed64=1,qn.Bytes=2,qn.Fixed32=5;var wh=4294967296,bp=1/wh,wp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ea(t){return t.type===qn.Bytes?t.readVarint()+t.pos:t.pos+1}function Tp(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var a=i.pos-1;a>=t;a--)i.buf[a+r]=i.buf[a]}function og(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function sg(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function ag(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function lg(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function cg(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function ug(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function hg(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function dg(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function pg(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function ku(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Ml(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Ep(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function fg(t,e,i){e.glyphs=[],1===t&&i.readMessage(mg,e)}function mg(t,e,i){if(3===t){const{id:r,bitmap:a,width:c,height:h,left:p,top:g,advance:_}=i.readMessage(gg,{});e.glyphs.push({id:r,bitmap:new Qs({width:c+6,height:h+6},a),metrics:{width:c,height:h,left:p,top:g,advance:_}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function gg(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}function Th(t){let e=0,i=0;for(const h of t)e+=h.w*h.h,i=Math.max(i,h.w);t.sort((h,p)=>p.h-h.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,c=0;for(const h of t)for(let p=r.length-1;p>=0;p--){const g=r[p];if(!(h.w>g.w||h.h>g.h)){if(h.x=g.x,h.y=g.y,c=Math.max(c,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===g.w&&h.h===g.h){const _=r.pop();p<r.length&&(r[p]=_)}else h.h===g.h?(g.x+=h.w,g.w-=h.w):h.w===g.w?(g.y+=h.h,g.h-=h.h):(r.push({x:g.x+h.w,y:g.y,w:g.w-h.w,h:h.h}),g.y+=h.h,g.h-=h.h);break}}return{w:a,h:c,fill:e/(a*c)||0}}qn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),a=r>>3,c=this.pos;this.type=7&r,t(a,e,this),this.pos===c&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ku(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Ep(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ku(this.buf,this.pos)+ku(this.buf,this.pos+4)*wh;return this.pos+=8,t},readSFixed64:function(){var t=ku(this.buf,this.pos)+Ep(this.buf,this.pos+4)*wh;return this.pos+=8,t},readFloat:function(){var t=vp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=vp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(a,c,h){var p,g,_=h.buf;if(p=(112&(g=_[h.pos++]))>>4,g<128||(p|=(127&(g=_[h.pos++]))<<3,g<128)||(p|=(127&(g=_[h.pos++]))<<10,g<128)||(p|=(127&(g=_[h.pos++]))<<17,g<128)||(p|=(127&(g=_[h.pos++]))<<24,g<128)||(p|=(1&(g=_[h.pos++]))<<31,g<128))return function Cl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(a,p,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&wp?wp.decode(this.buf.subarray(e,t)):function(i,r,a){for(var c="",h=r;h<a;){var p,g,_,w=i[h],S=null,A=w>239?4:w>223?3:w>191?2:1;if(h+A>a)break;1===A?w<128&&(S=w):2===A?128==(192&(p=i[h+1]))&&(S=(31&w)<<6|63&p)<=127&&(S=null):3===A?(g=i[h+2],128==(192&(p=i[h+1]))&&128==(192&g)&&((S=(15&w)<<12|(63&p)<<6|63&g)<=2047||S>=55296&&S<=57343)&&(S=null)):4===A&&(g=i[h+2],_=i[h+3],128==(192&(p=i[h+1]))&&128==(192&g)&&128==(192&_)&&((S=(15&w)<<18|(63&p)<<12|(63&g)<<6|63&_)<=65535||S>=1114112)&&(S=null)),null===S?(S=65533,A=1):S>65535&&(S-=65536,c+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),c+=String.fromCharCode(S),h+=A}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==qn.Bytes)return t.push(this.readVarint(e));var i=ea(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==qn.Bytes)return t.push(this.readSVarint());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==qn.Bytes)return t.push(this.readBoolean());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==qn.Bytes)return t.push(this.readFloat());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==qn.Bytes)return t.push(this.readDouble());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==qn.Bytes)return t.push(this.readFixed32());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==qn.Bytes)return t.push(this.readSFixed32());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==qn.Bytes)return t.push(this.readFixed64());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==qn.Bytes)return t.push(this.readSFixed64());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===qn.Varint)for(;this.buf[this.pos++]>127;);else if(e===qn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===qn.Fixed32)this.pos+=4;else{if(e!==qn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ml(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ml(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ml(this.buf,-1&t,this.pos),Ml(this.buf,Math.floor(t*bp),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ml(this.buf,-1&t,this.pos),Ml(this.buf,Math.floor(t*bp),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,a,c,p;if(e>=0?(r=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,a=a+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),c=r,(p=i).buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,p.buf[p.pos]=127&(c>>>=7),function(c,h){var p=(7&c)<<4;h.buf[h.pos++]|=p|((c>>>=3)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c|((c>>>=7)?128:0),c&&(h.buf[h.pos++]=127&c)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,a,c){for(var h,p,g=0;g<a.length;g++){if((h=a.charCodeAt(g))>55295&&h<57344){if(!p){h>56319||g+1===a.length?(r[c++]=239,r[c++]=191,r[c++]=189):p=h;continue}if(h<56320){r[c++]=239,r[c++]=191,r[c++]=189,p=h;continue}h=p-55296<<10|h-56320|65536,p=null}else p&&(r[c++]=239,r[c++]=191,r[c++]=189,p=null);h<128?r[c++]=h:(h<2048?r[c++]=h>>6|192:(h<65536?r[c++]=h>>12|224:(r[c++]=h>>18|240,r[c++]=h>>12&63|128),r[c++]=h>>6&63|128),r[c++]=63&h|128)}return c}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Tp(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),xp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),xp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Tp(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,qn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,og,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,sg,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,cg,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ag,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,lg,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,ug,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,hg,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,dg,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,pg,e)},writeBytesField:function(t,e){this.writeTag(t,qn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,qn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,qn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,qn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,qn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,qn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,qn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,qn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,qn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,qn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Eh{constructor(e,{pixelRatio:i,version:r,stretchX:a,stretchY:c,content:h}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=c,this.content=h,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Sp{constructor(e,i){const r={},a={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,r,c),this.addImages(i,a,c);const{w:h,h:p}=Th(c),g=new Po({width:h||1,height:p||1});for(const _ in e){const w=e[_],S=r[_].paddedRect;Po.copy(w.data,g,{x:0,y:0},{x:S.x+1,y:S.y+1},w.data)}for(const _ in i){const w=i[_],S=a[_].paddedRect,A=S.x+1,R=S.y+1,F=w.data.width,H=w.data.height;Po.copy(w.data,g,{x:0,y:0},{x:A,y:R},w.data),Po.copy(w.data,g,{x:0,y:H-1},{x:A,y:R-1},{width:F,height:1}),Po.copy(w.data,g,{x:0,y:0},{x:A,y:R+H},{width:F,height:1}),Po.copy(w.data,g,{x:F-1,y:0},{x:A-1,y:R},{width:1,height:H}),Po.copy(w.data,g,{x:0,y:0},{x:A+F,y:R},{width:1,height:H})}this.image=g,this.iconPositions=r,this.patternPositions=a}addImages(e,i,r){for(const a in e){const c=e[a],h={x:0,y:0,w:c.data.width+2,h:c.data.height+2};r.push(h),i[a]=new Eh(h,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),i),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,c]=e.tl;r.update(i.data,void 0,{x:a,y:c})}}hi(Eh,"ImagePosition"),hi(Sp,"ImageAtlas");const qo={horizontal:1,vertical:2,horizontalOnly:3};class bc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new bc;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new bc;return i.imageName=e,i}}class kl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new kl;for(let a=0;a<e.sections.length;a++){const c=e.sections[a];c.image?r.addImageSection(c):r.addTextSection(c,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,r){let a="";for(let c=0;c<i.length;c++){const h=i.charCodeAt(c+1)||null,p=i.charCodeAt(c-1)||null;a+=!r&&(h&&y(h)&&!vc[i[c+1]]||p&&y(p)&&!vc[i[c-1]])||!vc[i[c]]?i[c]:vc[i[c]]}return a}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Iu[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Iu[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new kl;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(bc.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void Ji("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(bc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sh(t,e,i,r,a,c,h,p,g,_,w,S,A,R,F){const H=kl.fromFeature(t,a);S===qo.vertical&&H.verticalizePunctuation(A);let Q=[];const we=function(Pe,at,rt,yt,Ot,ht){if(!Pe)return[];const Tt=[],Ct=function(ii,zi,ai,_i,ri,Oi){let en=0;for(let sn=0;sn<ii.length();sn++){const _n=ii.getSection(sn);en+=Ap(ii.getCharCode(sn),_n,_i,ri,zi,Oi)}return en/Math.max(1,Math.ceil(en/ai))}(Pe,at,rt,yt,Ot,ht),Dt=Pe.text.indexOf("\u200b")>=0;let Ft=0;for(let ii=0;ii<Pe.length();ii++){const zi=Pe.getSection(ii),ai=Pe.getCharCode(ii);if(Iu[ai]||(Ft+=Ap(ai,zi,yt,Ot,at,ht)),ii<Pe.length()-1){const _i=!((dt=ai)<11904||!(fl(dt)||pl(dt)||gl(dt)||ou(dt)||tu(dt)||Yl(dt)||Qc(dt)||Ua(dt)||iu(dt)||Ql(dt)||Jl(dt)||n(dt)||dl(dt)||Kl(dt)||Jc(dt)||eu(dt)||ja(dt)||su(dt)||nu(dt)||ml(dt)));(_g[ai]||_i||zi.imageName)&&Tt.push(Mp(ii+1,Ft,Ct,Tt,yg(ai,Pe.getCharCode(ii+1),_i&&Dt),!1))}}var dt;return kp(Mp(Pe.length(),Ft,Ct,Tt,0,!0))}(H,_,c,e,r,R),{processBidirectionalText:Oe,processStyledBidirectionalText:be}=ze;if(Oe&&1===H.sections.length){const Pe=Oe(H.toString(),we);for(const at of Pe){const rt=new kl;rt.text=at,rt.sections=H.sections;for(let yt=0;yt<at.length;yt++)rt.sectionIndex.push(0);Q.push(rt)}}else if(be){const Pe=be(H.text,H.sectionIndex,we);for(const at of Pe){const rt=new kl;rt.text=at[0],rt.sectionIndex=at[1],rt.sections=H.sections,Q.push(rt)}}else Q=function(Pe,at){const rt=[],yt=Pe.text;let Ot=0;for(const ht of at)rt.push(Pe.substring(Ot,ht)),Ot=ht;return Ot<yt.length&&rt.push(Pe.substring(Ot,yt.length)),rt}(H,we);const ke=[],Ue={positionedLines:ke,text:H.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,at,rt,yt,Ot,ht,Tt,Ct,Dt,Ft,dt,ii){let zi=0,ai=0,_i=0;const ri="right"===Ct?1:"left"===Ct?0:.5;let Oi=!1;for(const un of Ot){const pn=un.getSections();for(const On of pn){if(On.imageName)continue;const Yn=at[On.fontStack];if(Yn&&(Oi=void 0!==Yn.ascender&&void 0!==Yn.descender,!Oi))break}if(!Oi)break}let en=0;for(const un of Ot){un.trim();const pn=un.getMaxScale(),On=24*(pn-1),Yn={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[en]=Yn;const Zn=Yn.positionedGlyphs;let Kn=0;if(!un.length()){ai+=ht,++en;continue}let tr=0,ur=0;for(let In=0;In<un.length();In++){const Er=un.getSection(In),gr=un.getSectionIndex(In),Tn=un.getCharCode(In);let rr=Er.scale,kr=null,Rn=null,dr=null,oo=24,Fr=0;const Nr=!(Dt===qo.horizontal||!dt&&!f(Tn)||dt&&(Iu[Tn]||(sn=Tn,Yc(sn)||Na(sn)||Kc(sn)||ec(sn)||l(sn))));if(Er.imageName){const go=yt[Er.imageName];if(!go)continue;dr=Er.imageName,Pe.iconsInText=Pe.iconsInText||!0,Rn=go.paddedRect;const Ur=go.displaySize;rr=24*rr/ii,kr={width:Ur[0],height:Ur[1],left:1,top:-3,advance:Nr?Ur[1]:Ur[0],localGlyph:!1},Fr=Oi?-kr.height*rr:24*pn-17-Ur[1]*rr,oo=kr.advance;const na=(Nr?Ur[0]:Ur[1])*rr-24*pn;na>0&&na>Kn&&(Kn=na)}else{const go=rt[Er.fontStack];if(!go)continue;go[Tn]&&(Rn=go[Tn]);const Ur=at[Er.fontStack];if(!Ur)continue;const na=Ur.glyphs[Tn];if(!na)continue;if(kr=na.metrics,oo=8203!==Tn?24:0,Oi){const Fl=void 0!==Ur.ascender?Math.abs(Ur.ascender):0,Lc=void 0!==Ur.descender?Math.abs(Ur.descender):0,zc=(Fl+Lc)*rr;tr<zc&&(tr=zc,ur=(Fl-Lc)/2*rr),Fr=-Fl*rr}else Fr=24*(pn-rr)-17}Nr?(Pe.verticalizable=!0,Zn.push({glyph:Tn,imageName:dr,x:zi,y:ai+Fr,vertical:Nr,scale:rr,localGlyph:kr.localGlyph,fontStack:Er.fontStack,sectionIndex:gr,metrics:kr,rect:Rn}),zi+=oo*rr+Ft):(Zn.push({glyph:Tn,imageName:dr,x:zi,y:ai+Fr,vertical:Nr,scale:rr,localGlyph:kr.localGlyph,fontStack:Er.fontStack,sectionIndex:gr,metrics:kr,rect:Rn}),zi+=kr.advance*rr+Ft)}0!==Zn.length&&(_i=Math.max(zi-Ft,_i),Oi?Ip(Zn,ri,Kn,ur,ht*pn/2):Ip(Zn,ri,Kn,0,ht/2)),zi=0;const Br=ht*pn+Kn;Yn.lineOffset=Math.max(Kn,On),ai+=Br,++en}var sn;const _n=ai,{horizontalAlign:Ki,verticalAlign:er}=Ah(Tt);(function(un,pn,On,Yn,Zn,Kn){const tr=(pn-On)*Zn,ur=-Kn*Yn;for(const Br of un)for(const In of Br.positionedGlyphs)In.x+=tr,In.y+=ur})(Pe.positionedLines,ri,Ki,er,_i,_n),Pe.top+=-er*_n,Pe.bottom=Pe.top+_n,Pe.left+=-Ki*_i,Pe.right=Pe.left+_i,Pe.hasBaseline=Oi}(Ue,e,i,r,Q,h,p,g,S,_,A,F),!function(Pe){for(const at of Pe)if(0!==at.positionedGlyphs.length)return!1;return!0}(ke)&&Ue}const Iu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_g={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ap(t,e,i,r,a,c){if(e.imageName){const h=r[e.imageName];return h?h.displaySize[0]*e.scale*24/c+a:0}{const h=i[e.fontStack],p=h&&h.glyphs[t];return p?p.metrics.advance*e.scale+a:0}}function Cp(t,e,i,r){const a=Math.pow(t-e,2);return r?t<e?a/2:2*a:a+Math.abs(i)*i}function yg(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Mp(t,e,i,r,a,c){let h=null,p=Cp(e,i,a,c);for(const g of r){const _=Cp(e-g.x,i,a,c)+g.badness;_<=p&&(h=g,p=_)}return{index:t,x:e,priorBreak:h,badness:p}}function kp(t){return t?kp(t.priorBreak).concat(t.index):[]}function Ah(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Ip(t,e,i,r,a){if(!(e||i||r||a))return;const c=t.length-1,h=t[c],p=(h.x+h.metrics.advance*h.scale)*e;for(let g=0;g<=c;g++)t[g].x-=p,t[g].y+=i+r+a}function vg(t,e,i){const{horizontalAlign:r,verticalAlign:a}=Ah(i),c=e[0]-t.displaySize[0]*r,h=e[1]-t.displaySize[1]*a;return{image:t,top:h,bottom:h+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function Dp(t,e,i,r,a,c){const h=t.image;let p;if(h.content){const Q=h.content,we=h.pixelRatio||1;p=[Q[0]/we,Q[1]/we,h.displaySize[0]-Q[2]/we,h.displaySize[1]-Q[3]/we]}const g=e.left*c,_=e.right*c;let w,S,A,R;"width"===i||"both"===i?(R=a[0]+g-r[3],S=a[0]+_+r[1]):(R=a[0]+(g+_-h.displaySize[0])/2,S=R+h.displaySize[0]);const F=e.top*c,H=e.bottom*c;return"height"===i||"both"===i?(w=a[1]+F-r[0],A=a[1]+H+r[2]):(w=a[1]+(F+H-h.displaySize[1])/2,A=w+h.displaySize[1]),{image:h,top:w,right:S,bottom:A,left:R,collisionPadding:p}}class ta extends ne{constructor(e,i,r,a,c){super(e,i),this.angle=a,this.z=r,void 0!==c&&(this.segment=c)}clone(){return new ta(this.x,this.y,this.z,this.angle,this.segment)}}function Pp(t,e,i,r,a){if(void 0===e.segment)return!0;let c=e,h=e.segment+1,p=0;for(;p>-i/2;){if(h--,h<0)return!1;p-=t[h].dist(c),c=t[h]}p+=t[h].dist(t[h+1]),h++;const g=[];let _=0;for(;p<i/2;){const w=t[h],S=t[h+1];if(!S)return!1;let A=t[h-1].angleTo(w)-w.angleTo(S);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:p,angleDelta:A}),_+=A;p-g[0].distance>r;)_-=g.shift().angleDelta;if(_>a)return!1;h++,p+=w.dist(S)}return!0}function Lp(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function zp(t,e,i){return t?.6*e*i:0}function Op(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function xg(t,e,i,r,a,c){const h=zp(i,a,c),p=Op(i,r)*c;let g=0;const _=Lp(t)/2;for(let w=0;w<t.length-1;w++){const S=t[w],A=t[w+1],R=S.dist(A);if(g+R>_){const F=(_-g)/R,H=on(S.x,A.x,F),Q=on(S.y,A.y,F),we=new ta(H,Q,0,A.angleTo(S),w);return!h||Pp(t,we,p,h,e)?we:void 0}g+=R}}function bg(t,e,i,r,a,c,h,p,g){const _=zp(r,c,h),w=Op(r,a),S=w*h,A=0===t[0].x||t[0].x===g||0===t[0].y||t[0].y===g;return e-S<e/4&&(e=S+e/4),Rp(t,A?e/2*p%e:(w/2+2*c)*h*p%e,e,_,i,S,A,!1,g)}function Rp(t,e,i,r,a,c,h,p,g){const _=c/2,w=Lp(t);let S=0,A=e-i,R=[];for(let F=0;F<t.length-1;F++){const H=t[F],Q=t[F+1],we=H.dist(Q),Oe=Q.angleTo(H);for(;A+i<S+we;){A+=i;const be=(A-S)/we,ke=on(H.x,Q.x,be),Ue=on(H.y,Q.y,be);if(ke>=0&&ke<g&&Ue>=0&&Ue<g&&A-_>=0&&A+_<=w){const Pe=new ta(ke,Ue,0,Oe,F);Pe._round(),r&&!Pp(t,Pe,c,r,a)||R.push(Pe)}}S+=we}return p||R.length||h||(R=Rp(t,S/2,i,r,a,c,h,!0,g)),R}function Bp(t,e,i,r,a){const c=[];for(let h=0;h<t.length;h++){const p=t[h];let g;for(let _=0;_<p.length-1;_++){let w=p[_],S=p[_+1];w.x<e&&S.x<e||(w.x<e?w=new ne(e,w.y+(e-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x<e&&(S=new ne(e,w.y+(e-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y<i&&S.y<i||(w.y<i?w=new ne(w.x+(i-w.y)/(S.y-w.y)*(S.x-w.x),i)._round():S.y<i&&(S=new ne(w.x+(i-w.y)/(S.y-w.y)*(S.x-w.x),i)._round()),w.x>=r&&S.x>=r||(w.x>=r?w=new ne(r,w.y+(r-w.x)/(S.x-w.x)*(S.y-w.y))._round():S.x>=r&&(S=new ne(r,w.y+(r-w.x)/(S.x-w.x)*(S.y-w.y))._round()),w.y>=a&&S.y>=a||(w.y>=a?w=new ne(w.x+(a-w.y)/(S.y-w.y)*(S.x-w.x),a)._round():S.y>=a&&(S=new ne(w.x+(a-w.y)/(S.y-w.y)*(S.x-w.x),a)._round()),g&&w.equals(g[g.length-1])||(g=[w],c.push(g)),g.push(S)))))}}return c}hi(ta,"Anchor");const wc=1e20;function Fp(t,e,i,r,a,c,h,p,g){for(let _=e;_<e+r;_++)Np(t,i*c+_,c,a,h,p,g);for(let _=i;_<i+a;_++)Np(t,_*c+e,1,r,h,p,g)}function Np(t,e,i,r,a,c,h){c[0]=0,h[0]=-wc,h[1]=wc,a[0]=t[e];for(let p=1,g=0,_=0;p<r;p++){a[p]=t[e+p*i];const w=p*p;do{const S=c[g];_=(a[p]-a[S]+w-S*S)/(p-S)/2}while(_<=h[g]&&--g>-1);g++,c[g]=p,h[g]=_,h[g+1]=wc}for(let p=0,g=0;p<r;p++){for(;h[g+1]<p;)g++;const _=c[g],w=p-_;t[e+p*i]=a[_]+w*w}}const Ch={none:0,ideographs:1,all:2};class Il{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const r=[];for(const a in e)for(const c of e[a])r.push({stack:a,id:c});mi(r,({stack:a,id:c},h)=>{let p=this.entries[a];p||(p=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let g=p.glyphs[c];if(void 0!==g)return void h(null,{stack:a,id:c,glyph:g});if(g=this._tinySDF(p,a,c),g)return p.glyphs[c]=g,void h(null,{stack:a,id:c,glyph:g});const _=Math.floor(c/256);if(256*_>65535)return void h(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void h(null,{stack:a,id:c,glyph:g});let w=p.requests[_];w||(w=p.requests[_]=[],Il.loadGlyphRange(a,_,this.url,this.requestManager,(S,A)=>{if(A){p.ascender=A.ascender,p.descender=A.descender;for(const R in A.glyphs)this._doesCharSupportLocalGlyph(+R)||(p.glyphs[+R]=A.glyphs[+R]);p.ranges[_]=!0}for(const R of w)R(S,A);delete p.requests[_]})),w.push((S,A)=>{S?h(S):A&&h(null,{stack:a,id:c,glyph:A.glyphs[c]||null})})},(a,c)=>{if(a)i(a);else if(c){const h={};for(const{stack:p,id:g,glyph:_}of c)void 0===h[p]&&(h[p]={}),void 0===h[p].glyphs&&(h[p].glyphs={}),h[p].glyphs[g]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},h[p].ascender=this.entries[p].ascender,h[p].descender=this.entries[p].descender;i(null,h)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ch.none&&(this.localGlyphMode===Ch.all?!!this.localFontFamily:!!this.localFontFamily&&(Ql(e)||ru(e)||dl(e)||ja(e)||Ua(e)))}_tinySDF(e,i,r){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(r))return;let c=e.tinySDF;if(!c){let H="400";/bold/i.test(i)?H="900":/medium/i.test(i)?H="500":/light/i.test(i)&&(H="200"),c=e.tinySDF=new Il.TinySDF({fontFamily:a,fontWeight:H,fontSize:48,buffer:6,radius:16}),c.fontWeight=H}if(this.localGlyphs[c.fontWeight][r])return this.localGlyphs[c.fontWeight][r];const h=String.fromCharCode(r),{data:p,width:g,height:_,glyphWidth:w,glyphHeight:S,glyphLeft:A,glyphTop:R,glyphAdvance:F}=c.draw(h);return this.localGlyphs[c.fontWeight][r]={id:r,bitmap:new Qs({width:g,height:_},p),metrics:{width:w/2,height:S/2,left:A/2,top:R/2-27,advance:F/2,localGlyph:!0}}}}function Up(t,e,i,r){const a=[],c=t.image,h=c.pixelRatio,p=c.paddedRect.w-2,g=c.paddedRect.h-2,_=t.right-t.left,w=t.bottom-t.top,S=c.stretchX||[[0,p]],A=c.stretchY||[[0,g]],R=(ht,Tt)=>ht+Tt[1]-Tt[0],F=S.reduce(R,0),H=A.reduce(R,0),Q=p-F,we=g-H;let Oe=0,be=F,ke=0,Ue=H,Pe=0,at=Q,rt=0,yt=we;if(c.content&&r){const ht=c.content;Oe=Du(S,0,ht[0]),ke=Du(A,0,ht[1]),be=Du(S,ht[0],ht[2]),Ue=Du(A,ht[1],ht[3]),Pe=ht[0]-Oe,rt=ht[1]-ke,at=ht[2]-ht[0]-be,yt=ht[3]-ht[1]-Ue}const Ot=(ht,Tt,Ct,Dt)=>{const Ft=Pu(ht.stretch-Oe,be,_,t.left),dt=Lu(ht.fixed-Pe,at,ht.stretch,F),ii=Pu(Tt.stretch-ke,Ue,w,t.top),zi=Lu(Tt.fixed-rt,yt,Tt.stretch,H),ai=Pu(Ct.stretch-Oe,be,_,t.left),_i=Lu(Ct.fixed-Pe,at,Ct.stretch,F),ri=Pu(Dt.stretch-ke,Ue,w,t.top),Oi=Lu(Dt.fixed-rt,yt,Dt.stretch,H),en=new ne(Ft,ii),sn=new ne(ai,ii),_n=new ne(ai,ri),Ki=new ne(Ft,ri),er=new ne(dt/h,zi/h),un=new ne(_i/h,Oi/h),pn=e*Math.PI/180;if(pn){const Zn=Math.sin(pn),Kn=Math.cos(pn),tr=[Kn,-Zn,Zn,Kn];en._matMult(tr),sn._matMult(tr),Ki._matMult(tr),_n._matMult(tr)}const On=ht.stretch+ht.fixed,Yn=Tt.stretch+Tt.fixed;return{tl:en,tr:sn,bl:Ki,br:_n,tex:{x:c.paddedRect.x+1+On,y:c.paddedRect.y+1+Yn,w:Ct.stretch+Ct.fixed-On,h:Dt.stretch+Dt.fixed-Yn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:er,pixelOffsetBR:un,minFontScaleX:at/h/_,minFontScaleY:yt/h/w,isSDF:i}};if(r&&(c.stretchX||c.stretchY)){const ht=jp(S,Q,F),Tt=jp(A,we,H);for(let Ct=0;Ct<ht.length-1;Ct++){const Dt=ht[Ct],Ft=ht[Ct+1];for(let dt=0;dt<Tt.length-1;dt++)a.push(Ot(Dt,Tt[dt],Ft,Tt[dt+1]))}}else a.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:g+1}));return a}function Du(t,e,i){let r=0;for(const a of t)r+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return r}function jp(t,e,i){const r=[{fixed:-1,stretch:0}];for(const[a,c]of t){const h=r[r.length-1];r.push({fixed:a-h.stretch,stretch:h.stretch}),r.push({fixed:a-h.stretch,stretch:h.stretch+(c-a)})}return r.push({fixed:e+1,stretch:i}),r}function Pu(t,e,i,r){return t/e*i+r}function Lu(t,e,i,r){return t-e*i/r}function wg(t,e,i,r){const a=e+t.positionedLines[r].lineOffset;return 0===r?i+a/2:i+(a+(e+t.positionedLines[r-1].lineOffset))/2}Il.loadGlyphRange=function(t,e,i,r,a){const c=256*e,h=c+255,p=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${c}-${h}`),Ce.Glyphs);Xt(p,(g,_)=>{if(g)a(g);else if(_){const w={},S=new xc(_).readFields(fg,{});for(const A of S.glyphs)w[A.id]=A;a(null,{glyphs:w,ascender:S.ascender,descender:S.descender})}})},Il.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const p=this.size=t+4*e,g=this._createCanvas(p),_=this.ctx=g.getContext("2d",{willReadFrequently:!0});_.font=`${h} ${c} ${t}px ${a}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(t),h=Math.ceil(i),p=Math.min(this.size-this.buffer,Math.ceil(c-a)),g=Math.min(this.size-this.buffer,h+Math.ceil(r)),_=p+2*this.buffer,w=g+2*this.buffer,S=Math.max(_*w,0),A=new Uint8ClampedArray(S),R={data:A,width:_,height:w,glyphWidth:p,glyphHeight:g,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(0===p||0===g)return R;const{ctx:F,buffer:H,gridInner:Q,gridOuter:we}=this;F.clearRect(H,H,p,g),F.fillText(t,H,H+h);const Oe=F.getImageData(H,H,p,g);we.fill(wc,0,S),Q.fill(0,0,S);for(let be=0;be<g;be++)for(let ke=0;ke<p;ke++){const Ue=Oe.data[4*(be*p+ke)+3]/255;if(0===Ue)continue;const Pe=(be+H)*_+ke+H;if(1===Ue)we[Pe]=0,Q[Pe]=wc;else{const at=.5-Ue;we[Pe]=at>0?at*at:0,Q[Pe]=at<0?at*at:0}}Fp(we,0,0,_,w,_,this.f,this.v,this.z),Fp(Q,H,H,p,g,_,this.f,this.v,this.z);for(let be=0;be<S;be++){const ke=Math.sqrt(we[be])-Math.sqrt(Q[be]);A[be]=Math.round(255-255*(ke/this.radius+this.cutoff))}return R}};class Tg{constructor(e=[],i=Eg){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,a=i[e];for(;e>0;){const c=e-1>>1,h=i[c];if(r(a,h)>=0)break;i[e]=h,e=c}i[e]=a}_down(e){const{data:i,compare:r}=this,a=this.length>>1,c=i[e];for(;e<a;){let h=1+(e<<1),p=i[h];const g=h+1;if(g<this.length&&r(i[g],p)<0&&(h=g,p=i[g]),r(p,c)>=0)break;i[e]=p,e=h}i[e]=c}}function Eg(t,e){return t<e?-1:t>e?1:0}function Sg(t,e=1,i=!1){let r=1/0,a=1/0,c=-1/0,h=-1/0;const p=t[0];for(let R=0;R<p.length;R++){const F=p[R];(!R||F.x<r)&&(r=F.x),(!R||F.y<a)&&(a=F.y),(!R||F.x>c)&&(c=F.x),(!R||F.y>h)&&(h=F.y)}const g=Math.min(c-r,h-a);let _=g/2;const w=new Tg([],Ag);if(0===g)return new ne(r,a);for(let R=r;R<c;R+=g)for(let F=a;F<h;F+=g)w.push(new Dl(R+_,F+_,_,t));let S=function(R){let F=0,H=0,Q=0;const we=R[0];for(let Oe=0,be=we.length,ke=be-1;Oe<be;ke=Oe++){const Ue=we[Oe],Pe=we[ke],at=Ue.x*Pe.y-Pe.x*Ue.y;H+=(Ue.x+Pe.x)*at,Q+=(Ue.y+Pe.y)*at,F+=3*at}return new Dl(H/F,Q/F,0,R)}(t),A=w.length;for(;w.length;){const R=w.pop();(R.d>S.d||!S.d)&&(S=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-S.d<=e||(_=R.h/2,w.push(new Dl(R.p.x-_,R.p.y-_,_,t)),w.push(new Dl(R.p.x+_,R.p.y-_,_,t)),w.push(new Dl(R.p.x-_,R.p.y+_,_,t)),w.push(new Dl(R.p.x+_,R.p.y+_,_,t)),A+=4)}return i&&(console.log(`num probes: ${A}`),console.log(`best distance: ${S.d}`)),S.p}function Ag(t,e){return e.max-t.max}function Dl(t,e,i,r){this.p=new ne(t,e),this.h=i,this.d=function(a,c){let h=!1,p=1/0;for(let g=0;g<c.length;g++){const _=c[g];for(let w=0,S=_.length,A=S-1;w<S;A=w++){const R=_[w],F=_[A];R.y>a.y!=F.y>a.y&&a.x<(F.x-R.x)*(a.y-R.y)/(F.y-R.y)+R.x&&(h=!h),p=Math.min(p,Ad(a,R,F))}}return(h?1:-1)*Math.sqrt(p)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const Mh=Number.POSITIVE_INFINITY,Cg=Math.sqrt(2);function Vp(t,e){return e[1]!==Mh?function(i,r,a){let c=0,h=0;switch(r=Math.abs(r),a=Math.abs(a),i){case"top-right":case"top-left":case"top":h=a-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-a}switch(i){case"top-right":case"bottom-right":case"right":c=-r;break;case"top-left":case"bottom-left":case"left":c=r}return[c,h]}(t,e[0],e[1]):function(i,r){let a=0,c=0;r<0&&(r=0);const h=r/Cg;switch(i){case"top-right":case"top-left":c=h-7;break;case"bottom-right":case"bottom-left":c=7-h;break;case"bottom":c=7-r;break;case"top":c=r-7}switch(i){case"top-right":case"bottom-right":a=-h;break;case"top-left":case"bottom-left":a=h;break;case"left":a=r;break;case"right":a=-r}return[a,c]}(t,e[0])}function Mg(t,e,i,r,a,c,h,p,g,_){t.createArrays(),t.tilePixelRatio=$i/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const w=t.layers[0].layout,S=t.layers[0]._unevaluatedLayout._values,A={};if("composite"===t.textSizeData.kind){const{minZoom:H,maxZoom:Q}=t.textSizeData;A.compositeTextSizes=[S["text-size"].possiblyEvaluate(new Te(H),p),S["text-size"].possiblyEvaluate(new Te(Q),p)]}if("composite"===t.iconSizeData.kind){const{minZoom:H,maxZoom:Q}=t.iconSizeData;A.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new Te(H),p),S["icon-size"].possiblyEvaluate(new Te(Q),p)]}A.layoutTextSize=S["text-size"].possiblyEvaluate(new Te(g+1),p),A.layoutIconSize=S["icon-size"].possiblyEvaluate(new Te(g+1),p),A.textMaxSize=S["text-size"].possiblyEvaluate(new Te(18),p);const R="map"===w.get("text-rotation-alignment")&&"point"!==w.get("symbol-placement"),F=w.get("text-size");for(const H of t.features){const Q=w.get("text-font").evaluate(H,{},p).join(","),we=F.evaluate(H,{},p),Oe=A.layoutTextSize.evaluate(H,{},p),be=(A.layoutIconSize.evaluate(H,{},p),{horizontal:{},vertical:void 0}),ke=H.text;let Ue,Pe=[0,0];if(ke){const yt=ke.toString(),Ot=24*w.get("text-letter-spacing").evaluate(H,{},p),ht=24*w.get("text-line-height").evaluate(H,{},p),Tt=u(yt)?Ot:0,Ct=w.get("text-anchor").evaluate(H,{},p),Dt=w.get("text-variable-anchor");if(!Dt){const ai=w.get("text-radial-offset").evaluate(H,{},p);Pe=ai?Vp(Ct,[24*ai,Mh]):w.get("text-offset").evaluate(H,{},p).map(_i=>24*_i)}let Ft=R?"center":w.get("text-justify").evaluate(H,{},p);const dt="point"===w.get("symbol-placement"),ii=dt?24*w.get("text-max-width").evaluate(H,{},p):1/0,zi=ai=>{t.allowVerticalPlacement&&s(yt)&&(be.vertical=Sh(ke,e,i,a,Q,ii,ht,Ct,ai,Tt,Pe,qo.vertical,!0,Oe,we))};if(!R&&Dt){const ai="auto"===Ft?Dt.map(ri=>kh(ri)):[Ft];let _i=!1;for(let ri=0;ri<ai.length;ri++){const Oi=ai[ri];if(!be.horizontal[Oi])if(_i)be.horizontal[Oi]=be.horizontal[0];else{const en=Sh(ke,e,i,a,Q,ii,ht,"center",Oi,Tt,Pe,qo.horizontal,!1,Oe,we);en&&(be.horizontal[Oi]=en,_i=1===en.positionedLines.length)}}zi("left")}else{if("auto"===Ft&&(Ft=kh(Ct)),dt||w.get("text-writing-mode").indexOf("horizontal")>=0||!s(yt)){const ai=Sh(ke,e,i,a,Q,ii,ht,Ct,Ft,Tt,Pe,qo.horizontal,!1,Oe,we);ai&&(be.horizontal[Ft]=ai)}zi(dt?"left":Ft)}}let at=!1;if(H.icon&&H.icon.name){const yt=r[H.icon.name];yt&&(Ue=vg(a[H.icon.name],w.get("icon-offset").evaluate(H,{},p),w.get("icon-anchor").evaluate(H,{},p)),at=yt.sdf,void 0===t.sdfIcons?t.sdfIcons=yt.sdf:t.sdfIcons!==yt.sdf&&Ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==t.pixelRatio||0!==w.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const rt=Gp(be.horizontal)||be.vertical;t.iconsInText||(t.iconsInText=!!rt&&rt.iconsInText),(rt||Ue)&&kg(t,H,be,Ue,r,A,Oe,0,Pe,at,h,p,_)}c&&t.generateCollisionDebugBuffers(g,t.collisionBoxArray)}function kh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kg(t,e,i,r,a,c,h,p,g,_,w,S,A){let R=c.textMaxSize.evaluate(e,{},S);void 0===R&&(R=h);const F=t.layers[0].layout,H=F.get("icon-offset").evaluate(e,{},S),Q=Gp(i.horizontal)||i.vertical,we="globe"===A.name,Oe=h/24,be=t.tilePixelRatio*R/24,ke=(Tt=t.overscaling,t.zoom>18&&Tt>2&&(Tt>>=1),Math.max($i/(512*Tt),1)*F.get("symbol-spacing")),Ue=F.get("text-padding")*t.tilePixelRatio,Pe=F.get("icon-padding")*t.tilePixelRatio,at=xt(F.get("text-max-angle")),rt="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),yt="map"===F.get("icon-rotation-alignment")&&"point"!==F.get("symbol-placement"),Ot=F.get("symbol-placement"),ht=ke/2;var Tt;const Ct=F.get("icon-text-fit");let Dt;r&&"none"!==Ct&&(t.allowVerticalPlacement&&i.vertical&&(Dt=Dp(r,i.vertical,Ct,F.get("icon-text-fit-padding"),H,Oe)),Q&&(r=Dp(r,Q,Ct,F.get("icon-text-fit-padding"),H,Oe)));const Ft=(dt,ii,zi)=>{if(ii.x<0||ii.x>=$i||ii.y<0||ii.y>=$i)return;let ai=null;if(we){const{x:_i,y:ri,z:Oi}=A.projectTilePoint(ii.x,ii.y,zi);ai={anchor:new ta(_i,ri,Oi,0,void 0),up:A.upVector(zi,ii.x,ii.y)}}!function(_i,ri,Oi,en,sn,_n,Ki,er,un,pn,On,Yn,Zn,Kn,tr,ur,Br,In,Er,gr,Tn,rr,kr,Rn,dr){const oo=_i.addToLineVertexArray(ri,en);let Fr,Nr,go,Ur,na,Fl,Lc,zc=0,kf=0,If=0,Df=0,qh=-1,Zh=-1;const Us={};let Pf=_l.exports("");const Ja=Oi?Oi.anchor:ri;let Hh=0,Wh=0;if(void 0===un._unevaluatedLayout.getValue("text-radial-offset")?[Hh,Wh]=un.layout.get("text-offset").evaluate(Tn,{},dr).map(Lo=>24*Lo):(Hh=24*un.layout.get("text-radial-offset").evaluate(Tn,{},dr),Wh=Mh),_i.allowVerticalPlacement&&sn.vertical){const Lo=sn.vertical;if(tr)Fl=Ih(Lo),er&&(Lc=Ih(er));else{const zo=un.layout.get("text-rotate").evaluate(Tn,{},dr)+90;go=zu(pn,Ja,ri,On,Yn,Zn,Lo,Kn,zo,ur),er&&(Ur=zu(pn,Ja,ri,On,Yn,Zn,er,In,zo))}}if(_n){const Lo=un.layout.get("icon-rotate").evaluate(Tn,{},dr),zo="none"!==un.layout.get("icon-text-fit"),Oc=Up(_n,Lo,kr,zo),Yh=er?Up(er,Lo,kr,zo):void 0;Nr=zu(pn,Ja,ri,On,Yn,Zn,_n,In,Lo),zc=4*Oc.length;const Lf=_i.iconSizeData;let Qa=null;"source"===Lf.kind?(Qa=[Os*un.layout.get("icon-size").evaluate(Tn,{},dr)],Qa[0]>ba&&Ji(`${_i.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Lf.kind&&(Qa=[Os*rr.compositeIconSizes[0].evaluate(Tn,{},dr),Os*rr.compositeIconSizes[1].evaluate(Tn,{},dr)],(Qa[0]>ba||Qa[1]>ba)&&Ji(`${_i.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),_i.addSymbols(_i.icon,Oc,Qa,gr,Er,Tn,!1,Oi,ri,oo.lineStartIndex,oo.lineLength,-1,Rn,dr),qh=_i.icon.placedSymbolArray.length-1,Yh&&(kf=4*Yh.length,_i.addSymbols(_i.icon,Yh,Qa,gr,Er,Tn,qo.vertical,Oi,ri,oo.lineStartIndex,oo.lineLength,-1,Rn,dr),Zh=_i.icon.placedSymbolArray.length-1)}for(const Lo in sn.horizontal){const zo=sn.horizontal[Lo];Fr||(Pf=_l.exports(zo.text),tr?na=Ih(zo):Fr=zu(pn,Ja,ri,On,Yn,Zn,zo,Kn,un.layout.get("text-rotate").evaluate(Tn,{},dr),ur));const Oc=1===zo.positionedLines.length;if(If+=$p(_i,Oi,ri,zo,Ki,un,tr,Tn,ur,oo,sn.vertical?qo.horizontal:qo.horizontalOnly,Oc?Object.keys(sn.horizontal):[Lo],Us,qh,rr,Rn,dr),Oc)break}sn.vertical&&(Df+=$p(_i,Oi,ri,sn.vertical,Ki,un,tr,Tn,ur,oo,qo.vertical,["vertical"],Us,Zh,rr,Rn,dr));let Ca=-1;const Xh=(Lo,zo)=>Lo?Math.max(Lo,zo):zo;Ca=Xh(na,Ca),Ca=Xh(Fl,Ca),Ca=Xh(Lc,Ca);const a_=Ca>-1?1:0;_i.glyphOffsetArray.length>=Ta.MAX_GLYPHS&&Ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Tn.sortKey&&_i.addToSortKeyRanges(_i.symbolInstances.length,Tn.sortKey),_i.symbolInstances.emplaceBack(Ja.x,Ja.y,Ja.z,ri.x,ri.y,Us.right>=0?Us.right:-1,Us.center>=0?Us.center:-1,Us.left>=0?Us.left:-1,Us.vertical>=0?Us.vertical:-1,qh,Zh,Pf,void 0!==Fr?Fr:_i.collisionBoxArray.length,void 0!==Fr?Fr+1:_i.collisionBoxArray.length,void 0!==go?go:_i.collisionBoxArray.length,void 0!==go?go+1:_i.collisionBoxArray.length,void 0!==Nr?Nr:_i.collisionBoxArray.length,void 0!==Nr?Nr+1:_i.collisionBoxArray.length,Ur||_i.collisionBoxArray.length,Ur?Ur+1:_i.collisionBoxArray.length,On,If,Df,zc,kf,a_,0,Hh,Wh,Ca)}(t,ii,ai,dt,i,r,a,Dt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Ue,rt,g,0,Pe,yt,H,e,c,_,w,S)};if("line"===Ot)for(const dt of Bp(e.geometry,0,0,$i,$i)){const ii=bg(dt,ke,at,i.vertical||Q,r,24,be,t.overscaling,$i);for(const zi of ii){const ai=Q;ai&&Ig(t,ai.text,ht,zi)||Ft(dt,zi,S)}}else if("line-center"===Ot){for(const dt of e.geometry)if(dt.length>1){const ii=xg(dt,at,i.vertical||Q,r,24,be);ii&&Ft(dt,ii,S)}}else if("Polygon"===e.type)for(const dt of _h(e.geometry,0)){const ii=Sg(dt,16);Ft(dt[0],new ta(ii.x,ii.y,0,0,void 0),S)}else if("LineString"===e.type)for(const dt of e.geometry)Ft(dt,new ta(dt[0].x,dt[0].y,0,0,void 0),S);else if("Point"===e.type)for(const dt of e.geometry)for(const ii of dt)Ft([ii],new ta(ii.x,ii.y,0,0,void 0),S)}const ba=32640;function $p(t,e,i,r,a,c,h,p,g,_,w,S,A,R,F,H,Q){const we=function(ke,Ue,Pe,at,rt,yt,Ot,ht){const Tt=[];if(0===Ue.positionedLines.length)return Tt;const Ct=at.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,Dt=function(ai){const _i=ai[0],ri=ai[1],Oi=_i*ri;return Oi>0?[_i,-ri]:Oi<0?[-_i,ri]:0===_i?[ri,_i]:[ri,-_i]}(Pe);let Ft=Math.abs(Ue.top-Ue.bottom);for(const ai of Ue.positionedLines)Ft-=ai.lineOffset;const dt=Ue.positionedLines.length,ii=Ft/dt;let zi=Ue.top-Pe[1];for(let ai=0;ai<dt;++ai){const _i=Ue.positionedLines[ai];zi=wg(Ue,ii,zi,ai);for(const ri of _i.positionedGlyphs){if(!ri.rect)continue;const Oi=ri.rect||{};let en=4,sn=!0,_n=1,Ki=0;if(ri.imageName){const Rn=Ot[ri.imageName];if(!Rn)continue;if(Rn.sdf){Ji("SDF images are not supported in formatted text and will be ignored.");continue}sn=!1,_n=Rn.pixelRatio,en=1/_n}const er=(rt||ht)&&ri.vertical,un=ri.metrics.advance*ri.scale/2,pn=ri.metrics,On=ri.rect;if(null===On)continue;ht&&Ue.verticalizable&&(Ki=ri.imageName?un-ri.metrics.width*ri.scale/2:0);const Yn=rt?[ri.x+un,ri.y]:[0,0];let Zn=[0,0],Kn=[0,0],tr=!1;rt||(er?(Kn=[ri.x+un+Dt[0],ri.y+Dt[1]-Ki],tr=!0):Zn=[ri.x+un+Pe[0],ri.y+Pe[1]-Ki]);const ur=On.w*ri.scale/(_n*(ri.localGlyph?2:1)),Br=On.h*ri.scale/(_n*(ri.localGlyph?2:1));let In,Er,gr,Tn;if(er){const Rn=ri.y-zi,dr=new ne(-un,un-Rn),oo=-Math.PI/2,Fr=new ne(...Kn);In=new ne(-un+Zn[0],Zn[1]),In._rotateAround(oo,dr)._add(Fr),In.x+=-Rn+un,In.y-=(pn.left-en)*ri.scale;const Nr=ri.imageName?pn.advance*ri.scale:24*ri.scale,go=String.fromCharCode(ri.glyph);ng(go)?In.x+=(1-en)*ri.scale:rg(go)?In.x+=Nr-pn.height*ri.scale+(-en-1)*ri.scale:In.x+=ri.imageName||pn.width+2*en===On.w&&pn.height+2*en===On.h?(Nr-Br)/2:(Nr-(pn.height+2*en)*ri.scale)/2,Er=new ne(In.x,In.y-ur),gr=new ne(In.x+Br,In.y),Tn=new ne(In.x+Br,In.y-ur)}else{const Rn=(pn.left-en)*ri.scale-un+Zn[0],dr=(-pn.top-en)*ri.scale+Zn[1],oo=Rn+ur,Fr=dr+Br;In=new ne(Rn,dr),Er=new ne(oo,dr),gr=new ne(Rn,Fr),Tn=new ne(oo,Fr)}if(Ct){let Rn;Rn=rt?new ne(0,0):tr?new ne(Dt[0],Dt[1]):new ne(Pe[0],Pe[1]),In._rotateAround(Ct,Rn),Er._rotateAround(Ct,Rn),gr._rotateAround(Ct,Rn),Tn._rotateAround(Ct,Rn)}const rr=new ne(0,0),kr=new ne(0,0);Tt.push({tl:In,tr:Er,bl:gr,br:Tn,tex:Oi,writingMode:Ue.writingMode,glyphOffset:Yn,sectionIndex:ri.sectionIndex,isSDF:sn,pixelOffsetTL:rr,pixelOffsetBR:kr,minFontScaleX:0,minFontScaleY:0})}}return Tt}(0,r,g,c,h,p,a,t.allowVerticalPlacement),Oe=t.textSizeData;let be=null;"source"===Oe.kind?(be=[Os*c.layout.get("text-size").evaluate(p,{},Q)],be[0]>ba&&Ji(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Oe.kind&&(be=[Os*F.compositeTextSizes[0].evaluate(p,{},Q),Os*F.compositeTextSizes[1].evaluate(p,{},Q)],(be[0]>ba||be[1]>ba)&&Ji(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,we,be,g,h,p,w,e,i,_.lineStartIndex,_.lineLength,R,H,Q);for(const ke of S)A[ke]=t.text.placedSymbolArray.length-1;return 4*we.length}function Gp(t){for(const e in t)return t[e];return null}function zu(t,e,i,r,a,c,h,p,g,_){let w=h.top,S=h.bottom,A=h.left,R=h.right;const F=h.collisionPadding;if(F&&(A-=F[0],w-=F[1],R+=F[2],S+=F[3]),g){const H=new ne(A,w),Q=new ne(R,w),we=new ne(A,S),Oe=new ne(R,S),be=xt(g);let ke=new ne(0,0);_&&(ke=new ne(_[0],_[1])),H._rotateAround(be,ke),Q._rotateAround(be,ke),we._rotateAround(be,ke),Oe._rotateAround(be,ke),A=Math.min(H.x,Q.x,we.x,Oe.x),R=Math.max(H.x,Q.x,we.x,Oe.x),w=Math.min(H.y,Q.y,we.y,Oe.y),S=Math.max(H.y,Q.y,we.y,Oe.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,A,w,R,S,p,r,a,c),t.length-1}function Ih(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Ig(t,e,i,r){const a=t.compareText;if(e in a){const c=a[e];for(let h=c.length-1;h>=0;h--)if(r.dist(c[h])<i)return!0}else a[e]=[];return a[e].push(r),!1}const Dg=Ht([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:qp}=Dg,Zp=Ht([{name:"a_pos_3",components:3,type:"Int16"}]);var Tc=Ht([{name:"a_pos",type:"Int16",components:2}]);const ia=$i/Math.PI/2,Dh=2*ts(1,0)*ia*Math.PI,Ll=[64,32,16],gs=-ia,_s=ia,Pg=[new fo([gs,gs,gs],[_s,_s,_s]),new fo([gs,gs,gs],[0,0,_s]),new fo([0,gs,gs],[_s,0,_s]),new fo([gs,0,gs],[0,_s,_s]),new fo([0,0,gs],[_s,_s,_s])];function Hp(t,e,i,r=!0){const a=Go([],t._camera.position,t.worldSize),c=[e,i,1,1];Ha(c,c,t.pixelMatrixInverse),Fd(c,c,1/c[3]);const h=po([],ms([],c,a)),p=t.globeMatrix,g=[p[12],p[13],p[14]],_=ms([],g,a),w=rc(_),S=po([],_),A=t.worldSize/(2*Math.PI),R=is(S,h),F=Math.asin(A/w);if(F<Math.acos(R)){if(!r)return null;const Ot=[],ht=[];Go(Ot,h,w/R),po(ht,ms(ht,Ot,_)),po(h,Js(h,_,Go(h,ht,Math.tan(F)*w)))}const H=[];new ch(a,h).closestPointOnSphere(g,A,H);const Q=po([],oe(p,0)),we=po([],oe(p,1)),Oe=po([],oe(p,2)),be=is(Q,H),ke=is(we,H),Ue=is(Oe,H),Pe=Wt(Math.asin(-ke/A));let at=Wt(Math.atan2(be,Ue));at=t.center.lng+function(Ot,ht){const Tt=(ht-Ot+180)%360-180;return Tt<-180?Tt+360:Tt}(t.center.lng,at);const rt=Ds(at),yt=qt(Ps(Pe),0,1);return new vl(rt,yt)}class Lg{constructor(e,i,r){this.a=ms([],e,r),this.b=ms([],i,r),this.center=r;const a=po([],this.a),c=po([],this.b);this.angle=Math.acos(is(a,c))}}function Ph(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,a,c,h){const p=Math.sin(c);return r*(Math.sin((1-h)*c)/p)+a*(Math.sin(h*c)/p)}(t.a[e],t.b[e],t.angle,qt(i,0,1))+t.center[e]}function Rs(t){if(t.z<=1)return Pg[t.z+2*t.y+t.x];const e=Lh(Ou(t));return fo.fromPoints(e)}function Xa(t,e,i){return Go(t,t,1-i),ac(t,t,e,i)}function Wp(t,e){const i=Ol(e.zoom);if(0===i)return Rs(t);const r=Ou(t),a=Lh(r),c=Ds(r.getWest())*e.worldSize,h=Ds(r.getEast())*e.worldSize,p=Ps(r.getNorth())*e.worldSize,g=Ps(r.getSouth())*e.worldSize,_=[c,p,0],w=[h,p,0],S=[c,g,0],A=[h,g,0],R=rh([],e.globeMatrix);return Tr(_,_,R),Tr(w,w,R),Tr(S,S,R),Tr(A,A,R),a[0]=Xa(a[0],S,i),a[1]=Xa(a[1],A,i),a[2]=Xa(a[2],w,i),a[3]=Xa(a[3],_,i),fo.fromPoints(a)}function Xp(t,e,i){for(const r of t)Tr(r,r,e),Go(r,r,i)}function Ou({x:t,y:e,z:i}){const r=1/(1<<i),a=new Sn($o(t*r),Wr((e+1)*r)),c=new Sn($o((t+1)*r),Wr(e*r));return new xa(a,c)}function Lh(t){const e=xt(t.getNorth()),i=xt(t.getSouth()),r=Math.cos(e),a=Math.cos(i),c=Math.sin(e),h=Math.sin(i),p=t.getWest(),g=t.getEast();return[zl(a,h,p),zl(a,h,g),zl(r,c,g),zl(r,c,p)]}function zl(t,e,i,r=ia){return i=xt(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function Ec(t,e,i){return zl(Math.cos(xt(t)),Math.sin(xt(t)),e,i)}function Sc(t,e,i,r){const a=1<<i.z,c=(t/$i+i.x)/a;return Ec(Wr((e/$i+i.y)/a),$o(c),r)}function Ru({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Yp=new Float64Array(16);function Ac(t){const e=Ru(t),i=Ld(Yp,[e,e,e]);return nc(i,i,((r=[])[0]=-(a=t.min)[0],r[1]=-a[1],r[2]=-a[2],r));var r,a}function zh(t){const e=(r=t.min,(i=Yp)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const a=1/Ru(t);return Za(e,e,[a,a,a])}function Kp(t,e,i,r,a){const c=function(g){const _=$i/(2*Math.PI);return g/(2*Math.PI)/_}(i),h=[t,e,-i/(2*Math.PI)],p=zs(new Float64Array(16));return nc(p,p,h),Za(p,p,[c,c,c]),oh(p,p,xt(-a)),_u(p,p,xt(-r)),p}function Ol(t){return Ri(5,6,t)}function Jp(t,e){const i=Ec(e.lat,e.lng);return h=(a=ah([],function(F){const H=Ec(F._center.lat,F._center.lng);let Q=lh([],wl(0,1,0),H);const we=zd([],-F.angle,H);Q=Tr(Q,Q,we),zd(we,-F._pitch,Q);const Oe=po([],H);return Go(Oe,Oe,F.cameraToCenterDistance/F.pixelsPerMeter*Dh),Tr(Oe,Oe,we),Js([],H,Oe)}(t),i))[0],p=a[1],g=a[2],_=(c=i)[0],w=c[1],S=c[2],R=(A=Math.sqrt(h*h+p*p+g*g)*Math.sqrt(_*_+w*w+S*S))&&is(a,c)/A,Math.acos(Math.min(Math.max(R,-1),1));var a,c,h,p,g,_,w,S,A,R}const Qp=xt(85),Og=Math.cos(Qp),Rg=Math.sin(Qp);function ef(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),c=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),h=Math.sin(t._pitch)*c+a;return Math.min(1.01*h,a*(1/t._horizonShift))}function Ya(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,a=(t.x+1)*i,c=t.y*i,h=(t.y+1)*i,p=$o(r),g=$o(a),_=Wr(c),w=Wr(h),S=e.project(p,_),A=e.project(g,_),R=e.project(g,w),F=e.project(p,w);let H=Math.min(S.x,A.x,R.x,F.x),Q=Math.min(S.y,A.y,R.y,F.y),we=Math.max(S.x,A.x,R.x,F.x),Oe=Math.max(S.y,A.y,R.y,F.y);const be=i/16;function ke(Pe,at,rt,yt,Ot,ht){const Tt=(rt+Ot)/2,Ct=(yt+ht)/2,Dt=e.project($o(Tt),Wr(Ct)),Ft=Math.max(0,H-Dt.x,Q-Dt.y,Dt.x-we,Dt.y-Oe);H=Math.min(H,Dt.x),we=Math.max(we,Dt.x),Q=Math.min(Q,Dt.y),Oe=Math.max(Oe,Dt.y),Ft>be&&(ke(Pe,Dt,rt,yt,Tt,Ct),ke(Dt,at,Tt,Ct,Ot,ht))}ke(S,A,r,c,a,c),ke(A,R,a,c,a,h),ke(R,F,a,h,r,h),ke(F,S,r,h,r,c),H-=be,Q-=be,we+=be,Oe+=be;const Ue=1/Math.max(we-H,Oe-Q);return{scale:Ue,x:H*Ue,y:Q*Ue,x2:we*Ue,y2:Oe*Ue,projection:e}}const Bg=zs(new Float32Array(16));class wa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Sn(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return ts(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return ef(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,a){const c=e.horizonLineFromTop(!1),h=new ne(i,Math.max(c,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,i,r){const a=new ne(i,r);if(e.elevation)return e.elevation.pointCoordinate(a);{const c=this.pointCoordinate(e,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return Bg}createTileMatrix(e,i,r){let a,c,h;const p=r.canonical,g=zs(new Float64Array(16));if(this.isReprojectedInTileSpace){const _=Ya(p,this);a=1,c=_.x+r.wrap*_.scale,h=_.y,Za(g,g,[a/_.scale,a/_.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(p.z),c=(p.x+Math.pow(2,p.z)*r.wrap)*a,h=p.y*a;return nc(g,g,[c,h,0]),Za(g,g,[a/$i,a/$i,1]),g}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class Fg extends wa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(xt(i));this.n=(a+Math.sin(xt(r)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:a,r0:c}=this,h=xt(e-this.center[0]),p=xt(i),g=Math.sqrt(a-2*r*Math.sin(p))/r;return{x:g*Math.sin(h*r),y:g*Math.cos(h*r)-c,z:0}}unproject(e,i){const{n:r,c:a,r0:c}=this,h=c+i;let p=Math.atan2(e,Math.abs(h))*Math.sign(h);h*r<0&&(p-=Math.PI*Math.sign(e)*Math.sign(h));const g=xt(this.center[0])*r;p=Bi(p,-Math.PI-g,Math.PI-g);const _=qt(Wt(p/r)+this.center[0],-180,180),w=Math.asin(qt((a-(e*e+h*h)*r*r)/(2*r),-1,1)),S=qt(Wt(w),-85.051129,Ls);return new Sn(_,S)}}const Cc=1.340264,Mc=-.081106,kc=893e-6,Ic=.003796,Bu=Math.sqrt(3)/2;class Ng extends wa{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Bu*Math.sin(i)),a=r*r,c=a*a*a;return{x:.5*(e*Math.cos(r)/(Bu*(Cc+3*Mc*a+c*(7*kc+9*Ic*a)))/Math.PI+.5),y:1-.5*(r*(Cc+Mc*a+c*(kc+Ic*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,a=r*r,c=a*a*a;for(let w,S,A,R=0;R<12&&(S=r*(Cc+Mc*a+c*(kc+Ic*a))-i,A=Cc+3*Mc*a+c*(7*kc+9*Ic*a),w=S/A,r=qt(r-w,-Math.PI/3,Math.PI/3),a=r*r,c=a*a*a,!(Math.abs(w)<1e-12));++R);const h=Bu*e*(Cc+3*Mc*a+c*(7*kc+9*Ic*a))/Math.cos(r),p=Math.asin(Math.sin(r)/Bu),g=qt(180*h/Math.PI,-180,180),_=qt(180*p/Math.PI,-85.051129,Ls);return new Sn(g,_)}}class Ug extends wa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),a=qt(360*(.5-i),-85.051129,Ls);return new Sn(r,a)}}const Rl=Math.PI/2;function Fu(t){return Math.tan((Rl+t)/2)}class jg extends wa{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let a=xt(i),c=xt(r);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const h=Math.cos(a),p=Fu(a);this.n=a===c?Math.sin(a):Math.log(h/Math.cos(c))/Math.log(Fu(c)/p),this.f=h*Math.pow(Fu(a),this.n)/this.n}project(e,i){i=xt(i),this.southernCenter&&(i=-i),e=xt(e-this.center[0]);const r=1e-6,{n:a,f:c}=this;c>0?i<-Rl+r&&(i=-Rl+r):i>Rl-r&&(i=Rl-r);const h=c/Math.pow(Fu(i),a);let p=h*Math.sin(a*e),g=c-h*Math.cos(a*e);return p=.5*(p/Math.PI+.5),g=.5*(g/Math.PI+.5),{x:p,y:this.southernCenter?g:1-g,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:a}=this,c=a-i,h=Math.sign(c),p=Math.sign(r)*Math.sqrt(e*e+c*c);let g=Math.atan2(e,Math.abs(c))*h;c*r<0&&(g-=Math.PI*Math.sign(e)*h);const _=qt(Wt(g/r)+this.center[0],-180,180),w=qt(Wt(2*Math.atan(Math.pow(a/p,1/r))-Rl),-85.051129,Ls);return new Sn(_,this.southernCenter?-w:w)}}class tf extends wa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Ds(e),y:Ps(i),z:0}}unproject(e,i){const r=$o(e),a=Wr(i);return new Sn(r,a)}}const nf=xt(Ls);class Vg extends wa{project(e,i){const r=(i=xt(i))*i,a=r*r;return{x:.5*((e=xt(e))*(.8707-.131979*r+a*(a*(.003971*r-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+a*(.028874*r-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,a=25,c=0,h=r*r;do{h=r*r;const _=h*h;c=(r*(1.007226+h*(.015085+_*(.028874*h-.044475-.005916*_)))-i)/(1.007226+h*(.045255+_*(.259866*h-.311325-.005916*11*_))),r=qt(r-c,-nf,nf)}while(Math.abs(c)>1e-6&&--a>0);h=r*r;const p=qt(Wt(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),g=Wt(r);return new Sn(p,g)}}const rf=xt(Ls);class $g extends wa{project(e,i){i=xt(i),e=xt(e);const r=Math.cos(i),a=2/Math.PI,c=Math.acos(r*Math.cos(e/2)),h=Math.sin(c)/c,p=.5*(e*a+2*r*Math.sin(e/2)/h)||0,g=.5*(i+Math.sin(i)/h)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,c=25;const h=1e-6;let p=0,g=0;do{const _=Math.cos(a),w=Math.sin(a),S=2*w*_,A=w*w,R=_*_,F=Math.cos(r/2),H=Math.sin(r/2),Q=2*F*H,we=H*H,Oe=1-R*F*F,be=Oe?1/Oe:0,ke=Oe?Math.acos(_*F)*Math.sqrt(1/Oe):0,Ue=.5*(2*ke*_*H+2*r/Math.PI)-e,Pe=.5*(ke*w+a)-i,at=.5*be*(R*we+ke*_*F*A)+1/Math.PI,rt=be*(Q*S/4-ke*w*H),yt=.125*be*(S*H-ke*w*R*Q),Ot=.5*be*(A*F+ke*we*_)+.5,ht=rt*yt-Ot*at;p=(Pe*rt-Ue*Ot)/ht,g=(Ue*yt-Pe*at)/ht,r=qt(r-p,-Math.PI,Math.PI),a=qt(a-g,-rf,rf)}while((Math.abs(p)>h||Math.abs(g)>h)&&--c>0);return new Sn(Wt(r),Wt(a))}}class of extends wa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(xt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:a}=this;return{x:xt(e)*a*r+.5,y:-Math.sin(xt(i))/a*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:a}=this,c=-(i-.5)/r,h=qt(Wt((e-.5)/r)/a,-180,180),p=Math.asin(qt(c*a,-1,1)),g=qt(Wt(p),-85.051129,Ls);return new Sn(h,g)}}class Gg extends tf{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,i,r){const a=Sc(e,i,r);return Tr(a,a,Ac(Rs(r))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){const r=Ec(i.lat,i.lng),a=po([],r),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ac(r,r,a,ts(1,0)*$i*c);const h=zs(new Float64Array(16));return bl(h,e.pixelMatrix,e.globeMatrix),Tr(r,r,h),new ne(r[0],r[1])}pixelsPerMeter(e,i){return ts(1,0)*i}pixelSpaceConversion(e,i,r){const a=ts(1,e)*i,c=on(ts(1,45)*i,a,r);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,r){const a=zh(Rs(r.canonical));return bl(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:r}=e,a=Ac(Rs(i));return _u(a,a,xt(r.lng)),oh(a,a,xt(r.lat)),Za(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,r,a){return Hp(e,i,r,!0)||new vl(0,0)}pointCoordinate3D(e,i,r){const a=this.pointCoordinate(e,i,r,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!Hp(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,c){const h=a.cameraToCenterDistance,p=a._centerAltitude*c,g=a._camera,_=a._camera.forward(),w=Js([],Go([],_,-h),[0,0,p]),S=a.worldSize/(2*Math.PI),A=[0,0,-S],R=a.width/a.height,F=Math.tan(a.fovAboveCenter),H=Go([],g.up(),F),Q=Go([],g.right(),F*R),we=po([],Js([],Js([],_,H),Q)),Oe=[];let be;if(new ch(w,we).closestPointOnSphere(A,S,Oe)){const ke=Js([],Oe,A),Ue=ms([],ke,w);be=Math.cos(a.fovAboveCenter)*rc(Ue)}else{const ke=ms([],w,A),Ue=ms([],A,w);po(Ue,Ue);const Pe=rc(ke)-S;be=Math.sqrt(Pe*(Pe+2*S));const at=Math.acos(be/(S+Pe))-Math.acos(is(_,Ue));be*=Math.cos(at)}return 1.01*be}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Ol(e.zoom);if(r>0){const a=ef(e,ts(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return on(i,a+c*(1-Math.cos(h)),Math.pow(r,10))}return i}upVector(e,i,r){return Sc(i,r,e,1)}upVectorScale(e){return{metersToTile:Dh*Ru(Rs(e))}}}function sf(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new tf(t);case"equirectangular":return new Ug(t);case"naturalEarth":return new Vg(t);case"equalEarth":return new Ng(t);case"winkelTripel":return new $g(t);case"albers":return i?new of(t):new Fg(t);case"lambertConformalConic":return i?new of(t):new jg(t);case"globe":return new Gg(t)}throw new Error(`Invalid projection name: ${t.name}`)}const qg=Eu.types,Zg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nu(t,e,i,r,a,c,h,p,g,_,w,S,A){const R=p?Math.min(ba,Math.round(p[0])):0,F=p?Math.min(ba,Math.round(p[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*a),c,h,(R<<1)+(g?1:0),F,16*_,16*w,256*S,256*A)}function Uu(t,e,i,r,a,c,h){t.emplaceBack(e,i,r,a,c,h)}function ju(t,e,i,r,a){t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a)}function Hg(t){for(const e of t.sections)if(P(e.text))return!0;return!1}class Oh{constructor(e){this.layoutVertexArray=new nr,this.indexArray=new ro,this.programConfigurations=e,this.segments=new wr,this.dynamicLayoutVertexArray=new Mr,this.opacityVertexArray=new fr,this.placedSymbolArray=new td,this.globeExtVertexArray=new Mn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,r,a){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Km.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Zg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ym.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}hi(Oh,"SymbolBuffers");class Rh{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new wr,this.collisionVertexArray=new Ws,this.collisionVertexArrayExt=new jo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Jm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Qm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hi(Rh,"CollisionBuffers");class Ta{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zs([]),this.placementViewportMatrix=zs([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bh(this.zoom,i["text-size"]),this.iconSizeData=bh(this.zoom,i["icon-size"]);const r=this.layers[0].layout,a=r.get("symbol-sort-key"),c=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==c&&void 0!==a.constantOr(1),this.sortFeaturesByY=("viewport-y"===c||"auto"===c&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(h=>qo[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Oh(new $a(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Oh(new $a(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new rd,this.lineVertexArray=new od,this.symbolInstances=new nd}calculateGlyphDependencies(e,i,r,a,c){for(let h=0;h<e.length;h++)if(i[e.charCodeAt(h)]=!0,a&&c){const p=vc[e.charAt(h)];p&&(i[p.charCodeAt(0)]=!0)}}populate(e,i,r,a){const c=this.layers[0],h=c.layout,p="globe"===this.projection.name,g=h.get("text-font"),_=h.get("text-field"),w=h.get("icon-image"),S=("constant"!==_.value.kind||_.value.value instanceof Ar&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&("constant"!==g.value.kind||g.value.value.length>0),A="constant"!==w.value.kind||!!w.value.value||Object.keys(w.parameters).length>0,R=h.get("symbol-sort-key");if(this.features=[],!S&&!A)return;const F=i.iconDependencies,H=i.glyphDependencies,Q=i.availableImages,we=new Te(this.zoom);for(const{feature:Oe,id:be,index:ke,sourceLayerIndex:Ue}of e){const Pe=c._featureFilter.needGeometry,at=Ga(Oe,Pe);if(!c._featureFilter.filter(we,at,r))continue;if(Pe||(at.geometry=Ks(Oe,r,a)),p&&1!==Oe.type&&r.z<=5){const ht=at.geometry,Tt=.98078528056,Ct=(Dt,Ft)=>is(Sc(Dt.x,Dt.y,r,1),Sc(Ft.x,Ft.y,r,1))<Tt;for(let Dt=0;Dt<ht.length;Dt++)ht[Dt]=Hf(ht[Dt],Ct)}let rt,yt;if(S){const ht=c.getValueAndResolveTokens("text-field",at,r,Q),Tt=Ar.factory(ht);Hg(Tt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===he()||this.hasRTLText&&ze.isParsed())&&(rt=ig(Tt,c,at))}if(A){const ht=c.getValueAndResolveTokens("icon-image",at,r,Q);yt=ht instanceof Ir?ht:Ir.fromString(ht)}if(!rt&&!yt)continue;const Ot=this.sortFeaturesByKey?R.evaluate(at,{},r):void 0;if(this.features.push({id:be,text:rt,icon:yt,index:ke,sourceLayerIndex:Ue,geometry:at.geometry,properties:Oe.properties,type:qg[Oe.type],sortKey:Ot}),yt&&(F[yt.name]=!0),rt){const ht=g.evaluate(at,{},r).join(","),Tt="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(qo.vertical)>=0;for(const Ct of rt.sections)if(Ct.image)F[Ct.image.name]=!0;else{const Dt=s(rt.toString()),Ft=Ct.fontStack||ht,dt=H[Ft]=H[Ft]||{};this.calculateGlyphDependencies(Ct.text,dt,Tt,this.allowVerticalPlacement,Dt)}}}"line"===h.get("symbol-placement")&&(this.features=function(Oe){const be={},ke={},Ue=[];let Pe=0;function at(ht){Ue.push(Oe[ht]),Pe++}function rt(ht,Tt,Ct){const Dt=ke[ht];return delete ke[ht],ke[Tt]=Dt,Ue[Dt].geometry[0].pop(),Ue[Dt].geometry[0]=Ue[Dt].geometry[0].concat(Ct[0]),Dt}function yt(ht,Tt,Ct){const Dt=be[Tt];return delete be[Tt],be[ht]=Dt,Ue[Dt].geometry[0].shift(),Ue[Dt].geometry[0]=Ct[0].concat(Ue[Dt].geometry[0]),Dt}function Ot(ht,Tt,Ct){const Dt=Ct?Tt[0][Tt[0].length-1]:Tt[0][0];return`${ht}:${Dt.x}:${Dt.y}`}for(let ht=0;ht<Oe.length;ht++){const Tt=Oe[ht],Ct=Tt.geometry,Dt=Tt.text?Tt.text.toString():null;if(!Dt){at(ht);continue}const Ft=Ot(Dt,Ct),dt=Ot(Dt,Ct,!0);if(Ft in ke&&dt in be&&ke[Ft]!==be[dt]){const ii=yt(Ft,dt,Ct),zi=rt(Ft,dt,Ue[ii].geometry);delete be[Ft],delete ke[dt],ke[Ot(Dt,Ue[zi].geometry,!0)]=zi,Ue[ii].geometry=null}else Ft in ke?rt(Ft,dt,Ct):dt in be?yt(Ft,dt,Ct):(at(ht),be[Ft]=Pe-1,ke[dt]=Pe-1)}return Ue.filter(ht=>ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Oe,be)=>Oe.sortKey-be.sortKey)}update(e,i,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,r,a),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,r,a))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=sf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length,a=e.segment;if(void 0!==a){let c=e.dist(i[a+1]),h=e.dist(i[a]);const p={};for(let g=a+1;g<i.length;g++)p[g]={x:i[g].x,y:i[g].y,tileUnitDistanceFromAnchor:c},g<i.length-1&&(c+=i[g+1].dist(i[g]));for(let g=a||0;g>=0;g--)p[g]={x:i[g].x,y:i[g].y,tileUnitDistanceFromAnchor:h},g>0&&(h+=i[g-1].dist(i[g]));for(let g=0;g<i.length;g++){const _=p[g];this.lineVertexArray.emplaceBack(_.x,_.y,_.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,a,c,h,p,g,_,w,S,A,R,F){const H=e.indexArray,Q=e.layoutVertexArray,we=e.globeExtVertexArray,Oe=e.segments.prepareSegment(4*i.length,Q,H,this.canOverlap?h.sortKey:void 0),be=this.glyphOffsetArray.length,ke=Oe.vertexLength,Ue=this.allowVerticalPlacement&&p===qo.vertical?Math.PI/2:0,Pe=h.text&&h.text.sections;for(let rt=0;rt<i.length;rt++){const{tl:yt,tr:Ot,bl:ht,br:Tt,tex:Ct,pixelOffsetTL:Dt,pixelOffsetBR:Ft,minFontScaleX:dt,minFontScaleY:ii,glyphOffset:zi,isSDF:ai,sectionIndex:_i}=i[rt],ri=Oe.vertexLength,Oi=zi[1];if(Nu(Q,_.x,_.y,yt.x,Oi+yt.y,Ct.x,Ct.y,r,ai,Dt.x,Dt.y,dt,ii),Nu(Q,_.x,_.y,Ot.x,Oi+Ot.y,Ct.x+Ct.w,Ct.y,r,ai,Ft.x,Dt.y,dt,ii),Nu(Q,_.x,_.y,ht.x,Oi+ht.y,Ct.x,Ct.y+Ct.h,r,ai,Dt.x,Ft.y,dt,ii),Nu(Q,_.x,_.y,Tt.x,Oi+Tt.y,Ct.x+Ct.w,Ct.y+Ct.h,r,ai,Ft.x,Ft.y,dt,ii),g){const en=g.anchor,sn=g.up;Uu(we,en.x,en.y,en.z,sn[0],sn[1],sn[2]),Uu(we,en.x,en.y,en.z,sn[0],sn[1],sn[2]),Uu(we,en.x,en.y,en.z,sn[0],sn[1],sn[2]),Uu(we,en.x,en.y,en.z,sn[0],sn[1],sn[2]),ju(e.dynamicLayoutVertexArray,en.x,en.y,en.z,Ue)}else ju(e.dynamicLayoutVertexArray,_.x,_.y,_.z,Ue);H.emplaceBack(ri,ri+1,ri+2),H.emplaceBack(ri+1,ri+2,ri+3),Oe.vertexLength+=4,Oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zi[0]),rt!==i.length-1&&_i===i[rt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Q.length,h,h.index,{},R,F,Pe&&Pe[_i])}const at=g?g.anchor:_;e.placedSymbolArray.emplaceBack(at.x,at.y,at.z,_.x,_.y,be,this.glyphOffsetArray.length-be,ke,w,S,_.segment,r?r[0]:0,r?r[1]:0,a[0],a[1],p,0,!1,0,A,0)}_commitLayoutVertex(e,i,r,a,c,h,p){e.emplaceBack(i,r,a,c,h,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,i,r,a,c,h,p){const g=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),_=g.vertexLength,w=p.tileAnchorX,S=p.tileAnchorY;for(let R=0;R<4;R++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,a,c,h,w,S,new ne(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,c,h,w,S,new ne(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,c,h,w,S,new ne(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,a,c,h,w,S,new ne(e.x1,e.y2)),g.vertexLength+=4;const A=r.indexArray;A.emplaceBack(_,_+1),A.emplaceBack(_+1,_+2),A.emplaceBack(_+2,_+3),A.emplaceBack(_+3,_),g.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,a,c,h){for(let p=a;p<c;p++){const g=r.get(p),_=this.getSymbolInstanceTextSize(e,h,i,p);this._addCollisionDebugVertices(g,_,this.textCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,r,a,c,h){for(let p=a;p<c;p++){const g=r.get(p),_=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(g,_,this.iconCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rh(Gn,yp.members,Vo),this.iconCollisionBox=new Rh(Gn,yp.members,Vo);const r=Al(this.iconSizeData,e),a=Al(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(r,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(r,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,i,r,a){const c=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),h=Mu(this.textSizeData,e,c)/24;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,r){const a=this.icon.placedSymbolArray.get(r),c=Mu(this.iconSizeData,e,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,i,r){e.emplaceBack(i,-r,-r),e.emplaceBack(i,r,-r),e.emplaceBack(i,r,r),e.emplaceBack(i,-r,r)}_updateTextDebugCollisionBoxes(e,i,r,a,c,h){for(let p=a;p<c;p++){const g=r.get(p),_=this.getSymbolInstanceTextSize(e,h,i,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,g.padding)}}_updateIconDebugCollisionBoxes(e,i,r,a,c,h){for(let p=a;p<c;p++){const g=r.get(p),_=this.getSymbolInstanceIconSize(e,i,h);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,g.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Al(this.iconSizeData,e),a=Al(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(a,e,i,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(a,e,i,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(r,e,i,h.iconBoxStartIndex,h.iconBoxEndIndex,h.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,i,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,a,c,h,p,g,_){const w={};for(let S=i;S<r;S++){const A=e.get(S);w.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},w.textFeatureIndex=A.featureIndex;break}for(let S=a;S<c;S++){const A=e.get(S);w.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},w.verticalTextFeatureIndex=A.featureIndex;break}for(let S=h;S<p;S++){const A=e.get(S);w.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},w.iconFeatureIndex=A.featureIndex;break}for(let S=g;S<_;S++){const A=e.get(S);w.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},w.verticalIconFeatureIndex=A.featureIndex;break}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),a=r.vertexStartIndex+4*r.numGlyphs;for(let c=r.vertexStartIndex;c<a;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),a=[],c=[],h=[];for(let p=0;p<this.symbolInstances.length;++p){h.push(p);const g=this.symbolInstances.get(p);a.push(0|Math.round(i*g.tileAnchorX+r*g.tileAnchorY)),c.push(g.featureIndex)}return h.sort((p,g)=>a[p]-a[g]||c[g]-c[p]),h}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex),[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((a,c,h)=>{a>=0&&h.indexOf(a)===c&&this.addIndicesForPlacedSymbol(this.text,a)}),r.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,r.verticalPlacedTextSymbolIndex),r.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.placedIconSymbolIndex),r.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,r.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}hi(Ta,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ta.MAX_GLYPHS=65535,Ta.addDynamicAttributes=ju;const Wg=new Zt({"symbol-placement":new it(ct.layout_symbol["symbol-placement"]),"symbol-spacing":new it(ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ze(ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new it(ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ze(ct.layout_symbol["icon-size"]),"icon-text-fit":new it(ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ze(ct.layout_symbol["icon-image"]),"icon-rotate":new Ze(ct.layout_symbol["icon-rotate"]),"icon-padding":new it(ct.layout_symbol["icon-padding"]),"icon-keep-upright":new it(ct.layout_symbol["icon-keep-upright"]),"icon-offset":new Ze(ct.layout_symbol["icon-offset"]),"icon-anchor":new Ze(ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(ct.layout_symbol["text-rotation-alignment"]),"text-field":new Ze(ct.layout_symbol["text-field"]),"text-font":new Ze(ct.layout_symbol["text-font"]),"text-size":new Ze(ct.layout_symbol["text-size"]),"text-max-width":new Ze(ct.layout_symbol["text-max-width"]),"text-line-height":new Ze(ct.layout_symbol["text-line-height"]),"text-letter-spacing":new Ze(ct.layout_symbol["text-letter-spacing"]),"text-justify":new Ze(ct.layout_symbol["text-justify"]),"text-radial-offset":new Ze(ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(ct.layout_symbol["text-variable-anchor"]),"text-anchor":new Ze(ct.layout_symbol["text-anchor"]),"text-max-angle":new it(ct.layout_symbol["text-max-angle"]),"text-writing-mode":new it(ct.layout_symbol["text-writing-mode"]),"text-rotate":new Ze(ct.layout_symbol["text-rotate"]),"text-padding":new it(ct.layout_symbol["text-padding"]),"text-keep-upright":new it(ct.layout_symbol["text-keep-upright"]),"text-transform":new Ze(ct.layout_symbol["text-transform"]),"text-offset":new Ze(ct.layout_symbol["text-offset"]),"text-allow-overlap":new it(ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new it(ct.layout_symbol["text-ignore-placement"]),"text-optional":new it(ct.layout_symbol["text-optional"])});var Bh={paint:new Zt({"icon-opacity":new Ze(ct.paint_symbol["icon-opacity"]),"icon-color":new Ze(ct.paint_symbol["icon-color"]),"icon-halo-color":new Ze(ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ze(ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ze(ct.paint_symbol["icon-halo-blur"]),"icon-translate":new it(ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ze(ct.paint_symbol["text-opacity"]),"text-color":new Ze(ct.paint_symbol["text-color"],{runtimeType:Qr,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Ze(ct.paint_symbol["text-halo-color"]),"text-halo-width":new Ze(ct.paint_symbol["text-halo-width"]),"text-halo-blur":new Ze(ct.paint_symbol["text-halo-blur"]),"text-translate":new it(ct.paint_symbol["text-translate"]),"text-translate-anchor":new it(ct.paint_symbol["text-translate-anchor"])}),layout:Wg};class af{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Eo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hi(af,"FormatSectionOverride",{omit:["defaultValue"]});class Vu extends fs{constructor(e){super(e,Bh)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const a=[];for(const c of r)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,a){const c=this.layout.get(e).evaluate(i,{},r,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||Cs(h.value)||!c?c:(p=i.properties,c.replace(/{([^{}]+)}/g,(_,w)=>w in p?String(p[w]):""));var p}createBucket(e){return new Ta(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Bh.paint.overridableProperties){if(!Vu.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new af(i),a=new As(r,i.property.specification);let c=null;c="constant"===i.value.kind||"source"===i.value.kind?new tl("source",a):new il("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new At(i.property,c,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&Vu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),a=Bh.paint.properties[i];let c=!1;const h=p=>{for(const g of p)if(a.overrides&&a.overrides.hasOverride(g))return void(c=!0)};if("constant"===r.value.kind&&r.value.value instanceof Ar)h(r.value.value.sections);else if("source"===r.value.kind){const p=_=>{c||(_ instanceof Xo&&$n(_.value)===jr?h(_.value.sections):_ instanceof lo?h(_.sections):_.eachChild(p))},g=r.value;g._styleExpression&&p(g._styleExpression.expression)}return c}getProgramConfiguration(e){return new va(this,e)}}var Xg={paint:new Zt({"background-color":new it(ct.paint_background["background-color"]),"background-pattern":new Gt(ct.paint_background["background-pattern"]),"background-opacity":new it(ct.paint_background["background-opacity"])})},Yg={paint:new Zt({"raster-opacity":new it(ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(ct.paint_raster["raster-brightness-max"]),"raster-saturation":new it(ct.paint_raster["raster-saturation"]),"raster-contrast":new it(ct.paint_raster["raster-contrast"]),"raster-resampling":new it(ct.paint_raster["raster-resampling"]),"raster-fade-duration":new it(ct.paint_raster["raster-fade-duration"])})};class Kg extends fs{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Jg={paint:new Zt({"sky-type":new it(ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new it(ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new it(ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new it(ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new it(ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qt(ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new it(ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new it(ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new it(ct.paint_sky["sky-opacity"])})};function Fh(t,e,i){const r=[0,0,1],a=jd([]);return $d(a,a,i?-xt(t)+Math.PI:xt(t)),Vd(a,a,-xt(e)),Bd(r,r,a),po(r,r)}const Qg={circle:class extends fs{constructor(t){super(t,em)}createBucket(t){return new th(t)}queryRadius(t){const e=t;return xl("circle-radius",this,e)+xl("circle-stroke-width",this,e)+mu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,a,c,h,p){const g=Id(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),_=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Gd(t,r,c,h,p,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),g,_)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new va(this,t)}},heatmap:class extends fs{createBucket(t){return new Zd(t)}constructor(t){super(t,lm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return xl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,a,c,h,p){const g=this.paint.get("heatmap-radius").evaluate(e,i);return Gd(t,r,c,h,p,!0,!0,new ne(0,0),g)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new va(this,t)}},hillshade:class extends fs{constructor(t){super(t,cm)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends fs{constructor(t){super(t,Sm)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new va(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new wu(t)}queryRadius(){return mu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,a,c){return!t.queryGeometry.isAboveHorizon&&Sd(kd(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends fs{constructor(t){super(t,jm)}createBucket(t){return new gc(t)}queryRadius(){return mu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new va(this,t)}queryIntersectsFeature(t,e,i,r,a,c,h,p,g){const _=Id(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,i),S=this.paint.get("fill-extrusion-base").evaluate(e,i),A=[0,0],R=p&&c.elevation,F=c.elevation?c.elevation.exaggeration():1,H=t.tile.getBucket(this);if(R&&H instanceof gc){const ke=H.centroidVertexArray,Ue=g+1;if(Ue<ke.length){const Pe=ke.get(Ue);A[0]=Pe.a_centroid_pos0,A[1]=Pe.a_centroid_pos1}}if(0===A[0]&&1===A[1])return!1;"globe"===c.projection.name&&(r=up([r],[new ne(0,0),new ne($i,$i)],t.tileID.canonical).map(ke=>ke.polygon).flat());const Q=R?p:null,[we,Oe]=(Ue=r,Pe=S,at=w,rt=_,yt=h,Ot=Q,ht=A,Tt=F,Ct=c.center.lat,"globe"===(ke=c).projection.name?function(Ft,dt,ii,zi,ai,_i,ri,Oi,en,sn,_n){const Ki=[],er=[],un=Ft.projection.upVectorScale(_n,Ft.center.lat,Ft.worldSize).metersToTile,pn=[0,0,0,1],On=[0,0,0,1],Yn=(Kn,tr,ur,Br)=>{Kn[0]=tr,Kn[1]=ur,Kn[2]=Br,Kn[3]=1},Zn=cp();ii>0&&(ii+=Zn),zi+=Zn;for(const Kn of dt){const tr=[],ur=[];for(const Br of Kn){const In=Br.x+ai.x,Er=Br.y+ai.y,gr=Ft.projection.projectTilePoint(In,Er,_n),Tn=Ft.projection.upVector(_n,Br.x,Br.y);let rr=ii,kr=zi;if(ri){const Rn=fp(In,Er,ii,zi,ri,Oi,en,sn);rr+=Rn.base,kr+=Rn.top}0!==ii?Yn(pn,gr.x+Tn[0]*un*rr,gr.y+Tn[1]*un*rr,gr.z+Tn[2]*un*rr):Yn(pn,gr.x,gr.y,gr.z),Yn(On,gr.x+Tn[0]*un*kr,gr.y+Tn[1]*un*kr,gr.z+Tn[2]*un*kr),Tr(pn,pn,_i),Tr(On,On,_i),tr.push(new Sl(pn[0],pn[1],pn[2])),ur.push(new Sl(On[0],On[1],On[2]))}Ki.push(tr),er.push(ur)}return[Ki,er]}(ke,Ue,Pe,at,rt,yt,Ot,ht,Tt,Ct,t.tileID.canonical):Ot?function(Ft,dt,ii,zi,ai,_i,ri,Oi,en){const sn=[],_n=[],Ki=[0,0,0,1];for(const er of Ft){const un=[],pn=[];for(const On of er){const Yn=On.x+zi.x,Zn=On.y+zi.y,Kn=fp(Yn,Zn,dt,ii,_i,ri,Oi,en);Ki[0]=Yn,Ki[1]=Zn,Ki[2]=Kn.base,Ki[3]=1,Ha(Ki,Ki,ai),Ki[3]=Math.max(Ki[3],1e-5);const tr=new Sl(Ki[0]/Ki[3],Ki[1]/Ki[3],Ki[2]/Ki[3]);Ki[0]=Yn,Ki[1]=Zn,Ki[2]=Kn.top,Ki[3]=1,Ha(Ki,Ki,ai),Ki[3]=Math.max(Ki[3],1e-5);const ur=new Sl(Ki[0]/Ki[3],Ki[1]/Ki[3],Ki[2]/Ki[3]);un.push(tr),pn.push(ur)}sn.push(un),_n.push(pn)}return[sn,_n]}(Ue,Pe,at,rt,yt,Ot,ht,Tt,Ct):function(Ft,dt,ii,zi,ai){const _i=[],ri=[],Oi=ai[8]*dt,en=ai[9]*dt,sn=ai[10]*dt,_n=ai[11]*dt,Ki=ai[8]*ii,er=ai[9]*ii,un=ai[10]*ii,pn=ai[11]*ii;for(const On of Ft){const Yn=[],Zn=[];for(const Kn of On){const tr=Kn.x+zi.x,ur=Kn.y+zi.y,Br=ai[0]*tr+ai[4]*ur+ai[12],In=ai[1]*tr+ai[5]*ur+ai[13],Er=ai[2]*tr+ai[6]*ur+ai[14],gr=ai[3]*tr+ai[7]*ur+ai[15],Tn=Br+Oi,rr=In+en,kr=Er+sn,Rn=Math.max(gr+_n,1e-5),dr=Br+Ki,oo=In+er,Fr=Er+un,Nr=Math.max(gr+pn,1e-5);Yn.push(new Sl(Tn/Rn,rr/Rn,kr/Rn)),Zn.push(new Sl(dr/Nr,oo/Nr,Fr/Nr))}_i.push(Yn),ri.push(Zn)}return[_i,ri]}(Ue,Pe,at,rt,yt)),be=t.queryGeometry;var ke,Ue,Pe,at,rt,yt,Ot,ht,Tt,Ct;return function(ke,Ue,Pe){let at=1/0;Sd(Pe,Ue)&&(at=pp(Pe,Ue[0]));for(let rt=0;rt<Ue.length;rt++){const yt=Ue[rt],Ot=ke[rt];for(let ht=0;ht<yt.length-1;ht++){const Tt=yt[ht],Ct=[Tt,yt[ht+1],Ot[ht+1],Ot[ht],Tt];Ed(Pe,Ct)&&(at=Math.min(at,pp(Pe,Ct)))}}return at!==1/0&&at}(we,Oe,be.isPointQuery()?be.screenBounds:be.screenGeometry)}},line:class extends fs{constructor(t){super(t,mp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Un,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=gp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Cu(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new va(this,t)}queryRadius(t){const e=t,i=_p(xl("line-width",this,e),xl("line-gap-width",this,e)),r=xl("line-offset",this,e);return i/2+Math.abs(r)+mu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,a,c){if(t.queryGeometry.isAboveHorizon)return!1;const h=kd(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),p=t.pixelToTileUnitsFactor/2*_p(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),g=this.paint.get("line-offset").evaluate(e,i);return g&&(r=function(_,w){const S=[],A=new ne(0,0);for(let R=0;R<_.length;R++){const F=_[R],H=[];for(let Q=0;Q<F.length;Q++){const we=F[Q-1],Oe=F[Q],be=F[Q+1],ke=0===Q?A:Oe.sub(we)._unit()._perp(),Ue=Q===F.length-1?A:be.sub(Oe)._unit()._perp(),Pe=ke._add(Ue)._unit();Pe._mult(1/(Pe.x*Ue.x+Pe.y*Ue.y)),H.push(Pe._mult(w)._add(Oe))}S.push(H)}return S}(r,g*t.pixelToTileUnitsFactor)),function(_,w,S){for(let A=0;A<w.length;A++){const R=w[A];if(_.length>=3)for(let F=0;F<R.length;F++)if(qa(_,R[F]))return!0;if(Yf(_,R,S))return!0}return!1}(h,r,p)}isTileClipped(){return!0}},symbol:Vu,background:class extends fs{constructor(t){super(t,Xg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends fs{constructor(t){super(t,Yg)}getProgramIds(){return["raster"]}},sky:class extends fs{constructor(t){super(t,Jg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),a=!r,c=t.style.light,h=c.properties.get("position");return a&&"viewport"===c.properties.get("anchor")&&Ji("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Fh(h.azimuthal,90-h.polar,e):Fh(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return Fh(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Dc{constructor(e,i,r,a){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,r){const{width:a,height:c}=e,{context:h}=this,{gl:p}=h,{HTMLImageElement:g,HTMLCanvasElement:_,HTMLVideoElement:w,ImageData:S,ImageBitmap:A}=D;if(p.bindTexture(p.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!i||!1!==i.premultiply)),r||this.size&&this.size[0]===a&&this.size[1]===c){const{x:R,y:F}=r||{x:0,y:0};e instanceof g||e instanceof _||e instanceof w||e instanceof S||A&&e instanceof A?p.texSubImage2D(p.TEXTURE_2D,0,R,F,p.RGBA,p.UNSIGNED_BYTE,e):p.texSubImage2D(p.TEXTURE_2D,0,R,F,a,c,p.RGBA,p.UNSIGNED_BYTE,e.data)}else this.size=[a,c],e instanceof g||e instanceof _||e instanceof w||e instanceof S||A&&e instanceof A?p.texImage2D(p.TEXTURE_2D,0,this.format,this.format,p.UNSIGNED_BYTE,e):p.texImage2D(p.TEXTURE_2D,0,this.format,a,c,0,this.format,p.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class e_{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class t_{constructor(){this.tasks={},this.taskQueue=[],Bn(["process"],this),this.invoker=new e_(this.process),this.nextId=0}add(e,i){const r=this.nextId++,a=function({type:c,isSymbolTile:h,zoom:p}){return p=p||0,"message"===c?0:"maybePrepare"!==c||h?"parseTile"!==c||h?"parseTile"===c&&h?300-p:"maybePrepare"===c&&h?400-p:500:200-p:100-p}(i);if(0===a){gi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:a,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){gi();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<i&&(i=c.priority,e=a)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class lf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const i_=["tile","layer","source","sourceLayer","state"];class cf{constructor(e,i,r,a,c){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=a,this.properties=e.properties,this.id=c}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of i_)void 0!==this[i]&&(e[i]=this[i]);return e}}const Ea=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,a=0,c=0,h=0,p=0;for(1&e?a=c=h=32:i=r=p=32;(e>>=1)>1;){const _=i+a>>1,w=r+c>>1;1&e?(a=i,c=r,i=h,r=p):(i=a,r=c,a=h,c=p),h=_,p=w}const g=4*t;Ea[g+0]=i,Ea[g+1]=r,Ea[g+2]=a,Ea[g+3]=c}const Fs=new Uint16Array(2178),Sa=new Uint8Array(1089),$u=new Uint16Array(1089);function uf(t){return 0===t?-.03125:32===t?.03125:0}var hf=Ht([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const df={type:2,extent:$i,loadGeometry:()=>[[new ne(0,0),new ne(8193,0),new ne(8193,8193),new ne(0,8193),new ne(0,0)]]};class Nh{constructor(e,i,r,a,c){this.tileID=e,this.uid=ji(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<gn.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ya(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,c){const h={};if(!c)return h;for(const p of a){const g=p.layerIds.map(_=>c.getLayer(_)).filter(Boolean);if(0!==g.length){p.layers=g,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(_=>g.filter(w=>w.id===_)[0]));for(const _ of g)h[_.id]=p}}return h}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const c=this.buckets[a];if(c instanceof Ta){if(this.hasSymbolBuckets=!0,!r)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const c=this.buckets[a];if(c instanceof Ta&&c.hasRTLText){this.hasRTLText=!0,ze.isLoading()||ze.isLoaded()||"deferred"!==he()||Le();break}}this.queryPadding=0;for(const a in this.buckets){const c=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(a).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Wu}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const a=this.buckets[r];a.uploadPending()&&a.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Dc(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dc(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Dc(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,r,a,c,h,p,g){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:p,transform:h,params:c,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const a=r.loadVTLayers(),c=i?i.sourceLayer:"",h=a._geojsonTileLayer||a[c];if(!h)return;const p=rl(i&&i.filter),{z:g,x:_,y:w}=this.tileID.canonical,S={z:g,x:_,y:w};for(let A=0;A<h.length;A++){const R=h.feature(A);if(p.needGeometry){const Q=Ga(R,!0);if(!p.filter(new Te(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!p.filter(new Te(this.tileID.overscaledZ),R))continue;const F=r.getId(R,c),H=new cf(R,g,_,w,F);H.tile=S,e.push(H)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=Ai(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let a=!1;if(this.expirationTime>r)a=!1;else if(i)if(this.expirationTime<i)a=!0;else{const c=this.expirationTime-i;c?this.expirationTime=r+Math.max(c,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const r=this.latestFeatureIndex.loadVTLayers(),a=i.style.listImages();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const h=this.buckets[c],p=h.layers[0].sourceLayer||"_geojsonTileLayer",g=r[p],_=e[p];if(!g||!_||0===Object.keys(_).length)continue;if(h.update(_,g,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),h instanceof Cu||h instanceof wu){const S=i.style._getSourceCache(h.layers[0].source);i._terrain&&i._terrain.enabled&&S&&h.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(S.id,this.tileID)}const w=i&&i.style&&i.style.getLayer(c);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(h)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<gn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=gn.now()+e}setTexture(e,i){const r=i.context,a=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Dc(r,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,i){const r={};for(const a of i)r[a]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const a=this.dependencies[r];if(a)for(const c of i)if(a[c])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const r=Ks(df,this.tileID.canonical,this.tileTransform)[0],a=new cn,c=new tc;for(let h=0;h<r.length;h++){const{x:p,y:g}=r[h];a.emplaceBack(p,g),c.emplaceBack(h)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(a,Tc.members),this._tileDebugSegments=wr.simpleSegment(0,0,a.length,c.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const r=Ks(df,this.tileID.canonical,this.tileTransform)[0];let a,c;if(this.isRaster){const h=function(p,g){const _=Ya(p,g),w=Math.pow(2,p.z);for(let Q=0;Q<33;Q++)for(let we=0;we<33;we++){const Oe=$o((p.x+(we+uf(we))/32)/w),be=Wr((p.y+(Q+uf(Q))/32)/w),ke=g.project(Oe,be),Ue=33*Q+we;Fs[2*Ue+0]=Math.round((ke.x*_.scale-_.x)*$i),Fs[2*Ue+1]=Math.round((ke.y*_.scale-_.y)*$i)}Sa.fill(0),$u.fill(0);for(let Q=2045;Q>=0;Q--){const we=4*Q,Oe=Ea[we+0],be=Ea[we+1],ke=Ea[we+2],Ue=Ea[we+3],Pe=Oe+ke>>1,at=be+Ue>>1,rt=Pe+at-be,yt=at+Oe-Pe,Ot=33*be+Oe,ht=33*Ue+ke,Tt=33*at+Pe,Ct=Math.hypot((Fs[2*Ot+0]+Fs[2*ht+0])/2-Fs[2*Tt+0],(Fs[2*Ot+1]+Fs[2*ht+1])/2-Fs[2*Tt+1])>=16;if(Sa[Tt]=Sa[Tt]||(Ct?1:0),Q<1022){const Dt=33*(be+yt>>1)+(Oe+rt>>1),Ft=33*(Ue+yt>>1)+(ke+rt>>1);Sa[Tt]=Sa[Tt]||Sa[Dt]||Sa[Ft]}}const S=new zn,A=new ro;let R=0;function F(Q,we){const Oe=33*we+Q;return 0===$u[Oe]&&(S.emplaceBack(Fs[2*Oe+0],Fs[2*Oe+1],Q*$i/32,we*$i/32),$u[Oe]=++R),$u[Oe]-1}function H(Q,we,Oe,be,ke,Ue){const Pe=Q+Oe>>1,at=we+be>>1;if(Math.abs(Q-ke)+Math.abs(we-Ue)>1&&Sa[33*at+Pe])H(ke,Ue,Q,we,Pe,at),H(Oe,be,ke,Ue,Pe,at);else{const rt=F(Q,we),yt=F(Oe,be),Ot=F(ke,Ue);A.emplaceBack(rt,yt,Ot)}}return H(0,0,32,32,32,0),H(32,32,0,0,0,32),{vertices:S,indices:A}}(this.tileID.canonical,i);a=h.vertices,c=h.indices}else{a=new zn,c=new ro;for(const{x:p,y:g}of r)a.emplaceBack(p,g,0,0);const h=cc.exports(a.int16,void 0,4);for(let p=0;p<h.length;p+=3)c.emplaceBack(h[p],h[p+1],h[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,hf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=wr.simpleSegment(0,0,a.length,c.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const a=this.tileID.canonical,c=Ac(Wp(a,i)),h=Ol(i.zoom);let p;h>0&&(p=rh(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,i,c,p,h),this._makeGlobeTileDebugTextBuffer(e,a,i,c,p,h)}_globePoint(e,i,r,a,c,h,p){let g=Sc(e,i,r);if(h){const _=1<<r.z,w=Ds(a.center.lng),S=Ps(a.center.lat),A=(r.x+.5)/_-w;let R=0;A>.5?R=-1:A<-.5&&(R=1);let F=(e/$i+r.x)/_+R,H=(i/$i+r.y)/_;F=(F-w)*a._pixelsPerMercatorPixel+w,H=(H-S)*a._pixelsPerMercatorPixel+S;const Q=[F*a.worldSize,H*a.worldSize,0];Tr(Q,Q,h),g=Xa(g,Q,p)}return Tr(g,g,c)}_makeGlobeTileDebugBorderBuffer(e,i,r,a,c,h){const p=new cn,g=new tc,_=new Ln,w=(A,R,F,H,Q)=>{const we=(F-A)/(Q-1),Oe=(H-R)/(Q-1),be=p.length;for(let ke=0;ke<Q;ke++){const Ue=A+ke*we,Pe=R+ke*Oe;p.emplaceBack(Ue,Pe);const at=this._globePoint(Ue,Pe,i,r,a,c,h);_.emplaceBack(at[0],at[1],at[2]),g.emplaceBack(be+ke)}},S=$i;w(0,0,S,0,16),w(S,0,S,S,16),w(S,S,0,S,16),w(0,S,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(g),this._tileDebugBuffer=e.createVertexBuffer(p,Tc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(_,Zp.members),this._tileDebugSegments=wr.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugTextBuffer(e,i,r,a,c,h){const p=new cn,g=new ro,_=new Ln,w=25;g.reserve(32),p.reserve(w),_.reserve(w);const S=(A,R)=>w*A+R;for(let A=0;A<w;A++){const R=2048*A;for(let F=0;F<w;F++){const H=2048*F;p.emplaceBack(H,R);const Q=this._globePoint(H,R,i,r,a,c,h);_.emplaceBack(Q[0],Q[1],Q[2])}}for(let A=0;A<4;A++)for(let R=0;R<4;R++){const F=S(A,R),H=S(A,R+1),Q=S(A+1,R),we=S(A+1,R+1);g.emplaceBack(F,H,Q),g.emplaceBack(Q,H,we)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(g),this._tileDebugTextBuffer=e.createVertexBuffer(p,Tc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(_,Zp.members),this._tileDebugTextSegments=wr.simpleSegment(0,0,w,32)}}class n_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const a=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},Pt(this.stateChanges[e][a],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const c in this.state[e])c!==a&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][a]){this.deletedStates[e][a]={};for(const c in this.state[e][a])r[c]||(this.deletedStates[e][a][c]=null)}else for(const c in r)this.deletedStates[e]&&this.deletedStates[e][a]&&null===this.deletedStates[e][a][c]&&delete this.deletedStates[e][a][c]}removeFeatureState(e,i,r){if(null===this.deletedStates[e])return;const a=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==i)null!==this.deletedStates[e][a]&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][r]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][a])for(r in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][r]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),a=Pt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const c=this.deletedStates[e][i];if(null===c)return{};for(const h in c)delete a[h]}return a}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const c={};for(const h in this.stateChanges[a])this.state[a][h]||(this.state[a][h]={}),Pt(this.state[a][h],this.stateChanges[a][h]),c[h]=this.state[a][h];r[a]=c}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const c={};if(null===this.deletedStates[a])for(const h in this.state[a])c[h]={},this.state[a][h]={};else for(const h in this.deletedStates[a]){if(null===this.deletedStates[a][h])this.state[a][h]={};else for(const p of Object.keys(this.deletedStates[a][h]))delete this.state[a][h][p];c[h]=this.state[a][h]}r[a]=r[a]||{},Pt(r[a],c)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const a in e)e[a].setFeatureState(r,i)}}class pf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function ff(t,e,i,r){let a=0,c=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(r[h])<1e-15){if(i[h]<t[h]||i[h]>e[h])return null}else{const p=1/r[h];let g=(t[h]-i[h])*p,_=(e[h]-i[h])*p;if(g>_){const w=g;g=_,_=w}if(g>a&&(a=g),_<c&&(c=_),a>c)return null}return a}function mf(t,e,i,r,a,c,h,p,g,_,w){const S=r-t,A=a-e,R=c-i,F=h-t,H=p-e,Q=g-i,we=w[1]*Q-w[2]*H,Oe=w[2]*F-w[0]*Q,be=w[0]*H-w[1]*F,ke=S*we+A*Oe+R*be;if(Math.abs(ke)<1e-15)return null;const Ue=1/ke,Pe=_[0]-t,at=_[1]-e,rt=_[2]-i,yt=(Pe*we+at*Oe+rt*be)*Ue;if(yt<0||yt>1)return null;const Ot=at*R-rt*A,ht=rt*S-Pe*R,Tt=Pe*A-at*S,Ct=(w[0]*Ot+w[1]*ht+w[2]*Tt)*Ue;return Ct<0||yt+Ct>1?null:(F*Ot+H*ht+Q*Tt)*Ue}function gf(t,e,i){return(t-e)/(i-e)}function _f(t,e,i,r,a,c,h,p,g){const _=1<<i,w=c-r,S=h-a,A=(t+1)/_*w+r,R=(e+0)/_*S+a,F=(e+1)/_*S+a;p[0]=(t+0)/_*w+r,p[1]=R,g[0]=A,g[1]=F}class yf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(c){const h=Math.ceil(Math.log2(c.dim/8)),p=[];let g=Math.ceil(Math.pow(2,h));const _=1/g,w=(R,F,H,Q,we)=>{const Oe=Q?1:0,be=(R+1)*H-Oe,ke=F*H,Ue=(F+1)*H-Oe;we[0]=R*H,we[1]=ke,we[2]=be,we[3]=Ue};let S=new pf(g);const A=[];for(let R=0;R<g*g;R++){w(R%g,Math.floor(R/g),_,!1,A);const F=Aa(A[0],A[1],c),H=Aa(A[2],A[1],c),Q=Aa(A[2],A[3],c),we=Aa(A[0],A[3],c);S.minimums.push(Math.min(F,H,Q,we)),S.maximums.push(Math.max(F,H,Q,we)),S.leaves.push(1)}for(p.push(S),g/=2;g>=1;g/=2){const R=p[p.length-1];S=new pf(g);for(let F=0;F<g*g;F++){w(F%g,Math.floor(F/g),2,!0,A);const H=R.getElevation(A[0],A[1]),Q=R.getElevation(A[2],A[1]),we=R.getElevation(A[2],A[3]),Oe=R.getElevation(A[0],A[3]),be=R.isLeaf(A[0],A[1]),ke=R.isLeaf(A[2],A[1]),Ue=R.isLeaf(A[2],A[3]),Pe=R.isLeaf(A[0],A[3]),at=Math.min(H.min,Q.min,we.min,Oe.min),rt=Math.max(H.max,Q.max,we.max,Oe.max),yt=be&&ke&&Ue&&Pe;S.maximums.push(rt),S.minimums.push(at),S.leaves.push(rt-at<=5&&yt?1:0)}p.push(S)}return p}(this.dem),r=i.length-1,a=i[r];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,a,c,h,p=1){return ff([e,i,-100],[r,a,this.maximums[0]*p],c,h)}raycast(e,i,r,a,c,h,p=1){if(!this.nodeCount)return null;const g=this.raycastRoot(e,i,r,a,c,h,p);if(null==g)return null;const _=[],w=[],S=[],A=[],R=[{idx:0,t:g,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:F,t:H,nodex:Q,nodey:we,depth:Oe}=R.pop();if(this.leaves[F]){_f(Q,we,Oe,e,i,r,a,S,A);const ke=1<<Oe,Ue=(Q+0)/ke,Pe=(Q+1)/ke,at=(we+0)/ke,rt=(we+1)/ke,yt=Aa(Ue,at,this.dem)*p,Ot=Aa(Pe,at,this.dem)*p,ht=Aa(Pe,rt,this.dem)*p,Tt=Aa(Ue,rt,this.dem)*p,Ct=mf(S[0],S[1],yt,A[0],S[1],Ot,A[0],A[1],ht,c,h),Dt=mf(A[0],A[1],ht,S[0],A[1],Tt,S[0],S[1],yt,c,h),Ft=Math.min(null!==Ct?Ct:Number.MAX_VALUE,null!==Dt?Dt:Number.MAX_VALUE);if(Ft!==Number.MAX_VALUE)return Ft;{const dt=ac([],c,h,H);if(vf(yt,Ot,Tt,ht,gf(dt[0],S[0],A[0]),gf(dt[1],S[1],A[1]))>=dt[2])return H}continue}let be=0;for(let ke=0;ke<this._siblingOffset.length;ke++){_f((Q<<1)+this._siblingOffset[ke][0],(we<<1)+this._siblingOffset[ke][1],Oe+1,e,i,r,a,S,A),S[2]=-100,A[2]=this.maximums[this.childOffsets[F]+ke]*p;const Ue=ff(S,A,c,h);if(null!=Ue){const Pe=Ue;_[ke]=Pe;let at=!1;for(let rt=0;rt<be&&!at;rt++)Pe>=_[w[rt]]&&(w.splice(rt,0,ke),at=!0);at||(w[be]=ke),be++}}for(let ke=0;ke<be;ke++){const Ue=w[ke];R.push({idx:this.childOffsets[F]+Ue,t:_[Ue],nodex:(Q<<1)+this._siblingOffset[Ue][0],nodey:(we<<1)+this._siblingOffset[Ue][1],depth:Oe+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,a,c){if(1===e[a].isLeaf(i,r))return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const h=a-1,p=e[h];let g=0,_=0;for(let w=0;w<this._siblingOffset.length;w++){const S=2*i+this._siblingOffset[w][0],A=2*r+this._siblingOffset[w][1],R=p.getElevation(S,A),F=p.isLeaf(S,A),H=this._addNode(R.min,R.max,F);F&&(g|=1<<w),_||(_=H)}for(let w=0;w<this._siblingOffset.length;w++)g&1<<w||this._construct(e,2*i+this._siblingOffset[w][0],2*r+this._siblingOffset[w][1],h,_+w)}}function vf(t,e,i,r,a,c){return on(on(t,i,c),on(e,r,c),a)}function Aa(t,e,i){const r=i.dim,a=qt(t*r-.5,0,r-1),c=qt(e*r-.5,0,r-1),h=Math.floor(a),p=Math.floor(c),g=Math.min(h+1,r-1),_=Math.min(p+1,r-1);return vf(i.get(h,p),i.get(g,p),i.get(h,_),i.get(g,_),a-h,c-p)}const xf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Gu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,a=!1,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return Ji(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const h=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=r||"mapbox",this.borderReady=a,!a){for(let g=0;g<h;g++)p[this._idx(-1,g)]=p[this._idx(0,g)],p[this._idx(h,g)]=p[this._idx(h-1,g)],p[this._idx(g,-1)]=p[this._idx(g,0)],p[this._idx(g,h)]=p[this._idx(g,h-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(h,-1)]=p[this._idx(h-1,0)],p[this._idx(-1,h)]=p[this._idx(0,h-1)],p[this._idx(h,h)]=p[this._idx(h-1,h-1)],c&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new yf(this)}get(e,i,r=!1){r&&(e=qt(e,-1,this.dim),i=qt(i,-1,this.dim));const a=4*this._idx(e,i);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return xf[e]}get unpackVector(){return xf[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,r){return(256*e*256+256*i+r)/10-1e4}_unpackTerrarium(e,i,r){return 256*e+i+r/256-32768}static pack(e,i){const r=[0,0,0,0],a=Gu.getUnpackVector(i);let c=Math.floor((e+a[3])/a[2]);return r[2]=c%256,c=Math.floor(c/256),r[1]=c%256,c=Math.floor(c/256),r[0]=c,r}getPixels(){return new Po({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,c=i*this.dim+this.dim,h=r*this.dim,p=r*this.dim+this.dim;switch(i){case-1:a=c-1;break;case 1:c=a+1}switch(r){case-1:h=p-1;break;case 1:p=h+1}const g=-i*this.dim,_=-r*this.dim;for(let w=h;w<p;w++)for(let S=a;S<c;S++){const A=4*this._idx(S,w),R=4*this._idx(S+g,w+_);this.pixels[A+0]=e.pixels[R+0],this.pixels[A+1]=e.pixels[R+1],this.pixels[A+2]=e.pixels[R+2],this.pixels[A+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}hi(Gu,"DEMData"),hi(yf,"DemMinMaxQuadTree",{omit:["dem"]});class r_{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const a=e.wrapped().key;void 0===this.data[a]&&(this.data[a]=[]);const c={value:i,timeout:void 0};if(void 0!==r&&(c.timeout=setTimeout(()=>{this.remove(e,c)},r)),this.data[a].push(c),this.order.push(a),this.order.length>this.max){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,a=void 0===i?0:this.data[r].indexOf(i),c=this.data[r][a];return this.data[r].splice(a,1),c.timeout&&clearTimeout(c.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(c.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const a of this.data[r])e(a.value)||i.push(a);for(const r of i)this.remove(r.value.tileID,r)}}class Bl{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}Bl.ReadOnly=!1,Bl.ReadWrite=!0,Bl.disabled=new Bl(519,Bl.ReadOnly,[0,1]);class jh{constructor(e,i,r,a,c,h){this.test=e,this.ref=i,this.mask=r,this.fail=a,this.depthFail=c,this.pass=h}}jh.disabled=new jh({func:519,mask:0},0,0,7680,7680,7680);class Ns{constructor(e,i,r){this.blendFunction=e,this.blendColor=i,this.mask=r}}Ns.Replace=[1,0],Ns.disabled=new Ns(Ns.Replace,ir.transparent,[!1,!1,!1,!1]),Ns.unblended=new Ns(Ns.Replace,ir.transparent,[!0,!0,!0,!0]),Ns.alphaBlended=new Ns([1,771],ir.transparent,[!0,!0,!0,!0]);class ys{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}ys.disabled=new ys(!1,1029,2305),ys.backCCW=new ys(!0,1029,2305),ys.backCW=new ys(!0,1029,2304),ys.frontCW=new ys(!0,1028,2304),ys.frontCCW=new ys(!0,1028,2305);class Ka extends Kr{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",a=>{"source"===a.dataType&&"metadata"===a.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===a.dataType&&"content"===a.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new r_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new n_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return tn(this._tiles).map(e=>e.tileID).sort(bf).map(e=>e.key)}getRenderableIds(e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&i.push(this._tiles[r]);return e?i.sort((r,a)=>{const c=r.tileID,h=a.tileID,p=new ne(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),g=new ne(h.canonical.x,h.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-h.overscaledZ||g.y-p.y||g.x-p.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort(bf).map(r=>r.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,a){if(a)if(e.state="errored",404!==a.status)this._source.fire(new Yr(a,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=gn.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new bn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let a=0;a<i.length;a++){const c=i[a];if(e.neighboringTiles&&e.neighboringTiles[c]){const h=this.getTileByID(c);r(e,h),r(h,e)}}function r(a,c){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let h=c.tileID.canonical.x-a.tileID.canonical.x;const p=c.tileID.canonical.y-a.tileID.canonical.y,g=Math.pow(2,a.tileID.canonical.z),_=c.tileID.key;0===h&&0===p||Math.abs(p)>1||(Math.abs(h)>1&&(1===Math.abs(h+g)?h+=g:1===Math.abs(h-g)&&(h-=g)),c.dem&&a.dem&&(a.dem.backfillBorder(c.dem,h,p),a.neighboringTiles&&a.neighboringTiles[_]&&(a.neighboringTiles[_].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,a){for(const c in this._tiles){let h=this._tiles[c];if(a[c]||!h.hasData()||h.tileID.overscaledZ<=i||h.tileID.overscaledZ>r)continue;let p=h.tileID;for(;h&&h.tileID.overscaledZ>i+1;){const _=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[_.key],h&&h.hasData()&&(p=_)}let g=p;for(;g.overscaledZ>i;)if(g=g.scaledTo(g.overscaledZ-1),e[g.key]){a[p.key]=p;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const a=e.scaledTo(r),c=this._getLoadedTile(a);if(c)return c}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,a=Math.ceil(e.height/i)+1,c=Math.floor(r*a*5),h="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,c):c,p="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(p)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const a in this._tiles){const c=this._tiles[a];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),r[c.tileID.key]=c}this._tiles=r;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let a;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new mo(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(a=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(p=>this._source.hasTile(p)))):a=[];const c=this._updateRetainedTiles(a);if(wf(this._source.type)&&0!==a.length){const p={},g={},_=Object.keys(c);for(const S of _){const A=c[S],R=this._tiles[S];if(!R||R.fadeEndTime&&R.fadeEndTime<=gn.now())continue;const F=this.findLoadedParent(A,Math.max(A.overscaledZ-Ka.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),p[F.tileID.key]=F.tileID),g[S]=A}const w=a[a.length-1].overscaledZ;for(const S in this._tiles){const A=this._tiles[S];if(c[S]||!A.hasData())continue;let R=A.tileID;for(;R.overscaledZ>w;){R=R.scaledTo(R.overscaledZ-1);const F=this._tiles[R.key];if(F&&F.hasData()&&g[R.key]){c[S]=A.tileID;break}}}for(const S in p)c[S]||(this._coveredTiles[S]=!0,c[S]=p[S])}for(const p in c)this._tiles[p].clearFadeHold();const h=function(p,g){const _=[];for(const w in p)w in g||_.push(w);return _}(this._tiles,c);for(const p of h){const g=this._tiles[p];g.hasSymbolBuckets&&!g.holdingForFade()?g.setHoldDuration(this.map._fadeDuration):g.hasSymbolBuckets&&!g.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const r={},a=e.reduce((_,w)=>Math.min(_,w.overscaledZ),1/0),c=e[0].overscaledZ,h=Math.max(c-Ka.maxOverzooming,this._source.minzoom),p=Math.max(c+Ka.maxUnderzooming,this._source.minzoom),g={};for(const _ of e){const w=this._addTile(_);i[_.key]=_,w.hasData()||a<this._source.maxzoom&&(g[_.key]=_)}this._retainLoadedChildren(g,a,p,i);for(const _ of e){let w=this._tiles[_.key];if(w.hasData())continue;if(_.canonical.z>=this._source.maxzoom){const A=_.children(this._source.maxzoom)[0],R=this.getTile(A);if(R&&R.hasData()){i[A.key]=A;continue}}else{const A=_.children(this._source.maxzoom);if(i[A[0].key]&&i[A[1].key]&&i[A[2].key]&&i[A[3].key])continue}let S=w.wasRequested();for(let A=_.overscaledZ-1;A>=h;--A){const R=_.scaledTo(A);if(r[R.key]||(r[R.key]=!0,w=this.getTile(R),!w&&S&&(w=this._addTile(R)),w&&(i[R.key]=R,S=w.wasRequested(),w.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){r=this._loadedParentTiles[a.key];break}i.push(a.key);const c=a.scaledTo(a.overscaledZ-1);if(r=this._getLoadedTile(c),r)break;a=c}for(const c of i)this._loadedParentTiles[c]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=Boolean(i);if(!r){const a=this.map?this.map.painter:null;i=new Nh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new bn("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const a=[],c=this.transform;if(!c)return a;const h="globe"===c.projection.name,p=Ds(c.center.lng);for(const g in this._tiles){const _=this._tiles[g];if(r&&_.clearQueryDebugViz(),_.holdingForFade())continue;let w;if(h){const S=_.tileID.canonical;if(0===S.z){const A=[Math.abs(qt(p,...Pc(S,-1))-p),Math.abs(qt(p,...Pc(S,1))-p)];w=[0,2*A.indexOf(Math.min(...A))-1]}else{const A=[Math.abs(qt(p,...Pc(S,-1))-p),Math.abs(qt(p,...Pc(S,0))-p),Math.abs(qt(p,...Pc(S,1))-p)];w=[A.indexOf(Math.min(...A))-1]}}else w=[0];for(const S of w){const A=e.containsTile(_,c,i,S);A&&a.push(A)}}return a}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of i)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(wf(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=gn.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const a=this._tiles[e];a&&a.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){const r=new Map,a=Array.isArray(e)?e:[e],c=this.map.painter.terrain,h=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const p of a){const g=p.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const _ of g)r.set(_.key,_);this.usedForTerrain&&p.updateElevation(!1)}mi(Array.from(r.values()),(p,g)=>{const _=new Nh(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(_,w=>{"raster-dem"===this._source.type&&_.dem&&this._backfillDEM(_),g(w,_)})},i)}}function bf(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function wf(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Pc(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Ka.maxOverzooming=10,Ka.maxUnderzooming=3;class qu{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const a=r||e.findDEMTileFor(i);if(!a||!a.dem)return;const c=a.dem,h=a.tileID,p=1<<i.canonical.z-h.canonical.z;return new qu(a,a.tileSize/$i/p,[(i.canonical.x/p-h.canonical.x)*c.dim,(i.canonical.y/p-h.canonical.y)*c.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(r);return new ne(a,c)}getElevationAt(e,i,r,a){const c=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],p=Math.floor(c),g=Math.floor(h),_=this._dem;return a=!!a,r?on(on(_.get(p,g,a),_.get(p,g+1,a),h-g),on(_.get(p+1,g,a),_.get(p+1,g+1,a),h-g),c-p):_.get(p,g,a)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ts(1,e)*this._dem.stride}}class Tf{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ga($i,16,0),this.featureIndexArray=new ad,this.promoteId=i}insert(e,i,r,a,c,h=0){const p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,a,c,h);const g=this.grid;for(let _=0;_<i.length;_++){const w=i[_],S=[1/0,1/0,-1/0,-1/0];for(let A=0;A<w.length;A++){const R=w[A];S[0]=Math.min(S[0],R.x),S[1]=Math.min(S[1],R.y),S[2]=Math.max(S[2],R.x),S[3]=Math.max(S[3],R.y)}S[0]<$i&&S[1]<$i&&S[2]>=0&&S[3]>=0&&g.insert(p,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xh(new xc(this.rawTileData)).layers,this.sourceLayerCoder=new lf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,a){this.loadVTLayers();const c=e.params||{},h=rl(c.filter),p=e.tileResult,g=e.transform,_=p.bufferedTilespaceBounds,w=this.grid.query(_.min.x,_.min.y,_.max.x,_.max.y,(F,H,Q,we)=>Md(p.bufferedTilespaceGeometry,F,H,Q,we));w.sort(o_);let S=null;g.elevation&&w.length>0&&(S=qu.create(g.elevation,this.tileID));const A={};let R;for(let F=0;F<w.length;F++){const H=w[F];if(H===R)continue;R=H;const Q=this.featureIndexArray.get(H);let we=null;this.loadMatchingFeature(A,Q,h,c.layers,c.availableImages,i,r,a,(Oe,be,ke,Ue=0)=>(we||(we=Ks(Oe,this.tileID.canonical,e.tileTransform)),be.queryIntersectsFeature(p,Oe,ke,we,this.z,e.transform,e.pixelPosMatrix,S,Ue)))}return A}loadMatchingFeature(e,i,r,a,c,h,p,g,_){const{featureIndex:w,bucketIndex:S,sourceLayerIndex:A,layoutVertexArrayOffset:R}=i,F=this.bucketLayerIDs[S];if(a&&!function(Oe,be){for(let ke=0;ke<Oe.length;ke++)if(be.indexOf(Oe[ke])>=0)return!0;return!1}(a,F))return;const H=this.sourceLayerCoder.decode(A),Q=this.vtLayers[H].feature(w);if(r.needGeometry){const Oe=Ga(Q,!0);if(!r.filter(new Te(this.tileID.overscaledZ),Oe,this.tileID.canonical))return}else if(!r.filter(new Te(this.tileID.overscaledZ),Q))return;const we=this.getId(Q,H);for(let Oe=0;Oe<F.length;Oe++){const be=F[Oe];if(a&&a.indexOf(be)<0)continue;const ke=h[be];if(!ke)continue;let Ue={};void 0!==we&&g&&(Ue=g.getState(ke.sourceLayer||"_geojsonTileLayer",we));const Pe=Pt({},p[be]);Pe.paint=Ef(Pe.paint,ke.paint,Q,Ue,c),Pe.layout=Ef(Pe.layout,ke.layout,Q,Ue,c);const at=!_||_(Q,ke,Ue,R);if(!at)continue;const rt=new cf(Q,this.z,this.x,this.y,we);rt.layer=Pe;let yt=e[be];void 0===yt&&(yt=e[be]=[]),yt.push({featureIndex:w,feature:rt,intersectionZ:at})}}lookupSymbolFeatures(e,i,r,a,c,h,p,g){const _={};this.loadVTLayers();const w=rl(c);for(const S of e)this.loadMatchingFeature(_,{bucketIndex:r,sourceLayerIndex:a,featureIndex:S,layoutVertexArrayOffset:0},w,h,p,g,i);return _}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(r),c=this.vtFeatures[a];if(c[i])return c[i];const h=this.vtLayers[a].feature(i);return c[i]=h,h}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const a="string"==typeof this.promoteId?this.promoteId:this.promoteId[i];null!=a&&(r=e.properties[a]),"boolean"==typeof r&&(r=Number(r))}return r}}function Ef(t,e,i,r,a){return En(t,(c,h)=>{const p=e instanceof Et?e.get(h):null;return p&&p.evaluate?p.evaluate(i,r,a):p})}function o_(t,e){return e-t}hi(Tf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Sf{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Qs({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=Si(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const a=[];let c=e.length%2==1?-e[e.length-1]*r:0,h=e[0]*r,p=!0;a.push({left:c,right:h,isDash:p,zeroLength:0===e[0]});let g=e[0];for(let _=1;_<e.length;_++){p=!p;const w=e[_];c=g*r,g+=w,h=g*r,a.push({left:c,right:h,isDash:p,zeroLength:0===w})}return a}addRoundDash(e,i,r){const a=i/2;for(let c=-r;c<=r;c++){const h=this.width*(this.nextRow+r+c);let p=0,g=e[p];for(let _=0;_<this.width;_++){_/g.right>1&&(g=e[++p]);const w=Math.abs(_-g.left),S=Math.abs(_-g.right),A=Math.min(w,S);let R;const F=c/r*(a+1);if(g.isDash){const H=a-Math.abs(F);R=Math.sqrt(A*A+H*H)}else R=a-Math.sqrt(A*A+F*F);this.image.data[h+_]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let g=e.length-1;g>=0;--g){const _=e[g],w=e[g+1];_.zeroLength?e.splice(g,1):w&&w.isDash===_.isDash&&(w.left=_.left,e.splice(g,1))}const r=e[0],a=e[e.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const c=this.width*this.nextRow;let h=0,p=e[h];for(let g=0;g<this.width;g++){g/p.right>1&&(p=e[++h]);const _=Math.abs(g-p.left),w=Math.abs(g-p.right),S=Math.min(_,w);this.image.data[c+g]=Math.max(0,Math.min(255,(p.isDash?S:-S)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const a="round"===i,c=a?7:0,h=2*c+1;if(this.nextRow+h>this.height)return Ji("LineAtlas out of space"),null;0===e.length&&e.push(1);let p=0;for(let w=0;w<e.length;w++)e[w]<0&&(Ji("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),p+=e[w];if(0!==p){const w=this.width/p,S=this.getDashRanges(e,this.width,w);a?this.addRoundDash(S,w,c):this.addRegularDash(S,"square"===i?.5*w:0)}const g=this.nextRow+c;this.nextRow+=h;const _={tl:[g,c],br:[p,0]};return this.positions[r]=_,_}}hi(Sf,"LineAtlas");class Af{constructor(e){const i={},r=[];for(const p in e){const g=e[p],_=i[p]={};for(const w in g.glyphs){const S=g.glyphs[+w];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const A=S.metrics.localGlyph?2:1,R={x:0,y:0,w:S.bitmap.width+2*A,h:S.bitmap.height+2*A};r.push(R),_[w]=R}}const{w:a,h:c}=Th(r),h=new Qs({width:a||1,height:c||1});for(const p in e){const g=e[p];for(const _ in g.glyphs){const w=g.glyphs[+_];if(!w||0===w.bitmap.width||0===w.bitmap.height)continue;const S=i[p][_],A=w.metrics.localGlyph?2:1;Qs.copy(w.bitmap,h,{x:0,y:0},{x:S.x+A,y:S.y+A},w.bitmap)}}this.image=h,this.positions=i}}hi(Af,"GlyphAtlas");class s_{constructor(e){this.tileID=new mo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ya(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,r,a,c){this.status="parsing",this.data=e,this.collisionBoxArray=new Wu;const h=new lf(Object.keys(e.layers).sort()),p=new Tf(this.tileID,this.promoteId);p.bucketLayerIDs=[];const g={},_=new Sf(256,256),w={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:_,availableImages:r},S=i.familiesBySource[this.source];for(const Ue in S){const Pe=e.layers[Ue];if(!Pe)continue;let at=!1,rt=!1;for(const ht of S[Ue])"symbol"===ht[0].type?at=!0:rt=!0;if(!0===this.isSymbolTile&&!at||!1===this.isSymbolTile&&!rt)continue;1===Pe.version&&Ji(`Vector tile source "${this.source}" layer "${Ue}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yt=h.encode(Ue),Ot=[];for(let ht=0;ht<Pe.length;ht++){const Tt=Pe.feature(ht),Ct=p.getId(Tt,Ue);Ot.push({feature:Tt,id:Ct,index:ht,sourceLayerIndex:yt})}for(const ht of S[Ue]){const Tt=ht[0];void 0!==this.isSymbolTile&&"symbol"===Tt.type!==this.isSymbolTile||Tt.minzoom&&this.zoom<Math.floor(Tt.minzoom)||Tt.maxzoom&&this.zoom>=Tt.maxzoom||"none"!==Tt.visibility&&(Gh(ht,this.zoom,r),(g[Tt.id]=Tt.createBucket({index:p.bucketLayerIDs.length,layers:ht,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(Ot,w,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(ht.map(Ct=>Ct.id)))}}let A,R,F,H;_.trim();const Q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},we=En(w.glyphDependencies,Ue=>Object.keys(Ue).map(Number));Object.keys(we).length?a.send("getGlyphs",{uid:this.uid,stacks:we},(Ue,Pe)=>{A||(A=Ue,R=Pe,ke.call(this))},void 0,!1,Q):R={};const Oe=Object.keys(w.iconDependencies);Oe.length?a.send("getImages",{icons:Oe,source:this.source,tileID:this.tileID,type:"icons"},(Ue,Pe)=>{A||(A=Ue,F=Pe,ke.call(this))},void 0,!1,Q):F={};const be=Object.keys(w.patternDependencies);function ke(){if(A)return c(A);if(R&&F&&H){const Ue=new Af(R),Pe=new Sp(F,H);for(const at in g){const rt=g[at];rt instanceof Ta?(Gh(rt.layers,this.zoom,r),Mg(rt,R,Ue.positions,F,Pe.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):rt.hasPattern&&(rt instanceof Cu||rt instanceof wu||rt instanceof gc)&&(Gh(rt.layers,this.zoom,r),rt.addFeatures(w,this.tileID.canonical,Pe.patternPositions,r,this.tileTransform))}this.status="done",c(null,{buckets:tn(g).filter(at=>!at.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ue.image,lineAtlas:_,imageAtlas:Pe,glyphMap:this.returnDependencies?R:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?Ue.positions:null})}}be.length?a.send("getImages",{icons:be,source:this.source,tileID:this.tileID,type:"patterns"},(Ue,Pe)=>{A||(A=Ue,H=Pe,ke.call(this))},void 0,!1,Q):H={},ke.call(this)}}function Gh(t,e,i){const r=new Te(e);for(const a of t)a.recalculate(r,i)}class Cf{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,a){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[h,p]=c.result;return this.scheduler?this.scheduler.add(()=>{a(h,p)},i):a(h,p),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=r((h,p)=>{c.result=[h,p];for(const g of c.callbacks)this.scheduler?this.scheduler.add(()=>{g(h,p)},i):g(h,p);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(h=>h!==a),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function Mf(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const c=Xt(t.request,(h,p,g,_)=>{h?a(h):p&&a(null,{vectorTile:i?void 0:new xh(new xc(p)),rawData:p,cacheControl:g,expires:_})});return()=>{c.cancel(),a()}},e)}o.ARRAY_TYPE=Do,o.AUTH_ERR_MSG=gt,o.Aabb=fo,o.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Bn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=gi()?t:D,this.scheduler=new t_}send(t,e,i,r,a=!1,c){const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[h]=i);const p=Y(this.globalScope)?void 0:[];return this.target.postMessage({id:h,type:t,hasCallback:!!i,targetMapId:r,mustQueue:a,sourceMapId:this.mapId,data:Fa(e,p)},p),{cancel:()=>{i&&delete this.callbacks[h],this.target.postMessage({id:h,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(e.mustQueue||gi()){const r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),r&&r.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Ms(e.error)):i(null,Ms(e.data)))}else{const i=Y(this.globalScope)?void 0:[],r=e.hasCallback?(c,h)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:c?Fa(c):null,data:Fa(h,i)},i)}:c=>{},a=Ms(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,r);else if(this.parent.getWorkerSource){const c=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,c[0],a.source)[c[1]](a,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Au,o.Color=ir,o.ColorMode=Ns,o.CullFaceMode=ys,o.DEMData=Gu,o.DataConstantProperty=it,o.DedupedRequest=Cf,o.DepthMode=Bl,o.EXTENT=$i,o.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,a=Math.floor(t.x),c=Math.floor((t.x-a)*r),h=Math.floor(t.y*r),p=this.findDEMTileFor(new mo(i,a,i,c,h));return!(!p||!p.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const a=r.getSource().maxzoom,c=1<<a,h=Math.floor(t.x),p=t.x-h,g=new mo(a,h,a,Math.floor(p*c),Math.floor(t.y*c)),_=this.findDEMTileFor(g);if(!_||!_.dem)return e;const w=_.dem,S=1<<_.tileID.canonical.z,A=(p*S-_.tileID.canonical.x)*w.dim,R=(t.y*S-_.tileID.canonical.y)*w.dim,F=Math.floor(A),H=Math.floor(R);return(i?this.exaggeration():1)*on(on(w.get(F,H),w.get(F,H+1),R-H),on(w.get(F+1,H),w.get(F+1,H+1),R-H),A-F)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new vl(t.wrap+(t.canonical.x+e/$i)/r,(t.canonical.y+i/$i)/r))}getAtTileOffsetFunc(t,e,i,r){return a=>{const c=this.getAtTileOffset(t,a.x,a.y),h=r.upVector(t.canonical,a.x,a.y);return Go(h,h,c*r.upVectorScale(t.canonical,e,i).metersToTile),h}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const a=qu.create(this,t,r);return!!a&&(e.forEach(c=>{c[2]=this.exaggeration()*a.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,a=1<<t.canonical.z-r.canonical.z;let c=t.canonical.x/a-r.canonical.x,h=t.canonical.y/a-r.canonical.y,p=0;for(let g=0;g<t.canonical.z-r.canonical.z&&!i.leaves[p];g++){c*=2,h*=2;const _=2*Math.floor(h)+Math.floor(c);p=i.childOffsets[p]+_,c%=1,h%=1}return{min:this.exaggeration()*i.minimums[p],max:this.exaggeration()*i.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Yr,o.EvaluationParameters=Te,o.Event=bn,o.Evented=Kr,o.FillExtrusionBucket=gc,o.Frustum=hh,o.FrustumCorners=uh,o.GLOBE_METERS_TO_ECEF=Dh,o.GLOBE_RADIUS=ia,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new cn,i=new ro,r=65;for(let a=0;a<r;a++)for(let c=0;c<r;c++)e.emplaceBack(c,a);this._gridSegments=[];for(let a=0,c=0;a<Ll.length;a++){const h=Ll[a];for(let g=0;g<h;g++)for(let _=0;_<64;_++){const w=g*r+_;i.emplaceBack(w+1,w,w+r),i.emplaceBack(w+r,w+r+1,w+1)}const p=64*h*2;this._gridSegments.push(wr.simpleSegment(0,c,(h+1)*r,p)),c+=p}this._gridBuffer=t.createVertexBuffer(e,Tc.members),this._gridIndexBuffer=t.createIndexBuffer(i,!0)}_createPoles(t){const e=new ro;for(let a=0;a<=64;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new es,r=new es;this._poleSegments=[];for(let a=0,c=0;a<5;a++){const h=360/(1<<a);i.emplaceBack(0,-ia,0,.5,0),r.emplaceBack(0,-ia,0,.5,1);for(let p=0;p<=64;p++){const g=p/64,_=on(0,h,g),[w,S,A]=zl(Og,Rg,_,ia);i.emplaceBack(w,S,A,g,0),r.emplaceBack(w,S,A,g,1)}this._poleSegments.push(wr.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,qp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,qp,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new Vo,r=64,a=r+1;this._wireframeSegments=[];for(let c=0,h=0;c<Ll.length;c++){const p=Ll[c];for(let _=0;_<p;_++)for(let w=0;w<r;w++){const S=_*a+w;i.emplaceBack(S,S+1),i.emplaceBack(S,S+a),i.emplaceBack(S,S+a+1)}const g=p*r*3;this._wireframeSegments.push(wr.simpleSegment(0,h,(p+1)*a,g)),h+=g}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=Il,o.ImagePosition=Eh,o.LivePerformanceUtils=St,o.LngLat=Sn,o.LngLatBounds=xa,o.LocalGlyphMode=Ch,o.MAX_MERCATOR_LATITUDE=Ls,o.MercatorCoordinate=vl,o.ONE_EM=24,o.OverscaledTileID=mo,o.PerformanceMarkers=et,o.Properties=Zt,o.RGBAImage=Po,o.Ray=ch,o.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ie,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!_t(t))return t;const i=xi(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!_t(t))return t;const i=xi(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!_t(t))return t;const a=xi(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),r&&a.params.push(`worldview=${r}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const a=xi(t);return _t(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||r)):(a.path+=`${e}${i}`,pi(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!_t(t))return t;const r=xi(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${O.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${k.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${k.TILE_URL_VERSION}${r.path}`);const a=this._customAccessToken||function(c){for(const h of c){const p=h.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(r.params)||k.ACCESS_TOKEN;return k.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,a)}canonicalizeTileURL(t,e){const i=xi(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${k.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${k.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(c=>!c.match(/^access_token=/))),a.length&&(r+=`?${a.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&_t(e),r=[];for(const a of t.tiles||[])ft(a)?r.push(this.canonicalizeTileURL(a,i)):r.push(a);return r}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=xi(k.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!k.REQUIRE_ACCESS_TOKEN)return pi(t);if(e=e||k.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>-1===a.indexOf("access_token")),t.params.push(`access_token=${e||""}`),pi(t)}},o.ResourceType=Ce,o.SegmentVector=wr,o.SourceCache=Ka,o.StencilMode=jh,o.StructArrayLayout1ui2=tc,o.StructArrayLayout2f1f2i16=ho,o.StructArrayLayout2i4=cn,o.StructArrayLayout2ui4=Vo,o.StructArrayLayout3f12=jo,o.StructArrayLayout3ui6=ro,o.StructArrayLayout4i8=zn,o.StructArrayLayout5f20=es,o.Texture=Dc,o.Tile=Nh,o.Transitionable=ut,o.Uniform1f=uu,o.Uniform1i=class extends Xs{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends Xs{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends Xs{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=gd,o.UniformColor=_d,o.UniformMatrix2f=class extends Xs{constructor(t){super(t),this.current=Uf}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},o.UniformMatrix3f=class extends Xs{constructor(t){super(t),this.current=Nf}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},o.UniformMatrix4f=class extends Xs{constructor(t){super(t),this.current=Ff}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=dp,o.ValidationError=ui,o.VectorTileFeature=Eu,o.VectorTileWorkerSource=class extends Kr{constructor(t,e,i,r,a){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=a||Mf,this.loading={},this.loaded={},this.deduped=new Cf(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,a=r&&r.collectResourceTiming,c=this.loading[i]=new s_(t);c.abort=this.loadVectorData(t,(h,p)=>{const g=!this.loading[i];if(delete this.loading[i],g||h||!p)return c.status="done",g||(this.loaded[i]=c),e(h);const _=p.rawData,w={};p.expires&&(w.expires=p.expires),p.cacheControl&&(w.cacheControl=p.cacheControl),c.vectorTile=p.vectorTile||new xh(new xc(_));const S=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,R)=>{if(A||!R)return e(A);const F={};if(a){const H=Mi(r);H.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(H)))}e(null,Pt({rawTileData:_.slice(0)},R,w,F))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[i]=c})}reloadTile(t,e){const i=this.loaded,r=t.uid,a=this;if(i&&i[r]){const c=i[r];c.showCollisionBoxes=t.showCollisionBoxes,c.enableTerrain=!!t.enableTerrain,c.projection=t.projection,c.tileTransform=Ya(t.tileID.canonical,t.projection);const h=(p,g)=>{const _=c.reloadCallback;_&&(delete c.reloadCallback,c.parse(c.vectorTile,a.layerIndex,this.availableImages,a.actor,_)),e(p,g)};"parsing"===c.status?c.reloadCallback=h:"done"===c.status&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,h):h())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},o.WritingMode=qo,o.ZoomHistory=Xc,o.add=Js,o.addDynamicAttributes=ju,o.adjoint=function(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],h=e[4],p=e[5],g=e[6],_=e[7],w=e[8];return t[0]=h*w-p*_,t[1]=a*_-r*w,t[2]=r*p-a*h,t[3]=p*g-c*w,t[4]=i*w-a*g,t[5]=a*c-i*p,t[6]=c*_-h*g,t[7]=r*g-i*_,t[8]=i*h-r*c,t},o.asyncAll=mi,o.bezier=$t,o.bindAll=Bn,o.boundsAttributes=hf,o.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const a=Bi(r-1,-1,t.length-1),c=Bi(r+1,-1,t.length-1),h=t[r],p=t[c],g=t[a].sub(h).unit(),_=p.sub(h).unit(),w=_.angleWithSep(g.x,g.y),S=g.add(_).unit().mult(-1*e/Math.sin(w/2));i.push(h.add(S))}return i},o.cacheEntryPossiblyAdded=function(t){ve++,ve>Mt&&(t.getActor().send("enforceCacheSizeLimit",Rt),ve=0)},o.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,a=Kp(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return bl(a,a,zh(Rs(e)))},o.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:a}=t._center;return Kp(e,i,t.worldSize,r,a)},o.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/ts(1,t.center.lat),r=zs(new Float64Array(16));return nc(r,r,[t.point.x,t.point.y,0]),Za(r,r,[i,i,e]),Float32Array.from(r)},o.circumferenceAtLatitude=Ku,o.clamp=qt,o.clearTileCache=function(t){if(!jt())return;const e=D.caches.delete($e);t&&e.catch(t).then(()=>t())},o.clipLine=Bp,o.clone=function(t){var e=new Do(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=vn,o.collisionCircleLayout=eg,o.config=k,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new Do(16);return Do!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=Dd,o.createExpression=ls,o.createLayout=Ht,o.createStyleLayer=function(t){return"custom"===t.type?new Kg(t):new Qg[t.type](t)},o.cross=lh,o.degToRad=xt,o.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},o.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.dot=is,o.earthRadius=du,o.ease=li,o.easeCubicInOut=fi,o.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),a=Math.atan2(t,i),c=.5*Math.PI-Math.acos(-e/r);return new Sn(Wt(a),Wt(c))},o.emitValidationErrors=Xl,o.endsWith=yn,o.enforceCacheSizeLimit=function(t){Lt(),Ge&&Ge.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},o.evaluateSizeForFeature=Mu,o.evaluateSizeForZoom=Al,o.evaluateVariableOffset=Vp,o.evented=_e,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=gn,o.exported$1=O,o.extend=Pt,o.extend$1=_r,o.fillExtrusionHeightLift=cp,o.filterObject=Jn,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var i=e[0],r=e[1],a=e[2],c=e[3],h=i+i,p=r+r,g=a+a,_=i*h,w=r*h,S=r*p,A=a*h,R=a*p,F=a*g,H=c*h,Q=c*p,we=c*g;return t[0]=1-S-F,t[1]=w+we,t[2]=A-Q,t[3]=0,t[4]=w-we,t[5]=1-_-F,t[6]=R+H,t[7]=0,t[8]=A+Q,t[9]=R-H,t[10]=1-_-S,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=Ld,o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Nt[e]},o.getAABBPointSquareDist=function(t,e,i){let r=0;for(let a=0;a<2;++a){const c=i?i[a]:0;t[a]>c&&(r+=(t[a]-c)*(t[a]-c)),e[a]<c&&(r+=(c-e[a])*(c-e[a]))}return r},o.getAnchorAlignment=Ah,o.getAnchorJustification=kh,o.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,a=-1/0;for(const c of t)e=Math.min(e,c.x),i=Math.min(i,c.y),r=Math.max(r,c.x),a=Math.max(a,c.y);return{min:new ne(e,i),max:new ne(r,a)}},o.getColumn=oe,o.getGridMatrix=function(t,e,i,r){const a=e.getNorth(),c=e.getSouth(),h=e.getWest(),p=e.getEast(),g=1<<t.z,_=p-h,w=a-c,S=_/64,A=-w/Ll[i],R=[0,S,0,A,0,0,a,h,0];if(t.z>0){const F=180/r;Pd(R,R,[F/_+1,0,0,0,F/w+1,0,-.5*F/S,.5*F/A,1])}return R[2]=g,R[5]=t.x,R[8]=t.y,R},o.getImage=qe,o.getJSON=function(t,e){return Bt(Pt(t,{type:"json"}),e)},o.getLatitudinalLod=function(t){const e=80.051129;t=qt(t,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(xt(t))),3);return Math.round(i*(Ll.length-1))},o.getMapSessionAPI=He,o.getPerformanceMeasurement=Mi,o.getProjection=sf,o.getRTLTextPluginStatus=he,o.getReferrer=vt,o.getTilePoint=function(t,{x:e,y:i},r=0){return new ne(((e-r)*t.scale-t.x)*$i,(i*t.scale-t.y)*$i)},o.getTileVec3=function(t,e,i=0){return wl(((e.x-i)*t.scale-t.x)*$i,(e.y*t.scale-t.y)*$i,xd(e.z,e.y))},o.getVideo=function(t,e){const i=D.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const a=D.document.createElement("source");si(t[r])||(i.crossOrigin="Anonymous"),a.src=t[r],i.appendChild(a)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=zs(new Float64Array(16));return bl(i,t.pixelMatrix,t.globeMatrix),Tr(e,e,i),new ne(e[0],e[1])},o.globeDenormalizeECEF=zh,o.globeECEFOrigin=function(t,e){const i=[0,0,0];return Tr(i,i,Ac(Rs(e.canonical))),Tr(i,i,t),i},o.globeNormalizeECEF=Ac,o.globePixelsToTileUnits=function(t,e){return $i/(512*Math.pow(2,t))*Ru(Rs(e))},o.globePoleMatrixForTile=function(t,e,i){const r=zs(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return _u(r,i.globeMatrix,a),Float32Array.from(r)},o.globeTileBounds=Rs,o.globeTiltAtLngLat=Jp,o.globeToMercatorTransition=Ol,o.globeUseCustomAntiAliasing=function(t,e,i){const r=Ol(i.zoom),a=t.style.map._antialias,c=!!e.extStandardDerivatives,h=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!a&&!h&&c},o.identity=zs,o.identity$1=jd,o.invert=rh,o.isFullscreen=function(){return!!D.document.fullscreenElement||!!D.document.webkitFullscreenElement},o.isLngLatBehindGlobe=function(t,e){return Jp(t,e)>Math.PI/2*1.01},o.isMapAuthenticated=function(t){return je.has(t)},o.isMapboxURL=_t,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Y(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Wr,o.latLngToECEF=Ec,o.len=nm,o.length=rc,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.lngFromMercatorX=$o,o.loadVectorTile=Mf,o.makeRequest=Bt,o.mapValue=function(t,e,i,r,a){return qt((t-e)/(i-e)*(a-r)+r,r,a)},o.mercatorScale=bd,o.mercatorXfromLng=Ds,o.mercatorYfromLat=Ps,o.mercatorZfromAltitude=ts,o.mul=tm,o.mul$1=im,o.multiply=bl,o.multiply$1=Pd,o.multiply$2=Rd,o.nextPowerOfTwo=Si,o.normalize=po,o.normalize$1=rm,o.normalize$2=Nd,o.number=on,o.ortho=function(t,e,i,r,a,c,h){var p=1/(e-i),g=1/(r-a),_=1/(c-h);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*_,t[11]=0,t[12]=(e+i)*p,t[13]=(a+r)*g,t[14]=(h+c)*_,t[15]=1,t},o.pbf=xc,o.perspective=function(t,e,i,r,a){var c,h=1/Math.tan(e/2);return t[0]=h/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(t[10]=(a+r)*(c=1/(r-a)),t[14]=2*a*r*c):(t[10]=-1,t[14]=-2*r),t},o.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const a=e[r];a in t&&(i[a]=t[a])}return i},o.plugin=ze,o.pointGeometry=ne,o.polygonContainsPoint=qa,o.polygonIntersectsBox=Md,o.polygonIntersectsPolygon=Ed,o.polygonizeBounds=function(t,e,i=0,r=!0){const a=new ne(i,i),c=t.sub(a),h=e.add(a),p=[c,new ne(h.x,c.y),h,new ne(c.x,h.y)];return r&&p.push(c.clone()),p},o.posAttributes=Tc,o.postMapLoadEvent=me,o.postPerformanceEvent=De,o.postTurnstileEvent=U,o.potpack=Th,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=Wt,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:ie,pluginURL:ge}),_e.on("pluginStateChange",t),t},o.removeAuthState=function(t){je.delete(t)},o.renderColorRamp=ph,o.resample=wd,o.rotateX=oh,o.rotateX$1=Vd,o.rotateY=_u,o.rotateY$1=$d,o.rotateZ=function(t,e,i){var r=Math.sin(i),a=Math.cos(i),c=e[0],h=e[1],p=e[2],g=e[3],_=e[4],w=e[5],S=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a+_*r,t[1]=h*a+w*r,t[2]=p*a+S*r,t[3]=g*a+A*r,t[4]=_*a-c*r,t[5]=w*a-h*r,t[6]=S*a-p*r,t[7]=A*a-g*r,t},o.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],a=e[1],c=e[2],h=e[3],p=Math.sin(i),g=Math.cos(i);return t[0]=r*g+a*p,t[1]=a*g-r*p,t[2]=c*g+h*p,t[3]=h*g-c*p,t},o.scale=Za,o.scale$1=Fd,o.scale$2=Go,o.scaleAndAdd=ac,o.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},o.setCacheLimits=function(t,e){Rt=t,Mt=e},o.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.setRTLTextPlugin=function(t,e,i=!1){if(ie===z||ie===V||ie===K)throw new Error("setRTLTextPlugin cannot be called multiple times.");ge=gn.resolveURL(t),ie=z,fe=e,ee(),i||Le()},o.smoothstep=Ri,o.spec=ct,o.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},o.storeAuthState=function(t,e){e?je.add(t):je.delete(t)},o.sub=ms,o.subtract=ah,o.symbolSize=tg,o.tileAABB=function(t,e,i,r,a,c,h,p,g){if("globe"===g.name)return function zg(t,e,i){const r=e/t.worldSize,a=t.globeMatrix;if(i.z<=1){const rt=Rs(i).getCorners();return Xp(rt,a,r),fo.fromPoints(rt)}const c=Ou(i),h=Lh(c);Xp(h,a,r);const p=Number.MAX_VALUE,g=[-p,-p,-p],_=[p,p,p];if(c.contains(t.center)){for(const Ot of h)oc(_,_,Ot),sc(g,g,Ot);g[2]=0;const rt=t.point,yt=[rt.x*r,rt.y*r,0];return oc(_,_,yt),sc(g,g,yt),new fo(_,g)}const w=[a[12]*r,a[13]*r,a[14]*r],S=c.getCenter(),A=qt(t.center.lat,-85.051129,Ls),R=qt(S.lat,-85.051129,Ls),F=Ds(t.center.lng),H=Ps(A);let Q=F-Ds(S.lng);const we=H-Ps(R);Q>.5?Q-=1:Q<-.5&&(Q+=1);let Oe=0;Math.abs(Q)>Math.abs(we)?Oe=Q>=0?1:3:(Oe=we>=0?0:2,ac(w,w,[a[4]*r,a[5]*r,a[6]*r],-Math.sin(xt(we>=0?c.getSouth():c.getNorth()))*ia));const be=h[Oe],ke=h[(Oe+1)%4],Ue=new Lg(be,ke,w),Pe=[Ph(Ue,0)||be[0],Ph(Ue,1)||be[1],Ph(Ue,2)||be[2]],at=Ol(t.zoom);if(at>0){const rt=function({x:Ot,y:ht,z:Tt},Ct,Dt,Ft,dt){const ii=1/(1<<Tt);let zi=Ot*ii,ai=zi+ii,_i=ht*ii,ri=_i+ii,Oi=0;const en=(zi+ai)/2-Ft;return en>.5?Oi=-1:en<-.5&&(Oi=1),zi=((zi+Oi)*Ct-(Ft*=Ct))*Dt+Ft,ai=((ai+Oi)*Ct-Ft)*Dt+Ft,_i=(_i*Ct-(dt*=Ct))*Dt+dt,ri=(ri*Ct-dt)*Dt+dt,[[zi,ri,0],[ai,ri,0],[ai,_i,0],[zi,_i,0]]}(i,e,t._pixelsPerMercatorPixel,F,H);for(let Ot=0;Ot<h.length;Ot++)Xa(h[Ot],rt[Ot],at);const yt=Js([],rt[Oe],rt[(Oe+1)%4]);Go(yt,yt,.5),Xa(Pe,yt,at)}for(const rt of h)oc(_,_,rt),sc(g,g,rt);return _[2]=Math.min(be[2],ke[2]),oc(_,_,Pe),sc(g,g,Pe),new fo(_,g)}(t,e,new Au(i,r,a));const _=Ya({z:i,x:r,y:a},g);return new fo([(c+_.x/_.scale)*e,e*(_.y/_.scale),h],[(c+_.x2/_.scale)*e,e*(_.y2/_.scale),p])},o.tileCornersToBounds=Ou,o.tileTransform=Ya,o.transformMat3=function(t,e,i){var r=e[0],a=e[1],c=e[2];return t[0]=r*i[0]+a*i[3]+c*i[6],t[1]=r*i[1]+a*i[4]+c*i[7],t[2]=r*i[2]+a*i[5]+c*i[8],t},o.transformMat4=Tr,o.transformMat4$1=Ha,o.transformQuat=Bd,o.transitionTileAABBinECEF=Wp,o.translate=nc,o.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=ce,o.uniqueId=ji,o.updateGlobeVertexNormal=function(t,e,i,r,a){const c=5*e+2;t.float32[c+0]=i,t.float32[c+1]=r,t.float32[c+2]=a},o.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=t=>ds(Ra(t)),o.validateFog=t=>ds(qc(t)),o.validateLayer=t=>ds(ql(t)),o.validateLight=t=>ds(Ba(t)),o.validateSource=t=>ds(ul(t)),o.validateStyle=Zc,o.validateTerrain=t=>ds(Zl(t)),o.values=tn,o.vectorTile=Tu,o.version=N,o.warnOnce=Ji,o.window=D,o.wrap=Bi}),$(0,function(o){function D(re){if("number"==typeof re||"boolean"==typeof re||"string"==typeof re||null==re)return JSON.stringify(re);if(Array.isArray(re)){let Z="[";for(const me of re)Z+=`${D(me)},`;return`${Z}]`}let U="{";for(const Z of Object.keys(re).sort())U+=`${Z}:${D(re[Z])},`;return`${U}}`}function N(re){let U="";for(const Z of o.refProperties)U+=`/${D(re[Z])}`;return U}class j{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,Z){for(const xe of U)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=o.createStyleLayer(xe)).compileFilter(),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of Z)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const me=function(xe,De){const Xe={};for(let je=0;je<xe.length;je++){const et=De&&De[xe[je].id]||N(xe[je]);De&&(De[xe[je].id]=et);let St=Xe[et];St||(St=Xe[et]=[]),St.push(xe[je])}const He=[];for(const je in Xe)He.push(Xe[je]);return He}(o.values(this._layerConfigs),this.keyCache);for(const xe of me){const De=xe.map(oi=>this._layers[oi.id]),Xe=De[0];if("none"===Xe.visibility)continue;const He=Xe.source||"";let je=this.familiesBySource[He];je||(je=this.familiesBySource[He]={});const et=Xe.sourceLayer||"_geojsonTileLayer";let St=je[et];St||(St=je[et]=[]),St.push(De)}}}class k{loadTile(U,Z){const{uid:me,encoding:xe,rawImageData:De,padding:Xe,buildQuadTree:He}=U,je=o.window.ImageBitmap&&De instanceof o.window.ImageBitmap?this.getImageData(De,Xe):De;Z(null,new o.DEMData(me,je,xe,Xe<1,He))}getImageData(U,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const me=this.offscreenCanvasContext.getImageData(-Z,-Z,U.width+2*Z,U.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}var O=function re(U,Z){var me,xe=U&&U.type;if("FeatureCollection"===xe)for(me=0;me<U.features.length;me++)re(U.features[me],Z);else if("GeometryCollection"===xe)for(me=0;me<U.geometries.length;me++)re(U.geometries[me],Z);else if("Feature"===xe)re(U.geometry,Z);else if("Polygon"===xe)I(U.coordinates,Z);else if("MultiPolygon"===xe)for(me=0;me<U.coordinates.length;me++)I(U.coordinates[me],Z);return U};function I(re,U){if(0!==re.length){X(re[0],U);for(var Z=1;Z<re.length;Z++)X(re[Z],!U)}}function X(re,U){for(var Z=0,me=0,xe=0,De=re.length,Xe=De-1;xe<De;Xe=xe++){var He=(re[xe][0]-re[Xe][0])*(re[Xe][1]+re[xe][1]),je=Z+He;me+=Math.abs(Z)>=Math.abs(He)?Z-je+He:He-je+Z,Z=je}Z+me>=0!=!!U&&re.reverse()}const le=o.VectorTileFeature.prototype.toGeoJSON;class te{constructor(U){this._feature=U,this.extent=o.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(1===this._feature.type){const U=[];for(const Z of this._feature.geometry)U.push([new o.pointGeometry(Z[0],Z[1])]);return U}{const U=[];for(const Z of this._feature.geometry){const me=[];for(const xe of Z)me.push(new o.pointGeometry(xe[0],xe[1]));U.push(me)}return U}}toGeoJSON(U,Z,me){return le.call(this,U,Z,me)}}class Be{constructor(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=U.length,this._features=U}feature(U){return new te(this._features[U])}}var Ie={exports:{}},Se=o.pointGeometry,Ke=o.vectorTile.VectorTileFeature,ne=mt;function mt(re,U){this.options=U||{},this.features=re,this.length=re.length}function C(re,U){this.id="number"==typeof re.id?re.id:void 0,this.type=re.type,this.rawGeometry=1===re.type?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=U||4096}mt.prototype.feature=function(re){return new C(this.features[re],this.options.extent)},C.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var U=0;U<re.length;U++){for(var Z=re[U],me=[],xe=0;xe<Z.length;xe++)me.push(new Se(Z[xe][0],Z[xe][1]));this.geometry.push(me)}return this.geometry},C.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,U=1/0,Z=-1/0,me=1/0,xe=-1/0,De=0;De<re.length;De++)for(var Xe=re[De],He=0;He<Xe.length;He++){var je=Xe[He];U=Math.min(U,je.x),Z=Math.max(Z,je.x),me=Math.min(me,je.y),xe=Math.max(xe,je.y)}return[U,me,Z,xe]},C.prototype.toGeoJSON=Ke.prototype.toGeoJSON;var wt=o.pbf,xt=ne;function Wt(re){var U=new wt;return function(Z,me){for(var xe in Z.layers)me.writeMessage(3,Nt,Z.layers[xe])}(re,U),U.finish()}function Nt(re,U){var Z;U.writeVarintField(15,re.version||1),U.writeStringField(1,re.name||""),U.writeVarintField(5,re.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<re.length;Z++)me.feature=re.feature(Z),U.writeMessage(2,fi,me);var xe=me.keys;for(Z=0;Z<xe.length;Z++)U.writeStringField(3,xe[Z]);var De=me.values;for(Z=0;Z<De.length;Z++)U.writeMessage(4,Bi,De[Z])}function fi(re,U){var Z=re.feature;void 0!==Z.id&&U.writeVarintField(1,Z.id),U.writeMessage(2,$t,re),U.writeVarintField(3,Z.type),U.writeMessage(4,Ri,Z)}function $t(re,U){var Z=re.feature,me=re.keys,xe=re.values,De=re.keycache,Xe=re.valuecache;for(var He in Z.properties){var je=Z.properties[He],et=De[He];if(null!==je){void 0===et&&(me.push(He),De[He]=et=me.length-1),U.writeVarint(et);var St=typeof je;"string"!==St&&"boolean"!==St&&"number"!==St&&(je=JSON.stringify(je));var oi=St+":"+je,kt=Xe[oi];void 0===kt&&(xe.push(je),Xe[oi]=kt=xe.length-1),U.writeVarint(kt)}}}function li(re,U){return(U<<3)+(7&re)}function qt(re){return re<<1^re>>31}function Ri(re,U){for(var Z=re.loadGeometry(),me=re.type,xe=0,De=0,Xe=Z.length,He=0;He<Xe;He++){var je=Z[He],et=1;1===me&&(et=je.length),U.writeVarint(li(1,et));for(var St=3===me?je.length-1:je.length,oi=0;oi<St;oi++){1===oi&&1!==me&&U.writeVarint(li(2,St-1));var kt=je[oi].x-xe,Mi=je[oi].y-De;U.writeVarint(qt(kt)),U.writeVarint(qt(Mi)),xe+=kt,De+=Mi}3===me&&U.writeVarint(li(7,1))}}function Bi(re,U){var Z=typeof re;"string"===Z?U.writeStringField(1,re):"boolean"===Z?U.writeBooleanField(7,re):"number"===Z&&(re%1!=0?U.writeDoubleField(3,re):re<0?U.writeSVarintField(6,re):U.writeVarintField(5,re))}function mi(re,U,Z,me,xe,De){if(xe-me<=Z)return;const Xe=me+xe>>1;tn(re,U,Xe,me,xe,De%2),mi(re,U,Z,me,Xe-1,De+1),mi(re,U,Z,Xe+1,xe,De+1)}function tn(re,U,Z,me,xe,De){for(;xe>me;){if(xe-me>600){const et=xe-me+1,St=Z-me+1,oi=Math.log(et),kt=.5*Math.exp(2*oi/3),Mi=.5*Math.sqrt(oi*kt*(et-kt)/et)*(St-et/2<0?-1:1);tn(re,U,Z,Math.max(me,Math.floor(Z-St*kt/et+Mi)),Math.min(xe,Math.floor(Z+(et-St)*kt/et+Mi)),De)}const Xe=U[2*Z+De];let He=me,je=xe;for(Pt(re,U,me,Z),U[2*xe+De]>Xe&&Pt(re,U,me,xe);He<je;){for(Pt(re,U,He,je),He++,je--;U[2*He+De]<Xe;)He++;for(;U[2*je+De]>Xe;)je--}U[2*me+De]===Xe?Pt(re,U,me,je):(je++,Pt(re,U,je,xe)),je<=Z&&(me=je+1),Z<=je&&(xe=je-1)}}function Pt(re,U,Z,me){wi(re,Z,me),wi(U,2*Z,2*me),wi(U,2*Z+1,2*me+1)}function wi(re,U,Z){const me=re[U];re[U]=re[Z],re[Z]=me}function ji(re,U,Z,me){const xe=re-Z,De=U-me;return xe*xe+De*De}Ie.exports=Wt,Ie.exports.fromVectorTileJs=Wt,Ie.exports.fromGeojsonVt=function(re,U){U=U||{};var Z={};for(var me in re)Z[me]=new xt(re[me].features,U),Z[me].name=me,Z[me].version=U.version,Z[me].extent=U.extent;return Wt({layers:Z})},Ie.exports.GeoJSONWrapper=xt;const pt=re=>re[0],Si=re=>re[1];class mn{constructor(U,Z=pt,me=Si,xe=64,De=Float64Array){this.nodeSize=xe,this.points=U;const Xe=U.length<65536?Uint16Array:Uint32Array,He=this.ids=new Xe(U.length),je=this.coords=new De(2*U.length);for(let et=0;et<U.length;et++)He[et]=et,je[2*et]=Z(U[et]),je[2*et+1]=me(U[et]);mi(He,je,xe,0,He.length-1,0)}range(U,Z,me,xe){return function(De,Xe,He,je,et,St,oi){const kt=[0,De.length-1,0],Mi=[];let Ti,bi;for(;kt.length;){const Di=kt.pop(),Qi=kt.pop(),gn=kt.pop();if(Qi-gn<=oi){for(let bn=gn;bn<=Qi;bn++)Ti=Xe[2*bn],bi=Xe[2*bn+1],Ti>=He&&Ti<=et&&bi>=je&&bi<=St&&Mi.push(De[bn]);continue}const Pi=Math.floor((gn+Qi)/2);Ti=Xe[2*Pi],bi=Xe[2*Pi+1],Ti>=He&&Ti<=et&&bi>=je&&bi<=St&&Mi.push(De[Pi]);const xn=(Di+1)%2;(0===Di?He<=Ti:je<=bi)&&(kt.push(gn),kt.push(Pi-1),kt.push(xn)),(0===Di?et>=Ti:St>=bi)&&(kt.push(Pi+1),kt.push(Qi),kt.push(xn))}return Mi}(this.ids,this.coords,U,Z,me,xe,this.nodeSize)}within(U,Z,me){return function(xe,De,Xe,He,je,et){const St=[0,xe.length-1,0],oi=[],kt=je*je;for(;St.length;){const Mi=St.pop(),Ti=St.pop(),bi=St.pop();if(Ti-bi<=et){for(let xn=bi;xn<=Ti;xn++)ji(De[2*xn],De[2*xn+1],Xe,He)<=kt&&oi.push(xe[xn]);continue}const Di=Math.floor((bi+Ti)/2),Qi=De[2*Di],gn=De[2*Di+1];ji(Qi,gn,Xe,He)<=kt&&oi.push(xe[Di]);const Pi=(Mi+1)%2;(0===Mi?Xe-je<=Qi:He-je<=gn)&&(St.push(bi),St.push(Di-1),St.push(Pi)),(0===Mi?Xe+je>=Qi:He+je>=gn)&&(St.push(Di+1),St.push(Ti),St.push(Pi))}return oi}(this.ids,this.coords,U,Z,me,this.nodeSize)}}const Bn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},yn=Math.fround||(En=new Float32Array(1),re=>(En[0]=+re,En[0]));var En;class Jn{constructor(U){this.options=lt(Object.create(Bn),U),this.trees=new Array(this.options.maxZoom+1)}load(U){const{log:Z,minZoom:me,maxZoom:xe,nodeSize:De}=this.options;Z&&console.time("total time");const Xe=`prepare ${U.length} points`;Z&&console.time(Xe),this.points=U;let He=[];for(let je=0;je<U.length;je++)U[je].geometry&&He.push(Fn(U[je],je));this.trees[xe+1]=new mn(He,Y,ue,De,Float32Array),Z&&console.timeEnd(Xe);for(let je=xe;je>=me;je--){const et=+Date.now();He=this._cluster(He,je),this.trees[je]=new mn(He,Y,ue,De,Float32Array),Z&&console.log("z%d: %d clusters in %dms",je,He.length,+Date.now()-et)}return Z&&console.timeEnd("total time"),this}getClusters(U,Z){let me=((U[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,U[1]));let De=180===U[2]?180:((U[2]+180)%360+360)%360-180;const Xe=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)me=-180,De=180;else if(me>De){const St=this.getClusters([me,xe,180,Xe],Z),oi=this.getClusters([-180,xe,De,Xe],Z);return St.concat(oi)}const He=this.trees[this._limitZoom(Z)],je=He.range(Xi(me),gi(Xe),Xi(De),gi(xe)),et=[];for(const St of je){const oi=He.points[St];et.push(oi.numPoints?Ji(oi):this.points[oi.index])}return et}getChildren(U){const Z=this._getOriginId(U),me=this._getOriginZoom(U),xe="No cluster with the specified id.",De=this.trees[me];if(!De)throw new Error(xe);const Xe=De.points[Z];if(!Xe)throw new Error(xe);const He=this.options.radius/(this.options.extent*Math.pow(2,me-1)),je=De.within(Xe.x,Xe.y,He),et=[];for(const St of je){const oi=De.points[St];oi.parentId===U&&et.push(oi.numPoints?Ji(oi):this.points[oi.index])}if(0===et.length)throw new Error(xe);return et}getLeaves(U,Z,me){const xe=[];return this._appendLeaves(xe,U,Z=Z||10,me=me||0,0),xe}getTile(U,Z,me){const xe=this.trees[this._limitZoom(U)],De=Math.pow(2,U),{extent:Xe,radius:He}=this.options,je=He/Xe,et=(me-je)/De,St=(me+1+je)/De,oi={features:[]};return this._addTileFeatures(xe.range((Z-je)/De,et,(Z+1+je)/De,St),xe.points,Z,me,De,oi),0===Z&&this._addTileFeatures(xe.range(1-je/De,et,1,St),xe.points,De,me,De,oi),Z===De-1&&this._addTileFeatures(xe.range(0,et,je/De,St),xe.points,-1,me,De,oi),oi.features.length?oi:null}getClusterExpansionZoom(U){let Z=this._getOriginZoom(U)-1;for(;Z<=this.options.maxZoom;){const me=this.getChildren(U);if(Z++,1!==me.length)break;U=me[0].properties.cluster_id}return Z}_appendLeaves(U,Z,me,xe,De){const Xe=this.getChildren(Z);for(const He of Xe){const je=He.properties;if(je&&je.cluster?De+je.point_count<=xe?De+=je.point_count:De=this._appendLeaves(U,je.cluster_id,me,xe,De):De<xe?De++:U.push(He),U.length===me)break}return De}_addTileFeatures(U,Z,me,xe,De,Xe){for(const He of U){const je=Z[He],et=je.numPoints;let St,oi,kt;if(et)St=Nn(je),oi=je.x,kt=je.y;else{const bi=this.points[je.index];St=bi.properties,oi=Xi(bi.geometry.coordinates[0]),kt=gi(bi.geometry.coordinates[1])}const Mi={type:1,geometry:[[Math.round(this.options.extent*(oi*De-me)),Math.round(this.options.extent*(kt*De-xe))]],tags:St};let Ti;et?Ti=je.id:this.options.generateId?Ti=je.index:this.points[je.index].id&&(Ti=this.points[je.index].id),void 0!==Ti&&(Mi.id=Ti),Xe.features.push(Mi)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,Z){const me=[],{radius:xe,extent:De,reduce:Xe,minPoints:He}=this.options,je=xe/(De*Math.pow(2,Z));for(let et=0;et<U.length;et++){const St=U[et];if(St.zoom<=Z)continue;St.zoom=Z;const oi=this.trees[Z+1],kt=oi.within(St.x,St.y,je),Mi=St.numPoints||1;let Ti=Mi;for(const bi of kt){const Di=oi.points[bi];Di.zoom>Z&&(Ti+=Di.numPoints||1)}if(Ti>Mi&&Ti>=He){let bi=St.x*Mi,Di=St.y*Mi,Qi=Xe&&Mi>1?this._map(St,!0):null;const gn=(et<<5)+(Z+1)+this.points.length;for(const Pi of kt){const xn=oi.points[Pi];if(xn.zoom<=Z)continue;xn.zoom=Z;const bn=xn.numPoints||1;bi+=xn.x*bn,Di+=xn.y*bn,xn.parentId=gn,Xe&&(Qi||(Qi=this._map(St,!0)),Xe(Qi,this._map(xn)))}St.parentId=gn,me.push(vn(bi/Ti,Di/Ti,gn,Ti,Qi))}else if(me.push(St),Ti>1)for(const bi of kt){const Di=oi.points[bi];Di.zoom<=Z||(Di.zoom=Z,me.push(Di))}}return me}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,Z){if(U.numPoints)return Z?lt({},U.properties):U.properties;const me=this.points[U.index].properties,xe=this.options.map(me);return Z&&xe===me?lt({},xe):xe}}function vn(re,U,Z,me,xe){return{x:yn(re),y:yn(U),zoom:1/0,id:Z,parentId:-1,numPoints:me,properties:xe}}function Fn(re,U){const[Z,me]=re.geometry.coordinates;return{x:yn(Xi(Z)),y:yn(gi(me)),zoom:1/0,index:U,parentId:-1}}function Ji(re){return{type:"Feature",id:re.id,properties:Nn(re),geometry:{type:"Point",coordinates:[(U=re.x,360*(U-.5)),Ai(re.y)]}};var U}function Nn(re){const U=re.numPoints,Z=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U;return lt(lt({},re.properties),{cluster:!0,cluster_id:re.id,point_count:U,point_count_abbreviated:Z})}function Xi(re){return re/360+.5}function gi(re){const U=Math.sin(re*Math.PI/180),Z=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Z<0?0:Z>1?1:Z}function Ai(re){const U=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function lt(re,U){for(const Z in U)re[Z]=U[Z];return re}function Y(re){return re.x}function ue(re){return re.y}function oe(re,U,Z,me){for(var xe,De=me,Xe=Z-U>>1,He=Z-U,je=re[U],et=re[U+1],St=re[Z],oi=re[Z+1],kt=U+3;kt<Z;kt+=3){var Mi=$e(re[kt],re[kt+1],je,et,St,oi);if(Mi>De)xe=kt,De=Mi;else if(Mi===De){var Ti=Math.abs(kt-Xe);Ti<He&&(xe=kt,He=Ti)}}De>me&&(xe-U>3&&oe(re,U,xe,me),re[xe+2]=De,Z-xe>3&&oe(re,xe,Z,me))}function $e(re,U,Z,me,xe,De){var Xe=xe-Z,He=De-me;if(0!==Xe||0!==He){var je=((re-Z)*Xe+(U-me)*He)/(Xe*Xe+He*He);je>1?(Z=xe,me=De):je>0&&(Z+=Xe*je,me+=He*je)}return(Xe=re-Z)*Xe+(He=U-me)*He}function Ge(re,U,Z,me){var xe={id:void 0===re?null:re,type:U,geometry:Z,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(De){var Xe=De.geometry,He=De.type;if("Point"===He||"MultiPoint"===He||"LineString"===He)ot(De,Xe);else if("Polygon"===He||"MultiLineString"===He)for(var je=0;je<Xe.length;je++)ot(De,Xe[je]);else if("MultiPolygon"===He)for(je=0;je<Xe.length;je++)for(var et=0;et<Xe[je].length;et++)ot(De,Xe[je][et])}(xe),xe}function ot(re,U){for(var Z=0;Z<U.length;Z+=3)re.minX=Math.min(re.minX,U[Z]),re.minY=Math.min(re.minY,U[Z+1]),re.maxX=Math.max(re.maxX,U[Z]),re.maxY=Math.max(re.maxY,U[Z+1])}function Rt(re,U,Z,me){if(U.geometry){var xe=U.geometry.coordinates,De=U.geometry.type,Xe=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),He=[],je=U.id;if(Z.promoteId?je=U.properties[Z.promoteId]:Z.generateId&&(je=me||0),"Point"===De)Mt(xe,He);else if("MultiPoint"===De)for(var et=0;et<xe.length;et++)Mt(xe[et],He);else if("LineString"===De)jt(xe,He,Xe,!1);else if("MultiLineString"===De){if(Z.lineMetrics){for(et=0;et<xe.length;et++)jt(xe[et],He=[],Xe,!1),re.push(Ge(je,"LineString",He,U.properties));return}Lt(xe,He,Xe,!1)}else if("Polygon"===De)Lt(xe,He,Xe,!0);else{if("MultiPolygon"!==De){if("GeometryCollection"===De){for(et=0;et<U.geometry.geometries.length;et++)Rt(re,{id:je,geometry:U.geometry.geometries[et],properties:U.properties},Z,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(et=0;et<xe.length;et++){var St=[];Lt(xe[et],St,Xe,!0),He.push(St)}}re.push(Ge(je,De,He,U.properties))}}function Mt(re,U){U.push(yi(re[0])),U.push(ve(re[1])),U.push(0)}function jt(re,U,Z,me){for(var xe,De,Xe=0,He=0;He<re.length;He++){var je=yi(re[He][0]),et=ve(re[He][1]);U.push(je),U.push(et),U.push(0),He>0&&(Xe+=me?(xe*et-je*De)/2:Math.sqrt(Math.pow(je-xe,2)+Math.pow(et-De,2))),xe=je,De=et}var St=U.length-3;U[2]=1,oe(U,0,St,Z),U[St+2]=1,U.size=Math.abs(Xe),U.start=0,U.end=U.size}function Lt(re,U,Z,me){for(var xe=0;xe<re.length;xe++){var De=[];jt(re[xe],De,Z,me),U.push(De)}}function yi(re){return re/360+.5}function ve(re){var U=Math.sin(re*Math.PI/180),Z=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Z<0?0:Z>1?1:Z}function Ce(re,U,Z,me,xe,De,Xe,He){if(me/=U,De>=(Z/=U)&&Xe<me)return re;if(Xe<Z||De>=me)return null;for(var je=[],et=0;et<re.length;et++){var St=re[et],oi=St.geometry,kt=St.type,Mi=0===xe?St.minX:St.minY,Ti=0===xe?St.maxX:St.maxY;if(Mi>=Z&&Ti<me)je.push(St);else if(!(Ti<Z||Mi>=me)){var bi=[];if("Point"===kt||"MultiPoint"===kt)We(oi,bi,Z,me,xe);else if("LineString"===kt)vt(oi,bi,Z,me,xe,!1,He.lineMetrics);else if("MultiLineString"===kt)Xt(oi,bi,Z,me,xe,!1);else if("Polygon"===kt)Xt(oi,bi,Z,me,xe,!0);else if("MultiPolygon"===kt)for(var Di=0;Di<oi.length;Di++){var Qi=[];Xt(oi[Di],Qi,Z,me,xe,!0),Qi.length&&bi.push(Qi)}if(bi.length){if(He.lineMetrics&&"LineString"===kt){for(Di=0;Di<bi.length;Di++)je.push(Ge(St.id,kt,bi[Di],St.tags));continue}"LineString"!==kt&&"MultiLineString"!==kt||(1===bi.length?(kt="LineString",bi=bi[0]):kt="MultiLineString"),"Point"!==kt&&"MultiPoint"!==kt||(kt=3===bi.length?"Point":"MultiPoint"),je.push(Ge(St.id,kt,bi,St.tags))}}}return je.length?je:null}function We(re,U,Z,me,xe){for(var De=0;De<re.length;De+=3){var Xe=re[De+xe];Xe>=Z&&Xe<=me&&(U.push(re[De]),U.push(re[De+1]),U.push(re[De+2]))}}function vt(re,U,Z,me,xe,De,Xe){for(var He,je,et=Bt(re),St=0===xe?W:ye,oi=re.start,kt=0;kt<re.length-3;kt+=3){var Mi=re[kt],Ti=re[kt+1],bi=re[kt+2],Di=re[kt+3],Qi=re[kt+4],gn=0===xe?Mi:Ti,Pi=0===xe?Di:Qi,xn=!1;Xe&&(He=Math.sqrt(Math.pow(Mi-Di,2)+Math.pow(Ti-Qi,2))),gn<Z?Pi>Z&&(je=St(et,Mi,Ti,Di,Qi,Z),Xe&&(et.start=oi+He*je)):gn>me?Pi<me&&(je=St(et,Mi,Ti,Di,Qi,me),Xe&&(et.start=oi+He*je)):si(et,Mi,Ti,bi),Pi<Z&&gn>=Z&&(je=St(et,Mi,Ti,Di,Qi,Z),xn=!0),Pi>me&&gn<=me&&(je=St(et,Mi,Ti,Di,Qi,me),xn=!0),!De&&xn&&(Xe&&(et.end=oi+He*je),U.push(et),et=Bt(re)),Xe&&(oi+=He)}var bn=re.length-3;Mi=re[bn],Ti=re[bn+1],bi=re[bn+2],(gn=0===xe?Mi:Ti)>=Z&&gn<=me&&si(et,Mi,Ti,bi),bn=et.length-3,De&&bn>=3&&(et[bn]!==et[0]||et[bn+1]!==et[1])&&si(et,et[0],et[1],et[2]),et.length&&U.push(et)}function Bt(re){var U=[];return U.size=re.size,U.start=re.start,U.end=re.end,U}function Xt(re,U,Z,me,xe,De){for(var Xe=0;Xe<re.length;Xe++)vt(re[Xe],U,Z,me,xe,De,!1)}function si(re,U,Z,me){re.push(U),re.push(Z),re.push(me)}function W(re,U,Z,me,xe,De){var Xe=(De-U)/(me-U);return re.push(De),re.push(Z+(xe-Z)*Xe),re.push(1),Xe}function ye(re,U,Z,me,xe,De){var Xe=(De-Z)/(xe-Z);return re.push(U+(me-U)*Xe),re.push(De),re.push(1),Xe}function Me(re,U){for(var Z=[],me=0;me<re.length;me++){var xe,De=re[me],Xe=De.type;if("Point"===Xe||"MultiPoint"===Xe||"LineString"===Xe)xe=qe(De.geometry,U);else if("MultiLineString"===Xe||"Polygon"===Xe){xe=[];for(var He=0;He<De.geometry.length;He++)xe.push(qe(De.geometry[He],U))}else if("MultiPolygon"===Xe)for(xe=[],He=0;He<De.geometry.length;He++){for(var je=[],et=0;et<De.geometry[He].length;et++)je.push(qe(De.geometry[He][et],U));xe.push(je)}Z.push(Ge(De.id,Xe,xe,De.tags))}return Z}function qe(re,U){var Z=[];Z.size=re.size,void 0!==re.start&&(Z.start=re.start,Z.end=re.end);for(var me=0;me<re.length;me+=3)Z.push(re[me]+U,re[me+1],re[me+2]);return Z}function gt(re,U){if(re.transformed)return re;var Z,me,xe,De=1<<re.z,Xe=re.x,He=re.y;for(Z=0;Z<re.features.length;Z++){var je=re.features[Z],et=je.geometry,St=je.type;if(je.geometry=[],1===St)for(me=0;me<et.length;me+=2)je.geometry.push(_t(et[me],et[me+1],U,De,Xe,He));else for(me=0;me<et.length;me++){var oi=[];for(xe=0;xe<et[me].length;xe+=2)oi.push(_t(et[me][xe],et[me][xe+1],U,De,Xe,He));je.geometry.push(oi)}}return re.transformed=!0,re}function _t(re,U,Z,me,xe,De){return[Math.round(Z*(re*me-xe)),Math.round(Z*(U*me-De))]}function ft(re,U,Z,me,xe){for(var De=U===xe.maxZoom?0:xe.tolerance/((1<<U)*xe.extent),Xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:me,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},He=0;He<re.length;He++){Xe.numFeatures++,Ut(Xe,re[He],De,xe);var je=re[He].minX,et=re[He].minY,St=re[He].maxX,oi=re[He].maxY;je<Xe.minX&&(Xe.minX=je),et<Xe.minY&&(Xe.minY=et),St>Xe.maxX&&(Xe.maxX=St),oi>Xe.maxY&&(Xe.maxY=oi)}return Xe}function Ut(re,U,Z,me){var xe=U.geometry,De=U.type,Xe=[];if("Point"===De||"MultiPoint"===De)for(var He=0;He<xe.length;He+=3)Xe.push(xe[He]),Xe.push(xe[He+1]),re.numPoints++,re.numSimplified++;else if("LineString"===De)ti(Xe,xe,re,Z,!1,!1);else if("MultiLineString"===De||"Polygon"===De)for(He=0;He<xe.length;He++)ti(Xe,xe[He],re,Z,"Polygon"===De,0===He);else if("MultiPolygon"===De)for(var je=0;je<xe.length;je++){var et=xe[je];for(He=0;He<et.length;He++)ti(Xe,et[He],re,Z,!0,0===He)}if(Xe.length){var St=U.tags||null;if("LineString"===De&&me.lineMetrics){for(var oi in St={},U.tags)St[oi]=U.tags[oi];St.mapbox_clip_start=xe.start/xe.size,St.mapbox_clip_end=xe.end/xe.size}var kt={geometry:Xe,type:"Polygon"===De||"MultiPolygon"===De?3:"LineString"===De||"MultiLineString"===De?2:1,tags:St};null!==U.id&&(kt.id=U.id),re.features.push(kt)}}function ti(re,U,Z,me,xe,De){var Xe=me*me;if(me>0&&U.size<(xe?Xe:me))Z.numPoints+=U.length/3;else{for(var He=[],je=0;je<U.length;je+=3)(0===me||U[je+2]>Xe)&&(Z.numSimplified++,He.push(U[je]),He.push(U[je+1])),Z.numPoints++;xe&&function(et,St){for(var oi=0,kt=0,Mi=et.length,Ti=Mi-2;kt<Mi;Ti=kt,kt+=2)oi+=(et[kt]-et[Ti])*(et[kt+1]+et[Ti+1]);if(oi>0===St)for(kt=0,Mi=et.length;kt<Mi/2;kt+=2){var bi=et[kt],Di=et[kt+1];et[kt]=et[Mi-2-kt],et[kt+1]=et[Mi-1-kt],et[Mi-2-kt]=bi,et[Mi-1-kt]=Di}}(He,De),re.push(He)}}function Ci(re,U){var Z=(U=this.options=function(xe,De){for(var Xe in De)xe[Xe]=De[Xe];return xe}(Object.create(this.options),U)).debug;if(Z&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var xe,De,Xe,He,je,et,me=function(xe,De){var Xe=[];if("FeatureCollection"===xe.type)for(var He=0;He<xe.features.length;He++)Rt(Xe,xe.features[He],De,He);else Rt(Xe,"Feature"===xe.type?xe:{geometry:xe},De);return Xe}(re,U);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),He=xe=me,je=Ce(xe,1,-1-(Xe=(De=U).buffer/De.extent),Xe,0,-1,2,De),et=Ce(xe,1,1-Xe,2+Xe,0,-1,2,De),(je||et)&&(He=Ce(xe,1,-Xe,1+Xe,0,-1,2,De)||[],je&&(He=Me(je,1).concat(He)),et&&(He=He.concat(Me(et,-1)))),(me=He).length&&this.splitTile(me,0,0,0),Z&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xi(re,U,Z){return 32*((1<<re)*Z+U)+re}function pi(re,U){const Z=re.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const me=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!me)return U(null,null);const xe=new Be(me.features);let De=Ie.exports(xe);0===De.byteOffset&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),U(null,{vectorTile:xe,rawData:De.buffer})}Ci.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ci.prototype.splitTile=function(re,U,Z,me,xe,De,Xe){for(var He=[re,U,Z,me],je=this.options,et=je.debug;He.length;){me=He.pop(),Z=He.pop(),U=He.pop(),re=He.pop();var St=1<<U,oi=xi(U,Z,me),kt=this.tiles[oi];if(!kt&&(et>1&&console.time("creation"),kt=this.tiles[oi]=ft(re,U,Z,me,je),this.tileCoords.push({z:U,x:Z,y:me}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,Z,me,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));var Mi="z"+U;this.stats[Mi]=(this.stats[Mi]||0)+1,this.total++}if(kt.source=re,xe){if(U===je.maxZoom||U===xe)continue;var Ti=1<<xe-U;if(Z!==Math.floor(De/Ti)||me!==Math.floor(Xe/Ti))continue}else if(U===je.indexMaxZoom||kt.numPoints<=je.indexMaxPoints)continue;if(kt.source=null,0!==re.length){et>1&&console.time("clipping");var bi,Di,Qi,gn,Pi,xn,bn=.5*je.buffer/je.extent,Yr=.5-bn,Kr=.5+bn,ct=1+bn;bi=Di=Qi=gn=null,Pi=Ce(re,St,Z-bn,Z+Kr,0,kt.minX,kt.maxX,je),xn=Ce(re,St,Z+Yr,Z+ct,0,kt.minX,kt.maxX,je),re=null,Pi&&(bi=Ce(Pi,St,me-bn,me+Kr,1,kt.minY,kt.maxY,je),Di=Ce(Pi,St,me+Yr,me+ct,1,kt.minY,kt.maxY,je),Pi=null),xn&&(Qi=Ce(xn,St,me-bn,me+Kr,1,kt.minY,kt.maxY,je),gn=Ce(xn,St,me+Yr,me+ct,1,kt.minY,kt.maxY,je),xn=null),et>1&&console.timeEnd("clipping"),He.push(bi||[],U+1,2*Z,2*me),He.push(Di||[],U+1,2*Z,2*me+1),He.push(Qi||[],U+1,2*Z+1,2*me),He.push(gn||[],U+1,2*Z+1,2*me+1)}}},Ci.prototype.getTile=function(re,U,Z){var me=this.options,xe=me.extent,De=me.debug;if(re<0||re>24)return null;var Xe=1<<re,He=xi(re,U=(U%Xe+Xe)%Xe,Z);if(this.tiles[He])return gt(this.tiles[He],xe);De>1&&console.log("drilling down to z%d-%d-%d",re,U,Z);for(var je,et=re,St=U,oi=Z;!je&&et>0;)et--,St=Math.floor(St/2),oi=Math.floor(oi/2),je=this.tiles[xi(et,St,oi)];return je&&je.source?(De>1&&console.log("found parent tile z%d-%d-%d",et,St,oi),De>1&&console.time("drilling down"),this.splitTile(je.source,et,St,oi,re,U,Z),De>1&&console.timeEnd("drilling down"),this.tiles[He]?gt(this.tiles[He],xe):null):null};class Ii extends o.VectorTileWorkerSource{constructor(U,Z,me,xe,De){super(U,Z,me,xe,pi),De&&(this.loadGeoJSON=De)}loadData(U,Z){const me=U&&U.request,xe=me&&me.collectResourceTiming;this.loadGeoJSON(U,(De,Xe)=>{if(De||!Xe)return Z(De);if("object"!=typeof Xe)return Z(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{O(Xe,!0);try{if(U.filter){const je=o.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===je.result)throw new Error(je.value.map(St=>`${St.key}: ${St.message}`).join(", "));Xe={type:"FeatureCollection",features:Xe.features.filter(St=>je.value.evaluate({zoom:0},St))}}this._geoJSONIndex=U.cluster?new Jn(function({superclusterOptions:je,clusterProperties:et}){if(!et||!je)return je;const St={},oi={},kt={accumulated:null,zoom:0},Mi={properties:null},Ti=Object.keys(et);for(const bi of Ti){const[Di,Qi]=et[bi],gn=o.createExpression(Qi),Pi=o.createExpression("string"==typeof Di?[Di,["accumulated"],["get",bi]]:Di);St[bi]=gn.value,oi[bi]=Pi.value}return je.map=bi=>{Mi.properties=bi;const Di={};for(const Qi of Ti)Di[Qi]=St[Qi].evaluate(kt,Mi);return Di},je.reduce=(bi,Di)=>{Mi.properties=Di;for(const Qi of Ti)kt.accumulated=bi[Qi],bi[Qi]=oi[Qi].evaluate(kt,Mi)},je}(U)).load(Xe.features):new Ci(je=Xe,U.geojsonVtOptions)}catch(je){return Z(je)}this.loaded={};const He={};if(xe){const je=o.getPerformanceMeasurement(me);je&&(He.resourceTiming={},He.resourceTiming[U.source]=JSON.parse(JSON.stringify(je)))}Z(null,He)}var je})}reloadTile(U,Z){const me=this.loaded;return me&&me[U.uid]?super.reloadTile(U,Z):this.loadTile(U,Z)}loadGeoJSON(U,Z){if(U.request)o.getJSON(U.request,Z);else{if("string"!=typeof U.data)return Z(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(U.data))}catch{return Z(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(me){Z(me)}}getClusterChildren(U,Z){try{Z(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(me){Z(me)}}getClusterLeaves(U,Z){try{Z(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(me){Z(me)}}}class Gi{constructor(U){this.self=U,this.actor=new o.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Ii},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,me)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=me},this.self.registerRTLTextPlugin=Z=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=Z.applyArabicShaping,o.plugin.processBidirectionalText=Z.processBidirectionalText,o.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(U,Z,me){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],me()}checkIfReady(U,Z,me){me()}setReferrer(U,Z){this.referrer=Z}spriteLoaded(U,Z){this.isSpriteLoaded[U]=Z;for(const me in this.workerSources[U]){const xe=this.workerSources[U][me];for(const De in xe)xe[De]instanceof o.VectorTileWorkerSource&&(xe[De].isSpriteLoaded=Z,xe[De].fire(new o.Event("isSpriteLoaded")))}}setImages(U,Z,me){this.availableImages[U]=Z;for(const xe in this.workerSources[U]){const De=this.workerSources[U][xe];for(const Xe in De)De[Xe].availableImages=Z}me()}enableTerrain(U,Z,me){this.terrain=Z,me()}setProjection(U,Z){this.projections[U]=o.getProjection(Z)}setLayers(U,Z,me){this.getLayerIndex(U).replace(Z),me()}updateLayers(U,Z,me){this.getLayerIndex(U).update(Z.layers,Z.removedIds),me()}loadTile(U,Z,me){const xe=this.enableTerrain?o.extend({enableTerrain:this.terrain},Z):Z;xe.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,Z.type,Z.source).loadTile(xe,me)}loadDEMTile(U,Z,me){const xe=this.enableTerrain?o.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(U,Z.source).loadTile(xe,me)}reloadTile(U,Z,me){const xe=this.enableTerrain?o.extend({enableTerrain:this.terrain},Z):Z;xe.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,Z.type,Z.source).reloadTile(xe,me)}abortTile(U,Z,me){this.getWorkerSource(U,Z.type,Z.source).abortTile(Z,me)}removeTile(U,Z,me){this.getWorkerSource(U,Z.type,Z.source).removeTile(Z,me)}removeSource(U,Z,me){if(!this.workerSources[U]||!this.workerSources[U][Z.type]||!this.workerSources[U][Z.type][Z.source])return;const xe=this.workerSources[U][Z.type][Z.source];delete this.workerSources[U][Z.type][Z.source],void 0!==xe.removeSource?xe.removeSource(Z,me):me()}loadWorkerSource(U,Z,me){try{this.self.importScripts(Z.url),me()}catch(xe){me(xe.toString())}}syncRTLPluginState(U,Z,me){try{o.plugin.setState(Z);const xe=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&null!=xe){this.self.importScripts(xe);const De=o.plugin.isParsed();me(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),De)}}catch(xe){me(xe.toString())}}getAvailableImages(U){let Z=this.availableImages[U];return Z||(Z=[]),Z}getLayerIndex(U){let Z=this.layerIndexes[U];return Z||(Z=this.layerIndexes[U]=new j),Z}getWorkerSource(U,Z,me){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][Z]||(this.workerSources[U][Z]={}),this.workerSources[U][Z][me]||(this.workerSources[U][Z][me]=new this.workerSourceTypes[Z]({send:(De,Xe,He,je,et,St)=>{this.actor.send(De,Xe,He,U,et,St)},scheduler:this.actor.scheduler},this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])),this.workerSources[U][Z][me]}getDEMWorkerSource(U,Z){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][Z]||(this.demWorkerSources[U][Z]=new k),this.demWorkerSources[U][Z]}enforceCacheSizeLimit(U,Z){o.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(U,Z,me){me(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Gi(self)),Gi}),$(0,function(o){function D(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let s=0;s<l.length;s++)if(!D(l[s],n[s]))return!1;return!0}if("object"==typeof l&&null!==l&&null!==n){if("object"!=typeof n||Object.keys(l).length!==Object.keys(n).length)return!1;for(const s in l)if(!D(l[s],n[s]))return!1;return!0}return l===n}var N=j;function j(l){return n=l,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var u,d,f=new Blob([""],{type:"text/javascript"}),y=URL.createObjectURL(f);try{d=new Worker(y),u=!0}catch{u=!1}return d&&d.terminate(),URL.revokeObjectURL(y),u}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var u=document.createElement("canvas");u.width=u.height=1;var d=u.getContext("2d");if(!d)return!1;var f=d.getImageData(0,0,1,1);return f&&f.width===u.width}()||(void 0===k[s=n&&n.failIfMajorPerformanceCaveat]&&(k[s]=function(u){var d,y,T,E,f=(y=u,T=document.createElement("canvas"),(E=Object.create(j.webGLContextAttributes)).failIfMajorPerformanceCaveat=y,T.getContext("webgl",E)||T.getContext("experimental-webgl",E));if(!f)return!1;try{d=f.createShader(f.VERTEX_SHADER)}catch{return!1}return!(!d||f.isContextLost())&&(f.shaderSource(d,"void main() {}"),f.compileShader(d),!0===f.getShaderParameter(d,f.COMPILE_STATUS))}(s)),!k[s]||document.documentMode));var n,s}var k={};function O(l,n,s){const u=o.window.document.createElement(l);return void 0!==n&&(u.className=n),s&&s.appendChild(u),u}function I(l,n,s){const u=o.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const d of Object.keys(n))u.setAttributeNS(null,d,n[d]);return s&&s.appendChild(u),u}j.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const X=o.window.document&&o.window.document.documentElement.style,le=X&&void 0!==X.userSelect?"userSelect":"WebkitUserSelect";let te;function Be(){X&&le&&(te=X[le],X[le]="none")}function Ie(){X&&le&&(X[le]=te)}function Se(l){l.preventDefault(),l.stopPropagation(),o.window.removeEventListener("click",Se,!0)}function Ke(){o.window.addEventListener("click",Se,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Se,!0)},0)}function ne(l,n){const s=l.getBoundingClientRect();return wt(l,s,n)}function mt(l,n){const s=l.getBoundingClientRect(),u=[];for(let d=0;d<n.length;d++)u.push(wt(l,s,n[d]));return u}function C(l){return void 0!==o.window.InstallTrigger&&2===l.button&&l.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function wt(l,n,s){const u=l.offsetWidth===n.width?1:l.offsetWidth/n.width;return new o.pointGeometry((s.clientX-n.left)*u,(s.clientY-n.top)*u)}function xt(l,n){var s=n[0],u=n[1],d=n[2],f=n[3],y=s*f-d*u;return y?(l[0]=f*(y=1/y),l[1]=-u*y,l[2]=-d*y,l[3]=s*y,l):null}function Wt(l){const{userImage:n}=l;return!!(n&&n.render&&n.render())&&(l.data.replace(new Uint8Array(n.data.buffer)),!0)}class Nt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:s,callback:u}of this.requestors)this._notify(s,u);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,s){this._validate(n,s)&&(this.images[n]=s)}_validate(n,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),u=!1),u}_validateStretch(n,s){if(!n)return!0;let u=0;for(const d of n){if(d[0]<u||d[1]<d[0]||s<d[1])return!1;u=d[1]}return!0}_validateContent(n,s){return!(n&&(4!==n.length||n[0]<0||s.data.width<n[0]||n[1]<0||s.data.height<n[1]||n[2]<0||s.data.width<n[2]||n[3]<0||s.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,s){s.version=this.images[n].version+1,this.images[n]=s,this.updatedImages[n]=!0}removeImage(n){const s=this.images[n];delete this.images[n],delete this.patterns[n],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,s){let u=!0;if(!this.isLoaded())for(const d of n)this.images[d]||(u=!1);this.isLoaded()||u?this._notify(n,s):this.requestors.push({ids:n,callback:s})}_notify(n,s){const u={};for(const d of n){this.images[d]||this.fire(new o.Event("styleimagemissing",{id:d}));const f=this.images[d];f?u[d]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:Boolean(f.userImage&&f.userImage.render)}:o.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,u)}getPixelSize(){const{width:n,height:s}=this.atlasImage;return{width:n,height:s}}getPattern(n){const s=this.patterns[n],u=this.getImage(n);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},f=new o.ImagePosition(d,u);this.patterns[n]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const s=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(n,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const f in this.patterns)n.push(this.patterns[f].bin);const{w:s,h:u}=o.potpack(n),d=this.atlasImage;d.resize({width:s||1,height:u||1});for(const f in this.patterns){const{bin:y}=this.patterns[f],T=y.x+1,E=y.y+1,P=this.images[f].data,z=P.width,V=P.height;o.RGBAImage.copy(P,d,{x:0,y:0},{x:T,y:E},{width:z,height:V}),o.RGBAImage.copy(P,d,{x:0,y:V-1},{x:T,y:E-1},{width:z,height:1}),o.RGBAImage.copy(P,d,{x:0,y:0},{x:T,y:E+V},{width:z,height:1}),o.RGBAImage.copy(P,d,{x:z-1,y:0},{x:T-1,y:E},{width:1,height:V}),o.RGBAImage.copy(P,d,{x:0,y:0},{x:T+z,y:E},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const s of n){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.images[s];Wt(u)&&this.updateImage(s,u)}}}const fi=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(l,n){return function([s,u,d]){const f=o.degToRad(u+90),y=o.degToRad(d);return{x:s*Math.cos(f)*Math.sin(y),y:s*Math.sin(f)*Math.sin(y),z:s*Math.cos(y),azimuthal:u,polar:d}}(l.expression.evaluate(n))}interpolate(l,n,s){return{x:o.number(l.x,n.x,s),y:o.number(l.y,n.y,s),z:o.number(l.z,n.z,s),azimuthal:o.number(l.azimuthal,n.azimuthal,s),polar:o.number(l.polar,n.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),$t="-transition";class li extends o.Evented{constructor(n){super(),this._transitionable=new o.Transitionable(fi),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,s={}){if(!this._validate(o.validateLight,n,s))for(const u in n){const d=n[u];o.endsWith(u,$t)?this._transitionable.setTransition(u.slice(0,-$t.length),d):this._transitionable.setValue(u,d)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,u){return(!u||!1!==u.validate)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const qt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Ri="-transition";class Bi extends o.Evented{constructor(n,s){super(),this._transitionable=new o.Transitionable(qt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(n){for(const s in n){const u=n[s];o.endsWith(s,Ri)?this._transitionable.setTransition(s.slice(0,-Ri.length),u):this._transitionable.setValue(s,u)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function mi(l,n,s,u){const d=o.smoothstep(45,65,s),[f,y]=tn(l,u),T=o.length(n);let E=1-Math.min(1,Math.exp((T-f)/(y-f)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*d*l.alpha}function tn(l,n){const s=.5/Math.tan(.5*n);return[l.range[0]+s,l.range[1]+s]}const Pt=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),wi="-transition";class ji extends o.Evented{constructor(n,s){super(),this._transitionable=new o.Transitionable(Pt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){const n=this._transform,s="globe"===n.projection.name,u=o.globeToMercatorTransition(n.zoom),d=this.properties.get("range"),f=[.5,3];return{range:s?[o.number(f[0],d[0],u),o.number(f[1],d[1],u)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,s={}){if(!this._validate(o.validateFog,n,s)){for(const u of Object.keys(o.spec.fog))n&&void 0===n[u]&&(n[u]=o.spec.fog[u].default);for(const u in n){const d=n[u];o.endsWith(u,wi)?this._transitionable.setTransition(u.slice(0,-wi.length),d):this._transitionable.setValue(u,d)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:o.smoothstep(45,65,n))*s.a}getOpacityAtLatLng(n,s){return this._transform.projection.supportsFog?function(u,d,f){const y=o.MercatorCoordinate.fromLngLat(d),T=f.elevation?f.elevation.getAtPointOrZero(y):0,E=[y.x,y.y,T];return o.transformMat4(E,E,f.mercatorFogMatrix),mi(u,E,f.pitch,f._fov)}(this.state,n,s):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?tn(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,u){return(!u||!1!==u.validate)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class pt{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const u=this.workerPool.acquire(this.id);for(let d=0;d<u.length;d++){const f=new pt.Actor(u[d],s,this.id);f.name=`Worker ${d}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,u){o.asyncAll(this.actors,(d,f)=>{d.send(n,s,f)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Si(l,n,s){return n*(o.EXTENT/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}pt.Actor=o.Actor;class mn{constructor(n,s,u,d){this.screenBounds=n,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(n,s){let u,d;if(n instanceof o.pointGeometry||"number"==typeof n[0]){const f=o.pointGeometry.convert(n);u=[f],d=s.isPointAboveHorizon(f)}else{const f=o.pointGeometry.convert(n[0]),y=o.pointGeometry.convert(n[1]);u=[f,y],d=o.polygonizeBounds(f,y).every(T=>s.isPointAboveHorizon(T))}return new mn(u,s.getCameraPoint(),d,s)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return o.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const s=this.screenBounds[0],u=1===this.screenBounds.length?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],d=o.polygonizeBounds(s,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<u.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?d[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(d[3]=this.cameraPoint)),o.bufferConvexPolygon(d,n)}bufferedCameraGeometryGlobe(n){const s=this.screenBounds[0],u=1===this.screenBounds.length?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],d=o.polygonizeBounds(s,u,n),f=this.cameraPoint.clone();switch(3*((f.y>s.y)+(f.y>u.y))+((f.x>s.x)+(f.x>u.x))){case 0:d[0]=f,d[4]=f.clone();break;case 1:d.splice(1,0,f);break;case 2:d[1]=f;break;case 3:d.splice(4,0,f);break;case 5:d.splice(2,0,f);break;case 6:d[3]=f;break;case 7:d.splice(3,0,f);break;case 8:d[2]=f}return d}containsTile(n,s,u,d=0){const f=n.queryPadding/s._pixelsPerMercatorPixel+1,y=u?this._bufferedCameraMercator(f,s):this._bufferedScreenMercator(f,s);let T=n.tileID.wrap+(y.unwrapped?d:0);const E=y.polygon.map(ce=>o.getTilePoint(n.tileTransform,ce,T));if(!o.polygonIntersectsBox(E,0,0,o.EXTENT,o.EXTENT))return;T=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const P=this.screenGeometryMercator.polygon.map(ce=>o.getTileVec3(n.tileTransform,ce,T)),z=P.map(ce=>new o.pointGeometry(ce[0],ce[1])),V=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),K=o.getTileVec3(n.tileTransform,V,T),fe=P.map(ce=>{const ee=o.sub(ce,ce,K);return o.normalize(ee,ee),new o.Ray(K,ee)}),ie=Si(n,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:fe,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(ge=o.getBounds(E),ge.min.x=o.clamp(ge.min.x,0,o.EXTENT),ge.min.y=o.clamp(ge.min.y,0,o.EXTENT),ge.max.x=o.clamp(ge.max.x,0,o.EXTENT),ge.max.y=o.clamp(ge.max.y,0,o.EXTENT),ge),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:ie};var ge}_bufferedScreenMercator(n,s){const u=En(n);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let d;return d="globe"===s.projection.name?this._projectAndResample(this.bufferedScreenGeometry(n),s):{polygon:this.bufferedScreenGeometry(n).map(f=>s.pointCoordinate3D(f)),unwrapped:!0},this._screenRaycastCache[u]=d,d}}_bufferedCameraMercator(n,s){const u=En(n);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let d;return d="globe"===s.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),s):{polygon:this.bufferedCameraGeometry(n).map(f=>s.pointCoordinate3D(f)),unwrapped:!0},this._cameraRaycastCache[u]=d,d}}_projectAndResample(n,s){const u=function(f,y){const T=o.multiply([],y.pixelMatrix,y.globeMatrix),E=[0,-o.GLOBE_RADIUS,0,1],P=[0,o.GLOBE_RADIUS,0,1],z=[0,0,0,1];o.transformMat4$1(E,E,T),o.transformMat4$1(P,P,T),o.transformMat4$1(z,z,T);const V=new o.pointGeometry(E[0]/E[3],E[1]/E[3]),K=new o.pointGeometry(P[0]/P[3],P[1]/P[3]),fe=o.polygonContainsPoint(f,V)&&E[3]<z[3],ie=o.polygonContainsPoint(f,K)&&P[3]<z[3];if(!fe&&!ie)return null;const ge=function(Re,tt,ut){for(let st=1;st<Re.length;st++){const zt=yn(tt.pointCoordinate3D(Re[st-1]).x),Ye=yn(tt.pointCoordinate3D(Re[st]).x);if(ut<0){if(zt<Ye)return{idx:st,t:-zt/(Ye-1-zt)}}else if(Ye<zt)return{idx:st,t:(1-zt)/(Ye+1-zt)}}return null}(f,y,fe?-1:1);if(!ge)return null;const{idx:ce,t:ee}=ge;let _e=ce>1?Bn(f.slice(0,ce),y):[],he=ce<f.length?Bn(f.slice(ce),y):[];_e=_e.map(Re=>new o.pointGeometry(yn(Re.x),Re.y)),he=he.map(Re=>new o.pointGeometry(yn(Re.x),Re.y));const Le=[..._e];0===Le.length&&Le.push(he[he.length-1]);const ze=o.number(Le[Le.length-1].y,(0===he.length?_e[0]:he[0]).y,ee);let Te;return Te=fe?[new o.pointGeometry(0,ze),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,ze)]:[new o.pointGeometry(1,ze),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,ze)],Le.push(...Te),0===he.length?Le.push(_e[0]):Le.push(...he),{polygon:Le.map(Re=>new o.MercatorCoordinate(Re.x,Re.y)),unwrapped:!1}}(n,s);if(u)return u;const d=function(f,y){let T=!1,E=-1/0,P=0;for(let V=0;V<f.length-1;V++)f[V].x>E&&(E=f[V].x,P=V);for(let V=0;V<f.length-1;V++){const K=(P+V)%(f.length-1),fe=f[K],ie=f[K+1];Math.abs(fe.x-ie.x)>.5&&(fe.x<ie.x?(fe.x+=1,0===K&&(f[f.length-1].x+=1)):(ie.x+=1,K+1===f.length-1&&(f[0].x+=1)),T=!0)}const z=o.mercatorXfromLng(y.center.lng);return T&&z<Math.abs(z-1)&&f.forEach(V=>{V.x-=1}),{polygon:f,unwrapped:T}}(Bn(n,s).map(f=>new o.pointGeometry(yn(f.x),f.y)),s);return{polygon:d.polygon.map(f=>new o.MercatorCoordinate(f.x,f.y)),unwrapped:d.unwrapped}}}function Bn(l,n){return o.resample(l,s=>{const u=n.pointCoordinate3D(s);s.x=u.x,s.y=u.y},1/256)}function yn(l){return l<0?1+l%1:l%1}function En(l){return 100*l|0}function Jn(l,n,s,u,d){const f=function(y,T){if(y)return d(y);if(T){l.url&&T.tiles&&l.tiles&&delete l.tiles;const E=o.pick(o.extend(T,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(E.vectorLayers=T.vector_layers,E.vectorLayerIds=E.vectorLayers.map(P=>P.id)),E.tiles=n.canonicalizeTileset(E,l.url),d(null,E)}};return l.url?o.getJSON(n.transformRequest(n.normalizeSourceURL(l.url,null,s,u),o.ResourceType.Source),f):o.exported.frame(()=>f(null,l))}class vn{constructor(n,s,u){this.bounds=o.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const s=Math.pow(2,n.z),u=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),d=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),f=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),y=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return n.x>=u&&n.x<f&&n.y>=d&&n.y<y}}class Fn{constructor(n,s,u){this.context=n;const d=n.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ji={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Nn{constructor(n,s,u,d){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=d,this.context=n;const f=n.gl;this.buffer=f.createBuffer(),n.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,s){for(let u=0;u<this.attributes.length;u++){const d=s.attributes[this.attributes[u].name];void 0!==d&&n.enableVertexAttribArray(d)}}setVertexAttribPointers(n,s,u){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],y=s.attributes[f.name];void 0!==y&&n.vertexAttribPointer(y,f.components,n[Ji[f.type]],!1,this.itemSize,f.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gi extends Xi{getDefault(){return o.Color.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ai extends Xi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class lt extends Xi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Y extends Xi{getDefault(){return[!0,!0,!0,!0]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ue extends Xi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class oe extends Xi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class $e extends Xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Ge extends Xi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class ot extends Xi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}}class Rt extends Xi{getDefault(){return[0,1]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Mt extends Xi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}}class jt extends Xi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Lt extends Xi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}}class yi extends Xi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class ve extends Xi{getDefault(){return o.Color.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ce extends Xi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class We extends Xi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}}class vt extends Xi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Bt extends Xi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Xt extends Xi{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class si extends Xi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class W extends Xi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ye extends Xi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Me extends Xi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class qe extends Xi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class gt extends Xi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class _t extends Xi{getDefault(){return null}set(n){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ft extends Xi{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Ut extends Xi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class ti extends Xi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Ci extends Xi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class xi extends Xi{constructor(n,s){super(n),this.context=n,this.parent=s}getDefault(){return null}}class pi extends xi{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Ii extends xi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Gi extends Ii{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class re{constructor(n,s,u,d){this.context=n,this.width=s,this.height=u;const f=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new pi(n,f),d&&(this.depthAttachment=new Ii(n,f))}destroy(){const n=this.context.gl,s=this.colorAttachment.get();if(s&&n.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&n.deleteRenderbuffer(u)}n.deleteFramebuffer(this.framebuffer)}}class U{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new gi(this),this.clearDepth=new Ai(this),this.clearStencil=new lt(this),this.colorMask=new Y(this),this.depthMask=new ue(this),this.stencilMask=new oe(this),this.stencilFunc=new $e(this),this.stencilOp=new Ge(this),this.stencilTest=new ot(this),this.depthRange=new Rt(this),this.depthTest=new Mt(this),this.depthFunc=new jt(this),this.blend=new Lt(this),this.blendFunc=new yi(this),this.blendColor=new ve(this),this.blendEquation=new Ce(this),this.cullFace=new We(this),this.cullFaceSide=new vt(this),this.frontFace=new Bt(this),this.program=new Xt(this),this.activeTexture=new si(this),this.viewport=new W(this),this.bindFramebuffer=new ye(this),this.bindRenderbuffer=new Me(this),this.bindTexture=new qe(this),this.bindVertexBuffer=new gt(this),this.bindElementBuffer=new _t(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ft(this),this.pixelStoreUnpack=new Ut(this),this.pixelStoreUnpackPremultiplyAlpha=new ti(this),this.pixelStoreUnpackFlipY=new Ci(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,s){return new Fn(this,n,s)}createVertexBuffer(n,s,u){return new Nn(this,n,s,u)}createRenderbuffer(n,s,u){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,n,s,u),this.bindRenderbuffer.set(null),f}createFramebuffer(n,s,u){return new re(this,n,s,u)}clear({color:n,depth:s,stencil:u}){const d=this.gl;let f=0;n&&(f|=d.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==s&&(f|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),void 0!==u&&(f|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(f)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){D(n.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Z extends o.Evented{constructor(n,s,u,d){super(),this.id=n,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Jn(this._options,this.map._requestManager,null,null,(n,s)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new vn(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,s){const u=o.exported.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);n.request=o.getImage(this.map._requestManager.transformRequest(d,o.ResourceType.Tile),(f,y,T,E)=>(delete n.request,n.aborted?(n.state="unloaded",s(null)):f?(n.state="errored",s(f)):y?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:T,expires:E}),n.setTexture(y,this.map.painter),n.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(n,s,u){n.setTexture(s,u)}static unloadTileData(n,s){n.texture&&s.saveTileTexture(n.texture)}abortTile(n,s){n.request&&(n.request.cancel(),delete n.request),s()}unloadTile(n,s){n.texture&&this.map.painter.saveTileTexture(n.texture),s()}hasTransition(){return!1}}let me;function xe(l,n,s,u,d,f,y,T){const E=[l,s,d,n,u,f,1,1,1],P=[y,T,1],z=o.adjoint([],E),[V,K,fe]=o.transformMat3(P,P,o.transpose(z,z));return o.multiply$1(E,[V,0,0,0,K,0,0,0,fe],E)}class De extends o.Evented{constructor(n,s,u,d){super(),this.id=n,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s,this._dirty=!1}load(n,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(u,d)=>{if(this._imageRequest=null,this._loaded=!0,u)this.fire(new o.ErrorEvent(u));else if(d){const{HTMLImageElement:f}=o.window;this.image=d instanceof f?o.exported.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const s=n.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(u){let d=1/0,f=1/0,y=-1/0,T=-1/0;for(const V of u)d=Math.min(d,V.x),f=Math.min(f,V.y),y=Math.max(y,V.x),T=Math.max(T,V.y);const E=Math.max(y-d,T-f),P=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),z=Math.pow(2,P);return new o.CanonicalTileID(P,Math.floor((d+y)/2*z),Math.floor((f+T)/2*z))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const E in this.tiles){const P=this.tiles[E];"loaded"!==P.state&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[u,d,f,y]=this.coordinates.map(E=>{const P=s.projection.project(E[0],E[1]);return o.getTilePoint(s,P)._round()});this.perspectiveTransform=function(E,P,z,V,K,fe,ie,ge,ce,ee){const _e=xe(0,0,E,0,0,P,E,P),he=xe(z,V,K,fe,ie,ge,ce,ee);return o.multiply$1(he,o.adjoint(_e,_e),he),[he[6]/he[8]*E/o.EXTENT,he[7]/he[8]*P/o.EXTENT]}(this.width,this.height,u.x,u.y,d.x,d.y,y.x,y.y,f.x,f.y);const T=this._boundsArray=new o.StructArrayLayout4i8;T.emplaceBack(u.x,u.y,0,0),T.emplaceBack(d.x,d.y,o.EXTENT,0),T.emplaceBack(y.x,y.y,0,o.EXTENT),T.emplaceBack(f.x,f.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(T,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,s=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Xe={vector:class extends o.Evented{constructor(l,n,s,u){if(super(),this.id=l,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(n,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=Jn(this._options,this.map._requestManager,n,s,(u,d)=>{this._tileJSONRequest=null,this._loaded=!0,u?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),s&&2!==s.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.ErrorEvent(u))):d&&(o.extend(this,d),d.bounds&&(this.tileBounds=new vn(d.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(d.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(u)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const l=this.map.style._getSourceCaches(this.id);for(const n of l)n.clearTiles()})}setSourceProperty(l){l(),this.reload()}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(l,n){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(u.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=n:l.request=l.actor.send("reloadTile",u,d.bind(this));else if(l.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",u,d.bind(this),void 0,!0);else{const f=o.loadVectorTile.call({deduped:this._deduped},u,(y,T)=>{y||!T?d.call(this,y):(u.data={cacheControl:T.cacheControl,expires:T.expires,rawData:T.rawData.slice(0)},l.actor&&l.actor.send("loadTile",u,d.bind(this),void 0,!0))},!0);l.request={cancel:f}}function d(f,y){return delete l.request,l.aborted?n(null):f&&404!==f.status?n(f):(y&&y.resourceTiming&&(l.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&l.setExpiryData(y),l.loadVectorData(y,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:Z,"raster-dem":class extends Z{constructor(l,n,s,u){super(l,n,s,u),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(l,n){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(d,f){d&&(l.state="errored",n(d)),f&&(l.dem=f,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",n(null))}l.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(d,f,y,T){if(delete l.request,l.aborted)l.state="unloaded",n(null);else if(d)l.state="errored",n(d);else if(f){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:y,expires:T});const E=o.window.ImageBitmap&&f instanceof o.window.ImageBitmap&&(null==me&&(me=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof o.window.createImageBitmap),me),P=1-(f.width-o.prevPowerOfTwo(f.width))/2;P<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const z=E?f:o.exported.getImageData(f,P),V={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:z,encoding:this.encoding,padding:P};l.actor&&"expired"!==l.state||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",V,u.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const n=l.canonical,s=Math.pow(2,n.z),u=(n.x-1+s)%s,d=0===n.x?l.wrap-1:l.wrap,f=(n.x+1+s)%s,y=n.x+1===s?l.wrap+1:l.wrap,T={};return T[new o.OverscaledTileID(l.overscaledZ,d,n.z,u,n.y).key]={backfilled:!1},T[new o.OverscaledTileID(l.overscaledZ,y,n.z,f,n.y).key]={backfilled:!1},n.y>0&&(T[new o.OverscaledTileID(l.overscaledZ,d,n.z,u,n.y-1).key]={backfilled:!1},T[new o.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new o.OverscaledTileID(l.overscaledZ,y,n.z,f,n.y-1).key]={backfilled:!1}),n.y+1<s&&(T[new o.OverscaledTileID(l.overscaledZ,d,n.z,u,n.y+1).key]={backfilled:!1},T[new o.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new o.OverscaledTileID(l.overscaledZ,y,n.z,f,n.y+1).key]={backfilled:!1}),T}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends o.Evented{constructor(l,n,s,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(u),this._data=n.data,this._options=o.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*d,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*d,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},n),this}getClusterChildren(l,n){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},n),this}getClusterLeaves(l,n,s,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:n,offset:s},u),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=o.extend({},this.workerOptions),n=this._data;"string"==typeof n?(l.request=this.map._requestManager.transformRequest(o.exported.resolveURL(n),o.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(s,u)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const d={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&u&&u.resourceTiming&&u.resourceTiming[this.id]&&(d.resourceTiming=u.resourceTiming[this.id]),this.fire(new o.Event("data",d)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,n){const s=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(s,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(u,d)=>(delete l.request,l.unloadVectorData(),l.aborted?n(null):u?n(u):(l.loadVectorData(d,this.map.painter,"reloadTile"===s),n(null))),void 0,"loadTile"===s)}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends De{constructor(l,n,s,u){super(l,n,s,u),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const n of l.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.ResourceType.Source).url);o.getVideo(this.urls,(n,s)=>{this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const n=this.video.seekable;l<n.start(0)||l>n.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const l=this.map.painter.context,n=l.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(l,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:De,canvas:class extends De{constructor(l,n,s,u){super(l,n,s,u),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(d=>!Array.isArray(d)||2!==d.length||d.some(f=>"number"!=typeof f))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.Evented{constructor(l,n,s,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=n,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new vn(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:n,y:s,z:u}=l.canonical;return this._implementation.hasTile({x:n,y:s,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,n){const{x:s,y:u,z:d}=l.tileID.canonical,f=new o.window.AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:s,y:u,z:d},{signal:f.signal})).then(function(y){return delete l.request,l.aborted?(l.state="unloaded",n(null)):void 0===y?(l.state="errored",n(null)):null===y?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",n(null)):(T=y)instanceof o.window.ImageData||T instanceof o.window.HTMLCanvasElement||T instanceof o.window.ImageBitmap||T instanceof o.window.HTMLImageElement?(this.loadTileData(l,y),l.state="loaded",void n(null)):(l.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var T}.bind(this)).catch(y=>{20!==y.code&&(l.state="errored",n(y))}),l.request.cancel=()=>f.abort()}loadTileData(l,n){Z.loadTileData(l,n,this._map.painter)}unloadTileData(l){Z.unloadTileData(l,this._map.painter)}unloadTile(l,n){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:s,y:u,z:d}=l.tileID.canonical;this._implementation.unloadTile({x:s,y:u,z:d})}n()}abortTile(l,n){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},He=function(l,n,s,u){const d=new Xe[n.type](l,n,s,u);if(d.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${d.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],d),d};function je(l,n){const s=o.identity([]);return o.scale(s,s,[.5*l.width,.5*-l.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,l.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(s)}function et(l,n,s,u,d,f,y,T=!1){const E=l.tilesIn(u,y,T);E.sort(oi);const P=[];for(const V of E)P.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(n,s,l._state,V,d,f,je(l.transform,V.tile.tileID),T)});const z=function(V){const K={},fe={};for(const ie of V){const ge=ie.queryResults,ce=ie.wrappedTileID,ee=fe[ce]=fe[ce]||{};for(const _e in ge){const he=ge[_e],Le=ee[_e]=ee[_e]||{},ze=K[_e]=K[_e]||[];for(const Te of he)Le[Te.featureIndex]||(Le[Te.featureIndex]=!0,ze.push(Te))}}return K}(P);for(const V in z)z[V].forEach(K=>{const fe=K.feature,ie=fe.layer;ie&&"background"!==ie.type&&"sky"!==ie.type&&(fe.source=ie.source,ie["source-layer"]&&(fe.sourceLayer=ie["source-layer"]),fe.state=void 0!==fe.id?l.getFeatureState(ie["source-layer"],fe.id):{})});return z}function St(l,n){const s=l.getRenderableIds().map(f=>l.getTileByID(f)),u=[],d={};for(let f=0;f<s.length;f++){const y=s[f],T=y.tileID.canonical.key;d[T]||(d[T]=!0,y.querySourceFeatures(u,n))}return u}function oi(l,n){const s=l.tileID,u=n.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function kt(){return null!=Va.workerClass?new Va.workerClass:new o.window.Worker(Va.workerUrl)}const Mi="mapboxgl_preloaded_worker_pool";class Ti{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ti.workerCount;)this.workers.push(new kt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mi]}numActive(){return Object.keys(this.active).length}}let bi;function Di(){return bi||(bi=new Ti),bi}function Qi(l,n){const s={};for(const u in l)"ref"!==u&&(s[u]=l[u]);return o.refProperties.forEach(u=>{u in n&&(s[u]=n[u])}),s}function gn(l){l=l.slice();const n=Object.create(null);for(let s=0;s<l.length;s++)n[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=Qi(l[s],n[l[s].ref]));return l}Ti.workerCount=2;const Pi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function xn(l,n,s){s.push({command:Pi.addSource,args:[l,n[l]]})}function bn(l,n,s){n.push({command:Pi.removeSource,args:[l]}),s[l]=!0}function Yr(l,n,s,u){bn(l,s,u),xn(l,n,s)}function Kr(l,n,s){let u;for(u in l[s])if(l[s].hasOwnProperty(u)&&"data"!==u&&!D(l[s][u],n[s][u]))return!1;for(u in n[s])if(n[s].hasOwnProperty(u)&&"data"!==u&&!D(l[s][u],n[s][u]))return!1;return!0}function ct(l,n,s,u,d,f){let y;for(y in n=n||{},l=l||{})l.hasOwnProperty(y)&&(D(l[y],n[y])||s.push({command:f,args:[u,y,n[y],d]}));for(y in n)n.hasOwnProperty(y)&&!l.hasOwnProperty(y)&&(D(l[y],n[y])||s.push({command:f,args:[u,y,n[y],d]}))}function _r(l){return l.id}function Hn(l,n){return l[n.id]=n,l}class Lr{constructor(n,s){this.reset(n,s)}reset(n,s){this.points=n||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=o.clamp(n,0,1);let s=1,u=this._distances[s];const d=n*this.paddedLength+this.padding;for(;u<d&&s<this._distances.length;)u=this._distances[++s];const f=s-1,y=this._distances[f],T=u-y,E=T>0?(d-y)/T:0;return this.points[f].mult(1-E).add(this.points[s].mult(E))}}class _o{constructor(n,s,u){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(n/u),this.yCellCount=Math.ceil(s/u);for(let y=0;y<this.xCellCount*this.yCellCount;y++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,s,u,d,f){this._forEachCell(s,u,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(n,s,u,d){this._forEachCell(s-d,u-d,s+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(u),this.circles.push(d)}_insertBoxCell(n,s,u,d,f,y){this.boxCells[f].push(y)}_insertCircleCell(n,s,u,d,f,y){this.circleCells[f].push(y)}_query(n,s,u,d,f,y){if(u<0||n>this.width||d<0||s>this.height)return!f&&[];const T=[];if(n<=0&&s<=0&&this.width<=u&&this.height<=d){if(f)return!0;for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const P=this.circles[3*E],z=this.circles[3*E+1],V=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:P-V,y1:z-V,x2:P+V,y2:z+V})}return y?T.filter(y):T}return this._forEachCell(n,s,u,d,this._queryCell,T,{hitTest:f,seenUids:{box:{},circle:{}}},y),f?T.length>0:T}_queryCircle(n,s,u,d,f){const y=n-u,T=n+u,E=s-u,P=s+u;if(T<0||y>this.width||P<0||E>this.height)return!d&&[];const z=[];return this._forEachCell(y,E,T,P,this._queryCellCircle,z,{hitTest:d,circle:{x:n,y:s,radius:u},seenUids:{box:{},circle:{}}},f),d?z.length>0:z}query(n,s,u,d,f){return this._query(n,s,u,d,!1,f)}hitTest(n,s,u,d,f){return this._query(n,s,u,d,!0,f)}hitTestCircle(n,s,u,d){return this._queryCircle(n,s,u,!0,d)}_queryCell(n,s,u,d,f,y,T,E){const P=T.seenUids,z=this.boxCells[f];if(null!==z){const K=this.bboxes;for(const fe of z)if(!P.box[fe]){P.box[fe]=!0;const ie=4*fe;if(n<=K[ie+2]&&s<=K[ie+3]&&u>=K[ie+0]&&d>=K[ie+1]&&(!E||E(this.boxKeys[fe]))){if(T.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[fe],x1:K[ie],y1:K[ie+1],x2:K[ie+2],y2:K[ie+3]})}}}const V=this.circleCells[f];if(null!==V){const K=this.circles;for(const fe of V)if(!P.circle[fe]){P.circle[fe]=!0;const ie=3*fe;if(this._circleAndRectCollide(K[ie],K[ie+1],K[ie+2],n,s,u,d)&&(!E||E(this.circleKeys[fe]))){if(T.hitTest)return y.push(!0),!0;{const ge=K[ie],ce=K[ie+1],ee=K[ie+2];y.push({key:this.circleKeys[fe],x1:ge-ee,y1:ce-ee,x2:ge+ee,y2:ce+ee})}}}}}_queryCellCircle(n,s,u,d,f,y,T,E){const P=T.circle,z=T.seenUids,V=this.boxCells[f];if(null!==V){const fe=this.bboxes;for(const ie of V)if(!z.box[ie]){z.box[ie]=!0;const ge=4*ie;if(this._circleAndRectCollide(P.x,P.y,P.radius,fe[ge+0],fe[ge+1],fe[ge+2],fe[ge+3])&&(!E||E(this.boxKeys[ie])))return y.push(!0),!0}}const K=this.circleCells[f];if(null!==K){const fe=this.circles;for(const ie of K)if(!z.circle[ie]){z.circle[ie]=!0;const ge=3*ie;if(this._circlesCollide(fe[ge],fe[ge+1],fe[ge+2],P.x,P.y,P.radius)&&(!E||E(this.circleKeys[ie])))return y.push(!0),!0}}}_forEachCell(n,s,u,d,f,y,T,E){const P=this._convertToXCellCoord(n),z=this._convertToYCellCoord(s),V=this._convertToXCellCoord(u),K=this._convertToYCellCoord(d);for(let fe=P;fe<=V;fe++)for(let ie=z;ie<=K;ie++)if(f.call(this,n,s,u,d,this.xCellCount*ie+fe,y,T,E))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,s,u,d,f,y){const T=d-n,E=f-s,P=u+y;return P*P>T*T+E*E}_circleAndRectCollide(n,s,u,d,f,y,T){const E=(y-d)/2,P=Math.abs(n-(d+E));if(P>E+u)return!1;const z=(T-f)/2,V=Math.abs(s-(f+z));if(V>z+u)return!1;if(P<=E||V<=z)return!0;const K=P-E,fe=V-z;return K*K+fe*fe<=u*u}}const Jr=Math.tan(85*Math.PI/180);function Oo(l,n,s,u,d,f,y){const T=o.create();if(s)if("globe"===f.name){const E=o.calculateGlobeLabelMatrix(d,n);o.multiply(T,T,E)}else{const E=xt([],y);T[0]=E[0],T[1]=E[1],T[4]=E[2],T[5]=E[3],u||o.rotateZ(T,T,d.angle)}else o.multiply(T,d.labelPlaneMatrix,l);return T}function rs(l,n,s,u,d,f,y){const T=Oo(l,n,s,u,d,f,y);return"globe"===f.name&&s||(T[2]=T[6]=T[10]=T[14]=0),T}function Eo(l,n,s,u,d,f,y){if(s){if("globe"===f.name){const T=Oo(l,n,s,u,d,f,y);return o.invert(T,T),o.multiply(T,l,T),T}{const T=o.clone(l),E=o.identity([]);return E[0]=y[0],E[1]=y[1],E[4]=y[2],E[5]=y[3],o.multiply(T,T,E),u||o.rotateZ(T,T,-d.angle),T}}return d.glCoordMatrix}function Jt(l,n,s=0){const u=[l.x,l.y,s,1];s?o.transformMat4$1(u,u,n):So(u,u,n);const d=u[3];return{point:[u[0]/d,u[1]/d,u[2]/d],signedDistanceFromCamera:d}}function nn(l,n){const s=[l[0],l[1],l[2],1];o.transformMat4$1(s,s,n);const u=s[3];return{point:[s[0]/u,s[1]/u,s[2]/u],signedDistanceFromCamera:u}}function Vi(l,n){return Math.min(.5+l/n*.5,1.5)}function Qr(l,n){const s=l[0]/l[3],u=l[1]/l[3];return s>=-n[0]&&s<=n[0]&&u>=-n[1]&&u<=n[1]}function hr(l,n,s,u,d,f,y,T,E,P){const z=s.transform,V=u?l.textSizeData:l.iconSizeData,K=o.evaluateSizeForZoom(V,s.transform.zoom),fe="globe"===z.projection.name,ie=[256/s.width*2+1,256/s.height*2+1],ge=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ge.clear();let ce=null;fe&&(ce=u?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const ee=l.lineVertexArray,_e=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,he=s.transform.width/s.transform.height;let Le=!1;for(let ze=0;ze<_e.length;ze++){const Te=_e.get(ze);if(Te.writingMode!==o.WritingMode.vertical||Le||0!==ze&&_e.get(ze-1).writingMode===o.WritingMode.horizontal||(Le=!0),(Te.hidden||Te.writingMode===o.WritingMode.vertical)&&!Le){$r(Te.numGlyphs,ge);continue}Le=!1;const Re=new o.pointGeometry(Te.tileAnchorX,Te.tileAnchorY),tt=E?E(Re):[0,0,0],ut=z.projection.projectTilePoint(Re.x,Re.y,P.canonical),st=[ut.x+tt[0],ut.y+tt[1],ut.z+tt[2]],zt=[...st,1];if(o.transformMat4$1(zt,zt,n),!Qr(zt,ie)){$r(Te.numGlyphs,ge);continue}const Ye=Vi(s.transform.cameraToCenterDistance,zt[3]),At=o.evaluateSizeForFeature(V,K,Te),Et=y?At/Ye:At*Ye,it=Jt(new o.pointGeometry(st[0],st[1]),d,st[2]);if(it.signedDistanceFromCamera<=0){$r(Te.numGlyphs,ge);continue}let Ze={};const ni=y?null:E,Gt=jr(Te,Et,!1,T,n,d,f,l.glyphOffsetArray,ee,ge,ce,it.point,Re,Ze,he,ni,z.projection,P,y);Le=Gt.useVertical,ni&&Gt.needsFlipping&&(Ze={}),(Gt.notEnoughRoom||Le||Gt.needsFlipping&&jr(Te,Et,!0,T,n,d,f,l.glyphOffsetArray,ee,ge,ce,it.point,Re,Ze,he,ni,z.projection,P,y).notEnoughRoom)&&$r(Te.numGlyphs,ge)}u?(l.text.dynamicLayoutVertexBuffer.updateData(ge),ce&&l.text.globeExtVertexBuffer.updateData(ce)):(l.icon.dynamicLayoutVertexBuffer.updateData(ge),ce&&l.icon.globeExtVertexBuffer.updateData(ce))}function an(l,n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge){const ce=T.glyphStartIndex+T.numGlyphs,ee=T.lineStartIndex,_e=T.lineStartIndex+T.lineLength,he=n.getoffsetX(T.glyphStartIndex),Le=n.getoffsetX(ce-1),ze=Dn(l*he,s,u,d,f,y,T.segment,ee,_e,E,P,z,V,K,!0,fe,ie,ge);if(!ze)return null;const Te=Dn(l*Le,s,u,d,f,y,T.segment,ee,_e,E,P,z,V,K,!0,fe,ie,ge);return Te?{first:ze,last:Te}:null}function os(l,n,s,u){return l.writingMode===o.WritingMode.horizontal&&Math.abs(s.y-n.y)>Math.abs(s.x-n.x)*u?{useVertical:!0}:l.writingMode===o.WritingMode.vertical?n.y<s.y?{needsFlipping:!0}:null:0!==l.flipState&&function(d,f,y){const T=(f.x-d.x)*y;return 0===T||Math.abs((f.y-d.y)/T)>Jr}(n,s,u)?1===l.flipState?{needsFlipping:!0}:null:n.x>s.x?{needsFlipping:!0}:null}function jr(l,n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge,ce,ee,_e){const he=n/24,Le=l.lineOffsetX*he,ze=l.lineOffsetY*he;let Te=[];if(l.numGlyphs>1){const Re=l.glyphStartIndex+l.numGlyphs,tt=l.lineStartIndex,ut=l.lineStartIndex+l.lineLength,st=an(he,T,Le,ze,s,V,K,l,E,f,fe,ge,!1,ce,ee,_e);if(!st)return{notEnoughRoom:!0};const zt=nn(st.first.point,y).point,Ye=nn(st.last.point,y).point,At=new o.pointGeometry(zt[0],zt[1]),Et=new o.pointGeometry(Ye[0],Ye[1]);if(u&&!s){const it=os(l,At,Et,ie);if(l.flipState=it&&it.needsFlipping?1:2,it)return it}Te=[st.first];for(let it=l.glyphStartIndex+1;it<Re-1;it++){const Ze=Dn(he*T.getoffsetX(it),Le,ze,s,V,K,l.segment,tt,ut,E,f,fe,ge,!1,!1,ce,ee,_e);if(!Ze)return{notEnoughRoom:!0};Te.push(Ze)}Te.push(st.last)}else{if(u&&!s){const tt=Jt(K,d).point,ut=l.lineStartIndex+l.segment+1,st=new o.pointGeometry(E.getx(ut),E.gety(ut)),zt=Jt(st,d),Ye=zt.signedDistanceFromCamera>0?zt.point:yr(K,st,tt,1,d,void 0,ce,ee.canonical),At=os(l,new o.pointGeometry(tt[0],tt[1]),new o.pointGeometry(Ye[0],Ye[1]),ie);if(l.flipState=At&&At.needsFlipping?1:2,At)return At}const Re=Dn(he*T.getoffsetX(l.glyphStartIndex),Le,ze,s,V,K,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,E,f,fe,ge,!1,!1,ce,ee,_e);if(!Re)return{notEnoughRoom:!0};Te=[Re]}if(z)for(const Re of Te)o.updateGlobeVertexNormal(z,P.length+0,Re.up[0],Re.up[1],Re.up[2]),o.updateGlobeVertexNormal(z,P.length+1,Re.up[0],Re.up[1],Re.up[2]),o.updateGlobeVertexNormal(z,P.length+2,Re.up[0],Re.up[1],Re.up[2]),o.updateGlobeVertexNormal(z,P.length+3,Re.up[0],Re.up[1],Re.up[2]),o.addDynamicAttributes(P,Re.point[0],Re.point[1],Re.point[2],Re.angle);else for(const Re of Te)o.addDynamicAttributes(P,Re.point[0],Re.point[1],Re.point[2],Re.angle);return{}}function Vr(l,n,s,u,d){const f=u.projectTilePoint(l.x,l.y,n);if(!d)return Jt(f,s,f.z);const y=d(l);return Jt(new o.pointGeometry(f.x+y[0],f.y+y[1]),s,f.z+y[2])}function yr(l,n,s,u,d,f,y,T){const E=Vr(l.add(l.sub(n)._unit()),T,d,y,f).point,P=o.sub([],s,E);return o.scaleAndAdd([],s,P,u/o.length(P))}function Dn(l,n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge,ce,ee){const _e=u?l-n:l+n;let he=_e>0?1:-1,Le=0;u&&(he*=-1,Le=Math.PI),he<0&&(Le+=Math.PI);let ze=he>0?T+y:T+y+1,Te=d,Re=d,tt=0,ut=0;const st=Math.abs(_e),zt=[],Ye=[];let At=f;const Et=()=>{const Ht=ze-he;return 0===tt?f:new o.pointGeometry(P.getx(Ht),P.gety(Ht))},it=()=>{const Ht=Et();return yr(Ht,At||Ht,Re,st-tt+1,z,K,ge,ce.canonical)};for(;tt+ut<=st;){if(ze+=he,ze<T||ze>=E)return null;if(Re=Te,zt.push(Te),fe&&Ye.push(At||Et()),Te=V[ze],void 0===Te){At=new o.pointGeometry(P.getx(ze),P.gety(ze));const Ht=Vr(At,ce.canonical,z,ge,K);Te=Ht.signedDistanceFromCamera>0?V[ze]=Ht.point:it()}else At=null;tt+=ut,ut=o.distance(Re,Te)}At=At||new o.pointGeometry(P.getx(ze),P.gety(ze));const Ze=Et();ie&&K&&(V[ze]=Te=void 0===V[ze]?Te:it(),ut=o.distance(Re,Te));const ni=(st-tt)/ut,Gt=At.sub(Ze).mult(ni)._add(Ze),Qt=o.sub([],Te,Re),Zt=o.scaleAndAdd([],Re,Qt,ni);let vi=[0,0,1],Ui=Qt[0],Li=Qt[1];if(ee&&(vi=ge.upVector(ce.canonical,Gt.x,Gt.y),0!==vi[0]||0!==vi[1]||1!==vi[2])){const Ht=[1,0,0],Wi=[0,1,0];Ht[0]=vi[2],Ht[1]=0,Ht[2]=-vi[0],o.cross(Wi,vi,Ht),o.normalize(Ht,Ht),o.normalize(Wi,Wi),Ui=o.dot(Qt,Ht),Li=o.dot(Qt,Wi)}if(s){const Ht=o.cross([],vi,Qt);o.normalize(Ht,Ht),o.scaleAndAdd(Zt,Zt,Ht,s*he)}const Ei=Le+Math.atan2(Li,Ui);return zt.push(Zt),fe&&Ye.push(Gt),{point:Zt,angle:Ei,path:zt,tilePath:Ye,up:vi}}const ra=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $r(l,n){for(let s=0;s<l;s++){const u=n.length;n.resize(u+4),n.float32.set(ra,4*u)}}function So(l,n,s){const u=n[0],d=n[1];return l[0]=s[0]*u+s[4]*d+s[12],l[1]=s[1]*u+s[5]*d+s[13],l[3]=s[3]*u+s[7]*d+s[15],l}const Sr=100;class Ro{constructor(n,s,u=new _o(n.width+200,n.height+200,25),d=new _o(n.width+200,n.height+200,25)){this.transform=n,this.grid=u,this.ignoredGrid=d,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Sr,this.screenBottomBoundary=n.height+Sr,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=s}placeCollisionBox(n,s,u,d,f,y,T,E){let P=u.projectedAnchorX,z=u.projectedAnchorY,V=u.projectedAnchorZ;const K=u.elevation,fe=u.tileID;if(K&&fe){const ze=n.getProjection().upVector(fe.canonical,u.tileAnchorX,u.tileAnchorY),Te=n.getProjection().upVectorScale(fe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ze[0]*K*Te,z+=ze[1]*K*Te,V+=ze[2]*K*Te}const ie=this.projectAndGetPerspectiveRatio(T,[P,z,V],u.tileID,"globe"===n.projection.name||!!K||this.transform.pitch>0,n.getProjection()),ge=y*ie.perspectiveRatio,ce=(u.x1*s+d.x-u.padding)*ge+ie.point.x,ee=(u.y1*s+d.y-u.padding)*ge+ie.point.y,_e=(u.x2*s+d.x+u.padding)*ge+ie.point.x,he=(u.y2*s+d.y+u.padding)*ge+ie.point.y,Le=ie.perspectiveRatio<=.55||ie.occluded;return!this.isInsideGrid(ce,ee,_e,he)||!f&&this.grid.hitTest(ce,ee,_e,he,E)||Le?{box:[],offscreen:!1,occluded:ie.occluded}:{box:[ce,ee,_e,he],offscreen:this.isOffscreen(ce,ee,_e,he),occluded:!1}}placeCollisionCircles(n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge){const ce=[],ee=this.transform.elevation,_e=ee?ee.getAtTileOffsetFunc(ge,this.transform.center.lat,this.transform.worldSize,n.getProjection()):Ze=>[0,0,0],he=new o.pointGeometry(u.tileAnchorX,u.tileAnchorY),Le=n.getProjection().projectTilePoint(u.tileAnchorX,u.tileAnchorY,ge.canonical),ze=_e(he),Te=[Le.x+ze[0],Le.y+ze[1],Le.z+ze[2]],Re="globe"===n.projection.name,tt=this.projectAndGetPerspectiveRatio(T,[Te[0],Te[1],Te[2]],ge,Re||!!ee||this.transform.pitch>0,n.getProjection()),{perspectiveRatio:ut}=tt,st=(V?y/ut:y*ut)/o.ONE_EM,zt=Jt(new o.pointGeometry(Te[0],Te[1]),E,Te[2]).point,Ye=tt.signedDistanceFromCamera>0?an(st,f,u.lineOffsetX*st,u.lineOffsetY*st,!1,zt,he,u,d,E,{},ee&&!V?_e:null,V&&!!ee,n.getProjection(),ge,V):null;let At=!1,Et=!1,it=!0;if(Ye&&!tt.occluded){const Ze=.5*fe*ut+ie,ni=new o.pointGeometry(-100,-100),Gt=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Qt=new Lr,Zt=Ye.first,vi=Ye.last;let Ui=[];for(let Ht=Zt.path.length-1;Ht>=1;Ht--)Ui.push(Zt.path[Ht]);for(let Ht=1;Ht<vi.path.length;Ht++)Ui.push(vi.path[Ht]);const Li=2.5*Ze;if(P){const Ht=Ui.map(ee&&!Re?(Wi,cn)=>{const Ln=_e(cn<Zt.path.length-1?Zt.tilePath[Zt.path.length-1-cn]:vi.tilePath[cn-Zt.path.length+2]);return Wi[2]=Ln[2],nn(Wi,P)}:Wi=>nn(Wi,P));Ui=Ht.some(Wi=>Wi.signedDistanceFromCamera<=0)?[]:Ht.map(Wi=>Wi.point)}let Ei=[];if(Ui.length>0){const Ht=Ui.map(kn=>new o.pointGeometry(kn[0],kn[1]));let Wi=1/0,cn=-1/0,Ln=1/0,zn=-1/0;for(let kn=0;kn<Ht.length;kn++)Wi=Math.min(Wi,Ht[kn].x),Ln=Math.min(Ln,Ht[kn].y),cn=Math.max(cn,Ht[kn].x),zn=Math.max(zn,Ht[kn].y);Ei=Wi>=ni.x&&cn<=Gt.x&&Ln>=ni.y&&zn<=Gt.y?[Ht]:cn<ni.x||Wi>Gt.x||zn<ni.y||Ln>Gt.y?[]:o.clipLine([Ht],ni.x,ni.y,Gt.x,Gt.y)}for(const Ht of Ei){Qt.reset(Ht,.25*Ze);let Wi=0;Wi=Qt.length<=.5*Ze?1:Math.ceil(Qt.paddedLength/Li)+1;for(let cn=0;cn<Wi;cn++){const Ln=cn/Math.max(Wi-1,1),zn=Qt.lerp(Ln),kn=zn.x+Sr,Mr=zn.y+Sr;ce.push(kn,Mr,Ze,0);const no=kn-Ze,Qo=Mr-Ze,Xn=kn+Ze,nr=Mr+Ze;if(it=it&&this.isOffscreen(no,Qo,Xn,nr),Et=Et||this.isInsideGrid(no,Qo,Xn,nr),!s&&this.grid.hitTestCircle(kn,Mr,Ze,K)&&(At=!0,!z))return{circles:[],offscreen:!1,collisionDetected:At,occluded:!1}}}}return{circles:!z&&At||!Et?[]:ce,offscreen:it,collisionDetected:At,occluded:tt.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const s=[];let u=1/0,d=1/0,f=-1/0,y=-1/0;for(const z of n){const V=new o.pointGeometry(z.x+Sr,z.y+Sr);u=Math.min(u,V.x),d=Math.min(d,V.y),f=Math.max(f,V.x),y=Math.max(y,V.y),s.push(V)}const T=this.grid.query(u,d,f,y).concat(this.ignoredGrid.query(u,d,f,y)),E={},P={};for(const z of T){const V=z.key;if(void 0===E[V.bucketInstanceId]&&(E[V.bucketInstanceId]={}),E[V.bucketInstanceId][V.featureIndex])continue;const K=[new o.pointGeometry(z.x1,z.y1),new o.pointGeometry(z.x2,z.y1),new o.pointGeometry(z.x2,z.y2),new o.pointGeometry(z.x1,z.y2)];o.polygonIntersectsPolygon(s,K)&&(E[V.bucketInstanceId][V.featureIndex]=!0,void 0===P[V.bucketInstanceId]&&(P[V.bucketInstanceId]=[]),P[V.bucketInstanceId].push(V.featureIndex))}return P}insertCollisionBox(n,s,u,d,f){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:f},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,s,u,d,f){const y=s?this.ignoredGrid:this.grid,T={bucketInstanceId:u,featureIndex:d,collisionGroupID:f};for(let E=0;E<n.length;E+=4)y.insertCircle(T,n[E],n[E+1],n[E+2])}projectAndGetPerspectiveRatio(n,s,u,d,f){const y=[s[0],s[1],s[2],1];let T=!1;if(s[2]||this.transform.pitch>0){o.transformMat4$1(y,y,n);const E="globe"===f.name;this.fogState&&u&&!E&&(T=function(P,z,V,K,fe,ie){const ge=ie.calculateFogTileMatrix(fe),ce=[z,V,K];return o.transformMat4(ce,ce,ge),mi(P,ce,ie.pitch,ie._fov)}(this.fogState,s[0],s[1],s[2],u.toUnwrapped(),this.transform)>.9)}else So(y,y,n);return{point:new o.pointGeometry((y[0]/y[3]+1)/2*this.transform.width+Sr,(-y[1]/y[3]+1)/2*this.transform.height+Sr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(f)/y[3]*.5,1.5),signedDistanceFromCamera:y[3],occluded:d&&y[2]>y[3]||T}}isOffscreen(n,s,u,d){return u<Sr||n>=this.screenRightBoundary||d<Sr||s>this.screenBottomBoundary}isInsideGrid(n,s,u,d){return u>=0&&n<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const n=o.identity([]);return o.translate(n,n,[-100,-100,0]),n}}function Bo(l,n,s){const u=n.createTileMatrix(l,l.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),l.projMatrix,u)}function Zo(l,n,s){if(n.projection.name===s.projection.name)return l.projMatrix;const u=s.clone();return u.setProjection(n.projection),Bo(u,n.getProjection(),l)}function Ho(l,n,s){return n.name===s.projection.name?l.projMatrix:Bo(s,n,l)}class Ao{constructor(n,s,u,d){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):d&&u?1:0,this.placed=u}isHidden(){return 0===this.opacity&&!this.placed}}class so{constructor(n,s,u,d,f,y=!1){this.text=new Ao(n?n.text:null,s,u,f),this.icon=new Ao(n?n.icon:null,s,d,f),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vr{constructor(n,s,u,d=!1){this.text=n,this.icon=s,this.skipFade=u,this.clipped=d}}class ir{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class js{constructor(n,s,u,d,f){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=f}}class yo{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[n]}}function Ar(l,n,s,u,d){const{horizontalAlign:f,verticalAlign:y}=o.getAnchorAlignment(l),T=-(f-.5)*n,E=-(y-.5)*s,P=o.evaluateVariableOffset(l,u);return new o.pointGeometry(T+P[0]*d,E+P[1]*d)}function Ir(l,n,s,u,d){const f=new o.pointGeometry(l,n);return s&&f._rotate(u?d:-d),f}class Wo{constructor(n,s,u,d,f){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Ro(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new yo(u),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,s,u,d){const f=u.getBucket(s),y=u.latestFeatureIndex;if(!f||!y||s.id!==f.layerIds[0])return;const T=f.layers[0].layout,E=u.collisionBoxArray,P=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),z=u.tileSize/o.EXTENT,V=u.tileID.toUnwrapped();this.transform.setProjection(f.projection);const K=(fe=u.tileID,ie=f.getProjection(),ge=this.transform,ie.name===this.projection?ge.calculateProjMatrix(fe.toUnwrapped()):Bo(ge,ie,fe));var fe,ie,ge;const ce="map"===T.get("text-pitch-alignment"),ee="map"===T.get("text-rotation-alignment");s.compileFilter();const _e=s.dynamicFilter(),he=s.dynamicFilterNeedsFeature(),Le=this.transform.calculatePixelsToTileUnitsMatrix(u),ze=rs(K,u.tileID.canonical,ce,ee,this.transform,f.getProjection(),Le);let Te=null;if(ce){const ut=Eo(K,u.tileID.canonical,ce,ee,this.transform,f.getProjection(),Le);Te=o.multiply([],this.transform.labelPlaneMatrix,ut)}let Re=null;_e&&u.latestFeatureIndex&&(Re={unwrappedTileID:V,dynamicFilter:_e,dynamicFilterNeedsFeature:he,featureIndex:u.latestFeatureIndex}),this.retainedQueryData[f.bucketInstanceId]=new js(f.bucketInstanceId,y,f.sourceLayerIndex,f.index,u.tileID);const tt={bucket:f,layout:T,posMatrix:K,textLabelPlaneMatrix:ze,labelToScreenMatrix:Te,clippingData:Re,scale:P,textPixelRatio:z,holdingForFade:u.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(f.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const ut of f.sortKeyRanges){const{sortKey:st,symbolInstanceStart:zt,symbolInstanceEnd:Ye}=ut;n.push({sortKey:st,symbolInstanceStart:zt,symbolInstanceEnd:Ye,parameters:tt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:tt})}attemptAnchorPlacement(n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge,ce,ee,_e){const he=[K.textOffset0,K.textOffset1],Le=Ar(n,u,d,he,f),ze=this.collisionIndex.placeCollisionBox(ie,f,s,Ir(Le.x,Le.y,y,T,this.transform.angle),V,E,P,z.predicate);if(ce){const Te=ie.getSymbolInstanceIconSize(_e,this.transform.zoom,K.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ie,Te,ce,Ir(Le.x,Le.y,y,T,this.transform.angle),V,E,P,z.predicate).box.length)return}if(ze.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[K.crossTileID].anchor),this.variableOffsets[K.crossTileID]={textOffset:he,width:u,height:d,anchor:n,textScale:f,prevAnchor:Te},this.markUsedJustification(ie,n,K,ge),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,ge,K),this.placedOrientations[K.crossTileID]=ge),{shift:Le,placedGlyphBoxes:ze}}}placeLayerBucketPart(n,s,u,d){const{bucket:f,layout:y,posMatrix:T,textLabelPlaneMatrix:E,labelToScreenMatrix:P,clippingData:z,textPixelRatio:V,holdingForFade:K,collisionBoxArray:fe,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ge,collisionGroup:ce}=n.parameters,ee=y.get("text-optional"),_e=y.get("icon-optional"),he=y.get("text-allow-overlap"),Le=y.get("icon-allow-overlap"),ze="map"===y.get("text-rotation-alignment"),Te="map"===y.get("text-pitch-alignment"),Re="none"!==y.get("icon-text-fit"),tt="viewport-y"===y.get("symbol-z-order");this.transform.setProjection(f.projection);let ut=he&&(Le||!f.hasIconData()||_e),st=Le&&(he||!f.hasTextData()||ee);!f.collisionArrays&&fe&&f.deserializeCollisionBoxes(fe),u&&d&&f.updateCollisionDebugBuffers(this.transform.zoom,fe);const zt=(Ye,At,Et)=>{if(z){const Xn={zoom:this.transform.zoom,pitch:this.transform.pitch};let nr=null;if(z.dynamicFilterNeedsFeature){const Mn=this.retainedQueryData[f.bucketInstanceId];nr=z.featureIndex.loadFeature({featureIndex:Ye.featureIndex,bucketIndex:Mn.bucketIndex,sourceLayerIndex:Mn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Xn,nr,this.retainedQueryData[f.bucketInstanceId].tileID.canonical,new o.pointGeometry(Ye.tileAnchorX,Ye.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Ye.crossTileID]=new vr(!1,!1,!1,!0),void(s[Ye.crossTileID]=!0)}if(s[Ye.crossTileID])return;if(K)return void(this.placements[Ye.crossTileID]=new vr(!1,!1,!1));let it=!1,Ze=!1,ni=!0,Gt=!1,Qt=!1,Zt=null,vi={box:null,offscreen:null,occluded:null},Ui={box:null,offscreen:null,occluded:null},Li=null,Ei=null,Ht=null,Wi=0,cn=0,Ln=0;Et.textFeatureIndex?Wi=Et.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(Wi=Ye.featureIndex),Et.verticalTextFeatureIndex&&(cn=Et.verticalTextFeatureIndex);const zn=Xn=>{Xn.tileID=this.retainedQueryData[f.bucketInstanceId].tileID,(this.transform.elevation||Xn.elevation)&&(Xn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[f.bucketInstanceId].tileID,Xn.tileAnchorX,Xn.tileAnchorY):0)},kn=Et.textBox;if(kn){zn(kn);const Xn=Mn=>{let fr=o.WritingMode.horizontal;if(f.allowVerticalPlacement&&!Mn&&this.prevPlacement){const Hr=this.prevPlacement.placedOrientations[Ye.crossTileID];Hr&&(this.placedOrientations[Ye.crossTileID]=Hr,fr=Hr,this.markUsedOrientation(f,fr,Ye))}return fr},nr=(Mn,fr)=>{if(f.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&Et.verticalTextBox){for(const Hr of f.writingModes)if(Hr===o.WritingMode.vertical?(vi=fr(),Ui=vi):vi=Mn(),vi&&vi.box&&vi.box.length)break}else vi=Mn()};if(y.get("text-variable-anchor")){let Mn=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye.crossTileID]){const Gn=this.prevPlacement.variableOffsets[Ye.crossTileID];Mn.indexOf(Gn.anchor)>0&&(Mn=Mn.filter(ho=>ho!==Gn.anchor),Mn.unshift(Gn.anchor))}const fr=(Gn,ho,Ws)=>{const jo=f.getSymbolInstanceTextSize(ie,Ye,this.transform.zoom,At),ro=(Gn.x2-Gn.x1)*jo+2*Gn.padding,_a=(Gn.y2-Gn.y1)*jo+2*Gn.padding,ks=Re&&!Le?ho:null;ks&&zn(ks);let Rr={box:[],offscreen:!1,occluded:!1};const es=he?2*Mn.length:Mn.length;for(let Is=0;Is<es;++Is){const Vo=this.attemptAnchorPlacement(Mn[Is%Mn.length],Gn,ro,_a,jo,ze,Te,V,T,ce,Is>=Mn.length,Ye,At,f,Ws,ks,ie,ge);if(Vo&&(Rr=Vo.placedGlyphBoxes,Rr&&Rr.box&&Rr.box.length)){it=!0,Zt=Vo.shift;break}}return Rr};nr(()=>fr(kn,Et.iconBox,o.WritingMode.horizontal),()=>{const Gn=Et.verticalTextBox;return Gn&&zn(Gn),f.allowVerticalPlacement&&!(vi&&vi.box&&vi.box.length)&&Ye.numVerticalGlyphVertices>0&&Gn?fr(Gn,Et.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),vi&&(it=vi.box,ni=vi.offscreen,Gt=vi.occluded);const Hr=Xn(vi&&vi.box);if(!it&&this.prevPlacement){const Gn=this.prevPlacement.variableOffsets[Ye.crossTileID];Gn&&(this.variableOffsets[Ye.crossTileID]=Gn,this.markUsedJustification(f,Gn.anchor,Ye,Hr))}}else{const Mn=(fr,Hr)=>{const Gn=f.getSymbolInstanceTextSize(ie,Ye,this.transform.zoom,At),ho=this.collisionIndex.placeCollisionBox(f,Gn,fr,new o.pointGeometry(0,0),he,V,T,ce.predicate);return ho&&ho.box&&ho.box.length&&(this.markUsedOrientation(f,Hr,Ye),this.placedOrientations[Ye.crossTileID]=Hr),ho};nr(()=>Mn(kn,o.WritingMode.horizontal),()=>{const fr=Et.verticalTextBox;return f.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&fr?(zn(fr),Mn(fr,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Xn(vi&&vi.box&&vi.box.length)}}if(Li=vi,it=Li&&Li.box&&Li.box.length>0,ni=Li&&Li.offscreen,Gt=Li&&Li.occluded,Ye.useRuntimeCollisionCircles){const Xn=f.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex>=0?Ye.centerJustifiedTextSymbolIndex:Ye.verticalPlacedTextSymbolIndex),nr=o.evaluateSizeForFeature(f.textSizeData,ie,Xn),Mn=y.get("text-padding");Ei=this.collisionIndex.placeCollisionCircles(f,he,Xn,f.lineVertexArray,f.glyphOffsetArray,nr,T,E,P,u,Te,ce.predicate,Ye.collisionCircleDiameter*nr/o.ONE_EM,Mn,this.retainedQueryData[f.bucketInstanceId].tileID),it=he||Ei.circles.length>0&&!Ei.collisionDetected,ni=ni&&Ei.offscreen,Gt=Ei.occluded}if(Et.iconFeatureIndex&&(Ln=Et.iconFeatureIndex),Et.iconBox){const Xn=nr=>{zn(nr);const Mn=Re&&Zt?Ir(Zt.x,Zt.y,ze,Te,this.transform.angle):new o.pointGeometry(0,0),fr=f.getSymbolInstanceIconSize(ge,this.transform.zoom,Ye.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(f,fr,nr,Mn,Le,V,T,ce.predicate)};Ui&&Ui.box&&Ui.box.length&&Et.verticalIconBox?(Ht=Xn(Et.verticalIconBox),Ze=Ht.box.length>0):(Ht=Xn(Et.iconBox),Ze=Ht.box.length>0),ni=ni&&Ht.offscreen,Qt=Ht.occluded}const Mr=ee||0===Ye.numHorizontalGlyphVertices&&0===Ye.numVerticalGlyphVertices,no=_e||0===Ye.numIconVertices;if(Mr||no?no?Mr||(Ze=Ze&&it):it=Ze&&it:Ze=it=Ze&&it,it&&Li&&Li.box&&this.collisionIndex.insertCollisionBox(Li.box,y.get("text-ignore-placement"),f.bucketInstanceId,Ui&&Ui.box&&cn?cn:Wi,ce.ID),Ze&&Ht&&this.collisionIndex.insertCollisionBox(Ht.box,y.get("icon-ignore-placement"),f.bucketInstanceId,Ln,ce.ID),Ei&&(it&&this.collisionIndex.insertCollisionCircles(Ei.circles,y.get("text-ignore-placement"),f.bucketInstanceId,Wi,ce.ID),u)){const Xn=f.bucketInstanceId;let nr=this.collisionCircleArrays[Xn];void 0===nr&&(nr=this.collisionCircleArrays[Xn]=new ir);for(let Mn=0;Mn<Ei.circles.length;Mn+=4)nr.circles.push(Ei.circles[Mn+0]),nr.circles.push(Ei.circles[Mn+1]),nr.circles.push(Ei.circles[Mn+2]),nr.circles.push(Ei.collisionDetected?1:0)}const Qo="globe"!==f.projection.name;ut=ut&&(Qo||!Gt),st=st&&(Qo||!Qt),this.placements[Ye.crossTileID]=new vr(it||ut,Ze||st,ni||f.justReloaded),s[Ye.crossTileID]=!0};if(tt){const Ye=f.getSortedSymbolIndexes(this.transform.angle);for(let At=Ye.length-1;At>=0;--At){const Et=Ye[At];zt(f.symbolInstances.get(Et),Et,f.collisionArrays[Et])}}else for(let Ye=n.symbolInstanceStart;Ye<n.symbolInstanceEnd;Ye++)zt(f.symbolInstances.get(Ye),Ye,f.collisionArrays[Ye]);if(u&&f.bucketInstanceId in this.collisionCircleArrays){const Ye=this.collisionCircleArrays[f.bucketInstanceId];o.invert(Ye.invProjMatrix,T),Ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}f.justReloaded=!1}markUsedJustification(n,s,u,d){let f;f=d===o.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];const y=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const T of y)T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=f>=0&&T!==f?0:u.crossTileID)}markUsedOrientation(n,s,u){const d=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,f=s===o.WritingMode.vertical?s:0,y=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex].filter(T=>-1!==T);for(const T of y)n.text.placedSymbolArray.get(T).placedOrientation=d;-1!==u.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const d=s?s.symbolFadeChange(n):1,f=s?s.opacities:{},y=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(const E in this.placements){const P=this.placements[E],z=f[E];z?(this.opacities[E]=new so(z,d,P.text,P.icon,null,P.clipped),u=u||P.text!==z.text.placed||P.icon!==z.icon.placed):(this.opacities[E]=new so(null,d,P.text,P.icon,P.skipFade,P.clipped),u=u||P.text||P.icon)}for(const E in f){const P=f[E];if(!this.opacities[E]){const z=new so(P,d,!1,!1);z.isHidden()||(this.opacities[E]=z,u=u||P.text.placed||P.icon.placed)}}for(const E in y)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=y[E]);for(const E in T)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=T[E]);u?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)}updateLayerOpacities(n,s){const u={};for(const d of s){const f=d.getBucket(n);f&&d.latestFeatureIndex&&n.id===f.layerIds[0]&&this.updateBucketOpacities(f,u,d.collisionBoxArray)}}updateBucketOpacities(n,s,u){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const d=n.layers[0].layout,f=!!n.layers[0].dynamicFilter(),y=new so(null,0,!1,!1,!0),T=d.get("text-allow-overlap"),E=d.get("icon-allow-overlap"),P=d.get("text-variable-anchor"),z="map"===d.get("text-rotation-alignment"),V="map"===d.get("text-pitch-alignment"),K="none"!==d.get("icon-text-fit"),fe=new so(null,0,T&&(E||!n.hasIconData()||d.get("icon-optional")),E&&(T||!n.hasTextData()||d.get("text-optional")),!0);!n.collisionArrays&&u&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(u);const ie=(ce,ee,_e)=>{for(let he=0;he<ee/4;he++)ce.opacityVertexArray.emplaceBack(_e)};let ge=0;for(let ce=0;ce<n.symbolInstances.length;ce++){const ee=n.symbolInstances.get(ce),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:he,crossTileID:Le}=ee;let ze=this.opacities[Le];s[Le]?ze=y:ze||(ze=fe,this.opacities[Le]=ze),s[Le]=!0;const Te=_e>0||he>0,Re=ee.numIconVertices>0,tt=this.placedOrientations[ee.crossTileID],ut=tt===o.WritingMode.vertical,st=tt===o.WritingMode.horizontal||tt===o.WritingMode.horizontalOnly;if(!Te&&!Re||ze.isHidden()||ge++,Te){const zt=eo(ze.text);ie(n.text,_e,ut?lo:zt),ie(n.text,he,st?lo:zt);const Ye=ze.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(it=>{it>=0&&(n.text.placedSymbolArray.get(it).hidden=Ye||ut?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Ye||st?1:0);const At=this.variableOffsets[ee.crossTileID];At&&this.markUsedJustification(n,At.anchor,ee,tt);const Et=this.placedOrientations[ee.crossTileID];Et&&(this.markUsedJustification(n,"left",ee,Et),this.markUsedOrientation(n,Et,ee))}if(Re){const zt=eo(ze.icon);ee.placedIconSymbolIndex>=0&&(ie(n.icon,ee.numIconVertices,ut?lo:zt),n.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=ze.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(ie(n.icon,ee.numVerticalIconVertices,st?lo:zt),n.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=ze.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const zt=n.collisionArrays[ce];if(zt){let Ye=new o.pointGeometry(0,0),At=!0;if(zt.textBox||zt.verticalTextBox){if(P){const it=this.variableOffsets[Le];it?(Ye=Ar(it.anchor,it.width,it.height,it.textOffset,it.textScale),z&&Ye._rotate(V?this.transform.angle:-this.transform.angle)):At=!1}f&&(At=!ze.clipped),zt.textBox&&ao(n.textCollisionBox.collisionVertexArray,ze.text.placed,!At||ut,Ye.x,Ye.y),zt.verticalTextBox&&ao(n.textCollisionBox.collisionVertexArray,ze.text.placed,!At||st,Ye.x,Ye.y)}const Et=At&&Boolean(!st&&zt.verticalIconBox);zt.iconBox&&ao(n.iconCollisionBox.collisionVertexArray,ze.icon.placed,Et,K?Ye.x:0,K?Ye.y:0),zt.verticalIconBox&&ao(n.iconCollisionBox.collisionVertexArray,ze.icon.placed,!Et,K?Ye.x:0,K?Ye.y:0)}}}if(n.fullyClipped=0===ge,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ce.invProjMatrix,n.placementViewportMatrix=ce.viewportMatrix,n.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>n}setStale(){this.stale=!0}}function ao(l,n,s,u,d){l.emplaceBack(n?1:0,s?1:0,u||0,d||0),l.emplaceBack(n?1:0,s?1:0,u||0,d||0),l.emplaceBack(n?1:0,s?1:0,u||0,d||0),l.emplaceBack(n?1:0,s?1:0,u||0,d||0)}const $n=Math.pow(2,25),Co=Math.pow(2,24),vs=Math.pow(2,17),Xo=Math.pow(2,16),Qn=Math.pow(2,9),Vs=Math.pow(2,8),Mo=Math.pow(2,1);function eo(l){if(0===l.opacity&&!l.placed)return 0;if(1===l.opacity&&l.placed)return 4294967295;const n=l.placed?1:0,s=Math.floor(127*l.opacity);return s*$n+n*Co+s*vs+n*Xo+s*Qn+n*Vs+s*Mo+n}const lo=0;class vo{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,s,u,d,f){const y=this._bucketParts;for(;this._currentTileIndex<n.length;)if(s.getBucketParts(y,d,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((T,E)=>T.sortKey-E.sortKey));this._currentPartIndex<y.length;){const T=y[this._currentPartIndex];if(s.placeLayerBucketPart(T,this._seenCrossTileIDs,u,0===T.symbolInstanceStart),this._currentPartIndex++,f())return!0}return!1}}class oa{constructor(n,s,u,d,f,y,T,E){this.placement=new Wo(n,f,y,T,E),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(n,s,u){const d=o.exported.now(),f=()=>{const y=o.exported.now()-d;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=s[n[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if("symbol"===y.type&&(!y.minzoom||y.minzoom<=T)&&(!y.maxzoom||y.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new vo(y)),this._inProgressLayer.continuePlacement(u[y.source],this.placement,this._showCollisionBoxes,y,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const ss=512/o.EXTENT/2;class Fo{constructor(n,s,u){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(let d=0;d<s.length;d++){const f=s.get(d),y=f.key;this.indexedSymbolInstances[y]||(this.indexedSymbolInstances[y]=[]),this.indexedSymbolInstances[y].push({crossTileID:f.crossTileID,coord:this.getScaledCoordinates(f,n)})}}getScaledCoordinates(n,s){const u=ss/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+n.tileAnchorX)*u),y:Math.floor((s.canonical.y*o.EXTENT+n.tileAnchorY)*u)}}findMatches(n,s,u){const d=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<n.length;f++){const y=n.get(f);if(y.crossTileID)continue;const T=this.indexedSymbolInstances[y.key];if(!T)continue;const E=this.getScaledCoordinates(y,s);for(const P of T)if(Math.abs(P.coord.x-E.x)<=d&&Math.abs(P.coord.y-E.y)<=d&&!u[P.crossTileID]){u[P.crossTileID]=!0,y.crossTileID=P.crossTileID;break}}}}class m{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class b{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const s=Math.round((n-this.lng)/360);if(0!==s)for(const u in this.indexes){const d=this.indexes[u],f={};for(const y in d){const T=d[y];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),f[T.tileID.key]=T}this.indexes[u]=f}this.lng=n}addBucket(n,s,u){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const d=this.usedCrossTileIDs[n.overscaledZ];for(const f in this.indexes){const y=this.indexes[f];if(Number(f)>n.overscaledZ)for(const T in y){const E=y[T];E.tileID.isChildOf(n)&&E.findMatches(s.symbolInstances,n,d)}else{const T=y[n.scaledTo(Number(f)).key];T&&T.findMatches(s.symbolInstances,n,d)}}for(let f=0;f<s.symbolInstances.length;f++){const y=s.symbolInstances.get(f);y.crossTileID||(y.crossTileID=u.generate(),d[y.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Fo(n,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(n,s){for(const u in s.indexedSymbolInstances)for(const d of s.indexedSymbolInstances[u])delete this.usedCrossTileIDs[n][d.crossTileID]}removeStaleBuckets(n){let s=!1;for(const u in this.indexes){const d=this.indexes[u];for(const f in d)n[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[f]),delete d[f],s=!0)}return s}}class M{constructor(){this.layerIndexes={},this.crossTileIDs=new m,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,s,u,d){let f=this.layerIndexes[n.id];void 0===f&&(f=this.layerIndexes[n.id]=new b);let y=!1;const T={};"globe"!==d.name&&f.handleWrapJump(u);for(const E of s){const P=E.getBucket(n);P&&n.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(E.tileID,P,this.crossTileIDs)&&(y=!0),T[P.bucketInstanceId]=!0)}return f.removeStaleBuckets(T)&&(y=!0),y}pruneUnusedLayers(n){const s={};n.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const L=(l,n)=>o.emitValidationErrors(l,n&&n.filter(s=>"source.canvas"!==s.identifier)),q=o.pick(Pi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),J=o.pick(Pi,["setCenter","setZoom","setBearing","setPitch"]),se={version:8,layers:[],sources:{}},Ve={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class G extends o.Evented{constructor(n,s={}){super(),this.map=n,this.dispatcher=new pt(Di(),this),this.imageManager=new Nt,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(n._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.crossTileSymbolIndex=new M,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const u=this;this._rtlTextPluginCallback=G.registerForPluginStateChange(d=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(f,y)=>{if(o.triggerPluginCompletionEvent(f),y&&y.every(T=>T))for(const T in u._sourceCaches){const E=u._sourceCaches[T],P=E.getSource().type;"vector"!==P&&"geojson"!==P||E.reload()}})}),this.on("data",d=>{if("source"!==d.dataType||"metadata"!==d.sourceDataType)return;const f=this.getSource(d.sourceId);if(f&&f.vectorLayerIds)for(const y in this._layers){const T=this._layers[y];T.source===f.id&&this._validateLayer(T)}})}loadURL(n,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const u="boolean"==typeof s.validate?s.validate:!o.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,s.accessToken);const d=this.map._requestManager.transformRequest(n,o.ResourceType.Style);this._request=o.getJSON(d,(f,y)=>{this._request=null,f?this.fire(new o.ErrorEvent(f)):y&&this._load(y,u)})}loadJSON(n,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(n,!1!==s.validate)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(se,!1)}_updateLayerCount(n,s){const u=s?1:-1;n.is3D()&&(this._num3DLayers+=u),"circle"===n.type&&(this._numCircleLayers+=u),"symbol"===n.type&&(this._numSymbolLayers+=u)}_load(n,s){if(s&&L(this,o.validateStyle(n)))return;this._loaded=!0,this.stylesheet=o.clone$1(n),this._updateMapProjection();for(const d in n.sources)this.addSource(d,n.sources[d],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const u=gn(this.stylesheet.layers);this._order=u.map(d=>d.id),this._layers={},this._serializedLayers={};for(let d of u)d=o.createStyleLayer(d),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new li(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(s,u,d){let f,y,T;const E=o.exported.devicePixelRatio>1?"@2x":"";let P=o.getJSON(u.transformRequest(u.normalizeSpriteURL(s,E,".json"),o.ResourceType.SpriteJSON),(K,fe)=>{P=null,T||(T=K,f=fe,V())}),z=o.getImage(u.transformRequest(u.normalizeSpriteURL(s,E,".png"),o.ResourceType.SpriteImage),(K,fe)=>{z=null,T||(T=K,y=fe,V())});function V(){if(T)d(T);else if(f&&y){const K=o.exported.getImageData(y),fe={};for(const ie in f){const{width:ge,height:ce,x:ee,y:_e,sdf:he,pixelRatio:Le,stretchX:ze,stretchY:Te,content:Re}=f[ie],tt=new o.RGBAImage({width:ge,height:ce});o.RGBAImage.copy(K,tt,{x:ee,y:_e},{x:0,y:0},{width:ge,height:ce}),fe[ie]={data:tt,pixelRatio:Le,sdf:he,stretchX:ze,stretchY:Te,content:Re}}d(null,fe)}}return{cancel(){P&&(P.cancel(),P=null),z&&(z.cancel(),z=null)}}}(n,this.map._requestManager,(s,u)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(u)for(const d in u)this.imageManager.addImage(d,u[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(n){const s=this.getSource(n.source);if(!s)return;const u=n.sourceLayer;u&&("geojson"===s.type||s.vectorLayerIds&&-1===s.vectorLayerIds.indexOf(u))&&this.fire(new o.ErrorEvent(new Error(`Source layer "${u}" does not exist on source "${s.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const s=[];for(const u of n){const d=this._layers[u];"custom"!==d.type&&s.push(d.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&Ve[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const s=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const y in this._updatedSources){const T=this._updatedSources[y];"reload"===T?this._reloadSource(y):"clear"===T&&this._clearSource(y)}this._updateTilesForChangedImages();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const u={};for(const d in this._sourceCaches){const f=this._sourceCaches[d];u[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];if(f.recalculate(n,this._availableImages),!f.isHidden(n.zoom)){const T=this._getLayerSourceCache(f);T&&(T.used=!0)}const y=this.map.painter;if(y){const T=f.getProgramIds();if(!T)continue;const E=f.getProgramConfiguration(n.zoom);for(const P of T)y.useProgram(P,E)}}for(const d in u){const f=this._sourceCaches[d];u[d]!==f.used&&f.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:f.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),L(this,o.validateStyle(n)))return!1;(n=o.clone$1(n)).layers=gn(n.layers);const s=function(d,f){if(!d)return[{command:Pi.setStyle,args:[f]}];let y=[];try{if(!D(d.version,f.version))return[{command:Pi.setStyle,args:[f]}];D(d.center,f.center)||y.push({command:Pi.setCenter,args:[f.center]}),D(d.zoom,f.zoom)||y.push({command:Pi.setZoom,args:[f.zoom]}),D(d.bearing,f.bearing)||y.push({command:Pi.setBearing,args:[f.bearing]}),D(d.pitch,f.pitch)||y.push({command:Pi.setPitch,args:[f.pitch]}),D(d.sprite,f.sprite)||y.push({command:Pi.setSprite,args:[f.sprite]}),D(d.glyphs,f.glyphs)||y.push({command:Pi.setGlyphs,args:[f.glyphs]}),D(d.transition,f.transition)||y.push({command:Pi.setTransition,args:[f.transition]}),D(d.light,f.light)||y.push({command:Pi.setLight,args:[f.light]}),D(d.fog,f.fog)||y.push({command:Pi.setFog,args:[f.fog]}),D(d.projection,f.projection)||y.push({command:Pi.setProjection,args:[f.projection]});const T={},E=[];!function(V,K,fe,ie){let ge;for(ge in K=K||{},V=V||{})V.hasOwnProperty(ge)&&(K.hasOwnProperty(ge)||bn(ge,fe,ie));for(ge in K)K.hasOwnProperty(ge)&&(V.hasOwnProperty(ge)?D(V[ge],K[ge])||("geojson"===V[ge].type&&"geojson"===K[ge].type&&Kr(V,K,ge)?fe.push({command:Pi.setGeoJSONSourceData,args:[ge,K[ge].data]}):Yr(ge,K,fe,ie)):xn(ge,K,fe))}(d.sources,f.sources,E,T);const P=[];d.layers&&d.layers.forEach(V=>{V.source&&T[V.source]?y.push({command:Pi.removeLayer,args:[V.id]}):P.push(V)});let z=d.terrain;z&&T[z.source]&&(y.push({command:Pi.setTerrain,args:[void 0]}),z=void 0),y=y.concat(E),D(z,f.terrain)||y.push({command:Pi.setTerrain,args:[f.terrain]}),function(V,K,fe){K=K||[];const ie=(V=V||[]).map(_r),ge=K.map(_r),ce=V.reduce(Hn,{}),ee=K.reduce(Hn,{}),_e=ie.slice(),he=Object.create(null);let Le,ze,Te,Re,tt,ut,st;for(Le=0,ze=0;Le<ie.length;Le++)Te=ie[Le],ee.hasOwnProperty(Te)?ze++:(fe.push({command:Pi.removeLayer,args:[Te]}),_e.splice(_e.indexOf(Te,ze),1));for(Le=0,ze=0;Le<ge.length;Le++)Te=ge[ge.length-1-Le],_e[_e.length-1-Le]!==Te&&(ce.hasOwnProperty(Te)?(fe.push({command:Pi.removeLayer,args:[Te]}),_e.splice(_e.lastIndexOf(Te,_e.length-ze),1)):ze++,ut=_e[_e.length-Le],fe.push({command:Pi.addLayer,args:[ee[Te],ut]}),_e.splice(_e.length-Le,0,Te),he[Te]=!0);for(Le=0;Le<ge.length;Le++)if(Te=ge[Le],Re=ce[Te],tt=ee[Te],!he[Te]&&!D(Re,tt))if(D(Re.source,tt.source)&&D(Re["source-layer"],tt["source-layer"])&&D(Re.type,tt.type)){for(st in ct(Re.layout,tt.layout,fe,Te,null,Pi.setLayoutProperty),ct(Re.paint,tt.paint,fe,Te,null,Pi.setPaintProperty),D(Re.filter,tt.filter)||fe.push({command:Pi.setFilter,args:[Te,tt.filter]}),D(Re.minzoom,tt.minzoom)&&D(Re.maxzoom,tt.maxzoom)||fe.push({command:Pi.setLayerZoomRange,args:[Te,tt.minzoom,tt.maxzoom]}),Re)Re.hasOwnProperty(st)&&"layout"!==st&&"paint"!==st&&"filter"!==st&&"metadata"!==st&&"minzoom"!==st&&"maxzoom"!==st&&(0===st.indexOf("paint.")?ct(Re[st],tt[st],fe,Te,st.slice(6),Pi.setPaintProperty):D(Re[st],tt[st])||fe.push({command:Pi.setLayerProperty,args:[Te,st,tt[st]]}));for(st in tt)tt.hasOwnProperty(st)&&!Re.hasOwnProperty(st)&&"layout"!==st&&"paint"!==st&&"filter"!==st&&"metadata"!==st&&"minzoom"!==st&&"maxzoom"!==st&&(0===st.indexOf("paint.")?ct(Re[st],tt[st],fe,Te,st.slice(6),Pi.setPaintProperty):D(Re[st],tt[st])||fe.push({command:Pi.setLayerProperty,args:[Te,st,tt[st]]}))}else fe.push({command:Pi.removeLayer,args:[Te]}),ut=_e[_e.lastIndexOf(Te)+1],fe.push({command:Pi.addLayer,args:[tt,ut]})}(P,f.layers,y)}catch(T){console.warn("Unable to compute style diff:",T),y=[{command:Pi.setStyle,args:[f]}]}return y}(this.serialize(),n).filter(d=>!(d.command in J));if(0===s.length)return!1;const u=s.filter(d=>!(d.command in q));if(u.length>0)throw new Error(`Unimplemented: ${u.map(d=>d.command).join(", ")}.`);return s.forEach(d=>{"setTransition"!==d.command&&"setProjection"!==d.command&&this[d.command].apply(this,d.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,s){return this.getImage(n)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,s),this._afterImageUpdated(n),this)}updateImage(n,s){this.imageManager.updateImage(n,s)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,s,u={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${n}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const d=He(n,s,this.dispatcher,this);d.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:d.serialize(),sourceId:n}));const f=y=>{const T=(y?"symbol:":"other:")+n,E=this._sourceCaches[T]=new o.SourceCache(T,d,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[n]=E,E.style=this,E.onAdd(this.map)};f(!1),"vector"!==s.type&&"geojson"!==s.type||f(!0),d.onAdd&&d.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const s=this.getSource(n);if(!s)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const u=this._getSourceCaches(n);for(const d of u)delete this._sourceCaches[d.id],delete this._updatedSources[d.id],d.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,s){this._checkLoaded(),this.getSource(n).setData(s),this._changed=!0}getSource(n){const s=this._getSourceCache(n);return s&&s.getSource()}_getSources(){const n=[];for(const s in this._otherSourceCaches){const u=this._getSourceCache(s);u&&n.push(u.getSource())}return n}addLayer(n,s,u={}){this._checkLoaded();const d=n.id;if(this.getLayer(d))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${d}" already exists on this map`)));let f;if("custom"===n.type){if(L(this,o.validateCustomStyleLayer(n)))return;f=o.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(d,n.source),n=o.clone$1(n),n=o.extend(n,{source:d})),this._validate(o.validateLayer,`layers.${d}`,n,{arrayIndex:-1},u))return;f=o.createStyleLayer(n),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0)}const y=s?this._order.indexOf(s):this._order.length;if(s&&-1===y)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(y,0,d),this._layerOrderChanged=!0,this._layers[d]=f;const T=this._getLayerSourceCache(f);if(this._removedLayers[d]&&f.source&&T&&"custom"!==f.type){const E=this._removedLayers[d];delete this._removedLayers[d],E.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",T.pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,s){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===s)return;const u=this._order.indexOf(n);this._order.splice(u,1);const d=s?this._order.indexOf(s):this._order.length;s&&-1===d?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(d,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const s=this._layers[n];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const u=this._order.indexOf(n);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=s,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const s in this._layers)if(this._layers[s].type===n)return!0;return!1}setLayerZoomRange(n,s,u){this._checkLoaded();const d=this.getLayer(n);d?d.minzoom===s&&d.maxzoom===u||(null!=s&&(d.minzoom=s),null!=u&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,s,u={}){this._checkLoaded();const d=this.getLayer(n);if(d){if(!D(d.filter,s))return null==s?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(o.validateFilter,`layers.${d.id}.filter`,s,{layerType:d.type},u)||(d.filter=o.clone$1(s),this._updateLayer(d)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const s=this.getLayer(n);return s&&o.clone$1(s.filter)}setLayoutProperty(n,s,u,d={}){this._checkLoaded();const f=this.getLayer(n);f?D(f.getLayoutProperty(s),u)||(f.setLayoutProperty(s,u,d),this._updateLayer(f)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,s){const u=this.getLayer(n);if(u)return u.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,s,u,d={}){this._checkLoaded();const f=this.getLayer(n);f?D(f.getPaintProperty(s),u)||(f.setPaintProperty(s,u,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,s){const u=this.getLayer(n);return u&&u.getPaintProperty(s)}setFeatureState(n,s){this._checkLoaded();const u=n.source,d=n.sourceLayer,f=this.getSource(u);if(!f)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const y=f.type;if("geojson"===y&&d)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===y&&!d)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(u);for(const E of T)E.setFeatureState(d,n.id,s)}removeFeatureState(n,s){this._checkLoaded();const u=n.source,d=this.getSource(u);if(!d)return void this.fire(new o.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)));const f=d.type,y="vector"===f?n.sourceLayer:void 0;if("vector"===f&&!y)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(u);for(const E of T)E.removeFeatureState(y,n.id,s)}getFeatureState(n){this._checkLoaded();const s=n.source,u=n.sourceLayer,d=this.getSource(s);if(d){if("vector"!==d.type||u)return void 0===n.id&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(u,n.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const s in this._sourceCaches){const u=this._sourceCaches[s].getSource();n[u.id]||(n[u.id]=u.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},s=>void 0!==s)}_updateLayer(n){this._updatedLayers[n.id]=!0;const s=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&s&&"raster"!==s.getSource().type&&(this._updatedSources[n.source]="reload",s.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const s=y=>"fill-extrusion"===this._layers[y].type,u={},d=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T)){u[T]=y;for(const E of n){const P=E[T];if(P)for(const z of P)d.push(z)}}}d.sort((y,T)=>T.intersectionZ-y.intersectionZ);const f=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T))for(let E=d.length-1;E>=0;E--){const P=d[E].feature;if(u[P.layer.id]<y)break;f.push(P),d.pop()}else for(const E of n){const P=E[T];if(P)for(const z of P)f.push(z.feature)}}return f}queryRenderedFeatures(n,s,u){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of s.layers){const P=this._layers[E];if(!P)return this.fire(new o.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];d[P.source]=!0}}const f=[];s.availableImages=this._availableImages;const y=s&&s.layers?s.layers.some(E=>{const P=this.getLayer(E);return P&&P.is3D()}):this.has3DLayers(),T=mn.createFromScreenPoints(n,u);for(const E in this._sourceCaches){const P=this._sourceCaches[E].getSource().id;s.layers&&!d[P]||f.push(et(this._sourceCaches[E],this._layers,this._serializedLayers,T,s,u,y,!!this.map._showQueryGeometry))}return this.placement&&f.push(function(E,P,z,V,K,fe,ie){const ge={},ce=fe.queryRenderedSymbols(V),ee=[];for(const _e of Object.keys(ce).map(Number))ee.push(ie[_e]);ee.sort(oi);for(const _e of ee){const he=_e.featureIndex.lookupSymbolFeatures(ce[_e.bucketInstanceId],P,_e.bucketIndex,_e.sourceLayerIndex,K.filter,K.layers,K.availableImages,E);for(const Le in he){const ze=ge[Le]=ge[Le]||[],Te=he[Le];Te.sort((Re,tt)=>{const ut=_e.featureSortOrder;if(ut){const st=ut.indexOf(Re.featureIndex);return ut.indexOf(tt.featureIndex)-st}return tt.featureIndex-Re.featureIndex});for(const Re of Te)ze.push(Re)}}for(const _e in ge)ge[_e].forEach(he=>{const Le=he.feature,ze=z(E[_e]).getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=ze});return ge}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(n,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const u=this._getSourceCaches(n);let d=[];for(const f of u)d=d.concat(St(f,s));return d}addSourceType(n,s,u){return G.getSourceType(n)?u(new Error(`A source type called "${n}" already exists.`)):(G.setSourceType(n,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:s.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(n,s={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const y in n)if(!D(n[y],u[y])){d=!0;break}if(!d)return;const f=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,s),this.light.updateTransitions(f)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,s=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===s){if("object"==typeof n.source){const u="terrain-dem-src";this.addSource(u,n.source),n=o.clone$1(n),n=o.extend(n,{source:u})}if(this._validate(o.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(n,s);else{const u=this.terrain,d=u.get();for(const f of Object.keys(o.spec.terrain))!n.hasOwnProperty(f)&&o.spec.terrain[f].default&&(n[f]=o.spec.terrain[f].default);for(const f in n)if(!D(n[f],d[f])){u.set(n),this.stylesheet.terrain=n;const y=this._setTransitionParameters({duration:0});u.updateTransitions(y);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const s=this.fog=new ji(n,this.map.transform);this.stylesheet.fog=n;const u=this._setTransitionParameters({duration:0});s.updateTransitions(u)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,u=s.get();0===Object.keys(n).length&&s.set(n);for(const d in n)if(!D(n[d],u[d])){s.set(n),this.stylesheet.fog=n;const f=this._setTransitionParameters({duration:0});s.updateTransitions(f);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:o.exported.now(),transition:o.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(u=>this.isLayerDraped(this._layers[u])),s=this._order.filter(u=>!this.isLayerDraped(this._layers[u]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...s)}_createTerrain(n,s){const u=this.terrain=new Bi(n,s);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const d=this._setTransitionParameters({duration:0});u.updateTransitions(d)}_force3DLayerUpdate(){for(const n in this._layers){const s=this._layers[n];"fill-extrusion"===s.type&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const s=this._layers[n];"symbol"===s.type&&this._updateLayer(s)}}_validate(n,s,u,d,f={}){return(!f||!1!==f.validate)&&L(this,n.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:u,styleSpec:o.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const s=this._getSourceCaches(n);for(const u of s)u.clearTiles()}_reloadSource(n){const s=this._getSourceCaches(n);for(const u of s)u.resume(),u.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const s in this._sourceCaches)this._sourceCaches[s].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const s=this._sourceCaches[n];s.resume(),s.reload()}}_updatePlacement(n,s,u,d,f=!1){let y=!1,T=!1;const E={};for(const P of this._order){const z=this._layers[P];if("symbol"!==z.type)continue;if(!E[z.source]){const K=this._getLayerSourceCache(z);if(!K)continue;E[z.source]=K.getRenderableIds(!0).map(fe=>K.getTileByID(fe)).sort((fe,ie)=>ie.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(ie.tileID)?-1:1))}const V=this.crossTileSymbolIndex.addLayer(z,E[z.source],n.center.lng,n.projection);y=y||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),f=f||this._layerOrderChanged||0===u,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),n.zoom))&&(this.pauseablePlacement=new oa(n,this._order,f,s,u,d,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),T=!0),y&&this.pauseablePlacement.placement.setStale()),T||y)for(const P of this._order){const z=this._layers[P];"symbol"===z.type&&this.placement.updateLayerOpacities(z,E[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,s,u){this.imageManager.getImages(s.icons,u),this._updateTilesForChangedImages();const d=f=>{f&&f.setDependencies(s.tileID.key,s.type,s.icons)};d(this._otherSourceCaches[s.source]),d(this._symbolSourceCaches[s.source])}getGlyphs(n,s,u){this.glyphManager.getGlyphs(s.stacks,u)}getResource(n,s,u){return o.makeRequest(s,u)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const s=[];return this._otherSourceCaches[n]&&s.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&s.push(this._symbolSourceCaches[n]),s}_isSourceCacheLoaded(n){const s=this._getSourceCaches(n);return 0===s.length?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):s.every(u=>u.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}G.getSourceType=function(l){return Xe[l]},G.setSourceType=function(l,n){Xe[l]=n},G.registerForPluginStateChange=o.registerForPluginStateChange;var x="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",B="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",de="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Ee="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ne="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let bt={},ei={};const Yt=[];ki(x,Yt),ki(de,Yt),ki(Ee,Yt),ki(Ne,Yt),bt=Fi("",de),ei=Fi(Ne,Ee);const hn=Fi("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),wn=x,Pn="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var fn={background:Fi("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Fi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Fi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Fi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Fi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Fi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Fi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Fi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Fi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Fi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Fi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Fi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Fi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Fi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Fi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Fi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Fi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Fi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Fi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Fi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",B),skyboxGradient:Fi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",B),skyboxCapture:Fi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Fi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Fi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ki(l,n){const s=l.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let u of s)if(u=u.trim(),"#"===u[0]&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const d=u.split(" ");for(const f of d)n.includes(f)||n.push(f)}}function Fi(l,n){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),d={},f=[...Yt];return ki(l,f),ki(n,f),{fragmentSource:l=l.replace(s,(y,T,E,P,z)=>(d[z]=!0,"define"===T?`\n#ifndef HAS_UNIFORM_u_${z}\nvarying ${E} ${P} ${z};\n#else\nuniform ${E} ${P} u_${z};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${z}\n    ${E} ${P} ${z} = u_${z};\n#endif\n`)),vertexSource:n=n.replace(s,(y,T,E,P,z)=>{const V="float"===P?"vec2":"vec4",K=z.match(/color/)?"color":V;return d[z]?"define"===T?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${E} ${V} a_${z};\nvarying ${E} ${P} ${z};\n#else\nuniform ${E} ${P} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = a_${z};\n#else\n    ${E} ${P} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${E} ${P} ${z} = u_${z};\n#endif\n`:"define"===T?`\n#ifndef HAS_UNIFORM_u_${z}\nuniform lowp float u_${z}_t;\nattribute ${E} ${V} a_${z};\n#else\nuniform ${E} ${P} u_${z};\n#endif\n`:"vec4"===K?`\n#ifndef HAS_UNIFORM_u_${z}\n    ${E} ${P} ${z} = a_${z};\n#else\n    ${E} ${P} ${z} = u_${z};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${z}\n    ${E} ${P} ${z} = unpack_mix_${K}(a_${z}, u_${z}_t);\n#else\n    ${E} ${P} ${z} = u_${z};\n#endif\n`}),staticAttributes:u,usedDefines:f}}class rn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,s,u,d,f,y,T){this.context=n;let E=this.boundPaintVertexBuffers.length!==d.length;for(let z=0;!E&&z<d.length;z++)this.boundPaintVertexBuffers[z]!==d[z]&&(E=!0);let P=this.boundDynamicVertexBuffers.length!==T.length;for(let z=0;!P&&z<T.length;z++)this.boundDynamicVertexBuffers[z]!==T[z]&&(P=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||E||P||this.boundIndexBuffer!==f||this.boundVertexOffset!==y)this.freshBind(s,u,d,f,y,T);else{n.bindVertexArrayOES.set(this.vao);for(const z of T)z&&z.bind();f&&f.dynamicDraw&&f.bind()}}freshBind(n,s,u,d,f,y){let T;const E=n.numAttributes,P=this.context,z=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffers=y;else{T=P.currentNumAttributes||0;for(let V=E;V<T;V++)z.disableVertexAttribArray(V)}s.enableAttributes(z,n),s.bind(),s.setVertexAttribPointers(z,n,f);for(const V of u)V.enableAttributes(z,n),V.bind(),V.setVertexAttribPointers(z,n,f);for(const V of y)V&&(V.enableAttributes(z,n),V.bind(),V.setVertexAttribPointers(z,n,f));d&&d.bind(),P.currentNumAttributes=E}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function An(l,n){const s=Math.pow(2,n.canonical.z),u=n.canonical.y;return[new o.MercatorCoordinate(0,u/s).toLngLat().lat,new o.MercatorCoordinate(0,(u+1)/s).toLngLat().lat]}function to(l,n,s,u,d,f,y){const T=l.context,E=T.gl,P=s.fbo;if(!P)return;l.prepareDrawTile();const z=l.useProgram("hillshade");T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,P.colorAttachment.get());const V=((ge,ce,ee,_e)=>{const he=ee.paint.get("hillshade-shadow-color"),Le=ee.paint.get("hillshade-highlight-color"),ze=ee.paint.get("hillshade-accent-color");let Te=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ee.paint.get("hillshade-illumination-anchor")&&(Te-=ge.transform.angle);const Re=!ge.options.moving;return{u_matrix:_e||ge.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Re),u_image:0,u_latrange:An(0,ce.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),Te],u_shadow:he,u_highlight:Le,u_accent:ze}})(l,s,u,l.terrain?n.projMatrix:null);l.prepareDrawProgram(T,z,n.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:fe,tileBoundsSegments:ie}=l.getTileBoundsBuffers(s);z.draw(T,E.TRIANGLES,d,f,y,o.CullFaceMode.disabled,V,u.id,K,fe,ie)}function No(l,n,s){if(!n.needsDEMTextureUpload)return;const u=l.context,d=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||l.getTileTexture(s.stride);const f=s.getPixels();n.demTexture?n.demTexture.update(f,{premultiply:!1}):n.demTexture=new o.Texture(u,f,d.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function or(l,n,s,u,d,f){const y=l.context,T=y.gl;if(!n.dem)return;const E=n.dem;if(y.activeTexture.set(T.TEXTURE1),No(l,n,E),!n.demTexture)return;n.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const P=E.dim;y.activeTexture.set(T.TEXTURE0);let z=n.fbo;if(!z){const ie=new o.Texture(y,{width:P,height:P,data:null},T.RGBA);ie.bind(T.LINEAR,T.CLAMP_TO_EDGE),z=n.fbo=y.createFramebuffer(P,P,!0),z.colorAttachment.set(ie.texture)}y.bindFramebuffer.set(z.framebuffer),y.viewport.set([0,0,P,P]);const{tileBoundsBuffer:V,tileBoundsIndexBuffer:K,tileBoundsSegments:fe}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(y,T.TRIANGLES,u,d,f,o.CullFaceMode.disabled,((ie,ge)=>{const ce=ge.stride,ee=o.create();return o.ortho(ee,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(ee,ee,[0,-o.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[ce,ce],u_zoom:ie.overscaledZ,u_unpack:ge.unpackVector}})(n.tileID,E),s.id,V,K,fe),n.needsHillshadePrepare=!1}const co=l=>({u_matrix:new o.UniformMatrix4f(l),u_image0:new o.Uniform1i(l),u_skirt_height:new o.Uniform1f(l)}),Yo=(l,n)=>({u_matrix:l,u_image0:0,u_skirt_height:n}),Cr=(l,n,s,u,d,f,y,T,E,P,z,V,K,fe)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:s,u_zoom_transition:d,u_merc_center:f,u_image0:0,u_frustum_tl:y,u_frustum_tr:T,u_frustum_br:E,u_frustum_bl:P,u_globe_pos:z,u_globe_radius:V,u_viewport:K,u_grid_matrix:fe?Float32Array.from(fe):new Float32Array(9)});function ko(l,n){return null!=l&&null!=n&&!(!l.hasData()||!n.hasData())&&null!=l.demTexture&&null!=n.demTexture&&l.tileID.key!==n.tileID.key}const pr=new class{constructor(){this.operations={}}newMorphing(l,n,s,u,d){if(l in this.operations){const f=this.operations[l];f.to.tileID.key!==s.tileID.key&&(f.queued=s)}else this.operations[l]={startTime:u,phase:0,duration:d,from:n,to:s,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const n=this.operations[l];return{from:n.from,to:n.to,phase:n.phase}}update(l){for(const n in this.operations){const s=this.operations[n];for(s.phase=(l-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,l)){delete this.operations[n];break}}}_nextOp(l,n){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=n,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},Un={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function on(l,n){const s=1<<l.z;return!n&&(0===l.x||l.x===s-1)||0===l.y||l.y===s-1}const xr=l=>({u_matrix:l});function uo(l,n,s,u,d){if(d>0){const f=o.exported.now(),y=(f-l.timeAdded)/d,T=n?(f-n.timeAdded)/d:-1,E=s.getSource(),P=u.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-P)>Math.abs(l.tileID.overscaledZ-P),V=z&&l.refreshedUponExpiration?1:o.clamp(z?y:1-T,0,1);return l.refreshedUponExpiration&&y>=1&&(l.refreshedUponExpiration=!1),n?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class ln extends o.SourceCache{constructor(n){const s={type:"raster-dem",maxzoom:n.transform.maxZoom},u=new pt(Di(),null),d=He("mock-dem",s,u,n.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,s){n.state="loaded",s(null)}}class Cn extends o.SourceCache{constructor(n){const s=He("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new pt(Di(),null),n.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,s,u){if(n.freezeTileCoverage)return;this.transform=n;const d=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((f,y)=>{if(f[y.key]="",!this._tiles[y.key]){const T=new o.Tile(y,this._source.tileSize*y.overscaleFactor(),n.tileZoom);T.state="loaded",this._tiles[y.key]=T}return f},{});for(const f in this._tiles)f in d||(this.freeFBO(f),this._tiles[f].unloadVectorData(),delete this._tiles[f])}freeFBO(n){const s=this.proxyCachedFBO[n];if(void 0!==s){const u=Object.values(s);this.renderCachePool.push(...u),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sr extends o.OverscaledTileID{constructor(n,s,u){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=s,this.projMatrix=u}}class Gr extends o.Elevation{constructor(n,s){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,d,f]=function(E){const P=new o.StructArrayLayout4i8,z=new o.StructArrayLayout3ui6,V=131;P.reserve(17161),z.reserve(33800);const K=o.EXTENT/128,fe=o.EXTENT+K/2,ie=fe+K;for(let ce=-K;ce<ie;ce+=K)for(let ee=-K;ee<ie;ee+=K){const _e=ee<0||ee>fe||ce<0||ce>fe?24575:0,he=o.clamp(Math.round(ee),0,o.EXTENT),Le=o.clamp(Math.round(ce),0,o.EXTENT);P.emplaceBack(he+_e,Le,he,Le)}const ge=(ce,ee)=>{const _e=ee*V+ce;z.emplaceBack(_e+1,_e,_e+V),z.emplaceBack(_e+V,_e+V+1,_e+1)};for(let ce=1;ce<129;ce++)for(let ee=1;ee<129;ee++)ge(ee,ce);return[0,129].forEach(ce=>{for(let ee=0;ee<130;ee++)ge(ee,ce),ge(ce,ee)}),[P,z,32768]}(),y=n.context;this.gridBuffer=y.createVertexBuffer(u,o.boundsAttributes.members),this.gridIndexBuffer=y.createIndexBuffer(d),this.gridSegments=o.SegmentVector.simpleSegment(0,0,u.length,d.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,u.length,f),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Cn(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,o.EXTENT,0,o.EXTENT,0,1);const T=y.gl;this._overlapStencilMode=new o.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ln(s.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,s,u){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const d=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(d.get("source")),this._exaggeration=d.get("exaggeration");const f=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const y=this.getScaledDemTileSize();this.sourceCache.update(s,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,f(),this._initializing=!0),f(),s.updateElevation(!u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&o.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=0===u._centerAltitude&&-1===this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(u.center),-1),this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=s.getIds().map(E=>{const P=s.getTileByID(E).tileID;return P.projMatrix=u.calculateProjMatrix(P.toUnwrapped()),P});(function(E,P){const z=P.transform.pointCoordinate(P.transform.getCameraPoint()),V=new o.pointGeometry(z.x,z.y);E.sort((K,fe)=>{if(fe.overscaledZ-K.overscaledZ)return fe.overscaledZ-K.overscaledZ;const ie=new o.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ge=new o.pointGeometry(fe.canonical.x+(1<<fe.canonical.z)*fe.wrap,fe.canonical.y),ce=V.mult(1<<K.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(ie)-ce.distSqr(ge)})})(d,this.painter),this._previousZoom=u.zoom;const f=this.proxyToSource||{};this.proxyToSource={},d.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const y=this._style._sourceCaches;for(const E in y){const P=y[E];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,n[E],f),P.usedForTerrain))continue;const z=n[E];P.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[s.id]=d.map(E=>new sr(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(f),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const T={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const P=this.terrainTileForTile[E.key];if(!P)continue;const z=P.tileID.key;z in T||(this._visibleDemTiles.push(P),T[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach(s=>{if(this.terrainTileForTile[s.key])return;const u=this._findTileCoveringTileID(s,this.sourceCache);u&&(this.terrainTileForTile[s.key]=u)})}_prepareDEMTextures(){const n=this.painter.context,s=n.gl;for(const u in this.terrainTileForTile){const d=this.terrainTileForTile[u],f=d.dem;!f||d.demTexture&&!d.needsDEMTextureUpload||(n.activeTexture.set(s.TEXTURE1),No(this.painter,d,f))}}_prepareDemTileUniforms(n,s,u,d){if(!s||null==s.demTexture)return!1;const f=n.tileID.canonical,y=Math.pow(2,s.tileID.canonical.z-f.z),T=d||"";return u[`u_dem_tl${T}`]=[f.x*y%1,f.y*y%1],u[`u_dem_scale${T}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,s=n.gl;if(!this._emptyDepthBufferTexture){const u=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(n,u,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const s=this._visibleDemTiles.reduce((u,d)=>{if(!d.dem)return u;const f=d.dem.tree.minimums[0];return f>0&&n++,u+f},0);return n?s/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,s=n.gl;n.activeTexture.set(s.TEXTURE2);const u=this._getLoadedAreaMinimum(),d=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(u,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let f=this._emptyDEMTexture;return f?f.update(d,{premultiply:!1}):f=this._emptyDEMTexture=new o.Texture(n,d,s.RGBA,{premultiply:!1}),f}setupElevationDraw(n,s,u){const d=this.painter.context,f=d.gl,y=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var T;y.u_dem_size=this.sourceCache.getSource().tileSize,y.u_exaggeration=this.exaggeration();let E=null,P=null,z=1;if(u&&u.morphing&&this._useVertexMorphing){const V=u.morphing.srcDemTile,K=u.morphing.dstDemTile;z=u.morphing.phase,V&&K&&(this._prepareDemTileUniforms(n,V,y,"_prev")&&(P=V),this._prepareDemTileUniforms(n,K,y)&&(E=K))}if(P&&E?(d.activeTexture.set(f.TEXTURE2),E.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),d.activeTexture.set(f.TEXTURE4),P.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE,f.NEAREST),y.u_dem_lerp=z):(E=this.terrainTileForTile[n.tileID.key],d.activeTexture.set(f.TEXTURE2),(this._prepareDemTileUniforms(n,E,y)?E.demTexture:this.emptyDEMTexture).bind(f.NEAREST,f.CLAMP_TO_EDGE)),d.activeTexture.set(f.TEXTURE3),u&&u.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),this._depthFBO&&(y.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE),y.u_depth_size_inv=[1,1]),u&&u.useMeterToDem&&E){const V=(1<<E.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=V}if(u&&u.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),s.setTerrainUniformValues(d,y),"globe"===this.painter.transform.projection.name){const V=this.globeUniformValues(this.painter.transform,n.tileID.canonical,u&&u.useDenormalizedUpVectorScale);s.setGlobeUniformValues(d,V)}}globeUniformValues(n,s,u){const d=n.projection;return{u_tile_tl_up:d.upVector(s,0,0),u_tile_tr_up:d.upVector(s,o.EXTENT,0),u_tile_br_up:d.upVector(s,o.EXTENT,o.EXTENT),u_tile_bl_up:d.upVector(s,0,o.EXTENT),u_tile_up_scale:u?o.GLOBE_METERS_TO_ECEF:d.upVectorScale(s,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const s=this.painter,u=this.painter.context;0!==n.length&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(d,f,y,T,E){if("globe"===d.transform.projection.name)!function(P,z,V,K,fe){const ie=P.context,ge=ie.gl;let ce,ee;const _e=P.options.showTerrainWireframe?2:0,he=P.transform,Le=o.globeUseCustomAntiAliasing(P,ie,he),ze=(it,Ze)=>{if(ee===it)return;const ni=[Un[it],"PROJECTION_GLOBE_VIEW"];Le&&ni.push("CUSTOM_ANTIALIASING"),Ze&&ni.push(Un[_e]),ce=P.useProgram("globeRaster",null,ni),ee=it},Te=P.colorModeForRenderPass(),Re=new o.DepthMode(ge.LEQUAL,o.DepthMode.ReadWrite,P.depthRangeFor3D);pr.update(fe);const tt=o.calculateGlobeMercatorMatrix(he),ut=[o.mercatorXfromLng(he.center.lng),o.mercatorYfromLat(he.center.lat)],st=_e?[!1,!0]:[!1],zt=P.globeSharedBuffers,Ye=[he.width*o.exported.devicePixelRatio,he.height*o.exported.devicePixelRatio],At=Float32Array.from(he.globeMatrix),Et={useDenormalizedUpVectorScale:!0};if(st.forEach(it=>{ee=-1;const Ze=it?ge.LINES:ge.TRIANGLES;for(const ni of K){const Gt=V.getTile(ni),Qt=o.StencilMode.disabled,Zt=z.prevTerrainTileForTile[ni.key],vi=z.terrainTileForTile[ni.key];ko(Zt,vi)&&pr.newMorphing(ni.key,Zt,vi,fe,250),ie.activeTexture.set(ge.TEXTURE0),Gt.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);const Ui=pr.getMorphValuesForProxy(ni.key),Li=Ui?1:0;Ui&&o.extend$1(Et,{morphing:{srcDemTile:Ui.from,dstDemTile:Ui.to,phase:o.easeCubicInOut(Ui.phase)}});const Ei=o.tileCornersToBounds(ni.canonical),Ht=o.getLatitudinalLod(Ei.getCenter().lat),Wi=o.getGridMatrix(ni.canonical,Ei,Ht,he.worldSize/he._pixelsPerMercatorPixel),cn=o.globeNormalizeECEF(o.globeTileBounds(ni.canonical)),Ln=Cr(he.projMatrix,At,tt,cn,o.globeToMercatorTransition(he.zoom),ut,he.frustumCorners.TL,he.frustumCorners.TR,he.frustumCorners.BR,he.frustumCorners.BL,he.globeCenterInViewSpace,he.globeRadius,Ye,Wi);if(ze(Li,it),z.setupElevationDraw(Gt,ce,Et),P.prepareDrawProgram(ie,ce,ni.toUnwrapped()),zt){const[zn,kn,Mr]=it?zt.getWirefameBuffers(P.context,Ht):zt.getGridBuffers(Ht);ce.draw(ie,Ze,Re,Qt,Te,o.CullFaceMode.backCCW,Ln,"globe_raster",zn,kn,Mr)}}}),zt){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Le&&it.push("CUSTOM_ANTIALIASING"),ce=P.useProgram("globeRaster",null,it);for(const Ze of K){const{x:ni,y:Gt,z:Qt}=Ze.canonical,Zt=0===Gt,vi=Gt===(1<<Qt)-1,[Ui,Li,Ei,Ht]=zt.getPoleBuffers(Qt);if(Ht&&(Zt||vi)){const Wi=V.getTile(Ze);ie.activeTexture.set(ge.TEXTURE0),Wi.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE);let cn=o.globePoleMatrixForTile(Qt,ni,he);const Ln=o.globeNormalizeECEF(o.globeTileBounds(Ze.canonical)),zn=(kn,Mr)=>kn.draw(ie,ge.TRIANGLES,Re,o.StencilMode.disabled,Te,o.CullFaceMode.disabled,Cr(he.projMatrix,cn,cn,Ln,0,ut,he.frustumCorners.TL,he.frustumCorners.TR,he.frustumCorners.BR,he.frustumCorners.BL,he.globeCenterInViewSpace,he.globeRadius,Ye),"globe_pole_raster",Mr,Ei,Ht);z.setupElevationDraw(Wi,ce,Et),P.prepareDrawProgram(ie,ce,Ze.toUnwrapped()),Zt&&zn(ce,Ui),vi&&(cn=o.scale(o.create(),cn,[1,-1,1]),zn(ce,Li))}}}}(d,f,y,T,E);else{const P=d.context,z=P.gl;let V,K;const fe=d.options.showTerrainWireframe?2:0,ie=(he,Le)=>{if(K===he)return;const ze=[Un[he]];Le&&ze.push(Un[fe]),V=d.useProgram("terrainRaster",null,ze),K=he},ge=d.colorModeForRenderPass(),ce=new o.DepthMode(z.LEQUAL,o.DepthMode.ReadWrite,d.depthRangeFor3D);pr.update(E);const ee=d.transform,_e=6*Math.pow(1.5,22-ee.zoom)*f.exaggeration();(fe?[!1,!0]:[!1]).forEach(he=>{K=-1;const Le=he?z.LINES:z.TRIANGLES,[ze,Te]=he?f.getWirefameBuffer():[f.gridIndexBuffer,f.gridSegments];for(const Re of T){const tt=y.getTile(Re),ut=o.StencilMode.disabled,st=f.prevTerrainTileForTile[Re.key],zt=f.terrainTileForTile[Re.key];ko(st,zt)&&pr.newMorphing(Re.key,st,zt,E,250),P.activeTexture.set(z.TEXTURE0),tt.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const Ye=pr.getMorphValuesForProxy(Re.key),At=Ye?1:0;let Et;Ye&&(Et={morphing:{srcDemTile:Ye.from,dstDemTile:Ye.to,phase:o.easeCubicInOut(Ye.phase)}});const it=Yo(Re.projMatrix,on(Re.canonical,ee.renderWorldCopies)?_e/10:_e);ie(At,he),f.setupElevationDraw(tt,V,Et),d.prepareDrawProgram(P,V,Re.toUnwrapped()),V.draw(P,Le,ce,ut,ge,o.CullFaceMode.backCCW,it,"terrain_raster",f.gridBuffer,ze,Te)}})}}(s,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const s=this.painter,u=this.painter.context,d=this.proxySourceCache,f=this.proxiedCoords[d.id],y=this._drapedRenderBatches.shift(),T=[],E=s.style.order;let P=0;for(const z of f){const V=d.getTileByID(z.proxyTileKey),K=d.proxyCachedFBO[z.key]?d.proxyCachedFBO[z.key][n]:void 0,fe=void 0!==K?d.renderCache[K]:this.pool[P++],ie=void 0!==K;if(V.texture=fe.tex,ie&&!fe.dirty){T.push(V.tileID);continue}let ge;u.bindFramebuffer.set(fe.fb.framebuffer),this.renderedToTile=!1,fe.dirty&&(u.clear({color:o.Color.transparent,stencil:0}),fe.dirty=!1);for(let ce=y.start;ce<=y.end;++ce){const ee=s.style._layers[E[ce]];if(ee.isHidden(s.transform.zoom))continue;const _e=s.style._getLayerSourceCache(ee),he=_e?this.proxyToSource[z.key][_e.id]:[z];if(!he)continue;const Le=he;u.viewport.set([0,0,fe.fb.width,fe.fb.height]),ge!==(_e?_e.id:null)&&(this._setupStencil(fe,he,ee,_e),ge=_e?_e.id:null),s.renderLayer(s,_e,ee,Le)}this.renderedToTile?(fe.dirty=!0,T.push(V.tileID)):ie||--P,5===P&&(P=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),y.end+1}postRender(){}renderCacheEfficiency(n){const s=n.order.length;if(0===s)return{efficiency:100};let u,d=0,f=0,y=!1;for(let T=0;T<s;++T){const E=n._layers[n.order[T]];this._style.isLayerDraped(E)?(y&&++d,++f):y||(y=!0,u=E.id)}return 0===f?{efficiency:100}:{efficiency:100*(1-d/f),firstUndrapedLayer:u}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{n=Math.min(n,s.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,s,u){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(f=>f.dem).map(f=>{const y=f.tileID,T=1<<y.overscaledZ,{x:E,y:P}=y.canonical,z=E/T,V=(E+1)/T,K=P/T,fe=(P+1)/T;return{minx:z,miny:K,maxx:V,maxy:fe,t:f.dem.tree.raycastRoot(z,K,V,fe,n,s,u),tile:f}});d.sort((f,y)=>(null!==f.t?f.t:Number.MAX_VALUE)-(null!==y.t?y.t:Number.MAX_VALUE));for(const f of d){if(null==f.t)return null;const y=f.tile.dem.tree.raycast(f.minx,f.miny,f.maxx,f.maxy,n,s,u);if(null!=y)return y}return null}_createFBO(){const n=this.painter.context,s=n.gl,u=this.drapeBufferSize;n.activeTexture.set(s.TEXTURE0);const d=new o.Texture(n,{width:u[0],height:u[1],data:null},s.RGBA);d.bind(s.LINEAR,s.CLAMP_TO_EDGE);const f=n.createFramebuffer(u[0],u[1],!1);return f.colorAttachment.set(d.texture),f.depthAttachment=new Gi(n,f.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,f.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):f.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:f,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const s=this._style._layers[n],u=s.isHidden(this.painter.transform.zoom),d=s.getCrossfadeParameters(),f=!!d&&1!==d.t,y=s.hasTransition();return"custom"!==s.type&&!u&&(f||y)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof Z){n=!0;break}if(n)for(let s=0;s<this._style.order.length;++s){const u=this._style._layers[this._style.order[s]],d=u.isHidden(this.painter.transform.zoom),f=this._style._getLayerSourceCache(u);if("raster"!==u.type||d||!f)continue;const y=u.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const E=this.proxyToSource[T.key][f.id];if(E)for(const P of E){const z=uo(f.getTile(P),f.findLoadedParent(P,0),f,this.painter.transform,y);(1!==z.opacity||0!==z.mix)&&this._clearRenderCacheForTile(f.id,P)}}}}_setupDrapedRenderBatches(){const n=this._style.order,s=n.length;if(0===s)return;const u=[];let d,f=0,y=this._style._layers[n[f]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++f<s;)y=this._style._layers[n[f]];for(;f<s;++f){const T=this._style._layers[n[f]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?void 0===d&&(d=f):void 0!==d&&(u.push({start:d,end:f-1}),d=void 0))}void 0!==d&&u.push({start:d,end:f-1}),this._drapedRenderBatches=u}_setupRenderCache(n){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const y=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let T=0;T<y.length;++T){const E=Object.values(y[T]);s.renderCachePool.push(...E)}}return}this._clearRasterFadeFromRenderCache();const u=this.proxyCoords,d=this._tilesDirty;for(let y=u.length-1;y>=0;y--){const T=u[y];if(s.getTileByID(T.key),void 0!==s.proxyCachedFBO[T.key]){const E=n[T.key],P=this.proxyToSource[T.key];let z=0;for(const V in P){const K=P[V],fe=E[V];if(!fe||fe.length!==K.length||K.some((ie,ge)=>ie!==fe[ge]||d[V]&&d[V].hasOwnProperty(ie.key))){z=-1;break}++z}for(const V in s.proxyCachedFBO[T.key])s.renderCache[s.proxyCachedFBO[T.key][V]].dirty=z<0||z!==Object.values(E).length}}const f=[...this._drapedRenderBatches];f.sort((y,T)=>T.end-T.start-(y.end-y.start));for(const y of f)for(const T of u){if(s.proxyCachedFBO[T.key])continue;let E=s.renderCachePool.pop();void 0===E&&s.renderCache.length<50&&(E=s.renderCache.length,s.renderCache.push(this._createFBO())),void 0!==E&&(s.proxyCachedFBO[T.key]={},s.proxyCachedFBO[T.key][y.start]=E,s.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(n,s,u,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const f=this.painter.context,y=f.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let T;if(u.isTileClipped())T=s.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(f.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(n,s){const u=this.painter,d=this.painter.context,f=d.gl;u._tileClippingMaskIDs={},d.setColorMode(o.ColorMode.disabled),d.setDepthMode(o.DepthMode.disabled);const y=u.useProgram("clippingMask");for(const T of n){const E=u._tileClippingMaskIDs[T.key]=--s;y.draw(d,f.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:f.ALWAYS,mask:0},E,255,f.KEEP,f.KEEP,f.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,xr(T.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(n){const s=this.painter.transform;if(n.x<0||n.x>s.width||n.y<0||n.y>s.height)return null;const u=[n.x,n.y,1,1];o.transformMat4$1(u,u,s.pixelMatrixInverse),o.scale$1(u,u,1/u[3]),u[0]/=s.worldSize,u[1]/=s.worldSize;const d=s._camera.position,f=o.mercatorZfromAltitude(1,s.center.lat),y=[d[0],d[1],d[2]/f,0],T=o.subtract([],u.slice(0,3),y);o.normalize(T,T);const E=this.raycast(y,T,this._exaggeration);return null!==E&&E?(o.scaleAndAdd(y,y,T,E),y[3]=y[2],y[2]*=f,y):null}drawDepth(){const n=this.painter,s=n.context,u=this.proxySourceCache,d=Math.ceil(n.width),f=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===d&&this._depthFBO.height===f||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const y=s.gl,T=s.createFramebuffer(d,f,!0);s.activeTexture.set(y.TEXTURE0);const E=new o.Texture(s,{width:d,height:f,data:null},y.RGBA);E.bind(y.NEAREST,y.CLAMP_TO_EDGE),T.colorAttachment.set(E.texture);const P=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,d,f);T.depthAttachment.set(P),this._depthFBO=T,this._depthTexture=E}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,d,f]),function(y,T,E,P){if("globe"===y.transform.projection.name)return;const z=y.context,V=z.gl;z.clear({depth:1});const K=y.useProgram("terrainDepth"),fe=new o.DepthMode(V.LESS,o.DepthMode.ReadWrite,y.depthRangeFor3D);for(const ie of P){const ge=E.getTile(ie),ce=Yo(ie.projMatrix,0);T.setupElevationDraw(ge,K),K.draw(z,V.TRIANGLES,fe,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,ce,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(n,this,u,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,s,u){if(n.getSource()instanceof De)return this._setupProxiedCoordsForImageSource(n,s,u);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const d=this.proxiedCoords[n.id]=[],f=this.proxyCoords;for(let T=0;T<f.length;T++){const E=f[T],P=this._findTileCoveringTileID(E,n);if(P){const z=this._createProxiedId(E,P,u[E.key]&&u[E.key][n.id]);d.push(z),this.proxyToSource[E.key][n.id]=[z]}}let y=!1;for(let T=0;T<s.length;T++){const E=n.getTile(s[T]);if(!E||!E.hasData())continue;const P=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==E.tileID.canonical.z){const z=this.proxyToSource[P.tileID.key][n.id],V=this._createProxiedId(P.tileID,E,u[P.tileID.key]&&u[P.tileID.key][n.id]);z?z.splice(z.length-1,0,V):this.proxyToSource[P.tileID.key][n.id]=[V],d.push(V),y=!0}}this._sourceTilesOverlap[n.id]=y}_setupProxiedCoordsForImageSource(n,s,u){if(!n.getSource().loaded())return;const d=this.proxiedCoords[n.id]=[],f=this.proxyCoords,y=n.getSource(),T=new o.pointGeometry(y.tileID.x,y.tileID.y)._div(1<<y.tileID.z),E=y.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((z,V)=>(z.min.x=Math.min(z.min.x,V.x-T.x),z.min.y=Math.min(z.min.y,V.y-T.y),z.max.x=Math.max(z.max.x,V.x-T.x),z.max.y=Math.max(z.max.y,V.y-T.y),z),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(z,V)=>{const K=z.wrap+z.canonical.x/(1<<z.canonical.z),fe=z.canonical.y/(1<<z.canonical.z),ie=o.EXTENT/(1<<z.canonical.z),ge=V.wrap+V.canonical.x/(1<<V.canonical.z),ce=V.canonical.y/(1<<V.canonical.z);return K+ie<ge+E.min.x||K>ge+E.max.x||fe+ie<ce+E.min.y||fe>ce+E.max.y};for(let z=0;z<f.length;z++){const V=f[z];for(let K=0;K<s.length;K++){const fe=n.getTile(s[K]);if(!fe||!fe.hasData()||P(V,fe.tileID))continue;const ie=this._createProxiedId(V,fe,u[V.key]&&u[V.key][n.id]),ge=this.proxyToSource[V.key][n.id];ge?ge.push(ie):this.proxyToSource[V.key][n.id]=[ie],d.push(ie)}}}_createProxiedId(n,s,u){let d=this.orthoMatrix;if(u){const f=u.find(y=>y.key===s.tileID.key);if(f)return f}if(s.tileID.key!==n.key){const f=n.canonical.z-s.tileID.canonical.z;let y,T,E;d=o.create();const P=s.tileID.wrap-n.wrap<<n.overscaledZ;f>0?(y=o.EXTENT>>f,T=y*((s.tileID.canonical.x<<f)-n.canonical.x+P),E=y*((s.tileID.canonical.y<<f)-n.canonical.y)):(y=o.EXTENT<<-f,T=o.EXTENT*(s.tileID.canonical.x-(n.canonical.x+P<<-f)),E=o.EXTENT*(s.tileID.canonical.y-(n.canonical.y<<-f))),o.ortho(d,0,y,0,y,0,1),o.translate(d,d,[T,E,0])}return new sr(s.tileID,n.key,d)}_findTileCoveringTileID(n,s){let u=s.getTile(n);if(u&&u.hasData())return u;const d=this._findCoveringTileCache[s.id],f=d[n.key];if(u=f?s.getTileByID(f):null,u&&u.hasData()||null===f)return u;let y=u?u.tileID:n,T=y.overscaledZ;const E=s.getSource().minzoom,P=[];if(!f){const V=s.getSource().maxzoom;if(n.canonical.z>=V){const K=n.canonical.z-V;s.getSource().reparseOverscaled?(T=Math.max(n.canonical.z+2,s.transform.tileZoom),y=new o.OverscaledTileID(T,n.wrap,V,n.canonical.x>>K,n.canonical.y>>K)):0!==K&&(T=V,y=new o.OverscaledTileID(T,n.wrap,V,n.canonical.x>>K,n.canonical.y>>K))}y.key!==n.key&&(P.push(y.key),u=s.getTile(y))}const z=V=>{P.forEach(K=>{d[K]=V}),P.length=0};for(T-=1;T>=E&&(!u||!u.hasData());T--){u&&z(u.tileID.key);const V=y.calculateScaledKey(T);if(u=s.getTileByID(V),u&&u.hasData())break;const K=d[V];if(null===K)break;void 0===K?P.push(V):u=s.getTileByID(K)}return z(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,s){let u=this._tilesDirty[n];u||(u=this._tilesDirty[n]={}),u[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(s){let u=0;const d=new o.StructArrayLayout2ui4,f=131;for(let y=1;y<129;y++){for(let T=1;T<129;T++)u=y*f+T,d.emplaceBack(u,u+1),d.emplaceBack(u,u+f),d.emplaceBack(u+1,u+f),128===y&&d.emplaceBack(u+f,u+f+1);d.emplaceBack(u+1,u+1+f)}return d}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class cr{static cacheKey(n,s,u,d){let f=`${s}${d?d.cacheKey:""}`;for(const y of u)n.usedDefines.includes(y)&&(f+=`/${y}`);return f}constructor(n,s,u,d,f,y){const T=n.gl;this.program=T.createProgram();const E=function(ce){const ee=[];for(let _e=0;_e<ce.length;_e++){if(null===ce[_e])continue;const he=ce[_e].split(" ");ee.push(he.pop())}return ee}(u.staticAttributes),P=d?d.getBinderAttributes():[],z=E.concat(P);let V=d?d.defines():[];V=V.concat(y.map(ce=>`#define ${ce}`));const K=V.concat(n.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Pn):Pn,Pn,wn,hn.fragmentSource,ei.fragmentSource,u.fragmentSource).join("\n"),fe=V.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",wn,hn.vertexSource,ei.vertexSource,bt.vertexSource,u.vertexSource).join("\n"),ie=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(ie,K),T.compileShader(ie),T.attachShader(this.program,ie);const ge=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ge,fe),T.compileShader(ge),T.attachShader(this.program,ge),this.attributes={},this.numAttributes=z.length;for(let ce=0;ce<this.numAttributes;ce++)z[ce]&&(T.bindAttribLocation(this.program,ce,z[ce]),this.attributes[z[ce]]=ce);T.linkProgram(this.program),T.deleteShader(ge),T.deleteShader(ie),this.fixedUniforms=f(n),this.binderUniforms=d?d.getUniforms(n):[],y.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new o.Uniform1i(ce=n),u_dem_prev:new o.Uniform1i(ce),u_dem_unpack:new o.Uniform4f(ce),u_dem_tl:new o.Uniform2f(ce),u_dem_scale:new o.Uniform1f(ce),u_dem_tl_prev:new o.Uniform2f(ce),u_dem_scale_prev:new o.Uniform1f(ce),u_dem_size:new o.Uniform1f(ce),u_dem_lerp:new o.Uniform1f(ce),u_exaggeration:new o.Uniform1f(ce),u_depth:new o.Uniform1i(ce),u_depth_size_inv:new o.Uniform2f(ce),u_meter_to_dem:new o.Uniform1f(ce),u_label_plane_matrix_inv:new o.UniformMatrix4f(ce)}),y.includes("GLOBE")&&(this.globeUniforms=(ce=>({u_tile_tl_up:new o.Uniform3f(ce),u_tile_tr_up:new o.Uniform3f(ce),u_tile_br_up:new o.Uniform3f(ce),u_tile_bl_up:new o.Uniform3f(ce),u_tile_up_scale:new o.Uniform1f(ce)}))(n)),y.includes("FOG")&&(this.fogUniforms=(ce=>({u_fog_matrix:new o.UniformMatrix4f(ce),u_fog_range:new o.Uniform2f(ce),u_fog_color:new o.Uniform4f(ce),u_fog_horizon_blend:new o.Uniform1f(ce),u_fog_temporal_offset:new o.Uniform1f(ce),u_frustum_tl:new o.Uniform3f(ce),u_frustum_tr:new o.Uniform3f(ce),u_frustum_br:new o.Uniform3f(ce),u_frustum_bl:new o.Uniform3f(ce),u_globe_pos:new o.Uniform3f(ce),u_globe_radius:new o.Uniform1f(ce),u_globe_transition:new o.Uniform1f(ce),u_is_globe:new o.Uniform1i(ce),u_viewport:new o.Uniform2f(ce)}))(n))}var ce}setTerrainUniformValues(n,s){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in s)u[d]&&u[d].set(this.program,d,s[d])}}setGlobeUniformValues(n,s){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in s)u[d]&&u[d].set(this.program,d,s[d])}}setFogUniformValues(n,s){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in s)u[d].set(this.program,d,s[d])}}draw(n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge){const ce=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(u),n.setStencilMode(d),n.setColorMode(f),n.setCullFace(y);for(const _e of Object.keys(this.fixedUniforms))this.fixedUniforms[_e].set(this.program,_e,T[_e]);ie&&ie.setUniforms(this.program,n,this.binderUniforms,K,{zoom:fe});const ee={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[s];for(const _e of V.get()){const he=_e.vaos||(_e.vaos={});(he[E]||(he[E]=new rn)).bind(n,this,P,ie?ie.getPaintVertexBuffers():[],z,_e.vertexOffset,ge||[]),ce.drawElements(s,_e.primitiveLength*ee,ce.UNSIGNED_SHORT,_e.primitiveOffset*ee*2)}}}function qr(l,n,s){const u=1/Si(s,1,n.transform.tileZoom),d=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,n.transform.tileZoom)/d,y=f*(s.tileID.canonical.x+s.tileID.wrap*d),T=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[y>>16,T>>16],u_pixel_coord_lower:[65535&y,65535&T]}}const Ko=o.create(),as=(l,n,s,u,d,f,y,T,E,P,z)=>{const V=n.style.light,K=V.properties.get("position"),fe=[K.x,K.y,K.z],ie=o.create$1();"viewport"===V.properties.get("anchor")&&(o.fromRotation(ie,-n.transform.angle),o.transformMat3(fe,fe,ie));const ge=V.properties.get("color"),ce=n.transform,ee={u_matrix:l,u_lightpos:fe,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+s,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ko,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:d,u_edge_radius:f};return"globe"===ce.projection.name&&(ee.u_tile_id=[y.canonical.x,y.canonical.y,1<<y.canonical.z],ee.u_zoom_transition=E,ee.u_inv_rot_matrix=z,ee.u_merc_center=P,ee.u_up_dir=ce.projection.upVector(new o.CanonicalTileID(0,0,0),P[0]*o.EXTENT,P[1]*o.EXTENT),ee.u_height_lift=T),ee},Ma=(l,n,s,u,d,f,y,T,E,P,z,V,K)=>{const fe=as(l,n,s,u,d,f,y,P,z,V,K),ie={u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8};return o.extend(fe,qr(T,n,E),ie)},sa=l=>({u_matrix:l}),ka=(l,n,s,u)=>o.extend(sa(l),qr(s,n,u)),$s=(l,n)=>({u_matrix:l,u_world:n}),Nl=(l,n,s,u,d)=>o.extend(ka(l,n,s,u),{u_world:d}),Gs=o.create(),qs=(l,n,s,u,d,f)=>{const y=l.transform,T="globe"===y.projection.name;let E;if("map"===f.paint.get("circle-pitch-alignment"))if(T){const z=o.globePixelsToTileUnits(y.zoom,n.canonical)*y._pixelsPerMercatorPixel;E=Float32Array.from([z,0,0,z])}else E=y.calculatePixelsToTileUnitsMatrix(s);else E=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:l.translatePosMatrix(n.projMatrix,s,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Gs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){P.u_inv_rot_matrix=u,P.u_merc_center=d,P.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],P.u_zoom_transition=o.globeToMercatorTransition(y.zoom);const z=d[0]*o.EXTENT,V=d[1]*o.EXTENT;P.u_up_dir=y.projection.upVector(new o.CanonicalTileID(0,0,0),z,V)}return P},xs=l=>{const n=[];return"map"===l.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===l.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},aa=(l,n,s,u)=>{const d=o.EXTENT/s.tileSize;return{u_matrix:l,u_camera_to_center_distance:n.getCameraToCenterDistance(u),u_extrude_scale:[n.pixelsToGLUnits[0]/d,n.pixelsToGLUnits[1]/d]}},bs=(l,n,s=1)=>({u_matrix:l,u_color:n,u_overlay:0,u_overlay_scale:s}),br=o.create(),xo=(l,n,s,u,d,f,y)=>{const T=l.transform,E="globe"===T.projection.name,P=E?o.globePixelsToTileUnits(T.zoom,n.canonical)*T._pixelsPerMercatorPixel:Si(s,1,f),z={u_matrix:n.projMatrix,u_extrude_scale:P,u_intensity:y,u_inv_rot_matrix:br,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){z.u_inv_rot_matrix=u,z.u_merc_center=d,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=o.globeToMercatorTransition(T.zoom);const V=d[0]*o.EXTENT,K=d[1]*o.EXTENT;z.u_up_dir=T.projection.upVector(new o.CanonicalTileID(0,0,0),V,K)}return z},Ia=(l,n,s,u,d,f,y,T)=>{const E=l.transform,P=E.calculatePixelsToTileUnitsMatrix(n),z={u_matrix:ua(l,n,s,d),u_pixels_to_tile_units:P,u_device_pixel_ratio:y,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:T};if(jn(s)){const V=ca(n,l.transform);z.u_texsize=n.lineAtlasTexture.size,z.u_scale=[V,u.fromScale,u.toScale],z.u_mix=u.t}return z},la=(l,n,s,u,d,f)=>{const y=l.transform,T=ca(n,y);return{u_matrix:ua(l,n,s,d),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:f,u_image:0,u_scale:[T,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ca(l,n){return 1/Si(l,1,n.tileZoom)}function ua(l,n,s,u){return l.translatePosMatrix(u||n.tileID.projMatrix,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function jn(l){const n=l.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const ws=(l,n,s,u,d,f)=>{return{u_matrix:l,u_tl_parent:n,u_scale_parent:s,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(T=d.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(y=d.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:bo(d.paint.get("raster-hue-rotate")),u_perspective_transform:f};var y,T};function bo(l){l*=Math.PI/180;const n=Math.sin(l),s=Math.cos(l);return[(2*s+1)/3,(-Math.sqrt(3)*n-s+1)/3,(Math.sqrt(3)*n-s+1)/3]}const Dr=o.create(),ha=(l,n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge)=>{const ce=d.transform,ee={u_is_size_zoom_constant:+("constant"===l||"source"===l),u_is_size_feature_constant:+("constant"===l||"camera"===l),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:ce.width/ce.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:y,u_coord_matrix:T,u_is_text:+E,u_pitch_with_map:+u,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Dr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Dr,u_up_vector:[0,-1,0]};return"globe"===ge.name&&(ee.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],ee.u_zoom_transition=V,ee.u_inv_rot_matrix=fe,ee.u_merc_center=K,ee.u_camera_forward=ce._camera.forward(),ee.u_ecef_origin=o.globeECEFOrigin(ce.globeMatrix,z.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(ce.globeMatrix),ee.u_up_vector=ie),ee},Zs=(l,n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge,ce)=>o.extend(ha(l,n,s,u,d,f,y,T,E,P,V,K,fe,ie,ge,ce),{u_gamma_scale:u?d.transform.cameraToCenterDistance*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+z}),Ul=(l,n,s,u,d,f,y,T,E,P,z,V,K,fe,ie,ge)=>o.extend(Zs(l,n,s,u,d,f,y,T,!0,E,!0,z,V,K,fe,ie,ge),{u_texsize_icon:P,u_texture_icon:1}),Da=(l,n,s)=>({u_matrix:l,u_opacity:n,u_color:s}),el=(l,n,s,u,d,f)=>o.extend(function(y,T,E,P){const z=E.imageManager.getPattern(y.from.toString()),V=E.imageManager.getPattern(y.to.toString()),{width:K,height:fe}=E.imageManager.getPixelSize(),ie=Math.pow(2,P.tileID.overscaledZ),ge=P.tileSize*Math.pow(2,E.transform.tileZoom)/ie,ce=ge*(P.tileID.canonical.x+P.tileID.wrap*ie),ee=ge*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:V.tl,u_pattern_br_b:V.br,u_texsize:[K,fe],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:V.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/Si(P,1,E.transform.tileZoom),u_pixel_coord_upper:[ce>>16,ee>>16],u_pixel_coord_lower:[65535&ce,65535&ee]}}(u,f,s,d),{u_matrix:l,u_opacity:n}),Io={fillExtrusion:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l)}),fillExtrusionPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_lightpos:new o.Uniform3f(l),u_lightintensity:new o.Uniform1f(l),u_lightcolor:new o.Uniform3f(l),u_vertical_gradient:new o.Uniform1f(l),u_height_factor:new o.Uniform1f(l),u_edge_radius:new o.Uniform1f(l),u_ao:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_up_dir:new o.Uniform3f(l),u_height_lift:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l)}),fill:l=>({u_matrix:new o.UniformMatrix4f(l)}),fillPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l)}),fillOutline:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l)}),fillOutlinePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_world:new o.Uniform2f(l),u_image:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l)}),circle:l=>({u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),collisionBox:l=>({u_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_extrude_scale:new o.Uniform2f(l)}),collisionCircle:l=>({u_matrix:new o.UniformMatrix4f(l),u_inv_matrix:new o.UniformMatrix4f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_viewport_size:new o.Uniform2f(l)}),debug:l=>({u_color:new o.UniformColor(l),u_matrix:new o.UniformMatrix4f(l),u_overlay:new o.Uniform1i(l),u_overlay_scale:new o.Uniform1f(l)}),clippingMask:l=>({u_matrix:new o.UniformMatrix4f(l)}),heatmap:l=>({u_extrude_scale:new o.Uniform1f(l),u_intensity:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_up_dir:new o.Uniform3f(l)}),heatmapTexture:l=>({u_image:new o.Uniform1i(l),u_color_ramp:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l)}),hillshade:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_latrange:new o.Uniform2f(l),u_light:new o.Uniform2f(l),u_shadow:new o.UniformColor(l),u_highlight:new o.UniformColor(l),u_accent:new o.UniformColor(l)}),hillshadePrepare:l=>({u_matrix:new o.UniformMatrix4f(l),u_image:new o.Uniform1i(l),u_dimension:new o.Uniform2f(l),u_zoom:new o.Uniform1f(l),u_unpack:new o.Uniform4f(l)}),line:l=>({u_matrix:new o.UniformMatrix4f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_units_to_pixels:new o.Uniform2f(l),u_dash_image:new o.Uniform1i(l),u_gradient_image:new o.Uniform1i(l),u_image_height:new o.Uniform1f(l),u_texsize:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_mix:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l),u_trim_offset:new o.Uniform2f(l)}),linePattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_texsize:new o.Uniform2f(l),u_pixels_to_tile_units:new o.UniformMatrix2f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_units_to_pixels:new o.Uniform2f(l),u_scale:new o.Uniform3f(l),u_fade:new o.Uniform1f(l),u_alpha_discard_threshold:new o.Uniform1f(l)}),raster:l=>({u_matrix:new o.UniformMatrix4f(l),u_tl_parent:new o.Uniform2f(l),u_scale_parent:new o.Uniform1f(l),u_fade_t:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_image0:new o.Uniform1i(l),u_image1:new o.Uniform1i(l),u_brightness_low:new o.Uniform1f(l),u_brightness_high:new o.Uniform1f(l),u_saturation_factor:new o.Uniform1f(l),u_contrast_factor:new o.Uniform1f(l),u_spin_weights:new o.Uniform3f(l),u_perspective_transform:new o.Uniform2f(l)}),symbolIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_texture:new o.Uniform1i(l)}),symbolSDF:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_tile_id:new o.Uniform3f(l),u_zoom_transition:new o.Uniform1f(l),u_inv_rot_matrix:new o.UniformMatrix4f(l),u_merc_center:new o.Uniform2f(l),u_camera_forward:new o.Uniform3f(l),u_tile_matrix:new o.UniformMatrix4f(l),u_up_vector:new o.Uniform3f(l),u_ecef_origin:new o.Uniform3f(l),u_is_halo:new o.Uniform1i(l)}),symbolTextAndIcon:l=>({u_is_size_zoom_constant:new o.Uniform1i(l),u_is_size_feature_constant:new o.Uniform1i(l),u_size_t:new o.Uniform1f(l),u_size:new o.Uniform1f(l),u_camera_to_center_distance:new o.Uniform1f(l),u_rotate_symbol:new o.Uniform1i(l),u_aspect_ratio:new o.Uniform1f(l),u_fade_change:new o.Uniform1f(l),u_matrix:new o.UniformMatrix4f(l),u_label_plane_matrix:new o.UniformMatrix4f(l),u_coord_matrix:new o.UniformMatrix4f(l),u_is_text:new o.Uniform1i(l),u_pitch_with_map:new o.Uniform1i(l),u_texsize:new o.Uniform2f(l),u_texsize_icon:new o.Uniform2f(l),u_texture:new o.Uniform1i(l),u_texture_icon:new o.Uniform1i(l),u_gamma_scale:new o.Uniform1f(l),u_device_pixel_ratio:new o.Uniform1f(l),u_is_halo:new o.Uniform1i(l)}),background:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_color:new o.UniformColor(l)}),backgroundPattern:l=>({u_matrix:new o.UniformMatrix4f(l),u_opacity:new o.Uniform1f(l),u_image:new o.Uniform1i(l),u_pattern_tl_a:new o.Uniform2f(l),u_pattern_br_a:new o.Uniform2f(l),u_pattern_tl_b:new o.Uniform2f(l),u_pattern_br_b:new o.Uniform2f(l),u_texsize:new o.Uniform2f(l),u_mix:new o.Uniform1f(l),u_pattern_size_a:new o.Uniform2f(l),u_pattern_size_b:new o.Uniform2f(l),u_scale_a:new o.Uniform1f(l),u_scale_b:new o.Uniform1f(l),u_pixel_coord_upper:new o.Uniform2f(l),u_pixel_coord_lower:new o.Uniform2f(l),u_tile_units_to_pixels:new o.Uniform1f(l)}),terrainRaster:co,terrainDepth:co,skybox:l=>({u_matrix:new o.UniformMatrix4f(l),u_sun_direction:new o.Uniform3f(l),u_cubemap:new o.Uniform1i(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxGradient:l=>({u_matrix:new o.UniformMatrix4f(l),u_color_ramp:new o.Uniform1i(l),u_center_direction:new o.Uniform3f(l),u_radius:new o.Uniform1f(l),u_opacity:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l)}),skyboxCapture:l=>({u_matrix_3f:new o.UniformMatrix3f(l),u_sun_direction:new o.Uniform3f(l),u_sun_intensity:new o.Uniform1f(l),u_color_tint_r:new o.Uniform4f(l),u_color_tint_m:new o.Uniform4f(l),u_luminance:new o.Uniform1f(l)}),globeRaster:l=>({u_proj_matrix:new o.UniformMatrix4f(l),u_globe_matrix:new o.UniformMatrix4f(l),u_normalize_matrix:new o.UniformMatrix4f(l),u_merc_matrix:new o.UniformMatrix4f(l),u_zoom_transition:new o.Uniform1f(l),u_merc_center:new o.Uniform2f(l),u_image0:new o.Uniform1i(l),u_grid_matrix:new o.UniformMatrix3f(l),u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_globe_pos:new o.Uniform3f(l),u_globe_radius:new o.Uniform1f(l),u_viewport:new o.Uniform2f(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.Uniform3f(l),u_frustum_tr:new o.Uniform3f(l),u_frustum_br:new o.Uniform3f(l),u_frustum_bl:new o.Uniform3f(l),u_horizon:new o.Uniform1f(l),u_transition:new o.Uniform1f(l),u_fadeout_range:new o.Uniform1f(l),u_color:new o.Uniform4f(l),u_high_color:new o.Uniform4f(l),u_space_color:new o.Uniform4f(l),u_star_intensity:new o.Uniform1f(l),u_star_density:new o.Uniform1f(l),u_star_size:new o.Uniform1f(l),u_temporal_offset:new o.Uniform1f(l),u_horizon_angle:new o.Uniform1f(l),u_rotation_matrix:new o.UniformMatrix4f(l)})};let Ts;function da(l,n,s,u,d,f,y){const T=l.context,E=T.gl,P=l.transform,z=l.useProgram("collisionBox"),V=[];let K=0,fe=0;for(let Le=0;Le<u.length;Le++){const ze=u[Le],Te=n.getTile(ze),Re=Te.getBucket(s);if(!Re)continue;const tt=Zo(ze,Re,P);let ut=tt;0===d[0]&&0===d[1]||(ut=l.translatePosMatrix(tt,Te,d,f));const st=y?Re.textCollisionBox:Re.iconCollisionBox,zt=Re.collisionCircleArray;if(zt.length>0){const Ye=o.create(),At=ut;o.mul(Ye,Re.placementInvProjMatrix,P.glCoordMatrix),o.mul(Ye,Ye,Re.placementViewportMatrix),V.push({circleArray:zt,circleOffset:fe,transform:At,invTransform:Ye,projection:Re.getProjection()}),K+=zt.length/4,fe=K}st&&(l.terrain&&l.terrain.setupElevationDraw(Te,z),z.draw(T,E.LINES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,aa(ut,P,Te,Re.getProjection()),s.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,null,P.zoom,null,[st.collisionVertexBuffer,st.collisionVertexBufferExt]))}if(!y||!V.length)return;const ie=l.useProgram("collisionCircle"),ge=new o.StructArrayLayout2f1f2i16;ge.resize(4*K),ge._trim();let ce=0;for(const Le of V)for(let ze=0;ze<Le.circleArray.length/4;ze++){const Te=4*ze,Re=Le.circleArray[Te+0],tt=Le.circleArray[Te+1],ut=Le.circleArray[Te+2],st=Le.circleArray[Te+3];ge.emplace(ce++,Re,tt,ut,st,0),ge.emplace(ce++,Re,tt,ut,st,1),ge.emplace(ce++,Re,tt,ut,st,2),ge.emplace(ce++,Re,tt,ut,st,3)}(!Ts||Ts.length<2*K)&&(Ts=function(Le){const ze=2*Le,Te=new o.StructArrayLayout3ui6;Te.resize(ze),Te._trim();for(let Re=0;Re<ze;Re++){const tt=6*Re;Te.uint16[tt+0]=4*Re+0,Te.uint16[tt+1]=4*Re+1,Te.uint16[tt+2]=4*Re+2,Te.uint16[tt+3]=4*Re+2,Te.uint16[tt+4]=4*Re+3,Te.uint16[tt+5]=4*Re+0}return Te}(K));const ee=T.createIndexBuffer(Ts,!0),_e=T.createVertexBuffer(ge,o.collisionCircleLayout.members,!0);for(const Le of V){const ze={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(he=P).getCameraToCenterDistance(Le.projection),u_viewport_size:[he.width,he.height]};ie.draw(T,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,ze,s.id,_e,ee,o.SegmentVector.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,P.zoom)}var he;_e.destroy(),ee.destroy()}const Es=o.create();function Uo(l,n,s,u,d,f){const{horizontalAlign:y,verticalAlign:T}=o.getAnchorAlignment(l),E=-(y-.5)*n,P=-(T-.5)*s,z=o.evaluateVariableOffset(l,u);return new o.pointGeometry((E/d+z[0])*f,(P/d+z[1])*f)}function Pa(l,n,s,u,d,f,y,T,E,P,z){const V=l.text.placedSymbolArray,K=l.text.dynamicLayoutVertexArray,fe=l.icon.dynamicLayoutVertexArray,ie={},ge=Ho(T,l.getProjection(),f),ce=f.elevation,ee=l.getProjection().upVectorScale(T.canonical,f.center.lat,f.worldSize);K.clear();for(let _e=0;_e<V.length;_e++){const he=V.get(_e),Le=l.allowVerticalPlacement&&!he.placedOrientation,ze=he.hidden||!he.crossTileID||Le?null:u[he.crossTileID];if(ze){const Te=new o.pointGeometry(he.tileAnchorX,he.tileAnchorY),Re=l.getProjection().upVector(T.canonical,Te.x,Te.y),tt=ce?ce.getAtTileOffset(T,Te.x,Te.y):0,ut=nn([he.projectedAnchorX+tt*Re[0]*ee.metersToTile,he.projectedAnchorY+tt*Re[1]*ee.metersToTile,he.projectedAnchorZ+tt*Re[2]*ee.metersToTile],s?ge:y),st=Vi(f.getCameraToCenterDistance(l.getProjection()),ut.signedDistanceFromCamera);let zt=d.evaluateSizeForFeature(l.textSizeData,P,he)*st/o.ONE_EM;s&&(zt*=l.tilePixelRatio/E);const{width:Ye,height:At,anchor:Et,textOffset:it,textScale:Ze}=ze,ni=Uo(Et,Ye,At,it,Ze,zt);let Gt;if(s){const Zt=Te.add(ni),{x:vi,y:Ui,z:Li}=l.getProjection().projectTilePoint(Zt.x,Zt.y,T.canonical);Gt=nn([vi+tt*Re[0]*ee.metersToTile,Ui+tt*Re[1]*ee.metersToTile,Li+tt*Re[2]*ee.metersToTile],y).point}else{const Zt=n?ni.rotate(-f.angle):ni;Gt=[ut.point[0]+Zt.x,ut.point[1]+Zt.y,0]}const Qt=l.allowVerticalPlacement&&he.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Zt=0;Zt<he.numGlyphs;Zt++)o.addDynamicAttributes(K,Gt[0],Gt[1],Gt[2],Qt);z&&he.associatedIconIndex>=0&&(ie[he.associatedIconIndex]={shiftedAnchor:Gt,angle:Qt})}else $r(he.numGlyphs,K)}if(z){fe.clear();const _e=l.icon.placedSymbolArray;for(let he=0;he<_e.length;he++){const Le=_e.get(he);if(Le.hidden)$r(Le.numGlyphs,fe);else{const ze=ie[he];if(ze)for(let Te=0;Te<Le.numGlyphs;Te++)o.addDynamicAttributes(fe,ze.shiftedAnchor[0],ze.shiftedAnchor[1],ze.shiftedAnchor[2],ze.angle);else $r(Le.numGlyphs,fe)}}l.icon.dynamicLayoutVertexBuffer.updateData(fe)}l.text.dynamicLayoutVertexBuffer.updateData(K)}function pa(l,n,s){return s.iconsInText&&n?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function fa(l,n,s,u,d,f,y,T,E,P,z,V){const K=l.context,fe=K.gl,ie=l.transform,ge="map"===T,ce="map"===E,ee=ge&&"point"!==s.layout.get("symbol-placement"),_e=ge&&!ce&&!ee,he=void 0!==s.layout.get("symbol-sort-key").constantOr(1);let Le=!1;const ze=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),Te=[o.mercatorXfromLng(ie.center.lng),o.mercatorYfromLat(ie.center.lat)],Re=s.layout.get("text-variable-anchor"),tt="globe"===ie.projection.name,ut=[],st=[0,-1,0];let zt=st;!tt&&!ie.mercatorFromTransition||ge||(zt=function(Ye){const At=Ye._camera.getWorldToCamera(Ye.worldSize,1),Et=o.multiply([],At,Ye.globeMatrix);o.invert(Et,Et);const it=[0,0,0],Ze=[0,1,0,0];return o.transformMat4$1(Ze,Ze,Et),it[0]=Ze[0],it[1]=Ze[1],it[2]=Ze[2],o.normalize(it,it),it}(ie));for(const Ye of u){const At=n.getTile(Ye),Et=At.getBucket(s);if(!Et||"mercator"===Et.projection.name&&tt)continue;const it=d?Et.text:Et.icon;if(!it||Et.fullyClipped||!it.segments.get().length)continue;const Ze=it.programConfigurations.get(s.id),ni=d||Et.sdfIcons,Gt=d?Et.textSizeData:Et.iconSizeData,Qt=ce||0!==ie.pitch,Zt=o.evaluateSizeForZoom(Gt,ie.zoom);let vi,Ui,Li,Ei,Ht=[0,0],Wi=null;if(d){if(Ui=At.glyphAtlasTexture,Li=fe.LINEAR,vi=At.glyphAtlasTexture.size,Et.iconsInText){Ht=At.imageAtlasTexture.size,Wi=At.imageAtlasTexture;const Rr="composite"===Gt.kind||"camera"===Gt.kind;Ei=Qt||l.options.rotating||l.options.zooming||Rr?fe.LINEAR:fe.NEAREST}}else{const Rr=1!==s.layout.get("icon-size").constantOr(0)||Et.iconsNeedLinear;Ui=At.imageAtlasTexture,Li=ni||l.options.rotating||l.options.zooming||Rr||Qt?fe.LINEAR:fe.NEAREST,vi=At.imageAtlasTexture.size}const cn="globe"===Et.projection.name,Ln=cn?zt:st,zn=cn?o.globeToMercatorTransition(ie.zoom):0,kn=Ho(Ye,Et.getProjection(),ie),Mr=ie.calculatePixelsToTileUnitsMatrix(At),no=Oo(kn,At.tileID.canonical,ce,ge,ie,Et.getProjection(),Mr),Qo=l.terrain&&ce&&ee?o.invert(o.create(),no):Es,Xn=Eo(kn,At.tileID.canonical,ce,ge,ie,Et.getProjection(),Mr),nr=Re&&Et.hasTextData(),Mn="none"!==s.layout.get("icon-text-fit")&&nr&&Et.hasIconData();if(ee){const Rr=ie.elevation,es=Rr?Rr.getAtTileOffsetFunc(Ye,ie.center.lat,ie.worldSize,Et.getProjection()):Vo=>[0,0,0],Is=rs(kn,At.tileID.canonical,ce,ge,ie,Et.getProjection(),Mr);hr(Et,kn,l,d,Is,Xn,ce,P,es,Ye)}const fr=ee||d&&Re||Mn,Hr=l.translatePosMatrix(kn,At,f,y),Gn=fr?Es:no,ho=l.translatePosMatrix(Xn,At,f,y,!0),Ws=Et.getProjection().createInversionMatrix(ie,Ye.canonical),jo=[];l.terrainRenderModeElevated()&&ce&&jo.push("PITCH_WITH_MAP_TERRAIN"),cn&&jo.push("PROJECTION_GLOBE_VIEW"),fr&&jo.push("PROJECTED_POS_ON_VIEWPORT");const ro=ni&&0!==s.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1);let _a;_a=ni?Et.iconsInText?Ul(Gt.kind,Zt,_e,ce,l,Hr,Gn,ho,vi,Ht,Ye,zn,Te,Ws,Ln,Et.getProjection()):Zs(Gt.kind,Zt,_e,ce,l,Hr,Gn,ho,d,vi,!0,Ye,zn,Te,Ws,Ln,Et.getProjection()):ha(Gt.kind,Zt,_e,ce,l,Hr,Gn,ho,d,vi,Ye,zn,Te,Ws,Ln,Et.getProjection());const ks={program:l.useProgram(pa(ni,d,Et),Ze,jo),buffers:it,uniformValues:_a,atlasTexture:Ui,atlasTextureIcon:Wi,atlasInterpolation:Li,atlasInterpolationIcon:Ei,isSDF:ni,hasHalo:ro,tile:At,labelPlaneMatrixInv:Qo};if(he&&Et.canOverlap){Le=!0;const Rr=it.segments.get();for(const es of Rr)ut.push({segments:new o.SegmentVector([es]),sortKey:es.sortKey,state:ks})}else ut.push({segments:it.segments,sortKey:0,state:ks})}Le&&ut.sort((Ye,At)=>Ye.sortKey-At.sortKey);for(const Ye of ut){const At=Ye.state;if(l.terrain&&l.terrain.setupElevationDraw(At.tile,At.program,{useDepthForOcclusion:!tt,labelPlaneMatrixInv:At.labelPlaneMatrixInv}),K.activeTexture.set(fe.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,fe.CLAMP_TO_EDGE),At.atlasTextureIcon&&(K.activeTexture.set(fe.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,fe.CLAMP_TO_EDGE)),At.isSDF){const Et=At.uniformValues;At.hasHalo&&(Et.u_is_halo=1,ma(At.buffers,Ye.segments,s,l,At.program,ze,z,V,Et)),Et.u_is_halo=0}ma(At.buffers,Ye.segments,s,l,At.program,ze,z,V,At.uniformValues)}}function ma(l,n,s,u,d,f,y,T,E){const P=u.context,z=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer];d.draw(P,P.gl.TRIANGLES,f,y,T,o.CullFaceMode.disabled,E,s.id,l.layoutVertexBuffer,l.indexBuffer,n,s.paint,u.transform.zoom,l.programConfigurations.get(s.id),z)}function pe(l,n,s,u,d,f,y){const T=l.context.gl,E=s.paint.get("fill-pattern"),P=E&&E.constantOr(1),z=s.getCrossfadeParameters();let V,K,fe,ie,ge;y?(K=P&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=T.LINES):(K=P?"fillPattern":"fill",V=T.TRIANGLES);for(const ce of u){const ee=n.getTile(ce);if(P&&!ee.patternsLoaded())continue;const _e=ee.getBucket(s);if(!_e)continue;l.prepareDrawTile();const he=_e.programConfigurations.get(s.id),Le=l.useProgram(K,he);P&&(l.context.activeTexture.set(T.TEXTURE0),ee.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),he.updatePaintBuffers(z));const ze=E.constantOr(null);if(ze&&ee.imageAtlas){const Re=ee.imageAtlas,tt=Re.patternPositions[ze.to.toString()],ut=Re.patternPositions[ze.from.toString()];tt&&ut&&he.setConstantPatternPositions(tt,ut)}const Te=l.translatePosMatrix(ce.projMatrix,ee,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(y){ie=_e.indexBuffer2,ge=_e.segments2;const Re=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];fe="fillOutlinePattern"===K&&P?Nl(Te,l,z,ee,Re):$s(Te,Re)}else ie=_e.indexBuffer,ge=_e.segments,fe=P?ka(Te,l,z,ee):sa(Te);l.prepareDrawProgram(l.context,Le,ce.toUnwrapped()),Le.draw(l.context,V,d,l.stencilModeForClipping(ce),f,o.CullFaceMode.disabled,fe,s.id,_e.layoutVertexBuffer,ie,ge,s.paint,l.transform.zoom,he)}}function Fe(l,n,s,u,d,f,y){const T=l.context,E=T.gl,P=l.transform,z=s.paint.get("fill-extrusion-pattern"),V=z.constantOr(1),K=s.getCrossfadeParameters(),fe=s.paint.get("fill-extrusion-opacity"),ie=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),s.paint.get("fill-extrusion-ambient-occlusion-radius")],ge=s.layout.get("fill-extrusion-edge-radius"),ce="globe"===P.projection.name?o.fillExtrusionHeightLift():0,ee="globe"===P.projection.name,_e=ee?o.globeToMercatorTransition(P.zoom):0,he=[o.mercatorXfromLng(P.center.lng),o.mercatorYfromLat(P.center.lat)],Le=[];ee&&(Le.push("PROJECTION_GLOBE_VIEW"),l.style.terrainSetForDrapingOnly()&&Le.push("TERRAIN")),ie[0]>0&&Le.push("FAUX_AO");for(const ze of u){const Te=n.getTile(ze),Re=Te.getBucket(s);if(!Re||Re.projection.name!==P.projection.name)continue;const tt=Re.programConfigurations.get(s.id),ut=l.useProgram(V?"fillExtrusionPattern":"fillExtrusion",tt,Le);if(l.terrain){const Ze=l.terrain;if(l.style.terrainSetForDrapingOnly())Ze.setupElevationDraw(Te,ut,{useMeterToDem:!0});else{if(!Re.enableTerrain)continue;if(Ze.setupElevationDraw(Te,ut,{useMeterToDem:!0}),Je(T,n,ze,Re,s,Ze),!Re.centroidVertexBuffer){const ni=ut.attributes.a_centroid_pos;void 0!==ni&&E.vertexAttrib2f(ni,0,0)}}}V&&(l.context.activeTexture.set(E.TEXTURE0),Te.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),tt.updatePaintBuffers(K));const st=z.constantOr(null);if(st&&Te.imageAtlas){const Ze=Te.imageAtlas,ni=Ze.patternPositions[st.to.toString()],Gt=Ze.patternPositions[st.from.toString()];ni&&Gt&&tt.setConstantPatternPositions(ni,Gt)}const zt=l.translatePosMatrix(ze.projMatrix,Te,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ye=P.projection.createInversionMatrix(P,ze.canonical),At=s.paint.get("fill-extrusion-vertical-gradient"),Et=V?Ma(zt,l,At,fe,ie,ge,ze,K,Te,ce,_e,he,Ye):as(zt,l,At,fe,ie,ge,ze,ce,_e,he,Ye);l.prepareDrawProgram(T,ut,ze.toUnwrapped());const it=[];l.terrain&&it.push(Re.centroidVertexBuffer),ee&&it.push(Re.layoutVertexExtBuffer),ut.draw(T,T.gl.TRIANGLES,d,f,y,o.CullFaceMode.backCCW,Et,s.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,s.paint,l.transform.zoom,tt,it)}}function Je(l,n,s,u,d,f){const y=[ee=>{let _e=ee.canonical.x-1,he=ee.wrap;return _e<0&&(_e=(1<<ee.canonical.z)-1,he--),new o.OverscaledTileID(ee.overscaledZ,he,ee.canonical.z,_e,ee.canonical.y)},ee=>{let _e=ee.canonical.x+1,he=ee.wrap;return _e===1<<ee.canonical.z&&(_e=0,he++),new o.OverscaledTileID(ee.overscaledZ,he,ee.canonical.z,_e,ee.canonical.y)},ee=>new o.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,(0===ee.canonical.y?1<<ee.canonical.z:ee.canonical.y)-1),ee=>new o.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y===(1<<ee.canonical.z)-1?0:ee.canonical.y+1)],T=ee=>{const _e=n.getSource().minzoom,he=ze=>{const Te=n.getTileByID(ze);if(Te&&Te.hasData())return Te.getBucket(d)},Le=[0,-1,1];for(const ze of Le){if(ee.overscaledZ+ze<_e)continue;const Te=he(ee.calculateScaledKey(ee.overscaledZ+ze));if(Te)return Te}},E=[0,0,0],P=(ee,_e)=>(E[0]=Math.min(ee.min.y,_e.min.y),E[1]=Math.max(ee.max.y,_e.max.y),E[2]=o.EXTENT-_e.min.x>ee.max.x?_e.min.x-o.EXTENT:ee.max.x,E),z=(ee,_e)=>(E[0]=Math.min(ee.min.x,_e.min.x),E[1]=Math.max(ee.max.x,_e.max.x),E[2]=o.EXTENT-_e.min.y>ee.max.y?_e.min.y-o.EXTENT:ee.max.y,E),V=[(ee,_e)=>P(ee,_e),(ee,_e)=>P(_e,ee),(ee,_e)=>z(ee,_e),(ee,_e)=>z(_e,ee)],K=new o.pointGeometry(0,0);let fe,ie,ge;const ce=(ee,_e,he,Le,ze)=>{const Te=[[Le?he:ee,Le?ee:he,0],[Le?he:_e,Le?_e:he,0]],Re=ze<0?o.EXTENT+ze:ze,tt=[Le?Re:(ee+_e)/2,Le?(ee+_e)/2:Re,0];return 0===he&&ze<0||0!==he&&ze>0?f.getForTilePoints(ge,[tt],!0,ie):Te.push(tt),f.getForTilePoints(s,Te,!0,fe),Math.max(Te[0][2],Te[1][2],tt[2])/f.exaggeration()};for(let ee=0;ee<4;ee++){const _e=(ee<2?1:5)-ee,he=u.borders[ee];if(0===he.length)continue;const Le=ge=y[ee](s),ze=T(Le);if(!(ze&&ze instanceof o.FillExtrusionBucket&&ze.enableTerrain)||u.borderDoneWithNeighborZ[ee]===ze.canonical.z&&ze.borderDoneWithNeighborZ[_e]===u.canonical.z||(ie=f.findDEMTileFor(Le),!ie||!ie.dem))continue;if(!fe){const ut=f.findDEMTileFor(s);if(!ut||!ut.dem)return;fe=ut}const Te=ze.borders[_e];let Re=0;const tt=ze.borderDoneWithNeighborZ[_e]!==u.canonical.z;if(u.canonical.z===ze.canonical.z){for(let ut=0;ut<he.length;ut++){const st=u.featuresOnBorder[he[ut]],zt=st.borders[ee];let Ye;for(;Re<Te.length&&(Ye=ze.featuresOnBorder[Te[Re]],!(Ye.borders[_e][1]>zt[0]+3));)tt&&ze.encodeCentroid(void 0,Ye,!1),Re++;if(Ye&&Re<Te.length){const At=Re;let Et=0;for(;!(Ye.borders[_e][0]>zt[1]-3)&&(Et++,++Re!==Te.length);)Ye=ze.featuresOnBorder[Te[Re]];if(Ye=ze.featuresOnBorder[Te[At]],st.intersectsCount()>1||Ye.intersectsCount()>1||1!==Et){1!==Et&&(Re=At),u.encodeCentroid(void 0,st,!1),tt&&ze.encodeCentroid(void 0,Ye,!1);continue}const it=V[ee](st,Ye),Ze=ee%2?o.EXTENT-1:0;K.x=ce(it[0],Math.min(o.EXTENT-1,it[1]),Ze,ee<2,it[2]),K.y=0,u.encodeCentroid(K,st,!1),tt&&ze.encodeCentroid(K,Ye,!1)}else u.encodeCentroid(void 0,st,!1)}u.borderDoneWithNeighborZ[ee]=ze.canonical.z,u.needsCentroidUpdate=!0,tt&&(ze.borderDoneWithNeighborZ[_e]=u.canonical.z,ze.needsCentroidUpdate=!0)}else{for(const ut of he)u.encodeCentroid(void 0,u.featuresOnBorder[ut],!1);if(tt){for(const ut of Te)ze.encodeCentroid(void 0,ze.featuresOnBorder[ut],!1);ze.borderDoneWithNeighborZ[_e]=u.canonical.z,ze.needsCentroidUpdate=!0}u.borderDoneWithNeighborZ[ee]=ze.canonical.z,u.needsCentroidUpdate=!0}}(u.needsCentroidUpdate||!u.centroidVertexBuffer&&0!==u.centroidVertexArray.length)&&u.uploadCentroid(l)}const It=new o.Color(1,0,0,1),nt=new o.Color(0,1,0,1),Vt=new o.Color(0,0,1,1),Kt=new o.Color(1,0,1,1),ci=new o.Color(0,1,1,1);function di(l,n,s){const u=l.context,d=l.transform,f=u.gl,y="globe"===d.projection.name,T=y?["PROJECTION_GLOBE_VIEW"]:null;let E=s.projMatrix;if(y&&o.globeToMercatorTransition(d.zoom)>0){const st=o.transitionTileAABBinECEF(s.canonical,d),zt=o.globeDenormalizeECEF(st);E=o.multiply(new Float32Array(16),d.globeMatrix,zt),o.multiply(E,d.projMatrix,E)}const P=l.useProgram("debug",null,T),z=n.getTileByID(s.key);l.terrain&&l.terrain.setupElevationDraw(z,P);const V=o.DepthMode.disabled,K=o.StencilMode.disabled,fe=l.colorModeForRenderPass();u.activeTexture.set(f.TEXTURE0),l.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),y?z._makeGlobeTileDebugBuffers(l.context,d):z._makeDebugTileBoundsBuffers(l.context,d.projection);const ge=z._tileDebugBuffer||l.debugBuffer,ce=z._tileDebugIndexBuffer||l.debugIndexBuffer,ee=z._tileDebugSegments||l.debugSegments;P.draw(u,f.LINE_STRIP,V,K,fe,o.CullFaceMode.disabled,bs(E,o.Color.red),"$debug",ge,ce,ee,null,null,null,[z._globeTileDebugBorderBuffer]);const _e=z.latestRawTileData,he=Math.floor((_e&&_e.byteLength||0)/1024),Le=n.getTile(s).tileSize,ze=512/Math.min(Le,512)*(s.overscaledZ/d.zoom)*.5;let Te=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Te+=` => ${s.overscaledZ}`),Te+=` ${he}kb`,function(st,zt){st.initDebugOverlayCanvas();const Ye=st.debugOverlayCanvas,At=st.context.gl,Et=st.debugOverlayCanvas.getContext("2d");Et.clearRect(0,0,Ye.width,Ye.height),Et.shadowColor="white",Et.shadowBlur=2,Et.lineWidth=1.5,Et.strokeStyle="white",Et.textBaseline="top",Et.font="bold 36px Open Sans, sans-serif",Et.fillText(zt,5,5),Et.strokeText(zt,5,5),st.debugOverlayTexture.update(Ye),st.debugOverlayTexture.bind(At.LINEAR,At.CLAMP_TO_EDGE)}(l,Te);const Re=z._tileDebugTextBuffer||l.debugBuffer,tt=z._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,ut=z._tileDebugTextSegments||l.debugSegments;P.draw(u,f.TRIANGLES,V,K,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,bs(E,o.Color.transparent,ze),"$debug",Re,tt,ut,null,null,null,[z._globeTileDebugTextBuffer])}function Yi(l,n,s,u){Ni(l,0,n+s/2,l.transform.width,s,u)}function qi(l,n,s,u){Ni(l,n-s/2,0,s,l.transform.height,u)}function Ni(l,n,s,u,d,f){const y=l.context,T=y.gl;T.enable(T.SCISSOR_TEST),T.scissor(n*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,u*o.exported.devicePixelRatio,d*o.exported.devicePixelRatio),y.clear({color:f}),T.disable(T.SCISSOR_TEST)}const dn=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ar}=dn;function Hi(l,n,s,u){l.emplaceBack(n,s,u)}class Zi{constructor(n){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Hi(this.vertexArray,-1,-1,1),Hi(this.vertexArray,1,-1,1),Hi(this.vertexArray,-1,1,1),Hi(this.vertexArray,1,1,1),Hi(this.vertexArray,-1,-1,-1),Hi(this.vertexArray,1,-1,-1),Hi(this.vertexArray,-1,1,-1),Hi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ar),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Wn(l,n,s,u,d,f){const y=l.gl,T=n.paint.get("sky-atmosphere-color"),E=n.paint.get("sky-atmosphere-halo-color"),P=n.paint.get("sky-atmosphere-sun-intensity"),z={u_matrix_3f:o.fromMat4(o.create$1(),u),u_sun_direction:d,u_sun_intensity:P,u_color_tint_r:[(ie=T).r,ie.g,ie.b,ie.a],u_color_tint_m:[(ge=E).r,ge.g,ge.b,ge.a],u_luminance:5e-5};var ie,ge;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+f,n.skyboxTexture,0),s.draw(l,y.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const zr=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Vn{constructor(n){const s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const u=new o.StructArrayLayout3ui6;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(s,zr.members),this.indexBuffer=n.createIndexBuffer(u),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Or={symbol:function(l,n,s,u,d){if("translucent"!==l.renderPass)return;const f=o.StencilMode.disabled,y=l.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(T,E,P,z,V,K,fe){const ie=E.transform,ge="map"===V,ce="map"===K;for(const ee of T){const _e=z.getTile(ee),he=_e.getBucket(P);if(!he||!he.text||!he.text.segments.get().length)continue;const Le=o.evaluateSizeForZoom(he.textSizeData,ie.zoom),ze=Ho(ee,he.getProjection(),ie),Te=ie.calculatePixelsToTileUnitsMatrix(_e),Re=Oo(ze,_e.tileID.canonical,ce,ge,ie,he.getProjection(),Te),tt="none"!==P.layout.get("icon-text-fit")&&he.hasIconData();if(Le){const ut=Math.pow(2,ie.zoom-_e.tileID.overscaledZ);Pa(he,ge,ce,fe,o.symbolSize,ie,Re,ee,ut,Le,tt)}}}(u,l,s,n,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),d),0!==s.paint.get("icon-opacity").constantOr(1)&&fa(l,n,s,u,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),f,y),0!==s.paint.get("text-opacity").constantOr(1)&&fa(l,n,s,u,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),f,y),n.map.showCollisionBoxes&&(da(l,n,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),da(l,n,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(l,n,s,u){if("translucent"!==l.renderPass)return;const d=s.paint.get("circle-opacity"),f=s.paint.get("circle-stroke-width"),y=s.paint.get("circle-stroke-opacity"),T=void 0!==s.layout.get("circle-sort-key").constantOr(1);if(0===d.constantOr(1)&&(0===f.constantOr(1)||0===y.constantOr(1)))return;const E=l.context,P=E.gl,z=l.transform,V=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),K=o.StencilMode.disabled,fe=l.colorModeForRenderPass(),ie="globe"===z.projection.name,ge=[o.mercatorXfromLng(z.center.lng),o.mercatorYfromLat(z.center.lat)],ce=[];for(let _e=0;_e<u.length;_e++){const he=u[_e],Le=n.getTile(he),ze=Le.getBucket(s);if(!ze||ze.projection.name!==z.projection.name)continue;const Te=ze.programConfigurations.get(s.id),Re=xs(s);ie&&Re.push("PROJECTION_GLOBE_VIEW");const tt=l.useProgram("circle",Te,Re),ut=ze.layoutVertexBuffer,st=ze.globeExtVertexBuffer,zt=ze.indexBuffer,Ye=z.projection.createInversionMatrix(z,he.canonical),At={programConfiguration:Te,program:tt,layoutVertexBuffer:ut,globeExtVertexBuffer:st,indexBuffer:zt,uniformValues:qs(l,he,Le,Ye,ge,s),tile:Le};if(T){const Et=ze.segments.get();for(const it of Et)ce.push({segments:new o.SegmentVector([it]),sortKey:it.sortKey,state:At})}else ce.push({segments:ze.segments,sortKey:0,state:At})}T&&ce.sort((_e,he)=>_e.sortKey-he.sortKey);const ee={useDepthForOcclusion:!ie};for(const _e of ce){const{programConfiguration:he,program:Le,layoutVertexBuffer:ze,globeExtVertexBuffer:Te,indexBuffer:Re,uniformValues:tt,tile:ut}=_e.state,st=_e.segments;l.terrain&&l.terrain.setupElevationDraw(ut,Le,ee),l.prepareDrawProgram(E,Le,ut.tileID.toUnwrapped()),Le.draw(E,P.TRIANGLES,V,K,fe,o.CullFaceMode.disabled,tt,s.id,ze,Re,st,s.paint,z.zoom,he,[Te])}},heatmap:function(l,n,s,u){if(0!==s.paint.get("heatmap-opacity"))if("offscreen"===l.renderPass){const d=l.context,f=d.gl,y=o.StencilMode.disabled,T=new o.ColorMode([f.ONE,f.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(fe,ie,ge,ce){const ee=fe.gl,_e=ie.width*ce,he=ie.height*ce;fe.activeTexture.set(ee.TEXTURE1),fe.viewport.set([0,0,_e,he]);let Le=ge.heatmapFbo;if(!Le||Le&&(Le.width!==_e||Le.height!==he)){Le&&Le.destroy();const ze=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,ze),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),Le=ge.heatmapFbo=fe.createFramebuffer(_e,he,!1),function(Te,Re,tt,ut,st,zt){const Ye=Te.gl;Ye.texImage2D(Ye.TEXTURE_2D,0,Ye.RGBA,st,zt,0,Ye.RGBA,Te.extRenderToTextureHalfFloat?Te.extTextureHalfFloat.HALF_FLOAT_OES:Ye.UNSIGNED_BYTE,null),ut.colorAttachment.set(tt)}(fe,0,ze,Le,_e,he)}else ee.bindTexture(ee.TEXTURE_2D,Le.colorAttachment.get()),fe.bindFramebuffer.set(Le.framebuffer)})(d,l,s,"globe"===l.transform.projection.name?.5:.25),d.clear({color:o.Color.transparent});const E=l.transform,P="globe"===E.projection.name,z=P?["PROJECTION_GLOBE_VIEW"]:null,V=P?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,K=[o.mercatorXfromLng(E.center.lng),o.mercatorYfromLat(E.center.lat)];for(let fe=0;fe<u.length;fe++){const ie=u[fe];if(n.hasRenderableParent(ie))continue;const ge=n.getTile(ie),ce=ge.getBucket(s);if(!ce||ce.projection.name!==E.projection.name)continue;const ee=ce.programConfigurations.get(s.id),_e=l.useProgram("heatmap",ee,z),{zoom:he}=l.transform;l.terrain&&l.terrain.setupElevationDraw(ge,_e),l.prepareDrawProgram(d,_e,ie.toUnwrapped());const Le=E.projection.createInversionMatrix(E,ie.canonical);_e.draw(d,f.TRIANGLES,o.DepthMode.disabled,y,T,V,xo(l,ie,ge,Le,K,he,s.paint.get("heatmap-intensity")),s.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,s.paint,l.transform.zoom,ee,P?[ce.globeExtVertexBuffer]:null)}d.viewport.set([0,0,l.width,l.height])}else"translucent"===l.renderPass&&(l.context.setColorMode(l.colorModeForRenderPass()),function(d,f){const y=d.context,T=y.gl,E=f.heatmapFbo;if(!E)return;y.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,E.colorAttachment.get()),y.activeTexture.set(T.TEXTURE1);let P=f.colorRampTexture;P||(P=f.colorRampTexture=new o.Texture(y,f.colorRamp,T.RGBA)),P.bind(T.LINEAR,T.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(y,T.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,d.colorModeForRenderPass(),o.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:f.paint.get("heatmap-opacity")},f.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,f.paint,d.transform.zoom)}(l,s))},line:function(l,n,s,u){if("translucent"!==l.renderPass)return;const d=s.paint.get("line-opacity"),f=s.paint.get("line-width");if(0===d.constantOr(1)||0===f.constantOr(1))return;const y=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),T=l.colorModeForRenderPass(),E=l.terrain&&l.terrain.renderingToTexture?1:o.exported.devicePixelRatio,P=s.paint.get("line-dasharray"),z=P.constantOr(1),V=s.layout.get("line-cap"),K=s.paint.get("line-pattern"),fe=K.constantOr(1),ie=s.paint.get("line-gradient"),ge=s.getCrossfadeParameters(),ce=fe?"linePattern":"line",ee=l.context,_e=ee.gl,he=(ze=>{const Te=[];jn(ze)&&Te.push("RENDER_LINE_DASH"),ze.paint.get("line-gradient")&&Te.push("RENDER_LINE_GRADIENT");const Re=ze.paint.get("line-trim-offset");0===Re[0]&&0===Re[1]||Te.push("RENDER_LINE_TRIM_OFFSET");const tt=ze.paint.get("line-pattern").constantOr(1),ut=1!==ze.paint.get("line-opacity").constantOr(1);return!tt&&ut&&Te.push("RENDER_LINE_ALPHA_DISCARD"),Te})(s);let Le=he.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(Le=!1);for(const ze of u){const Te=n.getTile(ze);if(fe&&!Te.patternsLoaded())continue;const Re=Te.getBucket(s);if(!Re)continue;l.prepareDrawTile();const tt=Re.programConfigurations.get(s.id),ut=l.useProgram(ce,tt,he),st=K.constantOr(null);if(st&&Te.imageAtlas){const Gt=Te.imageAtlas,Qt=Gt.patternPositions[st.to.toString()],Zt=Gt.patternPositions[st.from.toString()];Qt&&Zt&&tt.setConstantPatternPositions(Qt,Zt)}const zt=P.constantOr(null),Ye=V.constantOr(null);if(!fe&&zt&&Ye&&Te.lineAtlas){const Gt=Te.lineAtlas,Qt=Gt.getDash(zt.to,Ye),Zt=Gt.getDash(zt.from,Ye);Qt&&Zt&&tt.setConstantPatternPositions(Qt,Zt)}let[At,Et]=s.paint.get("line-trim-offset");("round"===Ye||"square"===Ye)&&At!==Et&&(0===At&&(At-=1),1===Et&&(Et+=1));const it=l.terrain?ze.projMatrix:null,Ze=fe?la(l,Te,s,ge,it,E):Ia(l,Te,s,ge,it,Re.lineClipsArray.length,E,[At,Et]);if(ie){const Gt=Re.gradients[s.id];let Qt=Gt.texture;if(s.gradientVersion!==Gt.version){let Zt=256;if(s.stepInterpolant){const vi=n.getSource().maxzoom,Ui=ze.canonical.z===vi?Math.ceil(1<<l.transform.maxZoom-ze.canonical.z):1;Zt=o.clamp(o.nextPowerOfTwo(Re.maxLineLength/o.EXTENT*1024*Ui),256,ee.maxTextureSize)}Gt.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Zt,image:Gt.gradient||void 0,clips:Re.lineClipsArray}),Gt.texture?Gt.texture.update(Gt.gradient):Gt.texture=new o.Texture(ee,Gt.gradient,_e.RGBA),Gt.version=s.gradientVersion,Qt=Gt.texture}ee.activeTexture.set(_e.TEXTURE1),Qt.bind(s.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}z&&(ee.activeTexture.set(_e.TEXTURE0),Te.lineAtlasTexture.bind(_e.LINEAR,_e.REPEAT),tt.updatePaintBuffers(ge)),fe&&(ee.activeTexture.set(_e.TEXTURE0),Te.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),tt.updatePaintBuffers(ge)),l.prepareDrawProgram(ee,ut,ze.toUnwrapped());const ni=Gt=>{ut.draw(ee,_e.TRIANGLES,y,Gt,T,o.CullFaceMode.disabled,Ze,s.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,s.paint,l.transform.zoom,tt,[Re.layoutVertexBuffer2])};if(Le){const Gt=l.stencilModeForClipping(ze).ref;0===Gt&&l.terrain&&ee.clear({stencil:0});const Qt={func:_e.EQUAL,mask:255};Ze.u_alpha_discard_threshold=.8,ni(new o.StencilMode(Qt,Gt,255,_e.KEEP,_e.KEEP,_e.INVERT)),Ze.u_alpha_discard_threshold=0,ni(new o.StencilMode(Qt,Gt,255,_e.KEEP,_e.KEEP,_e.KEEP))}else ni(l.stencilModeForClipping(ze))}Le&&(l.resetStencilClippingMasks(),l.terrain&&ee.clear({stencil:0}))},fill:function(l,n,s,u){const d=s.paint.get("fill-color"),f=s.paint.get("fill-opacity");if(0===f.constantOr(1))return;const y=l.colorModeForRenderPass(),T=s.paint.get("fill-pattern"),E=l.opaquePassEnabledForLayer()&&!T.constantOr(1)&&1===d.constantOr(o.Color.transparent).a&&1===f.constantOr(0)?"opaque":"translucent";if(l.renderPass===E){const P=l.depthModeForSublayer(1,"opaque"===l.renderPass?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);pe(l,n,s,u,P,y,!1)}if("translucent"===l.renderPass&&s.paint.get("fill-antialias")){const P=l.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);pe(l,n,s,u,P,y,!0)}},"fill-extrusion":function(l,n,s,u){const d=s.paint.get("fill-extrusion-opacity");if(0!==d&&"translucent"===l.renderPass){const f=new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D);if(1!==d||s.paint.get("fill-extrusion-pattern").constantOr(1))Fe(l,n,s,u,f,o.StencilMode.disabled,o.ColorMode.disabled),Fe(l,n,s,u,f,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const y=l.colorModeForRenderPass();Fe(l,n,s,u,f,o.StencilMode.disabled,y)}}},hillshade:function(l,n,s,u){if("offscreen"!==l.renderPass&&"translucent"!==l.renderPass)return;const d=l.context,f=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),y=l.colorModeForRenderPass(),T=l.terrain&&l.terrain.renderingToTexture,[E,P]="translucent"!==l.renderPass||T?[{},u]:l.stencilConfigForOverlap(u);for(const z of P){const V=n.getTile(z);if(V.needsHillshadePrepare&&"offscreen"===l.renderPass)or(l,V,s,f,o.StencilMode.disabled,y);else if("translucent"===l.renderPass){const K=T&&l.terrain?l.terrain.stencilModeForRTTOverlap(z):E[z.overscaledZ];to(l,z,V,s,f,K,y)}}d.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,n,s,u,d,f){if("translucent"!==l.renderPass||0===s.paint.get("raster-opacity")||!u.length)return;const y=l.context,T=y.gl,E=n.getSource(),P=l.useProgram("raster"),z=l.colorModeForRenderPass(),V=l.terrain&&l.terrain.renderingToTexture,[K,fe]=E instanceof De||V?[{},u]:l.stencilConfigForOverlap(u),ie=fe[fe.length-1].overscaledZ,ge=!l.options.moving;for(const ce of fe){const ee=V?o.DepthMode.disabled:l.depthModeForSublayer(ce.overscaledZ-ie,1===s.paint.get("raster-opacity")?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,T.LESS),_e=ce.toUnwrapped(),he=n.getTile(ce);if(V&&(!he||!he.hasData()))continue;const Le=V?ce.projMatrix:l.transform.calculateProjMatrix(_e,ge),ze=l.terrain&&V?l.terrain.stencilModeForRTTOverlap(ce):K[ce.overscaledZ],Te=f?0:s.paint.get("raster-fade-duration");he.registerFadeDuration(Te);const Re=n.findLoadedParent(ce,0),tt=uo(he,Re,n,l.transform,Te);let ut,st;l.terrain&&l.terrain.prepareDrawTile();const zt="nearest"===s.paint.get("raster-resampling")?T.NEAREST:T.LINEAR;y.activeTexture.set(T.TEXTURE0),he.texture.bind(zt,T.CLAMP_TO_EDGE),y.activeTexture.set(T.TEXTURE1),Re?(Re.texture.bind(zt,T.CLAMP_TO_EDGE),ut=Math.pow(2,Re.tileID.overscaledZ-he.tileID.overscaledZ),st=[he.tileID.canonical.x*ut%1,he.tileID.canonical.y*ut%1]):he.texture.bind(zt,T.CLAMP_TO_EDGE);const Ye=ws(Le,st||[0,0],ut||1,tt,s,E instanceof De?E.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(y,P,_e),E instanceof De)E.boundsBuffer&&E.boundsSegments&&P.draw(y,T.TRIANGLES,ee,o.StencilMode.disabled,z,o.CullFaceMode.disabled,Ye,s.id,E.boundsBuffer,l.quadTriangleIndexBuffer,E.boundsSegments);else{const{tileBoundsBuffer:At,tileBoundsIndexBuffer:Et,tileBoundsSegments:it}=l.getTileBoundsBuffers(he);P.draw(y,T.TRIANGLES,ee,ze,z,o.CullFaceMode.disabled,Ye,s.id,At,Et,it)}}l.resetStencilClippingMasks()},background:function(l,n,s,u){const d=s.paint.get("background-color"),f=s.paint.get("background-opacity");if(0===f)return;const y=l.context,T=y.gl,E=l.transform,P=E.tileSize,z=s.paint.get("background-pattern");if(l.isPatternMissing(z))return;const V=!z&&1===d.a&&1===f&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==V)return;const K=o.StencilMode.disabled,fe=l.depthModeForSublayer(0,"opaque"===V?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),ie=l.colorModeForRenderPass(),ge=l.useProgram(z?"backgroundPattern":"background");let ce,ee=u;ee||(ce=l.getBackgroundTiles(),ee=Object.values(ce).map(he=>he.tileID)),z&&(y.activeTexture.set(T.TEXTURE0),l.imageManager.bind(l.context));const _e=s.getCrossfadeParameters();for(const he of ee){const Le=he.toUnwrapped(),ze=u?he.projMatrix:l.transform.calculateProjMatrix(Le);l.prepareDrawTile();const Te=n?n.getTile(he):ce?ce[he.key]:new o.Tile(he,P,E.zoom,l),Re=z?el(ze,f,l,z,{tileID:he,tileSize:P},_e):Da(ze,f,d);l.prepareDrawProgram(y,ge,Le);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:ut,tileBoundsSegments:st}=l.getTileBoundsBuffers(Te);ge.draw(y,T.TRIANGLES,fe,K,ie,o.CullFaceMode.disabled,Re,s.id,tt,ut,st)}},sky:function(l,n,s){const u=l.transform,d="mercator"===u.projection.name||"globe"===u.projection.name?1:o.smoothstep(7,8,u.zoom),f=s.paint.get("sky-opacity")*d;if(0===f)return;const y=l.context,T=s.paint.get("sky-type"),E=new o.DepthMode(y.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),P=l.frameCounter/1e3%1;"atmosphere"===T?"offscreen"===l.renderPass?s.needsSkyboxCapture(l)&&(function(z,V,K,fe){const ie=z.context,ge=ie.gl;let ce=V.skyboxFbo;if(!ce){ce=V.skyboxFbo=ie.createFramebuffer(32,32,!1),V.skyboxGeometry=new Zi(ie),V.skyboxTexture=ie.gl.createTexture(),ge.bindTexture(ge.TEXTURE_CUBE_MAP,V.skyboxTexture),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_CUBE_MAP,ge.TEXTURE_MAG_FILTER,ge.LINEAR);for(let Le=0;Le<6;++Le)ge.texImage2D(ge.TEXTURE_CUBE_MAP_POSITIVE_X+Le,0,ge.RGBA,32,32,0,ge.RGBA,ge.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(ce.framebuffer),ie.viewport.set([0,0,32,32]);const ee=V.getCenter(z,!0),_e=z.useProgram("skyboxCapture"),he=new Float64Array(16);o.identity(he),o.rotateY(he,he,.5*-Math.PI),Wn(ie,V,_e,he,ee,0),o.identity(he),o.rotateY(he,he,.5*Math.PI),Wn(ie,V,_e,he,ee,1),o.identity(he),o.rotateX(he,he,.5*-Math.PI),Wn(ie,V,_e,he,ee,2),o.identity(he),o.rotateX(he,he,.5*Math.PI),Wn(ie,V,_e,he,ee,3),o.identity(he),Wn(ie,V,_e,he,ee,4),o.identity(he),o.rotateY(he,he,Math.PI),Wn(ie,V,_e,he,ee,5),ie.viewport.set([0,0,z.width,z.height])}(l,s),s.markSkyboxValid(l)):"sky"===l.renderPass&&function(z,V,K,fe,ie){const ge=z.context,ce=ge.gl,ee=z.transform,_e=z.useProgram("skybox");ge.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,V.skyboxTexture);const he={u_matrix:ee.skyboxMatrix,u_sun_direction:V.getCenter(z,!1),u_cubemap:0,u_opacity:fe,u_temporal_offset:ie};z.prepareDrawProgram(ge,_e),_e.draw(ge,ce.TRIANGLES,K,o.StencilMode.disabled,z.colorModeForRenderPass(),o.CullFaceMode.backCW,he,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(l,s,E,f,P):"gradient"===T&&"sky"===l.renderPass&&function(z,V,K,fe,ie){const ge=z.context,ce=ge.gl,ee=z.transform,_e=z.useProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new Zi(ge)),ge.activeTexture.set(ce.TEXTURE0);let he=V.colorRampTexture;he||(he=V.colorRampTexture=new o.Texture(ge,V.colorRamp,ce.RGBA)),he.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const Le=(ze=ee.skyboxMatrix,Te=V.getCenter(z,!1),Re=V.paint.get("sky-gradient-radius"),tt=fe,ut=ie,{u_matrix:ze,u_color_ramp:0,u_center_direction:Te,u_radius:o.degToRad(Re),u_opacity:tt,u_temporal_offset:ut});var ze,Te,Re,tt,ut;z.prepareDrawProgram(ge,_e),_e.draw(ge,ce.TRIANGLES,K,o.StencilMode.disabled,z.colorModeForRenderPass(),o.CullFaceMode.backCW,Le,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(l,s,E,f,P)},debug:function(l,n,s){for(let u=0;u<s.length;u++)di(l,n,s[u])},custom:function(l,n,s){const u=l.context,d=s.implementation;if(l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===l.renderPass){const f=d.prerender;f&&(l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),f.call(d,u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState())}else if("translucent"===l.renderPass){l.setCustomLayerDefaults(),u.setColorMode(l.colorModeForRenderPass()),u.setStencilMode(o.StencilMode.disabled);const f="3d"===d.renderingMode?new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,o.DepthMode.ReadOnly);u.setDepthMode(f),d.render(u.gl,l.transform.customLayerMatrix()),u.setDirty(),l.setBaseState(),u.bindFramebuffer.set(null)}}};class Pr{constructor(n,s){this.context=new U(n),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new M,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,s){const u=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Gr(this,n));const d=this._terrain;this.transform.elevation=u?d:null,d.update(n,this.transform,s)}_updateFog(n){const s=n.fog;if(!s||"globe"===this.transform.projection.name||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,d]=s.getFovAdjustedRange(this.transform._fov);if(u>d)return void(this.transform.fogCullDistSq=null);const f=u+.78*(d-u);this.transform.fogCullDistSq=f*f}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,s){if(this.width=n*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._layers[u].resize()}setup(){const n=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const u=new o.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(o.EXTENT,0),u.emplaceBack(0,o.EXTENT),u.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=n.createVertexBuffer(u,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const d=new o.StructArrayLayout2i4;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(d,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const f=new o.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(o.EXTENT,0,o.EXTENT,0),f.emplaceBack(0,o.EXTENT,0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(f,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(y);const T=new o.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])T.emplaceBack(P);this.debugIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new o.Texture(n,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=o.create();const E=this.context.gl;this.stencilClearMode=new o.StencilMode({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Vn(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,s=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,xr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,s,u){if(!s||this.currentStencilSource===s.id||!n.isTileClipped()||!u||0===u.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const E of u)if(void 0===this._tileClippingMaskIDs[E.key]){T=!0;break}if(!T)return}this.currentStencilSource=s.id;const d=this.context,f=d.gl;this.nextStencilID+u.length>256&&this.clearStencil(),d.setColorMode(o.ColorMode.disabled),d.setDepthMode(o.DepthMode.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of u){const E=s.getTile(T),P=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:V,tileBoundsSegments:K}=this.getTileBoundsBuffers(E);y.draw(d,f.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:f.ALWAYS,mask:0},P,255,f.KEEP,f.KEEP,f.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,xr(T.projMatrix),"$clipping",z,V,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(n){const s=this.context.gl,u=n.sort((y,T)=>T.overscaledZ-y.overscaledZ),d=u[u.length-1].overscaledZ,f=u[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const y={};for(let T=0;T<f;T++)y[T+d]=new o.StencilMode({func:s.GEQUAL,mask:255},T+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[y,u]}return[{[d]:o.StencilMode.disabled},u]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([n.CONSTANT_COLOR,n.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(n,s,u){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new o.DepthMode(u||this.context.gl.LEQUAL,s,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,s){this.style=n,this.options=s,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const u=this.style.order,d=this.style._sourceCaches;for(const E in d){const P=d[E];P.used&&P.prepare(this.context)}const f={},y={},T={};for(const E in d){const P=d[E];f[E]=P.getVisibleCoordinates(),y[E]=f[E].slice().reverse(),T[E]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<u.length;E++)if(this.style._layers[u[E]].is3D()){this.opaquePassCutoff=E;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const E of u){const P=this.style._layers[E],z=n._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const V=z?y[z.id]:void 0;("custom"===P.type||P.isSky()||V&&V.length)&&this.renderLayer(this,z,P,V)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[u[this.currentLayer]],P=n._getLayerSourceCache(E);if(E.isSky())continue;const z=P?y[P.id]:void 0;this._renderTileClippingMasks(E,P,z),this.renderLayer(this,P,E,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(E,P){const z=E.context,V=z.gl,K=E.transform,fe=new o.DepthMode(V.LEQUAL,o.DepthMode.ReadOnly,[0,1]),ie=E.useProgram("globeAtmosphere",null,"globe"===K.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ge=o.globeToMercatorTransition(K.zoom),ce=P.properties.get("color").toArray01(),ee=P.properties.get("high-color").toArray01(),_e=P.properties.get("space-color").toArray01PremultipliedAlpha(),he=o.identity$1([]);o.rotateY$1(he,he,-o.degToRad(K._center.lng)),o.rotateX$1(he,he,o.degToRad(K._center.lat)),o.rotateZ$1(he,he,K.angle),o.rotateX$1(he,he,-K._pitch);const Le=o.fromQuat(new Float32Array(16),he),ze=o.mapValue(P.properties.get("star-intensity"),0,1,0,.25),Re=o.mapValue(P.properties.get("horizon-blend"),0,1,5e-4,.25),tt=o.globeUseCustomAntiAliasing(E,z,K)&&5e-4===Re?K.worldSize/(2*Math.PI*1.025)-1:K.globeRadius,ut=E.frameCounter/1e3%1,st=o.length(K.globeCenterInViewSpace),zt=Math.sqrt(Math.pow(st,2)-Math.pow(tt,2)),Ye=Math.acos(zt/st),At={u_frustum_tl:K.frustumCorners.TL,u_frustum_tr:K.frustumCorners.TR,u_frustum_br:K.frustumCorners.BR,u_frustum_bl:K.frustumCorners.BL,u_horizon:K.frustumCorners.horizon,u_transition:ge,u_fadeout_range:Re,u_color:ce,u_high_color:ee,u_space_color:_e,u_star_intensity:ze,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ut,u_horizon_angle:Ye,u_rotation_matrix:Le};E.prepareDrawProgram(z,ie);const Et=E.atmosphereBuffer;Et&&ie.draw(z,V.TRIANGLES,fe,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,At,"skybox",Et.vertexBuffer,Et.indexBuffer,Et.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const E=this.style._layers[u[this.currentLayer]],P=n._getLayerSourceCache(E);E.isSky()&&this.renderLayer(this,P,E,P?y[P.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;){const E=this.style._layers[u[this.currentLayer]],P=n._getLayerSourceCache(E);if(E.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(E)){if(E.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=P?("symbol"===E.type?T:y)[P.id]:void 0;this._renderTileClippingMasks(E,P,P?f[P.id]:void 0),this.renderLayer(this,P,E,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let E=null;o.values(this.style._layers).forEach(P=>{const z=n._getLayerSourceCache(P);z&&!P.isHidden(this.transform.zoom)&&(!E||E.getSource().maxzoom<z.getSource().maxzoom)&&(E=z)}),E&&this.options.showTileBoundaries&&Or.debug(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const P=E.transform.padding;Yi(E,E.transform.height-(P.top||0),3,It),Yi(E,P.bottom||0,3,nt),qi(E,P.left||0,3,Vt),qi(E,E.transform.width-(P.right||0),3,Kt);const z=E.transform.centerPoint;var V,K,fe,ie;Ni(V=E,(K=z.x)-1,(fe=E.transform.height-z.y)-10,2,20,ie=ci),Ni(V,K-10,fe-1,20,2,ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,s,u,d){u.isHidden(this.transform.zoom)||("background"===u.type||"sky"===u.type||"custom"===u.type||d&&d.length)&&(this.id=u.id,this.gpuTimingStart(u),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(u.type)||Or[u.type](n,s,u,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let u=this.gpuTimers[n.id];u||(u=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),u.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,u.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,s=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),n.beginQueryEXT(n.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const s={};for(const u in n){const d=n[u],f=this.context.extTimerQuery,y=f.getQueryObjectEXT(d.query,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(d.query),s[u]=y}return s}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery;let u=0;for(const d of n)u+=s.getQueryObjectEXT(d,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(d);return u}translatePosMatrix(n,s,u,d,f){if(!u[0]&&!u[1])return n;const y=f?"map"===d?this.transform.angle:0:"viewport"===d?-this.transform.angle:0;if(y){const P=Math.sin(y),z=Math.cos(y);u=[u[0]*z-u[1]*P,u[0]*P+u[1]*z]}const T=[f?u[0]:Si(s,u[0],this.transform.zoom),f?u[1]:Si(s,u[1],this.transform.zoom),0],E=new Float32Array(16);return o.translate(E,n,T),E}saveTileTexture(n){const s=this._tileTextures[n.size[0]];s?s.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const s=this._tileTextures[n];return s&&s.length>0?s.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const s=this.imageManager.getPattern(n.from.toString()),u=this.imageManager.getPattern(n.to.toString());return!s||!u}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,u=[];return this.terrainRenderModeElevated()&&u.push("TERRAIN"),"globe"===this.transform.projection.name&&u.push("GLOBE"),s&&!n&&0!==s.getOpacity(this.transform.pitch)&&u.push("FOG"),n&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}useProgram(n,s,u){this.cache=this.cache||{};const d=u||[],f=this.currentGlobalDefines().concat(d),y=cr.cacheKey(fn[n],n,f,s);return this.cache[y]||(this.cache[y]=new cr(this.context,n,fn[n],s,Io[n],f)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,s,u){if(this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const f=d.getOpacity(this.transform.pitch),y=((T,E,P,z,V,K,fe,ie,ge,ce,ee)=>{const _e=T.transform,he=E.properties.get("color").toArray01();he[3]=z;const Le=T.frameCounter/1e3%1;return{u_fog_matrix:P?_e.calculateFogTileMatrix(P):T.identityMat,u_fog_range:E.getFovAdjustedRange(_e._fov),u_fog_color:he,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:Le,u_frustum_tl:V,u_frustum_tr:K,u_frustum_br:fe,u_frustum_bl:ie,u_globe_pos:ge,u_globe_radius:ce,u_viewport:ee,u_globe_transition:o.globeToMercatorTransition(_e.zoom),u_is_globe:+("globe"===_e.projection.name)}})(this,d,u,f,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(n,y)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,s=n.createTexture();return n.bindTexture(n.TEXTURE_2D,s),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,s=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const d of u)s[d.key]=n[d.key]||new o.Tile(d,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class lr{constructor(n=0,s=0,u=0,d=0){if(isNaN(n)||n<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=u,this.right=d}interpolate(n,s,u){return null!=s.top&&null!=n.top&&(this.top=o.number(n.top,s.top,u)),null!=s.bottom&&null!=n.bottom&&(this.bottom=o.number(n.bottom,s.bottom,u)),null!=s.left&&null!=n.left&&(this.left=o.number(n.left,s.left,u)),null!=s.right&&null!=n.right&&(this.right=o.number(n.right,s.right,u)),this}getCenter(n,s){const u=o.clamp((this.left+n-this.right)/2,0,n),d=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(u,d)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new lr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function io(l,n){const s=o.getColumn(l,3);o.fromQuat(l,n),o.setColumn(l,3,s)}function Ss(l,n){const s=o.identity$1([]);return o.rotateZ$1(s,s,-n),o.rotateX$1(s,s,-l),s}function As(l,n){const s=[l[0],l[1],0],u=[n[0],n[1],0];if(o.length(s)>=1e-15){const y=o.normalize([],s);o.scale$2(u,y,o.dot(u,y)),n[0]=u[0],n[1]=u[1]}const d=o.cross([],n,l);if(o.len(d)<1e-15)return null;const f=Math.atan2(-d[1],d[0]);return Ss(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),f)}class Cs{constructor(n,s){this.position=n,this.orientation=s}get position(){return this._position}set position(n){if(n){const s=n instanceof o.MercatorCoordinate?n:new o.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(n,s){if(this.orientation=null,!this.position)return;const u=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(n)):0,d=this.position,f=o.MercatorCoordinate.fromLngLat(n,u),y=[f.x-d.x,f.y-d.y,f.z-d.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=As(y,s)}setPitchBearing(n,s){this.orientation=Ss(o.degToRad(n),o.degToRad(-s))}}class ls{constructor(n,s){this._transform=o.identity([]),this.orientation=s,this.position=n}get mercatorPosition(){const n=this.position;return new o.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=o.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var s;n&&o.setColumn(this._transform,3,[(s=n)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.identity$1([]),n&&io(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,s){this._orientation=Ss(n,s),io(this._transform,this._orientation)}forward(){const n=o.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,s){const u=new Float64Array(16);return o.invert(u,this.getWorldToCamera(n,s)),u}getWorldToCameraPosition(n,s,u){const d=this.position;o.scale$2(d,d,-n);const f=new Float64Array(16);return o.fromScaling(f,[u,u,u]),o.translate(f,f,d),f[10]*=s,f}getWorldToCamera(n,s){const u=new Float64Array(16),d=new Float64Array(4),f=this.position;return o.conjugate(d,this._orientation),o.scale$2(f,f,-n),o.fromQuat(u,d),o.translate(u,u,f),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=s,u[9]*=s,u[10]*=s,u[11]*=s,u}getCameraToClipPerspective(n,s,u,d){const f=new Float64Array(16);return o.perspective(f,n,s,u,d),f}getDistanceToElevation(n){const s=0===n?0:o.mercatorZfromAltitude(n,this.position[1]),u=this.forward();return(s-this.position[2])/u[2]}clone(){return new ls([...this.position],[...this.orientation])}}function tl(l,n){const s=La(l.projection,l.zoom,l.width,l.height),u=function(f,y,T,E,P){const z=new o.LngLat(T.lng-180*cs,T.lat),V=new o.LngLat(T.lng+180*cs,T.lat),K=f.project(z.lng,z.lat),fe=f.project(V.lng,V.lat),ie=-Math.atan2(fe.y-K.y,fe.x-K.x),ge=o.MercatorCoordinate.fromLngLat(T);ge.y=o.clamp(ge.y,-.999975,.999975);const ce=ge.toLngLat(),ee=f.project(ce.lng,ce.lat),_e=o.MercatorCoordinate.fromLngLat(ce);_e.x+=cs;const he=_e.toLngLat(),Le=f.project(he.lng,he.lat),ze=ui(Le.x-ee.x,Le.y-ee.y,ie),Te=o.MercatorCoordinate.fromLngLat(ce);Te.y+=cs;const Re=Te.toLngLat(),tt=f.project(Re.lng,Re.lat),ut=ui(tt.x-ee.x,tt.y-ee.y,ie),st=Math.abs(ze.x)/Math.abs(ut.y),zt=o.identity([]);o.rotateZ(zt,zt,-ie*(1-(P?0:E)));const Ye=o.identity([]);return o.scale(Ye,Ye,[1,1-(1-st)*E,1]),Ye[4]=-ut.x/ut.y*E,o.rotateZ(Ye,Ye,ie),o.multiply(Ye,zt,Ye),Ye}(l.projection,0,l.center,s,n),d=il(l);return o.scale(u,u,[d,d,1]),u}function il(l){const n=l.projection,s=La(l.projection,l.zoom,l.width,l.height),u=za(n,l.center),d=za(n,o.LngLat.convert(n.center));return Math.pow(2,u*s+(1-s)*d)}function La(l,n,s,u,d=1/0){const f=l.range;if(!f)return 0;const y=Math.min(d,Math.max(s,u)),T=Math.log(y/1024)/Math.LN2;return o.smoothstep(f[0]+T,f[1]+T,n)}const cs=1/4e4;function za(l,n){const s=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),u=new o.LngLat(n.lng-180*cs,s),d=new o.LngLat(n.lng+180*cs,s),f=l.project(u.lng,s),y=l.project(d.lng,s),T=o.MercatorCoordinate.fromLngLat(u),E=o.MercatorCoordinate.fromLngLat(d),P=y.x-f.x,z=y.y-f.y,V=E.x-T.x,K=E.y-T.y,fe=Math.sqrt((V*V+K*K)/(P*P+z*z));return Math.log(fe)/Math.LN2}function ui(l,n,s){const u=Math.cos(s),d=Math.sin(s);return{x:l*u-n*d,y:l*d+n*u}}class wo{constructor(n,s,u,d,f,y,T){this.tileSize=512,this._renderWorldCopies=void 0===f||f,this._minZoom=n||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=d??60,this.setProjection(y),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new lr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ls,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new wo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n){const s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||s)&&this._updateCameraOnTerrain(),(n||s)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const u=!D(s,this.getProjection());return u&&this._calcMatrices(),this.mercatorFromTransition=!1,u}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const s=n!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const s=-n*Math.PI/180;var u,d,f,y,T,E,P,z,V,K;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(u=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u),d=this.rotationMatrix,y=this.angle,T=(f=this.rotationMatrix)[0],E=f[1],P=f[2],z=f[3],V=Math.sin(y),K=Math.cos(y),d[0]=T*K+P*V,d[1]=E*K+z*V,d[2]=T*-V+P*K,d[3]=E*-V+z*K)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const s=o.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const s=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let d=0,f=0;for(let y=0;y<s.length;y++){const T=new o.pointGeometry(s[y][0]*this.width,u+s[y][1]*(this.height-u)),E=n.pointCoordinate(T);if(!E)continue;const P=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);d+=E[3]*P,f+=P}return 0===f?NaN:d/f}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*s,d=this._mercatorZfromZoom(n),f=this._mercatorZfromZoom(this._maxZoom),y=Math.max(d-u,f);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let u;u=n.z<this._camera.position[2]?[s.x,s.y,s.z]:[n.x,n.y,n.z];const d=o.length(o.sub([],this._camera.position,u));return o.clamp(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let s=!1;if(n.orientation&&!o.exactEquals(n.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(n.orientation)),n.position){const u=[n.position.x,n.position.y,n.position.z];o.exactEquals$1(u,this._camera.position)||(this._setCameraPosition(u),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,s=new Cs;return s.position=new o.MercatorCoordinate(n[0],n[1],n[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(n){if(!o.length$1(n))return!1;o.normalize$1(n,n);const s=o.transformQuat([],[0,0,-1],n),u=o.transformQuat([],[0,-1,0],n);if(u[2]<0)return!1;const d=As(s,u);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(n){const s=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;n[2]=o.clamp(n[2],d/u,d/s),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,s,u){this._unmodified=!1,this._edgeInsets.interpolate(n,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const s=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(n){const s=[new o.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const u=this.pointCoordinate(new o.pointGeometry(0,0)),d=this.pointCoordinate(new o.pointGeometry(this.width,0)),f=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),y=this.pointCoordinate(new o.pointGeometry(0,this.height)),T=Math.floor(Math.min(u.x,d.x,f.x,y.x)),E=Math.floor(Math.max(u.x,d.x,f.x,y.x)),P=1;for(let z=T-P;z<=E+P;z++)0!==z&&s.push(new o.UnwrappedTileID(z,n))}return s}coveringTiles(n){let s=this.coveringZoomLevel(n);const u=s,d=this.elevation&&!n.isTerrainDEM,f="mercator"===this.projection.name;if(void 0!==n.minzoom&&s<n.minzoom)return[];void 0!==n.maxzoom&&s>n.maxzoom&&(s=n.maxzoom);const y=this.locationCoordinate(this.center),T=this.center.lat,E=1<<s,P=[E*y.x,E*y.y,0],z="globe"===this.projection.name,V=!z,K=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,V),fe=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=E*o.mercatorZfromAltitude(1,this.center.lat),ge=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),ce=[E*fe.x,E*fe.y,ge*(V?1:ie)],ee=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),_e=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,he=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Le=n.isTerrainDEM?-he:this._elevation?this._elevation.getMinElevationBelowMSL():0,ze=this.projection.isReprojectedInTileSpace?il(this):1,Te=Ze=>{const Gt=new o.MercatorCoordinate(Ze.x+25e-6,Ze.y,Ze.z),Qt=new o.MercatorCoordinate(Ze.x,Ze.y+25e-6,Ze.z),Zt=Ze.toLngLat(),vi=Gt.toLngLat(),Ui=Qt.toLngLat(),Li=this.locationCoordinate(Zt),Ei=this.locationCoordinate(vi),Ht=this.locationCoordinate(Ui),Wi=Math.hypot(Ei.x-Li.x,Ei.y-Li.y),cn=Math.hypot(Ht.x-Li.x,Ht.y-Li.y);return Math.sqrt(Wi*cn)*ze/25e-6},Re=Ze=>{const ni=he,Gt=Le;return{aabb:o.tileAABB(this,E,0,0,0,Ze,Gt,ni,this.projection),zoom:0,x:0,y:0,minZ:Gt,maxZ:ni,wrap:Ze,fullyVisible:!1}},tt=[];let ut=[];const st=s,zt=n.reparseOverscaled?u:s,Ye=Ze=>Ze*Ze,At=Ye((ge-this._centerAltitude)*ie),Et=Ze=>{if(!this._elevation||!Ze.tileID||!f)return;const ni=this._elevation.getMinMaxForTile(Ze.tileID),Gt=Ze.aabb;ni?(Gt.min[2]=ni.min,Gt.max[2]=ni.max,Gt.center[2]=(Gt.min[2]+Gt.max[2])/2):(Ze.shouldSplit=it(Ze),Ze.shouldSplit||(Gt.min[2]=Gt.max[2]=Gt.center[2]=this._centerAltitude))},it=Ze=>{if(Ze.zoom<_e)return!0;if(Ze.zoom===st)return!1;if(null!=Ze.shouldSplit)return Ze.shouldSplit;const ni=Ze.aabb.distanceX(ce),Gt=Ze.aabb.distanceY(ce);let Qt=At,Zt=1;if(z){Qt=Ye(Ze.aabb.distanceZ(ce));const Li=Math.pow(2,Ze.zoom),Ei=o.latFromMercatorY((Ze.y+1)/Li),Ht=o.latFromMercatorY(Ze.y/Li),Wi=Math.min(Math.max(T,Ei),Ht),cn=o.circumferenceAtLatitude(Wi)/o.circumferenceAtLatitude(T);if(Zt=Wi===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,cn/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Ze.zoom===st-1&&cn>=.9)return!0}else if(d&&(Qt=Ye(Ze.aabb.distanceZ(ce)*ie)),this.projection.isReprojectedInTileSpace&&u<=5){const Li=Math.pow(2,Ze.zoom),Ei=Te(new o.MercatorCoordinate((Ze.x+.5)/Li,(Ze.y+.5)/Li));Zt=Ei>.85?1:Ei}const vi=ni*ni+Gt*Gt+Qt;return vi<Ye((1<<st-Ze.zoom)*ee*Zt*((Li,Ei)=>{if(Ei*Ye(.707)<Li)return 1;const Ht=Math.sqrt(Ei/Li);return Ht/(1.4144271570014144+(Math.pow(1.1,Ht-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Qt,At),vi))};if(this.renderWorldCopies)for(let Ze=1;Ze<=3;Ze++)tt.push(Re(-Ze)),tt.push(Re(Ze));for(tt.push(Re(0));tt.length>0;){const Ze=tt.pop(),ni=Ze.x,Gt=Ze.y;let Qt=Ze.fullyVisible;if(!Qt){const Zt=Ze.aabb.intersects(K);if(0===Zt)continue;Qt=2===Zt}if(Ze.zoom!==st&&it(Ze))for(let Zt=0;Zt<4;Zt++){const vi=(ni<<1)+Zt%2,Ui=(Gt<<1)+(Zt>>1),Li={aabb:f?Ze.aabb.quadrant(Zt):o.tileAABB(this,E,Ze.zoom+1,vi,Ui,Ze.wrap,Ze.minZ,Ze.maxZ,this.projection),zoom:Ze.zoom+1,x:vi,y:Ui,wrap:Ze.wrap,fullyVisible:Qt,tileID:void 0,shouldSplit:void 0,minZ:Ze.minZ,maxZ:Ze.maxZ};d&&!z&&(Li.tileID=new o.OverscaledTileID(Ze.zoom+1===st?zt:Ze.zoom+1,Ze.wrap,Ze.zoom+1,vi,Ui),Et(Li)),tt.push(Li)}else{const Zt=Ze.zoom===st?zt:Ze.zoom;if(n.minzoom&&n.minzoom>Zt)continue;const vi=P[0]-(.5+ni+(Ze.wrap<<Ze.zoom))*(1<<s-Ze.zoom),Ui=P[1]-.5-Gt,Li=Ze.tileID?Ze.tileID:new o.OverscaledTileID(Zt,Ze.wrap,Ze.zoom,ni,Gt);ut.push({tileID:Li,distanceSq:vi*vi+Ui*Ui})}}if(this.fogCullDistSq){const Ze=this.fogCullDistSq,ni=this.horizonLineFromTop();ut=ut.filter(Gt=>{const Qt=[0,0,0,1],Zt=[o.EXTENT,o.EXTENT,0,1],vi=this.calculateFogTileMatrix(Gt.tileID.toUnwrapped());o.transformMat4$1(Qt,Qt,vi),o.transformMat4$1(Zt,Zt,vi);const Ui=o.getAABBPointSquareDist(Qt,Zt);if(0===Ui)return!0;let Li=!1;const Ei=this._elevation;if(Ei&&Ui>Ze&&0!==ni){const Ht=this.calculateProjMatrix(Gt.tileID.toUnwrapped());let Wi;n.isTerrainDEM||(Wi=Ei.getMinMaxForTile(Gt.tileID)),Wi||(Wi={min:Le,max:he});const cn=o.furthestTileCorner(this.rotation),Ln=[cn[0]*o.EXTENT,cn[1]*o.EXTENT,Wi.max];o.transformMat4(Ln,Ln,Ht),Li=(1-Ln[1])*this.height*.5<ni}return Ui<Ze||Li})}return ut.sort((Ze,ni)=>Ze.distanceSq-ni.distanceSq).map(Ze=>Ze.tileID)}resize(n,s){this.width=n,this.height=s,this.pixelsToGLUnits=[2/n,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const s=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),u=this.projection.project(n.lng,s);return new o.pointGeometry(u.x*this.worldSize,u.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,s){let u,d;const f=this.centerPoint;if("globe"===this.projection.name){const T=this.worldSize;u=(s.x-f.x)/T,d=(s.y-f.y)/T}else{const T=this.pointCoordinate(s),E=this.pointCoordinate(f);u=T.x-E.x,d=T.y-E.y}const y=this.locationCoordinate(n);this.setLocation(new o.MercatorCoordinate(y.x-u,y.y-d))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,s){const u=s?o.mercatorZfromAltitude(s,n.lat):void 0,d=this.projection.project(n.lng,n.lat);return new o.MercatorCoordinate(d.x,d.y,u)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,s){const u=s??this._centerAltitude,d=[n.x,n.y,0,1],f=[n.x,n.y,1,1];o.transformMat4$1(d,d,this.pixelMatrixInverse),o.transformMat4$1(f,f,this.pixelMatrixInverse);const y=f[3];o.scale$1(d,d,1/d[3]),o.scale$1(f,f,1/y);const T=d[2],E=f[2];return{p0:d,p1:f,t:T===E?0:(u-T)/(E-T)}}screenPointToMercatorRay(n){const s=[n.x,n.y,0,1],u=[n.x,n.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(u,u,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(u,u,1/u[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,u[2]=o.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(u,u,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],u,s)))}rayIntersectionCoordinate(n){const{p0:s,p1:u,t:d}=n,f=o.mercatorZfromAltitude(s[2],this._center.lat),y=o.mercatorZfromAltitude(u[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],u[0],d)/this.worldSize,o.number(s[1],u[1],d)/this.worldSize,o.number(f,y,d))}pointCoordinate(n,s=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,s)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let s=this.projection.pointCoordinate3D(this,n.x,n.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let u=0,d=this.horizonLineFromTop();if(n.y>d)return this.pointCoordinate(n);const f=.02*d,y=n.clone();for(let T=0;T<10&&d-u>f;T++){y.y=o.number(u,d,.66);const E=this.projection.pointCoordinate3D(this,y.x,y.y);E?(d=y.y,s=E):u=y.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,s){const u=s&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,d=[n.x*this.worldSize,n.y*this.worldSize,u+n.toAltitude(),1];return o.transformMat4$1(d,d,this.pixelMatrix),d[3]>0?new o.pointGeometry(d[0]/d[3],d[1]/d[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:n,left:s}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,f=this.pointCoordinate3D(new o.pointGeometry(s,n)),y=this.pointCoordinate3D(new o.pointGeometry(d,n)),T=this.pointCoordinate3D(new o.pointGeometry(d,u)),E=this.pointCoordinate3D(new o.pointGeometry(s,u));let P=Math.min(f.x,E.x),z=Math.max(y.x,T.x),V=Math.min(f.y,y.y),K=Math.max(E.y,T.y);const fe=Math.pow(2,-this.zoom)/16,ie=(ee,_e,he,Le)=>{const ze=(ee+he)/2,Te=(_e+Le)/2,Re=new o.pointGeometry(ze,Te),tt=this.pointCoordinate3D(Re),ut=Math.max(0,P-tt.x,V-tt.y,tt.x-z,tt.y-K);P=Math.min(P,tt.x),z=Math.max(z,tt.x),V=Math.min(V,tt.y),K=Math.max(K,tt.y),ut>fe&&(ie(ee,_e,ze,Te),ie(ze,Te,he,Le))};ie(s,n,d,n),ie(d,n,d,u),ie(d,u,s,u),ie(s,u,s,n);const ge=new o.LngLat(o.lngFromMercatorX(z),o.latFromMercatorY(V)),ce=new o.LngLat(o.lngFromMercatorX(P),o.latFromMercatorY(K));return new o.LngLatBounds(ce,ge)}_getBounds(n,s){if("globe"===this.projection.name)return this._getGlobeBounds();const u=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),d=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),f=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),y=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let T=this.pointCoordinate(u,n),E=this.pointCoordinate(d,n);const P=this.pointCoordinate(f,s),z=this.pointCoordinate(y,s),V=(K,fe)=>(fe.y-K.y)/(fe.x-K.x);return T.y>1&&E.y>=0?T=new o.MercatorCoordinate((1-z.y)/V(z,T)+z.x,1):T.y<0&&E.y<=1&&(T=new o.MercatorCoordinate(-z.y/V(z,T)+z.x,0)),E.y>1&&T.y>=0?E=new o.MercatorCoordinate((1-P.y)/V(P,E)+P.x,1):E.y<0&&T.y<=1&&(E=new o.MercatorCoordinate(-P.y/V(P,E)+P.x,0)),(new o.LngLatBounds).extend(this.coordinateLocation(T)).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(P))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBounds(0,0);const s=n.visibleDemTiles.reduce((u,d)=>{if(d.dem){const f=d.dem.tree;u.min=Math.min(u.min,f.minimums[0]),u.max=Math.max(u.max,f.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*n.exaggeration(),s.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,u=this.height/2-s*(1-this._horizonShift);return n?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,s){return this.projection.createTileMatrix(this,s,n)}calculateDistanceTileData(n){const s=n.key,u=this._distanceTileDataCache;if(u[s])return u[s];const d=n.canonical,f=1/this.height,y=this.cameraWorldSize/this.zoomScale(d.z),T=(d.x+Math.pow(2,d.z)*n.wrap)*y,E=d.y*y,P=this.point,z=this.angle,V=Math.sin(-z),K=-Math.cos(-z);return u[s]={bearing:[V,K],center:[(P.x-T)*f,(P.y-E)*f],scale:y/o.EXTENT*f},u[s]}calculateFogTileMatrix(n){const s=n.key,u=this._fogTileMatrixCache;if(u[s])return u[s];const d=this.projection.createTileMatrix(this,this.cameraWorldSize,n);return o.multiply(d,this.worldToFogMatrix,d),u[s]=new Float32Array(d),u[s]}calculateProjMatrix(n,s=!1){const u=n.key,d=s?this._alignedProjMatrixCache:this._projMatrixCache;if(d[u])return d[u];const f=this.calculatePosMatrix(n,this.worldSize);return o.multiply(f,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,f),d[u]=new Float32Array(f),d[u]}calculatePixelsToTileUnitsMatrix(n){const s=n.tileID.key,u=this._pixelsToTileUnitsCache;if(u[s])return u[s];const d=function(f,y){const{scale:T}=f.tileTransform,E=T*o.EXTENT/(f.tileSize*Math.pow(2,y.zoom-f.tileID.overscaledZ+f.tileID.canonical.z));return P=new Float32Array(4),K=(z=y.inverseAdjustmentMatrix)[1],fe=z[2],ie=z[3],ce=(V=[E,E])[1],P[0]=z[0]*(ge=V[0]),P[1]=K*ge,P[2]=fe*ce,P[3]=ie*ce,P;var P,z,V,K,fe,ie,ge,ce}(n,this);return u[s]=d,u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const n=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(s),d=this._camera.forward(),f=o.mercatorZfromAltitude(1,this._center.lat);u[2]/=f,d[2]/=f,o.normalize(d,d);const y=n.raycast(u,d,n.exaggeration());if(y){const T=o.scaleAndAdd([],u,d,y),E=new o.MercatorCoordinate(T[0],T[1],o.mercatorZfromAltitude(T[2],o.latFromMercatorY(T[1]))),P=(E.z+o.length([E.x-u[0],E.y-u[1],E.z-u[2]*f]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(s),d=n.getAtPointOrZero(new o.MercatorCoordinate(...u)),f=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),y=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*d;if(y<f){const T=this.locationCoordinate(this._center,this._centerAltitude),E=[T.x-u[0],T.y-u[1],T.z-u[2]],P=o.length(E);E[2]-=(f-y)/this._pixelsPerMercatorPixel;const z=o.length(E);if(0===z)return;o.scale$2(E,E,P/z*this._pixelsPerMercatorPixel),this._camera.position=[T.x-E[0],T.y-E[1],T.z*this._pixelsPerMercatorPixel-E[2]],this._camera.orientation=As(E,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const K=this.center;return K.lat=o.clamp(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(K.lng=o.clamp(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const s=this._unmodified,{x:u,y:d}=this.point;let f=0,y=u,T=d;const E=this.width/2,P=this.height/2,z=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(d-P<z&&(T=z+P),d+P>V&&(T=V-P),V-z<this.height&&(f=Math.max(f,this.height/(V-z)),T=(V+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,fe=this.worldMaxX*this.scale,ie=this.worldSize/2-(K+fe)/2;y=(u+ie+this.worldSize)%this.worldSize-ie,y-E<K&&(y=K+E),y+E>fe&&(y=fe-E),fe-K<this.width&&(f=Math.max(f,this.width/(fe-K)),y=(fe+K)/2)}y===u&&T===d||(this.center=this.unproject(new o.pointGeometry(y,T))),f&&(this.zoom+=this.scaleZoom(f)),this._constrainCameraAltitude(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,s=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const u=La(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,u),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const d=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?s:1),f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);f[8]=2*-n.x/this.width,f[9]=2*n.y/this.height;let y=o.mul([],f,d);if(this.projection.isReprojectedInTileSpace){const ze=this.locationCoordinate(this.center),Te=o.identity([]);o.translate(Te,Te,[ze.x*this.worldSize,ze.y*this.worldSize,0]),o.multiply(Te,Te,tl(this)),o.translate(Te,Te,[-ze.x*this.worldSize,-ze.y*this.worldSize,0]),o.multiply(y,y,Te),this.inverseAdjustmentMatrix=function(Re){const tt=tl(Re,!0);return xt([],[tt[0],tt[1],tt[4],tt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],y,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=y,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const T=o.invert([],f);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(T,this.horizonLineFromTop(),this.height);const E=new Float32Array(16);o.identity(E),o.scale(E,E,[1,-1,1]),o.rotateX(E,E,this._pitch),o.rotateZ(E,E,this.angle);const P=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-n.x/this.width,P[9]=2*(n.y+z)/this.height,this.skyboxMatrix=o.multiply(E,P,E);const V=this.point,K=V.x,fe=V.y,ie=this.width%2/2,ge=this.height%2/2,ce=Math.cos(this.angle),ee=Math.sin(this.angle),_e=K-Math.round(K)+ce*ie+ee*ge,he=fe-Math.round(fe)+ce*ge+ee*ie,Le=new Float64Array(y);if(o.translate(Le,Le,[_e>.5?_e-1:_e,he>.5?he-1:he,0]),this.alignedProjMatrix=Le,y=o.create(),o.scale(y,y,[this.width/2,-this.height/2,1]),o.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=o.create(),o.scale(y,y,[1,-1,1]),o.translate(y,y,[-1,-1,0]),o.scale(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},y=o.invert(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=y,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const ze=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(ze,ze,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=y;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,s=this.cameraPixelsPerMeter,u=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,f=[n,n,s];o.scale$2(f,f,d),o.scale$2(u,u,-1),o.multiply$2(u,u,f);const y=o.create();o.translate(y,y,u),o.scale(y,y,f),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,s,d)}_computeCameraPosition(n){const s=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),d=this.point,f=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-n/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-u[0]*f,d.y/this.worldSize-u[1]*f,n/this.worldSize*this._centerAltitude-u[2]*f]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],d=n[2];let f=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(f=Math.min((s-u)/d,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,n,f),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,s=this._camera.forward(),{pitch:u,bearing:d}=this._camera.getPitchBearing(),f=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),T=Math.max((n[2]-f)/Math.cos(u),y),E=this._zoomFromMercatorZ(T);o.scaleAndAdd(n,n,s,T),this._pitch=o.clamp(u,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(d,-Math.PI,Math.PI),this._setZoom(o.clamp(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){const s=y=>{const T=this.getCameraToCenterDistance(this.projection,y);return this.scaleZoom(T/(n*this.tileSize))};let u,d=s(this.zoom),f=Math.abs(d-s(d));for(;u!==f;)d=s(d),u=f,f=Math.abs(d-s(d));return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,s){const u=Math.min(n.x,s.x),d=Math.max(n.x,s.x),f=Math.min(n.y,s.y),y=Math.max(n.y,s.y);if(f<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const T=[new o.pointGeometry(u,f),new o.pointGeometry(d,y),new o.pointGeometry(u,y),new o.pointGeometry(d,f)],E=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const z of T){const V=this.pointRayIntersection(z);if(V.t<0)return!0;const K=this.rayIntersectionCoordinate(V);if(K.x<E||K.y<0||K.x>P||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,s){const u=o.length(o.sub([],this._camera.position,n)),d=this._zoomFromMercatorZ(u)+s;return u-this._mercatorZfromZoom(d)}getCameraPoint(){if("globe"===this.projection.name){const n=function(s,u){const d=[s[0],s[1],s[2],1];o.transformMat4$1(d,d,u);const f=Math.max(d[3],1e-6);return[d[0]/f,d[1]/f,d[2]/f,f]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,n))}}getCameraToCenterDistance(n,s=this.zoom){const u=La(n,s,this.width,this.height,1024),d=n.pixelSpaceConversion(this.center.lat,this.worldSize,u);return.5/Math.tan(.5*this._fov)*this.height*d}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&o.multiply(n,n,this.globeMatrix),n}}function jl(l,n){let s=!1,u=null;const d=()=>{u=null,s&&(l(),u=setTimeout(d,n),s=!1)};return()=>(s=!0,u||d(),u)}class Rc{constructor(n){this._hashName=n&&encodeURIComponent(n),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=jl(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,o.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const s=Vl(n);if(this._hashName){const u=this._hashName;let d=!1;const f=o.window.location.hash.slice(1).split("&").map(y=>{const T=y.split("=")[0];return T===u?(d=!0,`${T}=${s}`):y}).filter(y=>y);return d||f.push(`${u}=${s}`),`#${f.join("&")}`}return`#${s}`}_getCurrentHash(){const n=o.window.location.hash.replace("#","");if(this._hashName){let s;return n.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(s=u)}),(s&&s[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(s[3]||0):n.getBearing();return n.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,n)}}function Vl(l,n){const s=l.getCenter(),u=Math.round(100*l.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),y=Math.round(s.lng*f)/f,T=Math.round(s.lat*f)/f,E=l.getBearing(),P=l.getPitch();let z=n?`/${y}/${T}/${u}`:`${u}/${T}/${y}`;return(E||P)&&(z+="/"+Math.round(10*E)/10),P&&(z+=`/${Math.round(P)}`),z}const us={linearity:.3,easing:o.bezier(0,0,.3,1)},Bc=o.extend({deceleration:2500,maxSpeed:1400},us),nl=o.extend({deceleration:20,maxSpeed:1400},us),$l=o.extend({deceleration:1e3,maxSpeed:360},us),rl=o.extend({deceleration:1e3,maxSpeed:90},us);class Fc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,s=o.exported.now();for(;n.length>0&&s-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(s.pan.mag()){const f=hs(s.pan.mag(),u,o.extend({},Bc,n||{}));d.offset=s.pan.mult(f.amount/s.pan.mag()),d.center=this._map.transform.center,Oa(d,f)}if(s.zoom){const f=hs(s.zoom,u,nl);d.zoom=this._map.transform.zoom+f.amount,Oa(d,f)}if(s.bearing){const f=hs(s.bearing,u,$l);d.bearing=this._map.transform.bearing+o.clamp(f.amount,-179,179),Oa(d,f)}if(s.pitch){const f=hs(s.pitch,u,rl);d.pitch=this._map.transform.pitch+f.amount,Oa(d,f)}if(d.zoom||d.bearing){const f=void 0===s.pinchAround?s.around:s.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function Oa(l,n){(!l.duration||l.duration<n.duration)&&(l.duration=n.duration,l.easing=n.easing)}function hs(l,n,s){const{maxSpeed:u,linearity:d,deceleration:f}=s,y=o.clamp(l*d/(n/1e3),-u,u),T=Math.abs(y)/(f*d);return{easing:s.easing,duration:1e3*T,amount:y*(T/2)}}class To extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u,d={}){const f=ne(s.getCanvasContainer(),u),y=s.unproject(f);super(n,o.extend({point:f,lngLat:y,originalEvent:u},d)),this._defaultPrevented=!1,this.target=s}}class ol extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u){const d="touchend"===n?u.changedTouches:u.touches,f=mt(s.getCanvasContainer(),d),y=f.map(E=>s.unproject(E)),T=f.reduce((E,P,z,V)=>E.add(P.div(V.length)),new o.pointGeometry(0,0));super(n,{points:f,point:T,lngLats:y,lngLat:s.unproject(T),originalEvent:u}),this._defaultPrevented=!1}}class Nc extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,u){super(n,{originalEvent:u}),this._defaultPrevented=!1}}class sl{constructor(n,s){this._map=n,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Nc(n.type,this._map,n))}mousedown(n,s){return this._mousedownPos=s,this._firePreventable(new To(n.type,this._map,n))}mouseup(n){this._map.fire(new To(n.type,this._map,n))}preclick(n){const s=o.extend({},n);s.type="preclick",this._map.fire(new To(s.type,this._map,s))}click(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(n),this._map.fire(new To(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new To(n.type,this._map,n))}mouseover(n){this._map.fire(new To(n.type,this._map,n))}mouseout(n){this._map.fire(new To(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ol(n.type,this._map,n))}touchmove(n){this._map.fire(new ol(n.type,this._map,n))}touchend(n){this._map.fire(new ol(n.type,this._map,n))}touchcancel(n){this._map.fire(new ol(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new To(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new To("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new To(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uc{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,s){this.isEnabled()&&n.shiftKey&&0===n.button&&(Be(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(n,s){if(!this._active)return;const u=s,d=this._startPos,f=this._lastPos;if(!d||!f||f.equals(u)||!this._box&&u.dist(d)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=O("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const y=Math.min(d.x,u.x),T=Math.max(d.x,u.x),E=Math.min(d.y,u.y),P=Math.max(d.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=T-y+"px",this._box.style.height=P-E+"px")})}mouseupWindow(n,s){if(!this._active)return;const u=this._startPos,d=s;if(u&&0===n.button){if(this.reset(),Ke(),u.x!==d.x||u.y!==d.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:f=>f.fitScreenCoordinates(u,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ie(),delete this._startPos,delete this._lastPos}_fireEvent(n,s){return this._map.fire(new o.Event(n,{originalEvent:s}))}}function al(l,n){const s={};for(let u=0;u<l.length;u++)s[l[u].identifier]=n[u];return s}class ll{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),u.length===this.numTouches&&(this.centroid=function(d){const f=new o.pointGeometry(0,0);for(const y of d)f._add(y);return f.div(d.length)}(s),this.touches=al(u,s)))}touchmove(n,s,u){if(this.aborted||!this.centroid)return;const d=al(u,s);for(const f in this.touches){const y=this.touches[f],T=d[f];(!T||T.dist(y)>30)&&(this.aborted=!0)}}touchend(n,s,u){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===u.length){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Ra{constructor(n){this.singleTap=new ll(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,s,u){this.singleTap.touchstart(n,s,u)}touchmove(n,s,u){this.singleTap.touchmove(n,s,u)}touchend(n,s,u){const d=this.singleTap.touchend(n,s,u);if(d){const f=n.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(d)<30;if(f&&y||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class jc{constructor(){this._zoomIn=new Ra({numTouches:1,numTaps:2}),this._zoomOut=new Ra({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,s,u){this._zoomIn.touchstart(n,s,u),this._zoomOut.touchstart(n,s,u)}touchmove(n,s,u){this._zoomIn.touchmove(n,s,u),this._zoomOut.touchmove(n,s,u)}touchend(n,s,u){const d=this._zoomIn.touchend(n,s,u),f=this._zoomOut.touchend(n,s,u);return d?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(d)},{originalEvent:n})}):f?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(f)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vc={0:1,2:2};class cl{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,s){return!1}_move(n,s){return{}}mousedown(n,s){if(this._lastPoint)return;const u=C(n);this._correctButton(n,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(n,s){const u=this._lastPoint;if(u)if(n.preventDefault(),null!=this._eventButton&&function(d,f){const y=Vc[f];return void 0===d.buttons||(d.buttons&y)!==y}(n,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}mouseupWindow(n){this._lastPoint&&C(n)===this._eventButton&&(this._moved&&Ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $c extends cl{mousedown(n,s){super.mousedown(n,s),this._lastPoint&&(this._active=!0)}_correctButton(n,s){return 0===s&&!n.ctrlKey}_move(n,s){return{around:s,panDelta:s.sub(n)}}}class ql extends cl{_correctButton(n,s){return 0===s&&n.ctrlKey||2===s}_move(n,s){const u=.8*(s.x-n.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(n){n.preventDefault()}}class Hs extends cl{_correctButton(n,s){return 0===s&&n.ctrlKey||2===s}_move(n,s){const u=-.5*(s.y-n.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(n){n.preventDefault()}}class Gc{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(n,s,u){return this._calculateTransform(n,s,u)}touchmove(n,s,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===u.length&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,s,u)}}touchend(n,s,u){this._calculateTransform(n,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,s,u){u.length>0&&(this._active=!0);const d=al(u,s),f=new o.pointGeometry(0,0),y=new o.pointGeometry(0,0);let T=0;for(const P in d){const z=d[P],V=this._touches[P];V&&(f._add(z),y._add(z.sub(V)),T++,d[P]=z)}if(this._touches=d,T<this._minTouches||!y.mag())return;const E=y.div(T);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(T),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ul{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,s,u){return{}}touchstart(n,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(n,s,u){const d=this._firstTwoTouches;if(!d)return;n.preventDefault();const[f,y]=d,T=Ba(u,s,f),E=Ba(u,s,y);if(!T||!E)return;const P=this._aroundCenter?null:T.add(E).div(2);return this._move([T,E],P,n)}touchend(n,s,u){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,y=Ba(u,s,d),T=Ba(u,s,f);y&&T||(this._active&&Ke(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ba(l,n,s){for(let u=0;u<l.length;u++)if(l[u].identifier===s)return n[u]}function Zl(l,n){return Math.log(l/n)/Math.LN2}class qc extends ul{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,s){const u=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Zl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zl(this._distance,u),pinchAround:s}}}function Hl(l,n){return 180*l.angleWith(n)/Math.PI}class Zr extends ul{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,s){const u=this._vector;if(this._vector=n[0].sub(n[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Hl(this._vector,u),pinchAround:s}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const s=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const d=Hl(n,u);return Math.abs(d)<s}}function Wl(l){return Math.abs(l.y)>Math.abs(l.x)}class Zc extends ul{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Wl(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,s,u){const d=this._lastPoints;if(!d)return;const f=n[0].sub(d[0]),y=n[1].sub(d[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(f,y,u.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(f.y+y.y)/2*-.5})}gestureBeginsVertically(n,s,u){if(void 0!==this._valid)return this._valid;const d=n.mag()>=2,f=s.mag()>=2;if(!d&&!f)return;if(!d||!f)return null==this._firstMove&&(this._firstMove=u),u-this._firstMove<100&&void 0;const y=n.y>0==s.y>0;return Wl(n)&&Wl(s)&&y}}const Zu={panStep:100,bearingStep:15,pitchStep:10};class Hu{constructor(){const n=Zu;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let s=0,u=0,d=0,f=0,y=0;switch(n.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:n.shiftKey?u=-1:(n.preventDefault(),f=-1);break;case 39:n.shiftKey?u=1:(n.preventDefault(),f=1);break;case 38:n.shiftKey?d=1:(n.preventDefault(),y=-1);break;case 40:n.shiftKey?d=-1:(n.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:T=>{const E=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:ds,zoom:s?Math.round(E)+s*(n.shiftKey?2:1):E,bearing:T.getBearing()+u*this._bearingStep,pitch:T.getPitch()+d*this._pitchStep,offset:[-f*this._panStep,-y*this._panStep],center:T.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ds(l){return l*(2-l)}const Xl=4.000244140625;class ga{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=n.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const u=o.exported.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,0!==s&&s%Xl==0?this._type="wheel":0!==s&&Math.abs(s)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(d*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ne(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const E="wheel"===this._type&&Math.abs(this._delta)>Xl?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&0!==P&&(P=1/P);const z=s(),V=Math.pow(2,z),K="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(K*P))),"wheel"===this._type&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._delta=0}const u="number"==typeof this._targetZoom?this._targetZoom:s(),d=this._startZoom,f=this._easing;let y,T=!1;if("wheel"===this._type&&d&&f){const E=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),P=f(E);y=o.number(d,u,P),E<1?this._frameId||(this._frameId=!0):T=!0}else y=u,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:y-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let s=o.ease;if(this._prevEase){const u=this._prevEase,d=(o.exported.now()-u.start)/u.duration,f=u.easing(d+.01)-u.easing(d),y=.27/Math.sqrt(f*f+1e-4)*.01,T=Math.sqrt(.0729-y*y);s=o.bezier(y,T,.25,1)}return this._prevEase={start:o.exported.now(),duration:n,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=O("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Jo{constructor(n,s){this._clickZoom=n,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,s){return n.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(n.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hi{constructor(){this._tap=new Ra({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,s,u){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(n,s,u))}touchmove(n,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=s[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,n.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(n,s,u)}touchend(n,s,u){this._tapTime?this._swipePoint&&0===u.length&&this.reset():this._tap.touchend(n,s,u)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hc{constructor(n,s,u){this._el=n,this._mousePan=s,this._touchPan=u}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wc{constructor(n,s,u){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fa{constructor(n,s,u,d){this._el=n,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ms=l=>l.zoom||l.drag||l.pitch||l.rotate;class Xc extends o.Event{}class Yc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,s){const u=o.sub([],s,n);this.radius=o.length(u[2]<0?o.div([],u,this.constants):[u[0],u[1],0])}projectRay(n){o.div(n,n,this.constants),o.normalize(n,n),o.mul$1(n,n,this.constants);const s=o.scale$2([],n,this.radius);if(s[2]>0){const u=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),d=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),f=o.add([],s,o.scale$2([],o.sub([],o.add([],d,u),s),2));s[0]=f[0],s[1]=f[1]}return s}}function Na(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Kc{constructor(n,s){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Fc(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Yc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[d,f,y]of this._listeners)d.addEventListener(f,d===o.window.document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[n,s,u]of this._listeners)n.removeEventListener(s,n===o.window.document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(n){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new sl(s,n));const d=s.boxZoom=new Uc(s,n);this._add("boxZoom",d);const f=new jc,y=new hl;s.doubleClickZoom=new Jo(y,f),this._add("tapZoom",f),this._add("clickZoom",y);const T=new hi;this._add("tapDragZoom",T);const E=s.touchPitch=new Zc(s);this._add("touchPitch",E);const P=new ql(n),z=new Hs(n);s.dragRotate=new Wc(n,P,z),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const V=new $c(n),K=new Gc(s,n);s.dragPan=new Hc(u,V,K),this._add("mousePan",V),this._add("touchPan",K,["touchZoom","touchRotate"]);const fe=new Zr,ie=new qc;s.touchZoomRotate=new Fa(u,ie,fe,T),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Gl(s));const ge=s.scrollZoom=new ga(s,this);this._add("scrollZoom",ge,["mousePan"]);const ce=s.keyboard=new Hu;this._add("keyboard",ce);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ee]&&s[ee].enable(n[ee])}_add(n,s,u){this._handlers.push({handlerName:n,handler:s,allowed:u}),this._handlersById[n]=s}stop(n){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ms(this._eventsInProgress)||this.isZooming()}_blockedByActive(n,s,u){for(const d in n)if(d!==u&&(!s||s.indexOf(d)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const s=[];for(const u of n)this._el.contains(u.target)&&s.push(u);return s}handleEvent(n,s){this._updatingCamera=!0;const u="renderFrame"===n.type,d=u?void 0:n,f={needsRenderFrame:!1},y={},T={},E=n.touches?this._getMapTouches(n.touches):void 0,P=E?mt(this._el,E):u?void 0:ne(this._el,n);for(const{handlerName:K,handler:fe,allowed:ie}of this._handlers){if(!fe.isEnabled())continue;let ge;this._blockedByActive(T,ie,K)?fe.reset():fe[s||n.type]&&(ge=fe[s||n.type](n,P,E),this.mergeHandlerResult(f,y,ge,K,d),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()),(ge||fe.isActive())&&(T[K]=fe)}const z={};for(const K in this._previousActiveHandlers)T[K]||(z[K]=d);this._previousActiveHandlers=T,(Object.keys(z).length||Na(f))&&(this._changes.push([f,y,z]),this._triggerRenderFrame()),(Object.keys(T).length||Na(f))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=f;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(n,s,u,d,f){if(!u)return;o.extend(n,u);const y={handlerName:d,originalEvent:u.originalEvent||f};void 0!==u.zoomDelta&&(s.zoom=y),void 0!==u.panDelta&&(s.drag=y),void 0!==u.pitchDelta&&(s.pitch=y),void 0!==u.bearingDelta&&(s.rotate=y)}_applyChanges(){const n={},s={},u={};for(const[d,f,y]of this._changes)d.panDelta&&(n.panDelta=(n.panDelta||new o.pointGeometry(0,0))._add(d.panDelta)),d.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+d.pitchDelta),void 0!==d.around&&(n.around=d.around),void 0!==d.aroundCoord&&(n.aroundCoord=d.aroundCoord),void 0!==d.pinchAround&&(n.pinchAround=d.pinchAround),d.noInertia&&(n.noInertia=d.noInertia),o.extend(s,f),o.extend(u,y);this._updateMapTransform(n,s,u),this._changes=[]}_updateMapTransform(n,s,u){const d=this._map,f=d.transform,y=_e=>[_e.x,_e.y,_e.z];if((_e=>{const he=this._eventsInProgress.drag;return he&&!this._handlersById[he.handlerName].isActive()})()&&!Na(n)){const _e=f.zoom;f.cameraElevationReference="sea",f.recenterOnTerrain(),f.cameraElevationReference="ground",_e!==f.zoom&&this._map._update(!0)}if(!Na(n))return void this._fireEvents(s,u,!0);let{panDelta:T,zoomDelta:E,bearingDelta:P,pitchDelta:z,around:V,aroundCoord:K,pinchAround:fe}=n;void 0!==fe&&(V=fe),(_e=>s.drag&&!this._eventsInProgress.drag)()&&V&&(this._dragOrigin=y(f.pointCoordinate3D(V)),this._trackingEllipsoid.setup(f._camera.position,this._dragOrigin)),f.cameraElevationReference="sea",d._stop(!0),V=V||d.transform.centerPoint,P&&(f.bearing+=P),z&&(f.pitch+=z),f._updateCameraState();const ie=[0,0,0];if(T)if("mercator"===f.projection.name){const _e=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(V).dir),he=this._trackingEllipsoid.projectRay(f.screenPointToMercatorRay(V.sub(T)).dir);ie[0]=he[0]-_e[0],ie[1]=he[1]-_e[1]}else{const _e=f.pointCoordinate(V);if("globe"===f.projection.name){T=T.rotate(-f.angle);const he=f._pixelsPerMercatorPixel/f.worldSize;ie[0]=-T.x*o.mercatorScale(o.latFromMercatorY(_e.y))*he,ie[1]=-T.y*o.mercatorScale(f.center.lat)*he}else{const he=f.pointCoordinate(V.sub(T));_e&&he&&(ie[0]=he.x-_e.x,ie[1]=he.y-_e.y)}}const ge=f.zoom,ce=[0,0,0];if(E){const _e=y(K||f.pointCoordinate3D(V)),he={dir:o.normalize([],o.sub([],_e,f._camera.position))};if(he.dir[2]<0){const Le=f.zoomDeltaToMovement(_e,E);o.scale$2(ce,he.dir,Le)}}const ee=o.add(ie,ie,ce);f._translateCameraConstrained(ee),E&&Math.abs(f.zoom-ge)>1e-4&&f.recenterOnTerrain(),f.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,u,!0)}_fireEvents(n,s,u){const d=Ms(this._eventsInProgress),f=Ms(n),y={};for(const z in n){const{originalEvent:V}=n[z];this._eventsInProgress[z]||(y[`${z}start`]=V),this._eventsInProgress[z]=n[z]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const z in y)this._fireEvent(z,y[z]);f&&this._fireEvent("move",f.originalEvent);for(const z in n){const{originalEvent:V}=n[z];this._fireEvent(z,V)}const T={};let E;for(const z in this._eventsInProgress){const{handlerName:V,originalEvent:K}=this._eventsInProgress[z];this._handlersById[V].isActive()||(delete this._eventsInProgress[z],E=s[V]||K,T[`${z}end`]=E)}for(const z in T)this._fireEvent(z,T[z]);const P=Ms(this._eventsInProgress);if(u&&(d||f)&&!P){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;z?(V(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:E})):(this._map.fire(new o.Event("moveend",{originalEvent:E})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,s){this._map.fire(new o.Event(n,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Xc("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Yl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Jc extends o.Evented{constructor(n,s){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,s){return this.jumpTo({center:n},s)}panBy(n,s,u){return n=o.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,o.extend({offset:n},s),u)}panTo(n,s,u){return this.easeTo(o.extend({center:n},s),u)}getZoom(){return this.transform.zoom}setZoom(n,s){return this.jumpTo({zoom:n},s),this}zoomTo(n,s,u){return this.easeTo(o.extend({zoom:n},s),u)}zoomIn(n,s){return this.zoomTo(this.getZoom()+1,n,s),this}zoomOut(n,s){return this.zoomTo(this.getZoom()-1,n,s),this}getBearing(){return this.transform.bearing}setBearing(n,s){return this.jumpTo({bearing:n},s),this}getPadding(){return this.transform.padding}setPadding(n,s){return this.jumpTo({padding:n},s),this}rotateTo(n,s,u){return this.easeTo(o.extend({bearing:n},s),u)}resetNorth(n,s){return this.rotateTo(0,o.extend({duration:1e3},n),s),this}resetNorthPitch(n,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},n),s),this}snapToNorth(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this}getPitch(){return this.transform.pitch}setPitch(n,s){return this.jumpTo({pitch:n},s),this}cameraForBounds(n,s){n=o.LngLatBounds.convert(n);const u=s&&s.bearing||0,d=n.getNorthWest(),f=n.getSouthEast();return this._cameraForBounds(this.transform,d,f,u,s)}_extendCameraOptions(n){const s={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const u=n.padding;n.padding={top:u,bottom:u,right:u,left:u}}return n.padding=o.extend(s,n.padding),n}_minimumAABBFrustumDistance(n,s){const u=s.max[0]-s.min[0],d=s.max[1]-s.min[1];return u/d>n.aspect?u/(2*Math.tan(.5*n.fovX)*n.aspect):d/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,s,u,d,f){const y=n.clone(),T=this._extendCameraOptions(f);y.bearing=d;const E=o.LngLat.convert(s),P=o.LngLat.convert(u),z=.5*(E.lat+P.lat),V=.5*(E.lng+P.lng),K=o.latLngToECEF(z,V),fe=o.normalize([],K),ie=o.normalize([],o.cross([],fe,[0,1,0])),ge=o.cross([],ie,fe),ce=[ie[0],ie[1],ie[2],0,ge[0],ge[1],ge[2],0,fe[0],fe[1],fe[2],0,0,0,0,1],ee=[K,o.latLngToECEF(E.lat,E.lng),o.latLngToECEF(P.lat,E.lng),o.latLngToECEF(P.lat,P.lng),o.latLngToECEF(E.lat,P.lng),o.latLngToECEF(z,E.lng),o.latLngToECEF(z,P.lng),o.latLngToECEF(E.lat,V),o.latLngToECEF(P.lat,V)];let _e=o.Aabb.fromPoints(ee.map(Gt=>[o.dot(ie,Gt),o.dot(ge,Gt),o.dot(fe,Gt)]));const he=o.transformMat4([],_e.center,ce);0===o.squaredLength(he)&&o.set(he,0,0,1),o.normalize(he,he),o.scale$2(he,he,o.GLOBE_RADIUS),y.center=o.ecefToLatLng(he);const Le=y.getWorldToCameraMatrix(),ze=o.invert(new Float64Array(16),Le);_e=o.Aabb.applyTransform(_e,o.multiply([],Le,ce)),o.transformMat4(he,he,Le);const Te=.5*(_e.max[2]-_e.min[2]),Re=this._minimumAABBFrustumDistance(y,_e),tt=o.scale$2([],[0,0,1],Te),ut=o.add(tt,he,tt),st=Re+(0===y.pitch?0:o.distance(he,ut)),zt=y.globeCenterInViewSpace,Ye=o.sub([],he,[zt[0],zt[1],zt[2]]);o.normalize(Ye,Ye),o.scale$2(Ye,Ye,st);const At=o.add([],he,Ye);o.transformMat4(At,At,ze);const Et=o.earthRadius/o.GLOBE_RADIUS,it=o.length(At),Ze=o.mercatorZfromAltitude(it*Et-o.earthRadius,0),ni=Math.min(y.zoomFromMercatorZAdjusted(Ze),T.maxZoom);return ni>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(y.setProjection({name:"mercator"}),y.zoom=ni,this._cameraForBounds(y,s,u,d,f)):{center:y.center,zoom:ni,bearing:d}}queryTerrainElevation(n,s){const u=this.transform.elevation;return u?(s=o.extend({},{exaggerated:!0},s),u.getAtPoint(o.MercatorCoordinate.fromLngLat(n),null,s.exaggerated)):null}_cameraForBounds(n,s,u,d,f){if("globe"===n.projection.name)return this._cameraForBoundsOnGlobe(n,s,u,d,f);const y=n.clone(),T=this._extendCameraOptions(f),E=y.padding;y.bearing=d;const P=o.LngLat.convert(s),z=o.LngLat.convert(u),V=new o.LngLat(P.lng,z.lat),K=new o.LngLat(z.lng,P.lat),fe=y.project(P),ie=y.project(z),ge=this.queryTerrainElevation(P),ce=this.queryTerrainElevation(z),ee=this.queryTerrainElevation(V),_e=this.queryTerrainElevation(K),he=[[fe.x,fe.y,Math.min(ge||0,ce||0,ee||0,_e||0)],[ie.x,ie.y,Math.max(ge||0,ce||0,ee||0,_e||0)]];let Le=o.Aabb.fromPoints(he);const ze=y.getWorldToCameraMatrix(),Te=o.invert(new Float64Array(16),ze);Le=o.Aabb.applyTransform(Le,ze);const Re=o.sub([],Le.max,Le.min),tt=E.left||0,ut=E.right||0,st=E.bottom||0,zt=E.top||0,{left:Ye,right:At,top:Et,bottom:it}=T.padding,Ze=.5*(tt+ut),ni=.5*(zt+st),Gt=Math.min(y.scaleZoom(y.scale*Math.min((y.width-(tt+ut+Ye+At))/Re[0],(y.height-(st+zt+it+Et))/Re[1])),T.maxZoom),Qt=y.scale/y.zoomScale(Gt);Le=new o.Aabb([Le.min[0]-(Ye+Ze)*Qt,Le.min[1]-(it+ni)*Qt,Le.min[2]],[Le.max[0]+(At+Ze)*Qt,Le.max[1]+(Et+ni)*Qt,Le.max[2]]);const Zt=.5*Re[2],vi=this._minimumAABBFrustumDistance(y,Le),Ui=[0,0,1,0];o.transformMat4$1(Ui,Ui,ze),o.normalize$2(Ui,Ui);const Li=o.scale$2([],Ui,vi+Zt),Ei=o.add([],Le.center,Li),Ht=("number"==typeof T.offset.x&&"number"==typeof T.offset.y?new o.pointGeometry(T.offset.x,T.offset.y):o.pointGeometry.convert(T.offset)).rotate(-o.degToRad(d));Le.center[0]-=Ht.x*Qt,Le.center[1]+=Ht.y*Qt,o.transformMat4(Le.center,Le.center,Te),o.transformMat4(Ei,Ei,Te);const Wi=[Le.center[0],Le.center[1],Ei[2]*y.pixelsPerMeter];o.scale$2(Wi,Wi,1/y.worldSize);const cn=o.lngFromMercatorX(Wi[0]),Ln=o.latFromMercatorY(Wi[1]),zn=Math.min(y._zoomFromMercatorZ(Wi[2]),T.maxZoom),kn=new o.LngLat(cn,Ln);return y.mercatorFromTransition&&zn<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(y.setProjection({name:"globe"}),y.zoom=zn,this._cameraForBounds(y,s,u,d,f)):{center:kn,zoom:zn,bearing:d}}fitBounds(n,s,u){const d=this.cameraForBounds(n,s);return this._fitInternal(d,s,u)}fitScreenCoordinates(n,s,u,d,f){const y=o.pointGeometry.convert(n),T=o.pointGeometry.convert(s),E=new o.pointGeometry(Math.min(y.x,T.x),Math.min(y.y,T.y)),P=new o.pointGeometry(Math.max(y.x,T.x),Math.max(y.y,T.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(y,T))return this;const z=this.transform.pointLocation3D(E),V=this.transform.pointLocation3D(P),K=this.transform.pointLocation3D(new o.pointGeometry(E.x,P.y)),fe=this.transform.pointLocation3D(new o.pointGeometry(P.x,E.y)),ie=[Math.min(z.lng,V.lng,K.lng,fe.lng),Math.min(z.lat,V.lat,K.lat,fe.lat)],ge=[Math.max(z.lng,V.lng,K.lng,fe.lng),Math.max(z.lat,V.lat,K.lat,fe.lat)],ce=this._cameraForBounds(this.transform,ie,ge,u,d);return this._fitInternal(ce,d,f)}_fitInternal(n,s,u){return n?(delete(s=o.extend(n,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(n,s){this.stop();const u=n.preloadOnly?this.transform.clone():this.transform;let d=!1,f=!1,y=!1;return"zoom"in n&&u.zoom!==+n.zoom&&(d=!0,u.zoom=+n.zoom),void 0!==n.center&&(u.center=o.LngLat.convert(n.center)),"bearing"in n&&u.bearing!==+n.bearing&&(f=!0,u.bearing=+n.bearing),"pitch"in n&&u.pitch!==+n.pitch&&(y=!0,u.pitch=+n.pitch),null==n.padding||u.isPaddingEqual(n.padding)||(u.padding=n.padding),n.preloadOnly?(this._preloadTiles(u),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),d&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),f&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),y&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(Yl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,s){const u=this.transform;if(!u.projection.supportsFreeCamera)return o.warnOnce(Yl),this;this.stop();const d=u.zoom,f=u.pitch,y=u.bearing;u.setFreeCameraOptions(n);const T=d!==u.zoom,E=f!==u.pitch,P=y!==u.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),T&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),P&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),E&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(n,s){this._stop(!1,n.easeId),(!1===(n=o.extend({offset:[0,0],duration:500,easing:o.ease},n)).animate||!n.essential&&o.exported.prefersReducedMotion)&&(n.duration=0);const u=this.transform,d=this.getZoom(),f=this.getBearing(),y=this.getPitch(),T=this.getPadding(),E="zoom"in n?+n.zoom:d,P="bearing"in n?this._normalizeBearing(n.bearing,f):f,z="pitch"in n?+n.pitch:y,V="padding"in n?n.padding:u.padding,K=o.pointGeometry.convert(n.offset);let fe,ie,ge;if("globe"===u.projection.name){const ut=o.MercatorCoordinate.fromLngLat(u.center),st=K.rotate(-u.angle);ut.x+=st.x/u.worldSize,ut.y+=st.y/u.worldSize;const zt=ut.toLngLat(),Ye=o.LngLat.convert(n.center||zt);this._normalizeCenter(Ye),fe=u.centerPoint.add(st),ie=new o.pointGeometry(ut.x,ut.y).mult(u.worldSize),ge=new o.pointGeometry(o.mercatorXfromLng(Ye.lng),o.mercatorYfromLat(Ye.lat)).mult(u.worldSize).sub(ie)}else{fe=u.centerPoint.add(K);const ut=u.pointLocation(fe),st=o.LngLat.convert(n.center||ut);this._normalizeCenter(st),ie=u.project(ut),ge=u.project(st).sub(ie)}const ce=u.zoomScale(E-d);let ee,_e;n.around&&(ee=o.LngLat.convert(n.around),_e=u.locationPoint(ee));const he=this._zooming||E!==d,Le=this._rotating||f!==P,ze=this._pitching||z!==y,Te=!u.isPaddingEqual(V),Re=ut=>st=>{if(he&&(ut.zoom=o.number(d,E,st)),Le&&(ut.bearing=o.number(f,P,st)),ze&&(ut.pitch=o.number(y,z,st)),Te&&(ut.interpolatePadding(T,V,st),fe=ut.centerPoint.add(K)),ee)ut.setLocationAtPoint(ee,_e);else{const zt=ut.zoomScale(ut.zoom-d),Ye=E>d?Math.min(2,ce):Math.max(.5,ce),At=Math.pow(Ye,1-st),Et=ut.unproject(ie.add(ge.mult(st*At)).mult(zt));ut.setLocationAtPoint(ut.renderWorldCopies?Et.wrap():Et,fe)}return n.preloadOnly||this._fireMoveEvents(s),ut};if(n.preloadOnly){const ut=this._emulate(Re,n.duration,u);return this._preloadTiles(ut),this}const tt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=he,this._rotating=Le,this._pitching=ze,this._padding=Te,this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,tt),this._ease(Re(u),ut=>{u.recenterOnTerrain(),this._afterEase(s,ut)},n),this}_prepareEase(n,s,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||u.moving||this.fire(new o.Event("movestart",n)),this._zooming&&!u.zooming&&this.fire(new o.Event("zoomstart",n)),this._rotating&&!u.rotating&&this.fire(new o.Event("rotatestart",n)),this._pitching&&!u.pitching&&this.fire(new o.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.Event("move",n)),this._zooming&&this.fire(new o.Event("zoom",n)),this._rotating&&this.fire(new o.Event("rotate",n)),this._pitching&&this.fire(new o.Event("pitch",n))}_afterEase(n,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.Event("zoomend",n)),d&&this.fire(new o.Event("rotateend",n)),f&&this.fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}flyTo(n,s){if(!n.essential&&o.exported.prefersReducedMotion){const Qt=o.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qt,s)}this.stop(),n=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},n);const u=this.transform,d=this.getZoom(),f=this.getBearing(),y=this.getPitch(),T=this.getPadding(),E="zoom"in n?o.clamp(+n.zoom,u.minZoom,u.maxZoom):d,P="bearing"in n?this._normalizeBearing(n.bearing,f):f,z="pitch"in n?+n.pitch:y,V="padding"in n?n.padding:u.padding,K=u.zoomScale(E-d),fe=o.pointGeometry.convert(n.offset);let ie=u.centerPoint.add(fe);const ge=u.pointLocation(ie),ce=o.LngLat.convert(n.center||ge);this._normalizeCenter(ce);const ee=u.project(ge),_e=u.project(ce).sub(ee);let he=n.curve;const Le=Math.max(u.width,u.height),ze=Le/K,Te=_e.mag();if("minZoom"in n){const Qt=o.clamp(Math.min(n.minZoom,d,E),u.minZoom,u.maxZoom),Zt=Le/u.zoomScale(Qt-d);he=Math.sqrt(Zt/Te*2)}const Re=he*he;function tt(Qt){const Zt=(ze*ze-Le*Le+(Qt?-1:1)*Re*Re*Te*Te)/(2*(Qt?ze:Le)*Re*Te);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function ut(Qt){return(Math.exp(Qt)-Math.exp(-Qt))/2}function st(Qt){return(Math.exp(Qt)+Math.exp(-Qt))/2}const zt=tt(0);let Ye=function(Qt){return st(zt)/st(zt+he*Qt)},At=function(Qt){return Le*((st(zt)*(ut(Zt=zt+he*Qt)/st(Zt))-ut(zt))/Re)/Te;var Zt},Et=(tt(1)-zt)/he;if(Math.abs(Te)<1e-6||!isFinite(Et)){if(Math.abs(Le-ze)<1e-6)return this.easeTo(n,s);const Qt=ze<Le?-1:1;Et=Math.abs(Math.log(ze/Le))/he,At=function(){return 0},Ye=function(Zt){return Math.exp(Qt*he*Zt)}}n.duration="duration"in n?+n.duration:1e3*Et/("screenSpeed"in n?+n.screenSpeed/he:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const it=f!==P,Ze=z!==y,ni=!u.isPaddingEqual(V),Gt=Qt=>Zt=>{const vi=Zt*Et,Ui=1/Ye(vi);Qt.zoom=1===Zt?E:d+Qt.scaleZoom(Ui),it&&(Qt.bearing=o.number(f,P,Zt)),Ze&&(Qt.pitch=o.number(y,z,Zt)),ni&&(Qt.interpolatePadding(T,V,Zt),ie=Qt.centerPoint.add(fe));const Li=1===Zt?ce:Qt.unproject(ee.add(_e.mult(At(vi))).mult(Ui));return Qt.setLocationAtPoint(Qt.renderWorldCopies?Li.wrap():Li,ie),Qt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(s),Qt};if(n.preloadOnly){const Qt=this._emulate(Gt,n.duration,u);return this._preloadTiles(Qt),this}return this._zooming=!0,this._rotating=it,this._pitching=Ze,this._padding=ni,this._prepareEase(s,!1),this._ease(Gt(u),()=>this._afterEase(s),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,s)}if(!n){const u=this.handlers;u&&u.stop(!1)}return this}_ease(n,s,u){!1===u.animate||0===u.duration?(n(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=u,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,s){n=o.wrap(n,-180,180);const u=Math.abs(n-s);return Math.abs(n-360-s)<u&&(n-=360),Math.abs(n+360-s)<u&&(n+=360),n}_normalizeCenter(n){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const u=n.lng-s.center.lng;n.lng+=u>180?-360:u<-180?360:0}_emulate(n,s,u){const d=Math.ceil(15*s/1e3),f=[],y=n(u.clone());for(let T=0;T<=d;T++){const E=y(T/d);f.push(E.clone())}return f}}class Kl{constructor(n={}){this.options=n,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const s=this.options&&this.options.compact;return this._map=n,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=O("button","mapboxgl-ctrl-attrib-button",this._container),O("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=O("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===s&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,s){const u=this._map._getUIString(`AttributionControl.${s}`);n.setAttribute("aria-label",u),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",u)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(n){const u=s.reduce((d,f,y)=>(f.value&&(d+=`${f.key}=${f.value}${y<s.length-1?"&":""}`),d),"?");n.href=`${o.config.FEEDBACK_URL}/${u}#${Vl(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const s=this._map.style._sourceCaches;for(const d in s){const f=s[d];if(f.used){const y=f.getSource();y.attribution&&n.indexOf(y.attribution)<0&&n.push(y.attribution)}}n.sort((d,f)=>d.length-f.length),n=n.filter((d,f)=>{for(let y=f+1;y<n.length;y++)if(n[y].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const u=n.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,n.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ua{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=O("div","mapboxgl-ctrl");const s=O("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const s in n){const u=n[s].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const s=n[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class dl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s}remove(n){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const d of u)if(d.id===n)return void(d.cancelled=!0)}run(n=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ja(l,n,s){if(l=new o.LngLat(l.lng,l.lat),n){const u=new o.LngLat(l.lng-360,l.lat),d=new o.LngLat(l.lng+360,l.lat),f=360*Math.ceil(Math.abs(l.lng-s.center.lng)/360),y=s.locationPoint(l).distSqr(n),T=n.x<0||n.y<0||n.x>s.width||n.y>s.height;s.locationPoint(u).distSqr(n)<y&&(T||Math.abs(u.lng-s.center.lng)<f)?l=u:s.locationPoint(d).distSqr(n)<y&&(T||Math.abs(d.lng-s.center.lng)<f)&&(l=d)}for(;Math.abs(l.lng-s.center.lng)>180;){const u=s.locationPoint(l);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;l.lng>s.center.lng?l.lng-=360:l.lng+=360}return l}const pl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class fl extends o.Evented{constructor(n,s){if(super(),(n instanceof o.window.HTMLElement||s)&&(n=o.extend({element:n},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=o.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=O("div");const d=41,f=27,y=I("svg",{display:"block",height:d*this._scale+"px",width:f*this._scale+"px",viewBox:`0 0 ${f} ${d}`},this._element),T=I("radialGradient",{id:"shadowGradient"},I("defs",{},y));I("stop",{offset:"10%","stop-opacity":.4},T),I("stop",{offset:"100%","stop-opacity":.05},T),I("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},y),I("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},y),I("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},y),I("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},y),this._offset=o.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()});const u=this._element.classList;for(const d in pl)u.remove(`mapboxgl-marker-anchor-${d}`);u.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const s=n.code,u=n.charCode||n.keyCode;"Space"!==s&&"Enter"!==s&&32!==u&&13!==u||this.togglePopup()}_onMapClick(n){const s=n.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,s=this._pos;if(!n||!s)return!1;const u=n.unproject(s),d=n.getFreeCameraOptions();if(!d.position)return!1;const f=d.position.toLngLat();return f.distanceTo(u)<.9*f.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const s=this._pos;if(!s||s.x<0||s.x>n.transform.width||s.y<0||s.y>n.transform.height)return void this._clearFadeTimer();const u=n.unproject(s);let d;n._showingGlobe()&&o.isLngLatBehindGlobe(n.transform,this._lngLat)?d=0:(d=1-n._queryFogOpacity(u),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${n.x}px,${n.y}px)\n            ${pl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${s.x}px,${s.y}px)\n        `}_calculateXYTransform(){const n=this._pos,s=this._map,u=this.getPitchAlignment();if(!s||!n||"map"!==u)return"";if(!s._showingGlobe()){const E=s.getPitch();return E?`rotateX(${E}deg)`:""}const d=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),f=n.sub(o.globeCenterToScreenPoint(s.transform)),y=Math.abs(f.x)+Math.abs(f.y);if(0===y)return"";const T=d/y;return`rotateX(${-f.y*T}deg) rotateY(${f.x*T}deg)`}_calculateZTransform(){const n=this._pos,s=this._map;if(!s||!n)return"";let u=0;const d=this.getRotationAlignment();if("map"===d)if(s._showingGlobe()){const f=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),y=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(f);u=o.radToDeg(Math.atan2(y.y,y.x))-90}else u=-s.getBearing();else if("horizon"===d){const f=o.smoothstep(4,6,s.getZoom()),y=o.globeCenterToScreenPoint(s.transform);y.y+=f*s.transform.height;const T=n.sub(y),E=o.radToDeg(Math.atan2(T.y,T.x));u=(E>90?E-270:E+90)*(1-f)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(n){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=ja(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),!0===n?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.pointGeometry.convert(n),this._update(),this}_onMove(n){const s=this._map;if(!s)return;const u=this._pointerdownPos,d=this._positionDelta;if(u&&d){if(!this._isDragging){const f=this._clickTolerance||s._clickTolerance;if(n.point.dist(u)<f)return;this._isDragging=!0}this._pos=n.point.sub(d),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(n){const s=this._map,u=this._pos;s&&u&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(u),this._pointerdownPos=n.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const s=this._map;return s&&(n?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Qc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},eu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jl(l=new o.pointGeometry(0,0),n="bottom"){if("number"==typeof l){const s=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(n){case"top":return new o.pointGeometry(0,l);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-l);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(l,0);case"right":return new o.pointGeometry(-l,0)}return new o.pointGeometry(0,0)}return l instanceof o.pointGeometry||Array.isArray(l)?o.pointGeometry.convert(l):o.pointGeometry.convert(l[n]||[0,0])}class tu{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const s=o.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,s,u){this._start=this.getValue(s),this._end=n,this._startTime=s,this._endTime=s+u}}const iu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ql={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ml(l){l.parentNode&&l.parentNode.removeChild(l)}const nu={showCompass:!0,showZoom:!0,visualizePitch:!1};class ru{constructor(n,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new ql({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,u&&(this.mousePitch=new Hs({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(n,s){this.mouseRotate.mousedown(n,s),this.mousePitch&&this.mousePitch.mousedown(n,s),Be()}move(n,s){const u=this.map,d=this.mouseRotate.mousemoveWindow(n,s),f=d&&d.bearingDelta;if(f&&u.setBearing(u.getBearing()+f),this.mousePitch){const y=this.mousePitch.mousemoveWindow(n,s),T=y&&y.pitchDelta;T&&u.setPitch(u.getPitch()+T)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ie(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),ne(this.element,n)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,ne(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=mt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=mt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ou={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ec={maxWidth:100,unit:"metric"};function su(l,n,s){const u=gl(n),d=u/n,f={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[s];this._map._requestDomTask(()=>{this._container.style.width=l*d+"px",this._container.innerHTML=`${u}&nbsp;${f}`})}function gl(l){const n=Math.pow(10,`${Math.floor(l)}`.length-1);let s=l/n;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:s>=1?1:function(u){const d=Math.pow(10,Math.ceil(-Math.log(u)/Math.LN10));return Math.round(u*d)/d}(s),n*s}const Va={version:o.version,supported:N,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Jc{constructor(l){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),null!=(l=o.extend({},Ql,l)).minZoom&&null!=l.maxZoom&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=l.minPitch&&null!=l.maxPitch&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=l.minPitch&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=l.maxPitch&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(l.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new wo(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new dl,this._domRenderTaskQueue=new dl,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},iu,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tu(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,"string"==typeof l.container){if(this._container=o.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==o.window&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Kc(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new Rc("string"==typeof l.hash&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,o.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new Kl({customAttribution:l.customAttribution})),this._logoControl=new Ua,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new o.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(l,n){if(void 0===n&&(n=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[n];return-1!==n.indexOf("bottom")?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(l);return n>-1&&this._controls.splice(n,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),this.fire(new o.Event("resize",l)),n&&this.fire(new o.Event("moveend",l)),this}getBounds(){return"globe"===this.transform.projection.name&&o.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return"auto"===l?o.window.navigator.language:Array.isArray(l)?0===l.length?void 0:l.map(n=>"auto"===n?o.window.navigator.language:n):l}setLanguage(l){const n=this._parseLanguage(l);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(l){return this._lazyInitEmptyStyle(),l?"string"==typeof l&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const l=this.transform,n=l.projection.name;let s;"globe"===n&&l.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(l.setMercatorFromTransition(),s=!0):"mercator"===n&&l.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(l.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,n){return this._updateProjection(l||n||{name:"mercator"})}_updateProjection(l){let n;if(n="globe"===l.name&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const s in this.style._sourceCaches)this.style._sourceCaches[s].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(l){return this.transform.locationPoint3D(o.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(o.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(l,n,s){if("mouseenter"===l||"mouseover"===l){let u=!1;const d=y=>{const T=n.filter(P=>this.getLayer(P)),E=T.length?this.queryRenderedFeatures(y.point,{layers:T}):[];E.length?u||(u=!0,s.call(this,new To(l,this,y.originalEvent,{features:E}))):u=!1},f=()=>{u=!1};return{layers:new Set(n),listener:s,delegates:{mousemove:d,mouseout:f}}}if("mouseleave"===l||"mouseout"===l){let u=!1;const d=y=>{const T=n.filter(E=>this.getLayer(E));(T.length?this.queryRenderedFeatures(y.point,{layers:T}):[]).length?u=!0:u&&(u=!1,s.call(this,new To(l,this,y.originalEvent)))},f=y=>{u&&(u=!1,s.call(this,new To(l,this,y.originalEvent)))};return{layers:new Set(n),listener:s,delegates:{mousemove:d,mouseout:f}}}{const u=d=>{const f=n.filter(T=>this.getLayer(T)),y=f.length?this.queryRenderedFeatures(d.point,{layers:f}):[];y.length&&(d.features=y,s.call(this,d),delete d.features)};return{layers:new Set(n),listener:s,delegates:{[l]:u}}}}on(l,n,s){if(void 0===s)return super.on(l,n);Array.isArray(n)||(n=[n]);const u=this._createDelegatedListener(l,n,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const d in u.delegates)this.on(d,u.delegates[d]);return this}once(l,n,s){if(void 0===s)return super.once(l,n);Array.isArray(n)||(n=[n]);const u=this._createDelegatedListener(l,n,s);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(l,n,s){if(void 0===s)return super.off(l,n);n=new Set(Array.isArray(n)?n:[n]);const u=(f,y)=>{if(f.size!==y.size)return!1;for(const T of f)if(!y.has(T))return!1;return!0},d=this._delegatedListeners?this._delegatedListeners[l]:void 0;return d&&(f=>{for(let y=0;y<f.length;y++){const T=f[y];if(T.listener===s&&u(T.layers,n)){for(const E in T.delegates)this.off(E,T.delegates[E]);return f.splice(y,1),this}}})(d),this}queryRenderedFeatures(l,n){return this.style?(void 0!==n||void 0===l||l instanceof o.pointGeometry||Array.isArray(l)||(n=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(l,n){return this.style.querySourceFeatures(l,n)}setStyle(l,n){return!1!==(n=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(l,n))}_getUIString(l){const n=this._locale[l];if(null==n)throw new Error(`Missing UI string '${l}'`);return n}_updateStyle(l,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new G(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof l?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new G(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,n){if("string"==typeof l){const s=this._requestManager.normalizeStyleURL(l),u=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(u,(d,f)=>{d?this.fire(new o.ErrorEvent(d)):f&&this._updateDiff(f,n)})}else"object"==typeof l&&this._updateDiff(l,n)}_updateDiff(l,n){try{this.style.setState(l)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(l,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(l,n){return this._lazyInitEmptyStyle(),this.style.addSource(l,n),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const n in l){const s=l[n]._tiles;for(const u in s){const d=s[u];if("loaded"!==d.state&&"errored"!==d.state)return!1}}return!0}addSourceType(l,n,s){this._lazyInitEmptyStyle(),this.style.addSourceType(l,n,s)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,n,{pixelRatio:s=1,sdf:u=!1,stretchX:d,stretchY:f,content:y}={}){if(this._lazyInitEmptyStyle(),n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap){const{width:T,height:E,data:P}=o.exported.getImageData(n);this.style.addImage(l,{data:new o.RGBAImage({width:T,height:E},P),pixelRatio:s,stretchX:d,stretchY:f,content:y,sdf:u,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:E}=n,P=n;this.style.addImage(l,{data:new o.RGBAImage({width:T,height:E},new Uint8Array(P.data)),pixelRatio:s,stretchX:d,stretchY:f,content:y,sdf:u,version:0,userImage:P}),P.onAdd&&P.onAdd(this,l)}}updateImage(l,n){const s=this.style.getImage(l);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap?o.exported.getImageData(n):n,{width:d,height:f}=u;void 0!==d&&void 0!==f?d===s.data.width&&f===s.data.height?(s.data.replace(u.data,!(n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap)),this.style.updateImage(l,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${d}, ${f})\n                must be that same as the previous version of the image\n                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,n){o.getImage(this._requestManager.transformRequest(l,o.ResourceType.Image),(s,u)=>{n(s,u instanceof o.window.HTMLImageElement?o.exported.getImageData(u):u)})}listImages(){return this.style.listImages()}addLayer(l,n){return this._lazyInitEmptyStyle(),this.style.addLayer(l,n),this._update(!0)}moveLayer(l,n){return this.style.moveLayer(l,n),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,n,s){return this.style.setLayerZoomRange(l,n,s),this._update(!0)}setFilter(l,n,s={}){return this.style.setFilter(l,n,s),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,n,s,u={}){return this.style.setPaintProperty(l,n,s,u),this._update(!0)}getPaintProperty(l,n){return this.style.getPaintProperty(l,n)}setLayoutProperty(l,n,s,u={}){return this.style.setLayoutProperty(l,n,s,u),this._update(!0)}getLayoutProperty(l,n){return this.style.getLayoutProperty(l,n)}setLight(l,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(l),this.transform):0}setFeatureState(l,n){return this.style.setFeatureState(l,n),this._update()}removeFeatureState(l,n){return this.style.removeFeatureState(l,n),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let s,u,d,f=this._container;for(;f&&(!u||!d);){const y=o.window.getComputedStyle(f).transform;y&&"none"!==y&&(s=y.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&"0"!==s[0]&&"1"!==s[0]&&(u=s[0]),s[3]&&"0"!==s[3]&&"1"!==s[3]&&(d=s[3])),f=f.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=d?Math.abs(n/d):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=O("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=O("div","mapboxgl-canvas-container",l);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=O("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=O("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{u[d]=O("div",`mapboxgl-ctrl-${d}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,n){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(l),this._canvas.height=s*Math.ceil(n),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${n}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const n=this._markers.indexOf(l);-1!==n&&this._markers.splice(n,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const n=this._popups.indexOf(l);-1!==n&&this._popups.splice(n,1)}_setupPainter(){const l=o.extend({},N.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);n?(o.storeAuthState(n,!0),this.painter=new Pr(n,this.transform),this.on("data",s=>{"source"===s.dataType&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(n)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let n;const s=this.painter.context.extTimerQuery,u=o.exported.now();if(this.listens("gpu-timing-frame")&&(n=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();let d=!1;const f=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,P=this.transform.pitch,z=o.exported.now();this.style.zoomHistory.update(E,z);const V=new o.EvaluationParameters(E,{now:z,fadeDuration:f,pitch:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=V.crossFadingFactor();1===K&&K===this._crossFadingFactor||(d=!0,this._crossFadingFactor=K),this.style.update(V)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(u),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(u),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,f,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const E=o.exported.now()-u;s.endQueryEXT(s.TIME_ELAPSED_EXT,n),setTimeout(()=>{const P=s.getQueryObjectEXT(n,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(n),this.fire(new o.Event("gpu-timing-frame",{cpuTime:E,gpuTime:P})),o.window.performance.mark("frame-gpu",{startTime:u,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(E);this.fire(new o.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(E);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(T||this._repaint)this.triggerRepaint();else{const E=!this.isMoving()&&this.loaded();if(E&&(y=this._updateAverageElevation(u,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const n of this._markers)l&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!l||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(l,n=!1){const s=u=>(this.transform.averageElevation=u,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&s(0);if((n||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const u=this.transform.averageElevation;let d=this.transform.sampleAverageElevation(),f=!1;this.transform.elevation&&(f=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(d)?d=0:this._averageElevationLastSampledAt=l;const y=Math.abs(u-d);if(y>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(d),s(d);this._averageElevation.easeTo(d,l,300)}else if(y>1e-4)return this._averageElevation.jumpTo(d),s(d)}return!!this._averageElevation.isEasing(l)&&s(this._averageElevation.getValue(l))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===o.AUTH_ERR_MSG||401===l.status)){const n=this.painter.context.gl;o.storeAuthState(n,!1),this._logoControl instanceof Ua&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const s=this.painter.context.gl,u=s.createFramebuffer();function d(f){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,f,0);const y=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,y),y}return s.bindFramebuffer(s.FRAMEBUFFER,u),this._canvasPixelComparison(d(l),n.canvasCopies.map(d),n.timeStamps)}_canvasPixelComparison(l,n,s){let u=s[1]-s[0];const d=l.length/4;for(let f=0;f<n.length;f++){const y=n[f];let T=0;for(let E=0;E<y.length;E+=4)y[E]===l[E]&&y[E+1]===l[E+1]&&y[E+2]===l[E+2]&&y[E+3]===l[E+3]&&(T+=1);u+=(s[f+2]-s[f+1])*(1-T/d)}return u}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==o.window&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),ml(this._canvasContainer),ml(this._controlContainer),ml(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.exported.frame(n=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(n)}))}_preloadTiles(l){const n=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(n,(s,u)=>s._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){"hidden"===o.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,n){o.setCacheLimits(l,n)}get version(){return o.version}},NavigationControl:class{constructor(l){this.options=o.extend({},nu,l),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),O("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),O("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:n}):s.resetNorth({},{originalEvent:n}))}),this._compassIcon=O("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const n=l.getZoom(),s=n===l.getMaxZoom(),u=n===l.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ru(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,n){const s=O("button",l,this._container);return s.type="button",s.addEventListener("click",n),s}_setButtonTitle(l,n){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${n}`);l.setAttribute("aria-label",s),l.firstElementChild&&l.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(l){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},ou,l),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=jl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const n=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,l(s)};void 0!==this._supportsGeolocation?l(this._supportsGeolocation):void 0!==o.window.navigator.permissions?o.window.navigator.permissions.query({name:"geolocation"}).then(s=>n("denied"!==s.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(l){const n=this._map.getMaxBounds(),s=l.coords;return!!n&&(s.longitude<n.getWest()||s.longitude>n.getEast()||s.latitude<n.getSouth()||s.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(l),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",l)),this._finish()}}_updateCamera(l){const n=new o.LngLat(l.coords.longitude,l.coords.latitude),s=l.coords.accuracy,u=this._map.getBearing(),d=o.extend({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(s),d,{geolocateSource:!0})}_updateMarker(l){if(l){const n=new o.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,n=o.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,s=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(1===l.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===l.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=O("button","mapboxgl-ctrl-geolocate",this._container),O("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===l){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=O("div","mapboxgl-user-location"),this._dotElement.appendChild(O("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(O("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new fl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=O("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:!0===l.absolute&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==o.window.DeviceMotionEvent&&"function"==typeof o.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Kl,ScaleControl:class{constructor(l){this.options=o.extend({},ec,l),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=su.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,n=this._map,s=n._containerHeight/2,u=n._containerWidth/2-l/2,d=n.unproject([u,s]),f=n.unproject([u+l,s]),y=d.distanceTo(f);if("imperial"===this.options.unit){const T=3.2808*y;T>5280?this._setScale(l,T/5280,"mile"):this._setScale(l,T,"foot")}else"nautical"===this.options.unit?this._setScale(l,y/1852,"nautical-mile"):y>=1e3?this._setScale(l,y/1e3,"kilometer"):this._setScale(l,y,"meter")}_setScale(l,n,s){const u=gl(n),d=u/n;this._map._requestDomTask(()=>{this._container.style.width=l*d+"px",this._container.innerHTML="nautical-mile"!==s?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:s}).format(u):`${u}&nbsp;nm`})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=O("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof o.window.HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=O("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=O("button","mapboxgl-ctrl-fullscreen",this._controlContainer);O("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(l){super(),this.options=o.extend(Object.create(Qc),l),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(o.window.document.createTextNode(l))}setHTML(l){const n=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let u;for(s.innerHTML=l;u=s.firstChild,u;)n.appendChild(u);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=O("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(l),this.options.closeButton){const s=this._closeButton=O("button","mapboxgl-popup-close-button",n);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let n;return this._classList.delete(l)?n=!1:(this._classList.add(l),n=!0),this._updateClassList(),n}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const n=this._map,s=this._container,u=this._pos;if(!n||!s||!u)return"bottom";const d=s.offsetWidth,f=s.offsetHeight,y=u.x<d/2,T=u.x>n.transform.width-d/2;if(u.y+l<f)return y?"top-left":T?"top-right":"top";if(u.y>n.transform.height-f){if(y)return"bottom-left";if(T)return"bottom-right"}return y?"left":T?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),l.className=n.join(" ")}_update(l){const n=this._map,s=this._content;if(!n||!this._lngLat&&!this._trackPointer||!s)return;let u=this._container;if(u||(u=this._container=O("div","mapboxgl-popup",n.getContainer()),this._tip=O("div","mapboxgl-popup-tip",u),u.appendChild(s)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ja(this._lngLat,this._pos,n.transform)),!this._trackPointer||l){const d=this._pos=this._trackPointer&&l?l:n.project(this._lngLat),f=Jl(this.options.offset),y=this._anchor=this._getAnchor(f.y),T=Jl(this.options.offset,y),E=d.add(T).round();n._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${pl[y]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&n._showingGlobe()){const d=o.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(eu);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:fl,Style:G,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Cs,Evented:o.Evented,config:o.config,prewarm:function(){Di().acquire(Mi)},clearPrewarmedResources:function(){const l=bi;l&&(l.isPreloaded()&&1===l.numActive()?(l.release(Mi),bi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(l){o.config.ACCESS_TOKEN=l},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(l){o.config.API_URL=l},get workerCount(){return Ti.workerCount},set workerCount(l){Ti.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Va}),v}),function(Ae){"object"==typeof exports&&typeof module<"u"?module.exports=Ae():"function"==typeof define&&define.amd?define([],Ae):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).Dygraph=Ae()}(function(){return function Ae(Qe,v,$){function ae(N,j){if(!v[N]){if(!Qe[N]){var k="function"==typeof require&&require;if(!j&&k)return k(N,!0);if(o)return o(N,!0);var O=new Error("Cannot find module '"+N+"'");throw O.code="MODULE_NOT_FOUND",O}var I=v[N]={exports:{}};Qe[N][0].call(I.exports,function(X){return ae(Qe[N][1][X]||X)},I,I.exports,Ae,Qe,v,$)}return v[N].exports}for(var o="function"==typeof require&&require,D=0;D<$.length;D++)ae($[D]);return ae}({1:[function(Ae,Qe,v){function $(){throw new Error("setTimeout has not been defined")}function ae(){throw new Error("clearTimeout has not been defined")}function o(Ke){if(I===setTimeout)return setTimeout(Ke,0);if((I===$||!I)&&setTimeout)return I=setTimeout,setTimeout(Ke,0);try{return I(Ke,0)}catch{try{return I.call(null,Ke,0)}catch{return I.call(this,Ke,0)}}}function N(){Ie&&te&&(Ie=!1,te.length?Be=te.concat(Be):Se=-1,Be.length&&j())}function j(){if(!Ie){var Ke=o(N);Ie=!0;for(var ne=Be.length;ne;){for(te=Be,Be=[];++Se<ne;)te&&te[Se].run();Se=-1,ne=Be.length}te=null,Ie=!1,function D(Ke){if(X===clearTimeout)return clearTimeout(Ke);if((X===ae||!X)&&clearTimeout)return X=clearTimeout,clearTimeout(Ke);try{X(Ke)}catch{try{return X.call(null,Ke)}catch{return X.call(this,Ke)}}}(Ke)}}function k(Ke,ne){this.fun=Ke,this.array=ne}function O(){}var I,X,le=Qe.exports={};!function(){try{I="function"==typeof setTimeout?setTimeout:$}catch{I=$}try{X="function"==typeof clearTimeout?clearTimeout:ae}catch{X=ae}}();var te,Be=[],Ie=!1,Se=-1;le.nextTick=function(Ke){var ne=new Array(arguments.length-1);if(arguments.length>1)for(var mt=1;mt<arguments.length;mt++)ne[mt-1]=arguments[mt];Be.push(new k(Ke,ne)),1!==Be.length||Ie||o(j)},k.prototype.run=function(){this.fun.apply(null,this.array)},le.title="browser",le.browser=!0,le.env={},le.argv=[],le.version="",le.versions={},le.on=O,le.addListener=O,le.once=O,le.off=O,le.removeListener=O,le.removeAllListeners=O,le.emit=O,le.prependListener=O,le.prependOnceListener=O,le.listeners=function(Ke){return[]},le.binding=function(Ke){throw new Error("process.binding is not supported")},le.cwd=function(){return"/"},le.chdir=function(Ke){throw new Error("process.chdir is not supported")},le.umask=function(){return 0}},{}],2:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var D,ae=(D=Ae("./bars"))&&D.__esModule?D:{default:D},o=function(){};(o.prototype=new ae.default).extractSeries=function(D,N,j){for(var k,O,I,X=[],le=j.get("logscale"),te=0;te<D.length;te++)k=D[te][0],I=D[te][N],le&&null!==I&&(I[0]<=0||I[1]<=0||I[2]<=0)&&(I=null),null!==I?null===(O=I[1])||isNaN(O)?X.push([k,O,[O,O]]):X.push([k,O,[I[0],I[2]]]):X.push([k,null,[null,null]]);return X},o.prototype.rollingAverage=function(D,N,j){N=Math.min(N,D.length);var k,O,I,X,le,te,Be,Ie=[];for(O=0,X=0,I=0,le=0,te=0;te<D.length;te++){if(k=D[te][1],Be=D[te][2],Ie[te]=D[te],null===k||isNaN(k)||(O+=Be[0],X+=k,I+=Be[1],le+=1),te-N>=0){var Se=D[te-N];null===Se[1]||isNaN(Se[1])||(O-=Se[2][0],X-=Se[1],I-=Se[2][1],le-=1)}Ie[te]=le?[D[te][0],1*X/le,[1*O/le,1*I/le]]:[D[te][0],null,[null,null]]}return Ie},v.default=o,Qe.exports=v.default},{"./bars":5}],3:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var D,ae=(D=Ae("./bars"))&&D.__esModule?D:{default:D},o=function(){};(o.prototype=new ae.default).extractSeries=function(D,N,j){for(var k,O,I,X,le=[],te=j.get("sigma"),Be=j.get("logscale"),Ie=0;Ie<D.length;Ie++)k=D[Ie][0],X=D[Ie][N],Be&&null!==X&&(X[0]<=0||X[0]-te*X[1]<=0)&&(X=null),null!==X?null===(O=X[0])||isNaN(O)?le.push([k,O,[O,O,O]]):le.push([k,O,[O-(I=te*X[1]),O+I,X[1]]]):le.push([k,null,[null,null,null]]);return le},o.prototype.rollingAverage=function(D,N,j){N=Math.min(N,D.length);var k,O,I,X,le,te,Be,Ie,Se,Ke=[],ne=j.get("sigma");for(k=0;k<D.length;k++){for(le=0,Ie=0,te=0,O=Math.max(0,k-N+1);O<k+1;O++)null===(I=D[O][1])||isNaN(I)||(te++,le+=I,Ie+=Math.pow(D[O][2][2],2));te?(Be=Math.sqrt(Ie)/te,Ke[k]=[D[k][0],Se=le/te,[Se-ne*Be,Se+ne*Be]]):Ke[k]=[D[k][0],X=1==N?D[k][1]:null,[X,X]]}return Ke},v.default=o,Qe.exports=v.default},{"./bars":5}],4:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var D,ae=(D=Ae("./bars"))&&D.__esModule?D:{default:D},o=function(){};(o.prototype=new ae.default).extractSeries=function(D,N,j){for(var k,O,I,X,le,te,Be,Ie,Se=[],Ke=j.get("sigma"),ne=j.get("logscale"),mt=0;mt<D.length;mt++)k=D[mt][0],I=D[mt][N],ne&&null!==I&&(I[0]<=0||I[1]<=0)&&(I=null),null!==I?(le=I[1],null===(X=I[0])||isNaN(X)?Se.push([k,X,[X,X,X,le]]):(te=le?X/le:0,Be=le?Ke*Math.sqrt(te*(1-te)/le):1,Se.push([k,O=100*te,[O-(Ie=100*Be),O+Ie,X,le]]))):Se.push([k,null,[null,null,null,null]]);return Se},o.prototype.rollingAverage=function(D,N,j){N=Math.min(N,D.length);var I,X,le=[],te=j.get("sigma"),Be=j.get("wilsonInterval"),Ie=0,Se=0;for(I=0;I<D.length;I++){Ie+=D[I][2][2],Se+=D[I][2][3],I-N>=0&&(Ie-=D[I-N][2][2],Se-=D[I-N][2][3]);var Ke=D[I][0],ne=Se?Ie/Se:0;if(Be)if(Se){var mt=ne<0?0:ne,wt=te*Math.sqrt(mt*(1-mt)/Se+te*te/(4*Se*Se)),xt=1+te*te/Se;le[I]=[Ke,100*mt,[(mt+te*te/(2*Se)-wt)/xt*100,(mt+te*te/(2*Se)+wt)/xt*100]]}else le[I]=[Ke,0,[0,0]];else X=Se?te*Math.sqrt(ne*(1-ne)/Se):1,le[I]=[Ke,100*ne,[100*(ne-X),100*(ne+X)]]}return le},v.default=o,Qe.exports=v.default},{"./bars":5}],5:[function(Ae,Qe,v){"use strict";function $(k){return k&&k.__esModule?k:{default:k}}Object.defineProperty(v,"__esModule",{value:!0});var o=$(Ae("./datahandler")),N=$(Ae("../dygraph-layout")),j=function(){o.default.call(this)};(j.prototype=new o.default).extractSeries=function(k,O,I){},j.prototype.rollingAverage=function(k,O,I){},j.prototype.onPointsCreated_=function(k,O){for(var I=0;I<k.length;++I){var X=k[I],le=O[I];le.y_top=NaN,le.y_bottom=NaN,le.yval_minus=o.default.parseFloat(X[2][0]),le.yval_plus=o.default.parseFloat(X[2][1])}},j.prototype.getExtremeYValues=function(k,O,I){for(var X,le=null,te=null,Be=k.length-1,Ie=0;Ie<=Be;Ie++)if(null!==(X=k[Ie][1])&&!isNaN(X)){var Se=k[Ie][2][0],Ke=k[Ie][2][1];Se>X&&(Se=X),Ke<X&&(Ke=X),(null===te||Ke>te)&&(te=Ke),(null===le||Se<le)&&(le=Se)}return[le,te]},j.prototype.onLineEvaluated=function(k,O,I){for(var X,le=0;le<k.length;le++)(X=k[le]).y_top=N.default.calcYNormal_(O,X.yval_minus,I),X.y_bottom=N.default.calcYNormal_(O,X.yval_plus,I)},v.default=j,Qe.exports=v.default},{"../dygraph-layout":13,"./datahandler":6}],6:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var $=function(){},ae=$;ae.X=0,ae.Y=1,ae.EXTRAS=2,ae.prototype.extractSeries=function(o,D,N){},ae.prototype.seriesToPoints=function(o,D,N){for(var j=[],k=0;k<o.length;++k){var O=o[k],I=O[1],X=null===I?null:ae.parseFloat(I),le={x:NaN,y:NaN,xval:ae.parseFloat(O[0]),yval:X,name:D,idx:k+N};j.push(le)}return this.onPointsCreated_(o,j),j},ae.prototype.onPointsCreated_=function(o,D){},ae.prototype.rollingAverage=function(o,D,N){},ae.prototype.getExtremeYValues=function(o,D,N){},ae.prototype.onLineEvaluated=function(o,D,N){},ae.parseFloat=function(o){return null===o?NaN:o},v.default=$,Qe.exports=v.default},{}],7:[function(Ae,Qe,v){"use strict";function $(j){return j&&j.__esModule?j:{default:j}}Object.defineProperty(v,"__esModule",{value:!0});var o=($(Ae("./datahandler")),Ae("./default")),D=$(o),N=function(){};(N.prototype=new D.default).extractSeries=function(j,k,O){for(var I,le,te,Be,Se=[],Ke=O.get("logscale"),ne=0;ne<j.length;ne++)I=j[ne][0],le=j[ne][k],Ke&&null!==le&&(le[0]<=0||le[1]<=0)&&(le=null),null!==le?(Be=le[1],null===(te=le[0])||isNaN(te)?Se.push([I,te,[te,Be]]):Se.push([I,100*(Be?te/Be:0),[te,Be]])):Se.push([I,null,[null,null]]);return Se},N.prototype.rollingAverage=function(j,k,O){k=Math.min(k,j.length);var I,X=[],le=0,te=0;for(I=0;I<j.length;I++)le+=j[I][2][0],te+=j[I][2][1],I-k>=0&&(le-=j[I-k][2][0],te-=j[I-k][2][1]),X[I]=[j[I][0],100*(te?le/te:0)];return X},v.default=N,Qe.exports=v.default},{"./datahandler":6,"./default":8}],8:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var D,ae=(D=Ae("./datahandler"))&&D.__esModule?D:{default:D},o=function(){};(o.prototype=new ae.default).extractSeries=function(D,N,j){for(var k=[],O=j.get("logscale"),I=0;I<D.length;I++){var le=D[I][N];O&&le<=0&&(le=null),k.push([D[I][0],le])}return k},o.prototype.rollingAverage=function(D,N,j){var k,O,I,X,le,te=[];if(1==(N=Math.min(N,D.length)))return D;for(k=0;k<D.length;k++){for(X=0,le=0,O=Math.max(0,k-N+1);O<k+1;O++)null===(I=D[O][1])||isNaN(I)||(le++,X+=D[O][1]);te[k]=le?[D[k][0],X/le]:[D[k][0],null]}return te},o.prototype.getExtremeYValues=function(D,N,j){for(var k,O=null,I=null,X=D.length-1,le=0;le<=X;le++)null===(k=D[le][1])||isNaN(k)||((null===I||k>I)&&(I=k),(null===O||k<O)&&(O=k));return[O,I]},v.default=o,Qe.exports=v.default},{"./datahandler":6}],9:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var j,ae=function(j){if(j&&j.__esModule)return j;var k={};if(null!=j)for(var O in j)Object.prototype.hasOwnProperty.call(j,O)&&(k[O]=j[O]);return k.default=j,k}(Ae("./dygraph-utils")),D=(j=Ae("./dygraph"))&&j.__esModule?j:{default:j},N=function(j,k,O,I){if(this.dygraph_=j,this.layout=I,this.element=k,this.elementContext=O,this.height=j.height_,this.width=j.width_,!ae.isCanvasSupported(this.element))throw"Canvas is not supported.";this.area=I.getPlotArea();var X=this.dygraph_.canvas_ctx_;X.beginPath(),X.rect(this.area.x,this.area.y,this.area.w,this.area.h),X.clip(),(X=this.dygraph_.hidden_ctx_).beginPath(),X.rect(this.area.x,this.area.y,this.area.w,this.area.h),X.clip()};N.prototype.clear=function(){this.elementContext.clearRect(0,0,this.width,this.height)},N.prototype.render=function(){this._updatePoints(),this._renderLineChart()},N._getIteratorPredicate=function(j){return j?N._predicateThatSkipsEmptyPoints:null},N._predicateThatSkipsEmptyPoints=function(j,k){return null!==j[k].yval},N._drawStyledLine=function(j,k,O,I,X,le,te){var Be=j.dygraph,Ie=Be.getBooleanOption("stepPlot",j.setName);ae.isArrayLike(I)||(I=null);var Se=Be.getBooleanOption("drawGapEdgePoints",j.setName),Ke=j.points,mt=ae.createIterator(Ke,0,Ke.length,N._getIteratorPredicate(Be.getBooleanOption("connectSeparatedPoints",j.setName))),C=I&&I.length>=2,wt=j.drawingContext;wt.save(),C&&wt.setLineDash&&wt.setLineDash(I);var xt=N._drawSeries(j,mt,O,te,X,Se,Ie,k);N._drawPointsOnLine(j,xt,le,k,te),C&&wt.setLineDash&&wt.setLineDash([]),wt.restore()},N._drawSeries=function(j,k,O,I,X,le,te,Be){var Ie,Se,Ke=null,ne=null,mt=null,C=[],wt=!0,xt=j.drawingContext;xt.beginPath(),xt.strokeStyle=Be,xt.lineWidth=O;for(var Wt=k.array_,Nt=k.end_,fi=k.predicate_,$t=k.start_;$t<Nt;$t++){if(Se=Wt[$t],fi){for(;$t<Nt&&!fi(Wt,$t);)$t++;if($t==Nt)break;Se=Wt[$t]}if(null===Se.canvasy||Se.canvasy!=Se.canvasy)te&&null!==Ke&&(xt.moveTo(Ke,ne),xt.lineTo(Se.canvasx,ne)),Ke=ne=null;else{if(Ie=!1,le||null===Ke){k.nextIdx_=$t,k.next();var li=null===(mt=k.hasNext?k.peek.canvasy:null)||mt!=mt;Ie=null===Ke&&li,le&&(!wt&&null===Ke||k.hasNext&&li)&&(Ie=!0)}null!==Ke?O&&(te&&(xt.moveTo(Ke,ne),xt.lineTo(Se.canvasx,ne)),xt.lineTo(Se.canvasx,Se.canvasy)):xt.moveTo(Se.canvasx,Se.canvasy),(X||Ie)&&C.push([Se.canvasx,Se.canvasy,Se.idx]),Ke=Se.canvasx,ne=Se.canvasy}wt=!1}return xt.stroke(),C},N._drawPointsOnLine=function(j,k,O,I,X){for(var le=j.drawingContext,te=0;te<k.length;te++){var Be=k[te];le.save(),O.call(j.dygraph,j.dygraph,j.setName,le,Be[0],Be[1],I,X,Be[2]),le.restore()}},N.prototype._updatePoints=function(){for(var j=this.layout.points,k=j.length;k--;)for(var O=j[k],I=O.length;I--;){var X=O[I];X.canvasx=this.area.w*X.x+this.area.x,X.canvasy=this.area.h*X.y+this.area.y}},N.prototype._renderLineChart=function(j,k){var O,I,X=k||this.elementContext,le=this.layout.points,te=this.layout.setNames;this.colors=this.dygraph_.colorsMap_;var Be=this.dygraph_.getOption("plotter"),Ie=Be;ae.isArrayLike(Ie)||(Ie=[Ie]);var Se={};for(O=0;O<te.length;O++){var Ke=this.dygraph_.getOption("plotter",I=te[O]);Ke!=Be&&(Se[I]=Ke)}for(O=0;O<Ie.length;O++)for(var ne=Ie[O],mt=O==Ie.length-1,C=0;C<le.length;C++)if(I=te[C],!j||I==j){var wt=le[C],xt=ne;if(I in Se){if(!mt)continue;xt=Se[I]}var Wt=this.colors[I],Nt=this.dygraph_.getOption("strokeWidth",I);X.save(),X.strokeStyle=Wt,X.lineWidth=Nt,xt({points:wt,setName:I,drawingContext:X,color:Wt,strokeWidth:Nt,dygraph:this.dygraph_,axis:this.dygraph_.axisPropertiesForSeries(I),plotArea:this.area,seriesIndex:C,seriesCount:le.length,singleSeriesName:j,allSeriesPoints:le}),X.restore()}},N._Plotters={linePlotter:function(j){N._linePlotter(j)},fillPlotter:function(j){N._fillPlotter(j)},errorPlotter:function(j){N._errorPlotter(j)}},N._linePlotter=function(j){var k=j.dygraph,O=j.setName,I=j.strokeWidth,X=k.getNumericOption("strokeBorderWidth",O),le=k.getOption("drawPointCallback",O)||ae.Circles.DEFAULT,te=k.getOption("strokePattern",O),Be=k.getBooleanOption("drawPoints",O),Ie=k.getNumericOption("pointSize",O);X&&I&&N._drawStyledLine(j,k.getOption("strokeBorderColor",O),I+2*X,te,Be,le,Ie),N._drawStyledLine(j,j.color,I,te,Be,le,Ie)},N._errorPlotter=function(j){var k=j.dygraph,O=j.setName;if(k.getBooleanOption("errorBars")||k.getBooleanOption("customBars")){k.getBooleanOption("fillGraph",O)&&console.warn("Can't use fillGraph option with error bars");var I,X=j.drawingContext,le=j.color,te=k.getNumericOption("fillAlpha",O),Be=k.getBooleanOption("stepPlot",O),Ie=j.points,Se=ae.createIterator(Ie,0,Ie.length,N._getIteratorPredicate(k.getBooleanOption("connectSeparatedPoints",O))),Ke=NaN,ne=NaN,mt=[-1,-1],C=ae.toRGB_(le);X.fillStyle="rgba("+C.r+","+C.g+","+C.b+","+te+")",X.beginPath();for(var xt=function(Nt){return null==Nt||isNaN(Nt)};Se.hasNext;){var Wt=Se.next();!Be&&xt(Wt.y)||Be&&!isNaN(ne)&&xt(ne)?Ke=NaN:(I=[Wt.y_bottom,Wt.y_top],Be&&(ne=Wt.y),isNaN(I[0])&&(I[0]=Wt.y),isNaN(I[1])&&(I[1]=Wt.y),I[0]=j.plotArea.h*I[0]+j.plotArea.y,I[1]=j.plotArea.h*I[1]+j.plotArea.y,isNaN(Ke)||(Be?(X.moveTo(Ke,mt[0]),X.lineTo(Wt.canvasx,mt[0]),X.lineTo(Wt.canvasx,mt[1])):(X.moveTo(Ke,mt[0]),X.lineTo(Wt.canvasx,I[0]),X.lineTo(Wt.canvasx,I[1])),X.lineTo(Ke,mt[1]),X.closePath()),mt=I,Ke=Wt.canvasx)}X.fill()}},N._fastCanvasProxy=function(j){var k=[],O=null,I=null,X=0,te=function(Ie){!function(Ie){if(!(k.length<=1)){for(var Se=k.length-1;Se>0;Se--)if(2==(Ke=k[Se])[0]){var ne=k[Se-1];ne[1]==Ke[1]&&ne[2]==Ke[2]&&k.splice(Se,1)}for(Se=0;Se<k.length-1;)2==(Ke=k[Se])[0]&&2==k[Se+1][0]?k.splice(Se,1):Se++;if(k.length>2&&!Ie){var mt=0;2==k[0][0]&&mt++;var C=null,wt=null;for(Se=mt;Se<k.length;Se++){var Ke;if(1==(Ke=k[Se])[0])if(null===C&&null===wt)C=Se,wt=Se;else{var xt=Ke[2];xt<k[C][2]?C=Se:xt>k[wt][2]&&(wt=Se)}}var Wt=k[C],Nt=k[wt];k.splice(mt,k.length-mt),C<wt?(k.push(Wt),k.push(Nt)):(C>wt&&k.push(Nt),k.push(Wt))}}}(Ie);for(var Se=0,Ke=k.length;Se<Ke;Se++){var ne=k[Se];1==ne[0]?j.lineTo(ne[1],ne[2]):2==ne[0]&&j.moveTo(ne[1],ne[2])}k.length&&(I=k[k.length-1][1]),X+=k.length,k=[]},Be=function(Ie,Se,Ke){var ne=Math.round(Se);null!==O&&ne==O||(te(O-I>1||ne-O>1),O=ne),k.push([Ie,Se,Ke])};return{moveTo:function(Ie,Se){Be(2,Ie,Se)},lineTo:function(Ie,Se){Be(1,Ie,Se)},stroke:function(){te(!0),j.stroke()},fill:function(){te(!0),j.fill()},beginPath:function(){te(!0),j.beginPath()},closePath:function(){te(!0),j.closePath()},_count:function(){return X}}},N._fillPlotter=function(j){if(!j.singleSeriesName&&0===j.seriesIndex){for(var k=j.dygraph,O=k.getLabels().slice(1),I=O.length;I>=0;I--)k.visibility()[I]||O.splice(I,1);if(function(){for(var yn=0;yn<O.length;yn++)if(k.getBooleanOption("fillGraph",O[yn]))return!0;return!1}())for(var X,le,te=j.plotArea,Be=j.allSeriesPoints,Ie=Be.length,Se=k.getBooleanOption("stackedGraph"),Ke=k.getColors(),ne={},mt=function(yn,En,Jn,vn){if(yn.lineTo(En,Jn),Se)for(var Fn=vn.length-1;Fn>=0;Fn--){var Ji=vn[Fn];yn.lineTo(Ji[0],Ji[1])}},C=Ie-1;C>=0;C--){var wt=j.drawingContext,xt=O[C];if(k.getBooleanOption("fillGraph",xt)){var Wt=k.getNumericOption("fillAlpha",xt),Nt=k.getBooleanOption("stepPlot",xt),fi=Ke[C],$t=k.axisPropertiesForSeries(xt),li=1+$t.minyval*$t.yscale;li<0?li=0:li>1&&(li=1),li=te.h*li+te.y;var qt,Ri=Be[C],Bi=ae.createIterator(Ri,0,Ri.length,N._getIteratorPredicate(k.getBooleanOption("connectSeparatedPoints",xt))),mi=NaN,tn=[-1,-1],Pt=ae.toRGB_(fi);wt.fillStyle="rgba("+Pt.r+","+Pt.g+","+Pt.b+","+Wt+")",wt.beginPath();var ji,pt=!0;(Ri.length>2*k.width_||D.default.FORCE_FAST_PROXY)&&(wt=N._fastCanvasProxy(wt));for(var Si,mn=[];Bi.hasNext;)if(Si=Bi.next(),ae.isOK(Si.y)||Nt){if(Se){if(!pt&&ji==Si.xval)continue;pt=!1,ji=Si.xval,qt=[Si.canvasy,void 0===(X=ne[Si.canvasx])?li:le?X[0]:X],ne[Si.canvasx]=Nt?-1===tn[0]?[Si.canvasy,li]:[Si.canvasy,tn[0]]:Si.canvasy}else qt=isNaN(Si.canvasy)&&Nt?[te.y+te.h,li]:[Si.canvasy,li];isNaN(mi)?(wt.moveTo(Si.canvasx,qt[1]),wt.lineTo(Si.canvasx,qt[0])):(Nt&&wt.lineTo(Si.canvasx,tn[0]),wt.lineTo(Si.canvasx,qt[0]),Se&&(mn.push([mi,tn[1]]),mn.push(le&&X?[Si.canvasx,X[1]]:[Si.canvasx,qt[1]]))),tn=qt,mi=Si.canvasx}else mt(wt,mi,tn[1],mn),mn=[],mi=NaN,null===Si.y_stacked||isNaN(Si.y_stacked)||(ne[Si.canvasx]=te.h*Si.y_stacked+te.y);le=Nt,qt&&Si&&(mt(wt,Si.canvasx,qt[1],mn),mn=[]),wt.fill()}}}},v.default=N,Qe.exports=v.default},{"./dygraph":18,"./dygraph-utils":17}],10:[function(Ae,Qe,v){"use strict";function $(te){return te&&te.__esModule?te:{default:te}}function ae(te){if(te&&te.__esModule)return te;var Be={};if(null!=te)for(var Ie in te)Object.prototype.hasOwnProperty.call(te,Ie)&&(Be[Ie]=te[Ie]);return Be.default=te,Be}Object.defineProperty(v,"__esModule",{value:!0});var D=ae(Ae("./dygraph-tickers")),j=$(Ae("./dygraph-interaction-model")),O=$(Ae("./dygraph-canvas")),X=ae(Ae("./dygraph-utils"));v.default={highlightCircleSize:3,highlightSeriesOpts:null,highlightSeriesBackgroundAlpha:.5,highlightSeriesBackgroundColor:"rgb(255, 255, 255)",labelsSeparateLines:!1,labelsShowZeroValues:!0,labelsKMB:!1,labelsKMG2:!1,showLabelsOnHighlight:!0,digitsAfterDecimal:2,maxNumberWidth:6,sigFigs:null,strokeWidth:1,strokeBorderWidth:0,strokeBorderColor:"white",axisTickSize:3,axisLabelFontSize:14,rightGap:5,showRoller:!1,xValueParser:void 0,delimiter:",",sigma:2,errorBars:!1,fractions:!1,wilsonInterval:!0,customBars:!1,fillGraph:!1,fillAlpha:.15,connectSeparatedPoints:!1,stackedGraph:!1,stackedGraphNaNFill:"all",hideOverlayOnMouseOut:!0,legend:"onmouseover",stepPlot:!1,xRangePad:0,yRangePad:null,drawAxesAtZero:!1,titleHeight:28,xLabelHeight:18,yLabelWidth:18,axisLineColor:"black",axisLineWidth:.3,gridLineWidth:.3,axisLabelWidth:50,gridLineColor:"rgb(128,128,128)",interactionModel:j.default.defaultModel,animatedZooms:!1,showRangeSelector:!1,rangeSelectorHeight:40,rangeSelectorPlotStrokeColor:"#808FAB",rangeSelectorPlotFillGradientColor:"white",rangeSelectorPlotFillColor:"#A7B1C4",rangeSelectorBackgroundStrokeColor:"gray",rangeSelectorBackgroundLineWidth:1,rangeSelectorPlotLineWidth:1.5,rangeSelectorForegroundStrokeColor:"black",rangeSelectorForegroundLineWidth:1,rangeSelectorAlpha:.6,showInRangeSelector:null,plotter:[O.default._fillPlotter,O.default._errorPlotter,O.default._linePlotter],plugins:[],axes:{x:{pixelsPerLabel:70,axisLabelWidth:60,axisLabelFormatter:X.dateAxisLabelFormatter,valueFormatter:X.dateValueFormatter,drawGrid:!0,drawAxis:!0,independentTicks:!0,ticker:D.dateTicker},y:{axisLabelWidth:50,pixelsPerLabel:30,valueFormatter:X.numberValueFormatter,axisLabelFormatter:X.numberAxisLabelFormatter,drawGrid:!0,drawAxis:!0,independentTicks:!0,ticker:D.numericTicks},y2:{axisLabelWidth:50,pixelsPerLabel:30,valueFormatter:X.numberValueFormatter,axisLabelFormatter:X.numberAxisLabelFormatter,drawAxis:!0,drawGrid:!1,independentTicks:!1,ticker:D.numericTicks}}},Qe.exports=v.default},{"./dygraph-canvas":9,"./dygraph-interaction-model":12,"./dygraph-tickers":16,"./dygraph-utils":17}],11:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var D,ae=(D=Ae("./dygraph"))&&D.__esModule?D:{default:D},o=function(D){this.container=D};o.prototype.draw=function(D,N){this.container.innerHTML="",void 0!==this.date_graph&&this.date_graph.destroy(),this.date_graph=new ae.default(this.container,D,N)},o.prototype.setSelection=function(D){var N=!1;D.length&&(N=D[0].row),this.date_graph.setSelection(N)},o.prototype.getSelection=function(){var D=[],N=this.date_graph.getSelection();if(N<0)return D;for(var j=this.date_graph.layout_.points,k=0;k<j.length;++k)D.push({row:N,column:k+1});return D},v.default=o,Qe.exports=v.default},{"./dygraph":18}],12:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var ae=function(j){if(j&&j.__esModule)return j;var k={};if(null!=j)for(var O in j)Object.prototype.hasOwnProperty.call(j,O)&&(k[O]=j[O]);return k.default=j,k}(Ae("./dygraph-utils")),o={maybeTreatMouseOpAsClick:function(j,k,O){O.dragEndX=ae.dragGetX_(j,O),O.dragEndY=ae.dragGetY_(j,O);var I=Math.abs(O.dragEndX-O.dragStartX),X=Math.abs(O.dragEndY-O.dragStartY);I<2&&X<2&&void 0!==k.lastx_&&-1!=k.lastx_&&o.treatMouseOpAsClick(k,j,O),O.regionWidth=I,O.regionHeight=X},startPan:function(j,k,O){var I,X;O.isPanning=!0;var le=k.xAxisRange();if(k.getOptionForAxis("logscale","x")?(O.initialLeftmostDate=ae.log10(le[0]),O.dateRange=ae.log10(le[1])-ae.log10(le[0])):(O.initialLeftmostDate=le[0],O.dateRange=le[1]-le[0]),O.xUnitsPerPixel=O.dateRange/(k.plotter_.area.w-1),k.getNumericOption("panEdgeFraction")){var te=k.width_*k.getNumericOption("panEdgeFraction"),Be=k.xAxisExtremes(),Ie=k.toDomXCoord(Be[0])-te,Se=k.toDomXCoord(Be[1])+te,Ke=k.toDataXCoord(Ie),ne=k.toDataXCoord(Se);O.boundedDates=[Ke,ne];var mt=[],C=k.height_*k.getNumericOption("panEdgeFraction");for(I=0;I<k.axes_.length;I++){var wt=(X=k.axes_[I]).extremeRange,xt=k.toDomYCoord(wt[0],I)+C,Wt=k.toDomYCoord(wt[1],I)-C,Nt=k.toDataYCoord(xt,I),fi=k.toDataYCoord(Wt,I);mt[I]=[Nt,fi]}O.boundedValues=mt}for(O.is2DPan=!1,O.axes=[],I=0;I<k.axes_.length;I++){X=k.axes_[I];var $t={},li=k.yAxisRange(I);k.attributes_.getForAxis("logscale",I)?($t.initialTopValue=ae.log10(li[1]),$t.dragValueRange=ae.log10(li[1])-ae.log10(li[0])):($t.initialTopValue=li[1],$t.dragValueRange=li[1]-li[0]),$t.unitsPerPixel=$t.dragValueRange/(k.plotter_.area.h-1),O.axes.push($t),X.valueRange&&(O.is2DPan=!0)}},movePan:function(j,k,O){O.dragEndX=ae.dragGetX_(j,O),O.dragEndY=ae.dragGetY_(j,O);var I=O.initialLeftmostDate-(O.dragEndX-O.dragStartX)*O.xUnitsPerPixel;O.boundedDates&&(I=Math.max(I,O.boundedDates[0]));var X=I+O.dateRange;if(O.boundedDates&&X>O.boundedDates[1]&&(X=(I-=X-O.boundedDates[1])+O.dateRange),k.dateWindow_=k.getOptionForAxis("logscale","x")?[Math.pow(ae.LOG_SCALE,I),Math.pow(ae.LOG_SCALE,X)]:[I,X],O.is2DPan)for(var le=O.dragEndY-O.dragStartY,te=0;te<k.axes_.length;te++){var Be=k.axes_[te],Ie=O.axes[te],Ke=O.boundedValues?O.boundedValues[te]:null,ne=Ie.initialTopValue+le*Ie.unitsPerPixel;Ke&&(ne=Math.min(ne,Ke[1]));var mt=ne-Ie.dragValueRange;Ke&&mt<Ke[0]&&(mt=(ne-=mt-Ke[0])-Ie.dragValueRange),Be.valueRange=k.attributes_.getForAxis("logscale",te)?[Math.pow(ae.LOG_SCALE,mt),Math.pow(ae.LOG_SCALE,ne)]:[mt,ne]}k.drawGraph_(!1)}};o.endPan=o.maybeTreatMouseOpAsClick,o.startZoom=function(j,k,O){O.isZooming=!0,O.zoomMoved=!1},o.moveZoom=function(j,k,O){O.zoomMoved=!0,O.dragEndX=ae.dragGetX_(j,O),O.dragEndY=ae.dragGetY_(j,O);var I=Math.abs(O.dragStartX-O.dragEndX),X=Math.abs(O.dragStartY-O.dragEndY);O.dragDirection=I<X/2?ae.VERTICAL:ae.HORIZONTAL,k.drawZoomRect_(O.dragDirection,O.dragStartX,O.dragEndX,O.dragStartY,O.dragEndY,O.prevDragDirection,O.prevEndX,O.prevEndY),O.prevEndX=O.dragEndX,O.prevEndY=O.dragEndY,O.prevDragDirection=O.dragDirection},o.treatMouseOpAsClick=function(j,k,O){for(var I=j.getFunctionOption("clickCallback"),X=j.getFunctionOption("pointClickCallback"),le=null,te=-1,Be=Number.MAX_VALUE,Ie=0;Ie<j.selPoints_.length;Ie++){var Se=j.selPoints_[Ie],Ke=Math.pow(Se.canvasx-O.dragEndX,2)+Math.pow(Se.canvasy-O.dragEndY,2);!isNaN(Ke)&&(-1==te||Ke<Be)&&(Be=Ke,te=Ie)}var ne=j.getNumericOption("highlightCircleSize")+2;if(Be<=ne*ne&&(le=j.selPoints_[te]),le){if(j.cascadeEvents_("pointClick",{cancelable:!0,point:le,canvasx:O.dragEndX,canvasy:O.dragEndY}))return;X&&X.call(j,k,le)}j.cascadeEvents_("click",{cancelable:!0,xval:j.lastx_,pts:j.selPoints_,canvasx:O.dragEndX,canvasy:O.dragEndY})||I&&I.call(j,k,j.lastx_,j.selPoints_)},o.endZoom=function(j,k,O){k.clearZoomRect_(),O.isZooming=!1,o.maybeTreatMouseOpAsClick(j,k,O);var I=k.getArea();if(O.regionWidth>=10&&O.dragDirection==ae.HORIZONTAL){var X=Math.min(O.dragStartX,O.dragEndX),le=Math.max(O.dragStartX,O.dragEndX);(X=Math.max(X,I.x))<(le=Math.min(le,I.x+I.w))&&k.doZoomX_(X,le),O.cancelNextDblclick=!0}else if(O.regionHeight>=10&&O.dragDirection==ae.VERTICAL){var te=Math.min(O.dragStartY,O.dragEndY),Be=Math.max(O.dragStartY,O.dragEndY);(te=Math.max(te,I.y))<(Be=Math.min(Be,I.y+I.h))&&k.doZoomY_(te,Be),O.cancelNextDblclick=!0}O.dragStartX=null,O.dragStartY=null},o.startTouch=function(j,k,O){j.preventDefault(),j.touches.length>1&&(O.startTimeForDoubleTapMs=null);for(var I=[],X=0;X<j.touches.length;X++){var le=j.touches[X];I.push({pageX:le.pageX,pageY:le.pageY,dataX:k.toDataXCoord(le.pageX),dataY:k.toDataYCoord(le.pageY)})}if(O.initialTouches=I,1==I.length)O.initialPinchCenter=I[0],O.touchDirections={x:!0,y:!0};else if(I.length>=2){O.initialPinchCenter={pageX:.5*(I[0].pageX+I[1].pageX),pageY:.5*(I[0].pageY+I[1].pageY),dataX:.5*(I[0].dataX+I[1].dataX),dataY:.5*(I[0].dataY+I[1].dataY)};var te=180/Math.PI*Math.atan2(O.initialPinchCenter.pageY-I[0].pageY,I[0].pageX-O.initialPinchCenter.pageX);(te=Math.abs(te))>90&&(te=90-te),O.touchDirections={x:te<67.5,y:te>22.5}}O.initialRange={x:k.xAxisRange(),y:k.yAxisRange()}},o.moveTouch=function(j,k,O){O.startTimeForDoubleTapMs=null;var I,X=[];for(I=0;I<j.touches.length;I++){var le=j.touches[I];X.push({pageX:le.pageX,pageY:le.pageY})}var te,mt,C,Be=O.initialTouches,Ie=O.initialPinchCenter,Se={pageX:(te=1==X.length?X[0]:{pageX:.5*(X[0].pageX+X[1].pageX),pageY:.5*(X[0].pageY+X[1].pageY)}).pageX-Ie.pageX,pageY:te.pageY-Ie.pageY},ne=O.initialRange.y[0]-O.initialRange.y[1];Se.dataX=Se.pageX/k.plotter_.area.w*(O.initialRange.x[1]-O.initialRange.x[0]),Se.dataY=Se.pageY/k.plotter_.area.h*ne,1==X.length?(mt=1,C=1):X.length>=2&&(mt=(X[1].pageX-te.pageX)/(Be[1].pageX-Ie.pageX),C=(X[1].pageY-te.pageY)/(Be[1].pageY-Ie.pageY)),mt=Math.min(8,Math.max(.125,mt)),C=Math.min(8,Math.max(.125,C));var Wt=!1;if(O.touchDirections.x&&(k.dateWindow_=[Ie.dataX-Se.dataX+(O.initialRange.x[0]-Ie.dataX)/mt,Ie.dataX-Se.dataX+(O.initialRange.x[1]-Ie.dataX)/mt],Wt=!0),O.touchDirections.y)for(I=0;I<1;I++){var Nt=k.axes_[I];k.attributes_.getForAxis("logscale",I)||(Nt.valueRange=[Ie.dataY-Se.dataY+(O.initialRange.y[0]-Ie.dataY)/C,Ie.dataY-Se.dataY+(O.initialRange.y[1]-Ie.dataY)/C],Wt=!0)}if(k.drawGraph_(!1),Wt&&X.length>1&&k.getFunctionOption("zoomCallback")){var $t=k.xAxisRange();k.getFunctionOption("zoomCallback").call(k,$t[0],$t[1],k.yAxisRanges())}},o.endTouch=function(j,k,O){if(0!==j.touches.length)o.startTouch(j,k,O);else if(1==j.changedTouches.length){var I=(new Date).getTime(),X=j.changedTouches[0];O.startTimeForDoubleTapMs&&I-O.startTimeForDoubleTapMs<500&&O.doubleTapX&&Math.abs(O.doubleTapX-X.screenX)<50&&O.doubleTapY&&Math.abs(O.doubleTapY-X.screenY)<50?k.resetZoom():(O.startTimeForDoubleTapMs=I,O.doubleTapX=X.screenX,O.doubleTapY=X.screenY)}};var D=function(j,k,O){return j<k?k-j:j>O?j-O:0};o.defaultModel={mousedown:function(j,k,O){if(!j.button||2!=j.button){O.initializeMouseDown(j,k,O),j.altKey||j.shiftKey?o.startPan(j,k,O):o.startZoom(j,k,O);var I=function(le){O.isZooming?function(j,k){var O=ae.findPos(k.canvas_),I={left:O.x,right:O.x+k.canvas_.offsetWidth,top:O.y,bottom:O.y+k.canvas_.offsetHeight},X={x:ae.pageX(j),y:ae.pageY(j)},le=D(X.x,I.left,I.right),te=D(X.y,I.top,I.bottom);return Math.max(le,te)}(le,k)<100?o.moveZoom(le,k,O):null!==O.dragEndX&&(O.dragEndX=null,O.dragEndY=null,k.clearZoomRect_()):O.isPanning&&o.movePan(le,k,O)};k.addAndTrackEvent(document,"mousemove",I),k.addAndTrackEvent(document,"mouseup",function le(te){O.isZooming?null!==O.dragEndX?o.endZoom(te,k,O):o.maybeTreatMouseOpAsClick(te,k,O):O.isPanning&&o.endPan(te,k,O),ae.removeEvent(document,"mousemove",I),ae.removeEvent(document,"mouseup",le),O.destroy()})}},willDestroyContextMyself:!0,touchstart:function(j,k,O){o.startTouch(j,k,O)},touchmove:function(j,k,O){o.moveTouch(j,k,O)},touchend:function(j,k,O){o.endTouch(j,k,O)},dblclick:function(j,k,O){O.cancelNextDblclick?O.cancelNextDblclick=!1:k.cascadeEvents_("dblclick",{canvasx:O.dragEndX,canvasy:O.dragEndY,cancelable:!0})||j.altKey||j.shiftKey||k.resetZoom()}},o.nonInteractiveModel_={mousedown:function(j,k,O){O.initializeMouseDown(j,k,O)},mouseup:o.maybeTreatMouseOpAsClick},o.dragIsPanInteractionModel={mousedown:function(j,k,O){O.initializeMouseDown(j,k,O),o.startPan(j,k,O)},mousemove:function(j,k,O){O.isPanning&&o.movePan(j,k,O)},mouseup:function(j,k,O){O.isPanning&&o.endPan(j,k,O)}},v.default=o,Qe.exports=v.default},{"./dygraph-utils":17}],13:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var ae=function(D){if(D&&D.__esModule)return D;var N={};if(null!=D)for(var j in D)Object.prototype.hasOwnProperty.call(D,j)&&(N[j]=D[j]);return N.default=D,N}(Ae("./dygraph-utils")),o=function(D){this.dygraph_=D,this.points=[],this.setNames=[],this.annotations=[],this.yAxes_=null,this.xTicks_=null,this.yTicks_=null};o.prototype.addDataset=function(D,N){this.points.push(N),this.setNames.push(D)},o.prototype.getPlotArea=function(){return this.area_},o.prototype.computePlotArea=function(){var D={x:0,y:0};D.w=this.dygraph_.width_-D.x-this.dygraph_.getOption("rightGap"),D.h=this.dygraph_.height_,this.dygraph_.cascadeEvents_("layout",{chart_div:this.dygraph_.graphDiv,reserveSpaceLeft:function(j){var k={x:D.x,y:D.y,w:j,h:D.h};return D.x+=j,D.w-=j,k},reserveSpaceRight:function(j){var k={x:D.x+D.w-j,y:D.y,w:j,h:D.h};return D.w-=j,k},reserveSpaceTop:function(j){var k={x:D.x,y:D.y,w:D.w,h:j};return D.y+=j,D.h-=j,k},reserveSpaceBottom:function(j){var k={x:D.x,y:D.y+D.h-j,w:D.w,h:j};return D.h-=j,k},chartRect:function(){return{x:D.x,y:D.y,w:D.w,h:D.h}}}),this.area_=D},o.prototype.setAnnotations=function(D){this.annotations=[];for(var N=this.dygraph_.getOption("xValueParser")||function(O){return O},j=0;j<D.length;j++){var k={};if(!D[j].xval&&void 0===D[j].x)return void console.error("Annotations must have an 'x' property");if(D[j].icon&&(!D[j].hasOwnProperty("width")||!D[j].hasOwnProperty("height")))return void console.error("Must set width and height when setting annotation.icon property");ae.update(k,D[j]),k.xval||(k.xval=N(k.x)),this.annotations.push(k)}},o.prototype.setXTicks=function(D){this.xTicks_=D},o.prototype.setYAxes=function(D){this.yAxes_=D},o.prototype.evaluate=function(){this._xAxis={},this._evaluateLimits(),this._evaluateLineCharts(),this._evaluateLineTicks(),this._evaluateAnnotations()},o.prototype._evaluateLimits=function(){var D=this.dygraph_.xAxisRange();this._xAxis.minval=D[0],this._xAxis.maxval=D[1];var N=D[1]-D[0];this._xAxis.scale=0!==N?1/N:1,this.dygraph_.getOptionForAxis("logscale","x")&&(this._xAxis.xlogrange=ae.log10(this._xAxis.maxval)-ae.log10(this._xAxis.minval),this._xAxis.xlogscale=0!==this._xAxis.xlogrange?1/this._xAxis.xlogrange:1);for(var j=0;j<this.yAxes_.length;j++){var k=this.yAxes_[j];k.minyval=k.computedValueRange[0],k.maxyval=k.computedValueRange[1],k.yrange=k.maxyval-k.minyval,k.yscale=0!==k.yrange?1/k.yrange:1,this.dygraph_.getOption("logscale")&&(k.ylogrange=ae.log10(k.maxyval)-ae.log10(k.minyval),k.ylogscale=0!==k.ylogrange?1/k.ylogrange:1,isFinite(k.ylogrange)&&!isNaN(k.ylogrange)||console.error("axis "+j+" of graph at "+k.g+" can't be displayed in log scale for range ["+k.minyval+" - "+k.maxyval+"]"))}},o.calcXNormal_=function(D,N,j){return j?(ae.log10(D)-ae.log10(N.minval))*N.xlogscale:(D-N.minval)*N.scale},o.calcYNormal_=function(D,N,j){if(j){var k=1-(ae.log10(N)-ae.log10(D.minyval))*D.ylogscale;return isFinite(k)?k:NaN}return 1-(N-D.minyval)*D.yscale},o.prototype._evaluateLineCharts=function(){for(var D=this.dygraph_.getOption("stackedGraph"),N=this.dygraph_.getOptionForAxis("logscale","x"),j=0;j<this.points.length;j++){for(var k=this.points[j],O=this.setNames[j],I=this.dygraph_.getOption("connectSeparatedPoints",O),X=this.dygraph_.axisPropertiesForSeries(O),le=this.dygraph_.attributes_.getForSeries("logscale",O),te=0;te<k.length;te++){var Be=k[te];Be.x=o.calcXNormal_(Be.xval,this._xAxis,N);var Ie=Be.yval;D&&(Be.y_stacked=o.calcYNormal_(X,Be.yval_stacked,le),null===Ie||isNaN(Ie)||(Ie=Be.yval_stacked)),null===Ie&&(Ie=NaN,I||(Be.yval=NaN)),Be.y=o.calcYNormal_(X,Ie,le)}this.dygraph_.dataHandler_.onLineEvaluated(k,X,le)}},o.prototype._evaluateLineTicks=function(){var D,N,j,k,I;for(this.xticks=[],D=0;D<this.xTicks_.length;D++)j=(N=this.xTicks_[D]).label,(k=this.dygraph_.toPercentXCoord((I=!("label_v"in N))?N.v:N.label_v))>=0&&k<1&&this.xticks.push({pos:k,label:j,has_tick:I});for(this.yticks=[],D=0;D<this.yAxes_.length;D++)for(var X=this.yAxes_[D],le=0;le<X.ticks.length;le++)j=(N=X.ticks[le]).label,(k=this.dygraph_.toPercentYCoord((I=!("label_v"in N))?N.v:N.label_v,D))>0&&k<=1&&this.yticks.push({axis:D,pos:k,label:j,has_tick:I})},o.prototype._evaluateAnnotations=function(){var D,N={};for(D=0;D<this.annotations.length;D++){var j=this.annotations[D];N[j.xval+","+j.series]=j}if(this.annotated_points=[],this.annotations&&this.annotations.length)for(var k=0;k<this.points.length;k++){var O=this.points[k];for(D=0;D<O.length;D++){var I=O[D],X=I.xval+","+I.name;X in N&&(I.annotation=N[X],this.annotated_points.push(I))}}},o.prototype.removeAllDatasets=function(){delete this.points,delete this.setNames,delete this.setPointsLengths,delete this.setPointsOffsets,this.points=[],this.setNames=[],this.setPointsLengths=[],this.setPointsOffsets=[]},v.default=o,Qe.exports=v.default},{"./dygraph-utils":17}],14:[function(Ae,Qe,v){(function($){"use strict";Object.defineProperty(v,"__esModule",{value:!0}),v.default=null,Qe.exports=v.default}).call(this,Ae("_process"))},{_process:1}],15:[function(Ae,Qe,v){(function($){"use strict";function ae(I){return I&&I.__esModule?I:{default:I}}Object.defineProperty(v,"__esModule",{value:!0});var D=function(I){if(I&&I.__esModule)return I;var X={};if(null!=I)for(var le in I)Object.prototype.hasOwnProperty.call(I,le)&&(X[le]=I[le]);return X.default=I,X}(Ae("./dygraph-utils")),j=ae(Ae("./dygraph-default-attrs")),O=(ae(Ae("./dygraph-options-reference")),function(I){this.dygraph_=I,this.yAxes_=[],this.xAxis_={},this.series_={},this.global_=this.dygraph_.attrs_,this.user_=this.dygraph_.user_attrs_||{},this.labels_=[],this.highlightSeries_=this.get("highlightSeriesOpts")||{},this.reparseSeries()});O.AXIS_STRING_MAPPINGS_={y:0,Y:0,y1:0,Y1:0,y2:1,Y2:1},O.axisToIndex_=function(I){if("string"==typeof I){if(O.AXIS_STRING_MAPPINGS_.hasOwnProperty(I))return O.AXIS_STRING_MAPPINGS_[I];throw"Unknown axis : "+I}if("number"==typeof I){if(0===I||1===I)return I;throw"Dygraphs only supports two y-axes, indexed from 0-1."}if(I)throw"Unknown axis : "+I;return 0},O.prototype.reparseSeries=function(){var I=this.get("labels");if(I){this.labels_=I.slice(1),this.yAxes_=[{series:[],options:{}}],this.xAxis_={options:{}},this.series_={};for(var X=this.user_.series||{},le=0;le<this.labels_.length;le++){var te=this.labels_[le],Be=X[te]||{},Ie=O.axisToIndex_(Be.axis);this.series_[te]={idx:le,yAxis:Ie,options:Be},this.yAxes_[Ie]?this.yAxes_[Ie].series.push(te):this.yAxes_[Ie]={series:[te],options:{}}}var Se=this.user_.axes||{};D.update(this.yAxes_[0].options,Se.y||{}),this.yAxes_.length>1&&D.update(this.yAxes_[1].options,Se.y2||{}),D.update(this.xAxis_.options,Se.x||{})}},O.prototype.get=function(I){var X=this.getGlobalUser_(I);return null!==X?X:this.getGlobalDefault_(I)},O.prototype.getGlobalUser_=function(I){return this.user_.hasOwnProperty(I)?this.user_[I]:null},O.prototype.getGlobalDefault_=function(I){return this.global_.hasOwnProperty(I)?this.global_[I]:j.default.hasOwnProperty(I)?j.default[I]:null},O.prototype.getForAxis=function(I,X){var le,te;if("number"==typeof X)te=0===(le=X)?"y":"y2";else{if("y1"==X&&(X="y"),"y"==X)le=0;else if("y2"==X)le=1;else{if("x"!=X)throw"Unknown axis "+X;le=-1}te=X}var Be=-1==le?this.xAxis_:this.yAxes_[le];if(Be){var Ie=Be.options;if(Ie.hasOwnProperty(I))return Ie[I]}if("x"!==X||"logscale"!==I){var Se=this.getGlobalUser_(I);if(null!==Se)return Se}var Ke=j.default.axes[te];return Ke.hasOwnProperty(I)?Ke[I]:this.getGlobalDefault_(I)},O.prototype.getForSeries=function(I,X){if(X===this.dygraph_.getHighlightSeries()&&this.highlightSeries_.hasOwnProperty(I))return this.highlightSeries_[I];if(!this.series_.hasOwnProperty(X))throw"Unknown series: "+X;var le=this.series_[X],te=le.options;return te.hasOwnProperty(I)?te[I]:this.getForAxis(I,le.yAxis)},O.prototype.numAxes=function(){return this.yAxes_.length},O.prototype.axisForSeries=function(I){return this.series_[I].yAxis},O.prototype.axisOptions=function(I){return this.yAxes_[I].options},O.prototype.seriesForAxis=function(I){return this.yAxes_[I].series},O.prototype.seriesNames=function(){return this.labels_},v.default=O,Qe.exports=v.default}).call(this,Ae("_process"))},{"./dygraph-default-attrs":10,"./dygraph-options-reference":14,"./dygraph-utils":17,_process:1}],16:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var ae=function(Be){if(Be&&Be.__esModule)return Be;var Ie={};if(null!=Be)for(var Se in Be)Object.prototype.hasOwnProperty.call(Be,Se)&&(Ie[Se]=Be[Se]);return Ie.default=Be,Ie}(Ae("./dygraph-utils"));v.numericLinearTicks=function(Be,Ie,Se,Ke,ne,mt){return D(Be,Ie,Se,function(C){return"logscale"!==C&&Ke(C)},ne,mt)};var D=function(Be,Ie,Se,Ke,ne,mt){var C,wt,Wt,Nt=Ke("pixelsPerLabel"),fi=[];if(mt)for(C=0;C<mt.length;C++)fi.push({v:mt[C]});else{if(Ke("logscale")){Wt=Math.floor(Se/Nt);var $t=ae.binarySearch(Be,I,1),li=ae.binarySearch(Ie,I,-1);-1==$t&&($t=0),-1==li&&(li=I.length-1);var qt=null;if(li-$t>=Wt/4){for(var Ri=li;Ri>=$t;Ri--){var Bi=I[Ri],mi=Math.log(Bi/Be)/Math.log(Ie/Be)*Se,tn={v:Bi};null===qt||Math.abs(mi-qt.pixel_coord)>=Nt?qt={tickValue:Bi,pixel_coord:mi}:tn.label="",fi.push(tn)}fi.reverse()}}if(0===fi.length){var Pt,wi;Ke("labelsKMG2")?(Pt=[1,2,4,8,16,32,64,128,256],wi=16):(Pt=[1,2,5,10,20,50,100],wi=10);var pt,Si,mn,Bn=Math.ceil(Se/Nt),yn=Math.abs(Ie-Be)/Bn,En=Math.floor(Math.log(yn)/Math.log(wi)),Jn=Math.pow(wi,En);for(wt=0;wt<Pt.length&&(pt=Jn*Pt[wt],Si=Math.floor(Be/pt)*pt,mn=Math.ceil(Ie/pt)*pt,!(Se/(Wt=Math.abs(mn-Si)/pt)>Nt));wt++);for(Si>mn&&(pt*=-1),C=0;C<=Wt;C++)fi.push({v:Si+C*pt})}}var vn=Ke("axisLabelFormatter");for(C=0;C<fi.length;C++)void 0===fi[C].label&&(fi[C].label=vn.call(ne,fi[C].v,0,Ke,ne));return fi};v.numericTicks=D,v.dateTicker=function(Be,Ie,Se,Ke,ne,mt){var C=X(Be,Ie,Se,Ke);return C>=0?te(Be,Ie,C,Ke,ne):[]};var j={MILLISECONDLY:0,TWO_MILLISECONDLY:1,FIVE_MILLISECONDLY:2,TEN_MILLISECONDLY:3,FIFTY_MILLISECONDLY:4,HUNDRED_MILLISECONDLY:5,FIVE_HUNDRED_MILLISECONDLY:6,SECONDLY:7,TWO_SECONDLY:8,FIVE_SECONDLY:9,TEN_SECONDLY:10,THIRTY_SECONDLY:11,MINUTELY:12,TWO_MINUTELY:13,FIVE_MINUTELY:14,TEN_MINUTELY:15,THIRTY_MINUTELY:16,HOURLY:17,TWO_HOURLY:18,SIX_HOURLY:19,DAILY:20,TWO_DAILY:21,WEEKLY:22,MONTHLY:23,QUARTERLY:24,BIANNUAL:25,ANNUAL:26,DECADAL:27,CENTENNIAL:28,NUM_GRANULARITIES:29};v.Granularity=j;var O=[];O[j.MILLISECONDLY]={datefield:6,step:1,spacing:1},O[j.TWO_MILLISECONDLY]={datefield:6,step:2,spacing:2},O[j.FIVE_MILLISECONDLY]={datefield:6,step:5,spacing:5},O[j.TEN_MILLISECONDLY]={datefield:6,step:10,spacing:10},O[j.FIFTY_MILLISECONDLY]={datefield:6,step:50,spacing:50},O[j.HUNDRED_MILLISECONDLY]={datefield:6,step:100,spacing:100},O[j.FIVE_HUNDRED_MILLISECONDLY]={datefield:6,step:500,spacing:500},O[j.SECONDLY]={datefield:5,step:1,spacing:1e3},O[j.TWO_SECONDLY]={datefield:5,step:2,spacing:2e3},O[j.FIVE_SECONDLY]={datefield:5,step:5,spacing:5e3},O[j.TEN_SECONDLY]={datefield:5,step:10,spacing:1e4},O[j.THIRTY_SECONDLY]={datefield:5,step:30,spacing:3e4},O[j.MINUTELY]={datefield:4,step:1,spacing:6e4},O[j.TWO_MINUTELY]={datefield:4,step:2,spacing:12e4},O[j.FIVE_MINUTELY]={datefield:4,step:5,spacing:3e5},O[j.TEN_MINUTELY]={datefield:4,step:10,spacing:6e5},O[j.THIRTY_MINUTELY]={datefield:4,step:30,spacing:18e5},O[j.HOURLY]={datefield:3,step:1,spacing:36e5},O[j.TWO_HOURLY]={datefield:3,step:2,spacing:72e5},O[j.SIX_HOURLY]={datefield:3,step:6,spacing:216e5},O[j.DAILY]={datefield:2,step:1,spacing:864e5},O[j.TWO_DAILY]={datefield:2,step:2,spacing:1728e5},O[j.WEEKLY]={datefield:2,step:7,spacing:6048e5},O[j.MONTHLY]={datefield:1,step:1,spacing:2629817280},O[j.QUARTERLY]={datefield:1,step:3,spacing:7889451840.000001},O[j.BIANNUAL]={datefield:1,step:6,spacing:432e5*365.2524},O[j.ANNUAL]={datefield:0,step:1,spacing:864e5*365.2524},O[j.DECADAL]={datefield:0,step:10,spacing:315578073600},O[j.CENTENNIAL]={datefield:0,step:100,spacing:3155780736e3};var I=function(){for(var Be=[],Ie=-39;Ie<=39;Ie++)for(var Se=Math.pow(10,Ie),Ke=1;Ke<=9;Ke++)Be.push(Se*Ke);return Be}(),X=function(Be,Ie,Se,Ke){for(var ne=Ke("pixelsPerLabel"),mt=0;mt<j.NUM_GRANULARITIES;mt++)if(Se/le(Be,Ie,mt)>=ne)return mt;return-1},le=function(Be,Ie,Se){return Math.round(1*(Ie-Be)/O[Se].spacing)},te=function(Be,Ie,Se,Ke,ne){var mt=Ke("axisLabelFormatter"),wt=Ke("labelsUTC")?ae.DateAccessorsUTC:ae.DateAccessorsLocal,xt=O[Se].datefield,Wt=O[Se].step,Nt=O[Se].spacing,fi=new Date(Be),$t=[];$t[0]=wt.getFullYear(fi),$t[1]=wt.getMonth(fi),$t[2]=wt.getDate(fi),$t[3]=wt.getHours(fi),$t[4]=wt.getMinutes(fi),$t[5]=wt.getSeconds(fi),$t[6]=wt.getMilliseconds(fi);var li=$t[xt]%Wt;Se==j.WEEKLY&&(li=wt.getDay(fi)),$t[xt]-=li;for(var qt=xt+1;qt<7;qt++)$t[qt]=2===qt?1:0;var Ri=[],Bi=wt.makeDate.apply(null,$t),mi=Bi.getTime();if(Se<=j.HOURLY)for(mi<Be&&(mi+=Nt,Bi=new Date(mi));mi<=Ie;)Ri.push({v:mi,label:mt.call(ne,Bi,Se,Ke,ne)}),mi+=Nt,Bi=new Date(mi);else for(mi<Be&&($t[xt]+=Wt,mi=(Bi=wt.makeDate.apply(null,$t)).getTime());mi<=Ie;)(Se>=j.DAILY||wt.getHours(Bi)%Wt==0)&&Ri.push({v:mi,label:mt.call(ne,Bi,Se,Ke,ne)}),$t[xt]+=Wt,mi=(Bi=wt.makeDate.apply(null,$t)).getTime();return Ri};v.getDateAxis=te},{"./dygraph-utils":17}],17:[function(Ae,Qe,v){"use strict";function N(ve){return!ve.pageX||ve.pageX<0?0:ve.pageX}function j(ve){return!ve.pageY||ve.pageY<0?0:ve.pageY}function le(ve,Ce){var We=Math.min(Math.max(1,Ce||2),21);return Math.abs(ve)<.001&&0!==ve?ve.toExponential(We-1):ve.toPrecision(We)}function te(ve){return ve<10?"0"+ve:""+ve}function Be(ve,Ce,We,vt){var Bt=te(ve)+":"+te(Ce);if(We&&(Bt+=":"+te(We),vt)){var Xt=""+vt;Bt+="."+("000"+Xt).substring(Xt.length)}return Bt}function Ie(ve,Ce){var We=Ce?oe:ue,vt=new Date(ve),Bt=We.getFullYear(vt),Xt=We.getMonth(vt),si=We.getDate(vt),W=We.getHours(vt),ye=We.getMinutes(vt),Me=We.getSeconds(vt),qe=We.getMilliseconds(vt),ti=Bt+"/"+te(Xt+1)+"/"+te(si);return 3600*W+60*ye+Me+.001*qe&&(ti+=" "+Be(W,ye,Me,qe)),ti}function Se(ve,Ce){var We=Math.pow(10,Ce);return Math.round(ve*We)/We}function mt(ve){return new Date(ve).getTime()}function xt(ve){var Ce=typeof ve;return("object"==Ce||"function"==Ce&&"function"==typeof ve.item)&&null!==ve&&"number"==typeof ve.length&&3!==ve.nodeType}function li(ve,Ce,We,vt){Ce=Ce||0,We=We||ve.length,this.hasNext=!0,this.peek=null,this.start_=Ce,this.array_=ve,this.predicate_=vt,this.end_=Math.min(ve.length,Ce+We),this.nextIdx_=Ce-1,this.next()}function Pt(ve,Ce){return Ce<0?1/Math.pow(ve,-Ce):Math.pow(ve,Ce)}function wi(ve){var Ce=Rt.exec(ve);if(!Ce)return null;var We=parseInt(Ce[1],10),vt=parseInt(Ce[2],10),Bt=parseInt(Ce[3],10);return Ce[4]?{r:We,g:vt,b:Bt,a:parseFloat(Ce[4])}:{r:We,g:vt,b:Bt}}function mn(ve,Ce){var We=Ce("sigFigs");if(null!==We)return le(ve,We);var vt,Bt=Ce("digitsAfterDecimal"),Xt=Ce("maxNumberWidth"),si=Ce("labelsKMB"),W=Ce("labelsKMG2");if(vt=0!==ve&&(Math.abs(ve)>=Math.pow(10,Xt)||Math.abs(ve)<Math.pow(10,-Bt))?ve.toExponential(Bt):""+Se(ve,Bt),si||W){var ye,Me=[],qe=[];si&&(ye=1e3,Me=Mt),W&&(si&&console.warn("Setting both labelsKMB and labelsKMG2. Pick one!"),ye=1024,Me=jt,qe=Lt);for(var gt=Math.abs(ve),_t=Pt(ye,Me.length),ft=Me.length-1;ft>=0;ft--,_t/=ye)if(gt>=_t){vt=Se(ve/_t,Bt)+Me[ft];break}if(W){var Ut=String(ve.toExponential()).split("e-");2===Ut.length&&Ut[1]>=3&&Ut[1]<=24&&(vt=Ut[1]%3>0?Se(Ut[0]/Pt(10,Ut[1]%3),Bt):Number(Ut[0]).toFixed(2),vt+=qe[Math.floor(Ut[1]/3)-1])}}return vt}Object.defineProperty(v,"__esModule",{value:!0}),v.removeEvent=function $(ve,Ce,We){ve.removeEventListener(Ce,We,!1)},v.cancelEvent=function ae(ve){return(ve=ve||window.event).stopPropagation&&ve.stopPropagation(),ve.preventDefault&&ve.preventDefault(),ve.cancelBubble=!0,ve.cancel=!0,ve.returnValue=!1,!1},v.hsvToRGB=function o(ve,Ce,We){var vt,Bt,Xt;if(0===Ce)vt=We,Bt=We,Xt=We;else{var si=Math.floor(6*ve),W=6*ve-si,ye=We*(1-Ce),Me=We*(1-Ce*W),qe=We*(1-Ce*(1-W));switch(si){case 1:vt=Me,Bt=We,Xt=ye;break;case 2:vt=ye,Bt=We,Xt=qe;break;case 3:vt=ye,Bt=Me,Xt=We;break;case 4:vt=qe,Bt=ye,Xt=We;break;case 5:vt=We,Bt=ye,Xt=Me;break;case 6:case 0:vt=We,Bt=qe,Xt=ye}}return"rgb("+(vt=Math.floor(255*vt+.5))+","+(Bt=Math.floor(255*Bt+.5))+","+(Xt=Math.floor(255*Xt+.5))+")"},v.findPos=function D(ve){var Ce=ve.getBoundingClientRect(),We=window,vt=document.documentElement;return{x:Ce.left+(We.pageXOffset||vt.scrollLeft),y:Ce.top+(We.pageYOffset||vt.scrollTop)}},v.pageX=N,v.pageY=j,v.dragGetX_=function k(ve,Ce){return N(ve)-Ce.px},v.dragGetY_=function O(ve,Ce){return j(ve)-Ce.py},v.isOK=function I(ve){return!!ve&&!isNaN(ve)},v.isValidPoint=function X(ve,Ce){return!!ve&&null!==ve.yval&&null!=ve.x&&null!=ve.y&&!(isNaN(ve.x)||!Ce&&isNaN(ve.y))},v.floatFormat=le,v.zeropad=te,v.hmsString_=Be,v.dateString_=Ie,v.round_=Se,v.binarySearch=function Ke(ve,Ce,We,vt,Bt){for(var Xt=!0;Xt;){var si=ve,W=Ce,ye=We,Me=vt,qe=Bt;if(Xt=!1,null!=Me&&null!=qe||(Me=0,qe=W.length-1),Me>qe)return-1;null!=ye||(ye=0);var gt,_t=function(ti){return ti>=0&&ti<W.length},ft=parseInt((Me+qe)/2,10),Ut=W[ft];if(Ut==si)return ft;if(Ut>si){if(ye>0&&_t(gt=ft-1)&&W[gt]<si)return ft;ve=si,Ce=W,We=ye,vt=Me,Bt=ft-1,Xt=!0,_t=ft=Ut=gt=void 0}else{if(!(Ut<si))return-1;if(ye<0&&_t(gt=ft+1)&&W[gt]>si)return ft;ve=si,Ce=W,We=ye,vt=ft+1,Bt=qe,Xt=!0,_t=ft=Ut=gt=void 0}}},v.dateParser=function ne(ve){var Ce,We;if((-1==ve.search("-")||-1!=ve.search("T")||-1!=ve.search("Z"))&&(We=mt(ve))&&!isNaN(We))return We;if(-1!=ve.search("-")){for(Ce=ve.replace("-","/","g");-1!=Ce.search("-");)Ce=Ce.replace("-","/");We=mt(Ce)}else We=mt(8==ve.length?Ce=ve.substr(0,4)+"/"+ve.substr(4,2)+"/"+ve.substr(6,2):ve);return We&&!isNaN(We)||console.error("Couldn't parse "+ve+" as a date"),We},v.dateStrToMillis=mt,v.update=function C(ve,Ce){if(null!=Ce)for(var We in Ce)Ce.hasOwnProperty(We)&&(ve[We]=Ce[We]);return ve},v.updateDeep=function wt(ve,Ce){if(null!=Ce)for(var We in Ce)Ce.hasOwnProperty(We)&&(null===Ce[We]?ve[We]=null:xt(Ce[We])?ve[We]=Ce[We].slice():(vt=Ce[We],("object"==typeof Node?vt instanceof Node:"object"==typeof vt&&"number"==typeof vt.nodeType&&"string"==typeof vt.nodeName)||"object"!=typeof Ce[We]?ve[We]=Ce[We]:("object"==typeof ve[We]&&null!==ve[We]||(ve[We]={}),wt(ve[We],Ce[We]))));var vt;return ve},v.isArrayLike=xt,v.isDateLike=function Wt(ve){return"object"==typeof ve&&null!==ve&&"function"==typeof ve.getTime},v.clone=function Nt(ve){for(var Ce=[],We=0;We<ve.length;We++)xt(ve[We])?Ce.push(Nt(ve[We])):Ce.push(ve[We]);return Ce},v.createCanvas=function fi(){return document.createElement("canvas")},v.getContextPixelRatio=function $t(ve){try{var Ce=window.devicePixelRatio;return void 0!==Ce?Ce/(ve.webkitBackingStorePixelRatio||ve.mozBackingStorePixelRatio||ve.msBackingStorePixelRatio||ve.oBackingStorePixelRatio||ve.backingStorePixelRatio||1):1}catch{return 1}},v.Iterator=li,v.createIterator=function qt(ve,Ce,We,vt){return new li(ve,Ce,We,vt)},v.repeatAndCleanup=function Ri(ve,Ce,We,vt){var Bt,Xt=0,si=(new Date).getTime();if(ve(Xt),1!=Ce){var W=Ce-1;!function ye(){Xt>=Ce||$e.call(window,function(){var Me=(new Date).getTime();Bt=Xt;var gt=(Xt=Math.floor((Me-si)/We))-Bt;Xt+gt>W||Xt>=W?(ve(W),vt()):(0!==gt&&ve(Xt),ye())})}()}else vt()},v.isPixelChangingOptionList=function Bi(ve,Ce){var We={};if(ve)for(var vt=1;vt<ve.length;vt++)We[ve[vt]]=!0;var Bt=function(ye){for(var Me in ye)if(ye.hasOwnProperty(Me)&&!Ge[Me])return!0;return!1};for(var Xt in Ce)if(Ce.hasOwnProperty(Xt))if("highlightSeriesOpts"==Xt||We[Xt]&&!Ce.series){if(Bt(Ce[Xt]))return!0}else if("series"==Xt||"axes"==Xt){var si=Ce[Xt];for(var W in si)if(si.hasOwnProperty(W)&&Bt(si[W]))return!0}else if(!Ge[Xt])return!0;return!1},v.detectLineDelimiter=function mi(ve){for(var Ce=0;Ce<ve.length;Ce++){var We=ve.charAt(Ce);if("\r"===We)return Ce+1<ve.length&&"\n"===ve.charAt(Ce+1)?"\r\n":We;if("\n"===We)return Ce+1<ve.length&&"\r"===ve.charAt(Ce+1)?"\n\r":We}return null},v.isNodeContainedBy=function tn(ve,Ce){if(null===Ce||null===ve)return!1;for(var We=ve;We&&We!==Ce;)We=We.parentNode;return We===Ce},v.pow=Pt,v.toRGB_=function ji(ve){var Ce=wi(ve);if(Ce)return Ce;var We=document.createElement("div");We.style.backgroundColor=ve,We.style.visibility="hidden",document.body.appendChild(We);var vt=window.getComputedStyle(We,null).backgroundColor;return document.body.removeChild(We),wi(vt)},v.isCanvasSupported=function pt(ve){try{(ve||document.createElement("canvas")).getContext("2d")}catch{return!1}return!0},v.parseFloat_=function Si(ve,Ce,We){var vt=parseFloat(ve);if(!isNaN(vt))return vt;if(/^ *$/.test(ve))return null;if(/^ *nan *$/i.test(ve))return NaN;var Bt="Unable to parse '"+ve+"' as a number";return void 0!==We&&void 0!==Ce&&(Bt+=" on line "+(1+(Ce||0))+" ('"+We+"') of CSV."),console.error(Bt),null},v.numberValueFormatter=mn,v.numberAxisLabelFormatter=function Bn(ve,Ce,We){return mn.call(this,ve,We)},v.dateAxisLabelFormatter=function yn(ve,Ce,We){var Bt=We("labelsUTC")?oe:ue,Xt=Bt.getFullYear(ve),si=Bt.getMonth(ve),W=Bt.getDate(ve),ye=Bt.getHours(ve),Me=Bt.getMinutes(ve),qe=Bt.getSeconds(ve),gt=Bt.getMilliseconds(ve);if(Ce>=vn.Granularity.DECADAL)return""+Xt;if(Ce>=vn.Granularity.MONTHLY)return yi[si]+"&#160;"+Xt;if(3600*ye+60*Me+qe+.001*gt===0||Ce>=vn.Granularity.DAILY)return te(W)+"&#160;"+yi[si];if(Ce<vn.Granularity.SECONDLY){var _t=""+gt;return te(qe)+"."+("000"+_t).substring(_t.length)}return Be(ye,Me,qe,Ce>vn.Granularity.MINUTELY?0:gt)},v.dateValueFormatter=function En(ve,Ce){return Ie(ve,Ce("labelsUTC"))};var vn=function(ve){if(ve&&ve.__esModule)return ve;var Ce={};if(null!=ve)for(var We in ve)Object.prototype.hasOwnProperty.call(ve,We)&&(Ce[We]=ve[We]);return Ce.default=ve,Ce}(Ae("./dygraph-tickers"));v.LOG_SCALE=10;var Fn=Math.log(10);v.LN_TEN=Fn;var Ji=function(ve){return Math.log(ve)/Fn};v.log10=Ji,v.logRangeFraction=function(ve,Ce,We){var vt=Ji(ve),Bt=Ji(Ce);return Math.pow(10,vt+We*(Bt-vt))},v.DOTTED_LINE=[2,2],v.DASHED_LINE=[7,3],v.DOT_DASH_LINE=[7,2,2,2],v.HORIZONTAL=1,v.VERTICAL=2,v.getContext=function(ve){return ve.getContext("2d")},v.addEvent=function(ve,Ce,We){ve.addEventListener(Ce,We,!1)};var ue={getFullYear:function(ve){return ve.getFullYear()},getMonth:function(ve){return ve.getMonth()},getDate:function(ve){return ve.getDate()},getHours:function(ve){return ve.getHours()},getMinutes:function(ve){return ve.getMinutes()},getSeconds:function(ve){return ve.getSeconds()},getMilliseconds:function(ve){return ve.getMilliseconds()},getDay:function(ve){return ve.getDay()},makeDate:function(ve,Ce,We,vt,Bt,Xt,si){return new Date(ve,Ce,We,vt,Bt,Xt,si)}};v.DateAccessorsLocal=ue;var oe={getFullYear:function(ve){return ve.getUTCFullYear()},getMonth:function(ve){return ve.getUTCMonth()},getDate:function(ve){return ve.getUTCDate()},getHours:function(ve){return ve.getUTCHours()},getMinutes:function(ve){return ve.getUTCMinutes()},getSeconds:function(ve){return ve.getUTCSeconds()},getMilliseconds:function(ve){return ve.getUTCMilliseconds()},getDay:function(ve){return ve.getUTCDay()},makeDate:function(ve,Ce,We,vt,Bt,Xt,si){return new Date(Date.UTC(ve,Ce,We,vt,Bt,Xt,si))}};v.DateAccessorsUTC=oe,li.prototype.next=function(){if(!this.hasNext)return null;for(var ve=this.peek,Ce=this.nextIdx_+1,We=!1;Ce<this.end_;){if(!this.predicate_||this.predicate_(this.array_,Ce)){this.peek=this.array_[Ce],We=!0;break}Ce++}return this.nextIdx_=Ce,We||(this.hasNext=!1,this.peek=null),ve};var $e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(ve){window.setTimeout(ve,1e3/60)};v.requestAnimFrame=$e;var Ge={annotationClickHandler:!0,annotationDblClickHandler:!0,annotationMouseOutHandler:!0,annotationMouseOverHandler:!0,axisLineColor:!0,axisLineWidth:!0,clickCallback:!0,drawCallback:!0,drawHighlightPointCallback:!0,drawPoints:!0,drawPointCallback:!0,drawGrid:!0,fillAlpha:!0,gridLineColor:!0,gridLineWidth:!0,hideOverlayOnMouseOut:!0,highlightCallback:!0,highlightCircleSize:!0,interactionModel:!0,labelsDiv:!0,labelsKMB:!0,labelsKMG2:!0,labelsSeparateLines:!0,labelsShowZeroValues:!0,legend:!0,panEdgeFraction:!0,pixelsPerYLabel:!0,pointClickCallback:!0,pointSize:!0,rangeSelectorPlotFillColor:!0,rangeSelectorPlotFillGradientColor:!0,rangeSelectorPlotStrokeColor:!0,rangeSelectorBackgroundStrokeColor:!0,rangeSelectorBackgroundLineWidth:!0,rangeSelectorPlotLineWidth:!0,rangeSelectorForegroundStrokeColor:!0,rangeSelectorForegroundLineWidth:!0,rangeSelectorAlpha:!0,showLabelsOnHighlight:!0,showRoller:!0,strokeWidth:!0,underlayCallback:!0,unhighlightCallback:!0,zoomCallback:!0};v.Circles={DEFAULT:function(ve,Ce,We,vt,Bt,Xt,si){We.beginPath(),We.fillStyle=Xt,We.arc(vt,Bt,si,0,2*Math.PI,!1),We.fill()}};var Rt=/^rgba?\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})(?:,\s*([01](?:\.\d+)?))?\)$/,Mt=["K","M","B","T","Q"],jt=["k","M","G","T","P","E","Z","Y"],Lt=["m","u","n","p","f","a","z","y"],yi=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},{"./dygraph-tickers":16}],18:[function(Ae,Qe,v){(function($){"use strict";function ae(Y){if(Y&&Y.__esModule)return Y;var ue={};if(null!=Y)for(var oe in Y)Object.prototype.hasOwnProperty.call(Y,oe)&&(ue[oe]=Y[oe]);return ue.default=Y,ue}function o(Y){return Y&&Y.__esModule?Y:{default:Y}}Object.defineProperty(v,"__esModule",{value:!0});var N=function(ue,oe){if(Array.isArray(ue))return ue;if(Symbol.iterator in Object(ue))return function Y(ue,oe){var $e=[],Ge=!0,ot=!1,Rt=void 0;try{for(var Mt,jt=ue[Symbol.iterator]();!(Ge=(Mt=jt.next()).done)&&($e.push(Mt.value),!oe||$e.length!==oe);Ge=!0);}catch(Lt){ot=!0,Rt=Lt}finally{try{!Ge&&jt.return&&jt.return()}finally{if(ot)throw Rt}}return $e}(ue,oe);throw new TypeError("Invalid attempt to destructure non-iterable instance")},k=o(Ae("./dygraph-layout")),I=o(Ae("./dygraph-canvas")),le=o(Ae("./dygraph-options")),Be=o(Ae("./dygraph-interaction-model")),Se=ae(Ae("./dygraph-tickers")),ne=ae(Ae("./dygraph-utils")),C=o(Ae("./dygraph-default-attrs")),xt=(o(Ae("./dygraph-options-reference")),Ae("./iframe-tarp")),Wt=o(xt),fi=o(Ae("./datahandler/default")),li=o(Ae("./datahandler/bars-error")),Ri=o(Ae("./datahandler/bars-custom")),mi=o(Ae("./datahandler/default-fractions")),Pt=o(Ae("./datahandler/bars-fractions")),ji=o(Ae("./datahandler/bars")),Si=o(Ae("./plugins/annotations")),Bn=o(Ae("./plugins/axes")),En=o(Ae("./plugins/chart-labels")),vn=o(Ae("./plugins/grid")),Ji=o(Ae("./plugins/legend")),Xi=o(Ae("./plugins/range-selector")),Ai=o(Ae("./dygraph-gviz")),lt=function(Y,ue,oe){this.__init__(Y,ue,oe)};lt.NAME="Dygraph",lt.VERSION="2.0.0",lt.DEFAULT_ROLL_PERIOD=1,lt.DEFAULT_WIDTH=480,lt.DEFAULT_HEIGHT=320,lt.ANIMATION_STEPS=12,lt.ANIMATION_DURATION=200,lt.Plotters=I.default._Plotters,lt.addedAnnotationCSS=!1,lt.prototype.__init__=function(Y,ue,oe){if(this.is_initial_draw_=!0,this.readyFns_=[],null!=oe||(oe={}),oe=lt.copyUserAttrs_(oe),"string"==typeof Y&&(Y=document.getElementById(Y)),!Y)throw new Error("Constructing dygraph with a non-existent div!");this.maindiv_=Y,this.file_=ue,this.rollPeriod_=oe.rollPeriod||lt.DEFAULT_ROLL_PERIOD,this.previousVerticalX_=-1,this.fractions_=oe.fractions||!1,this.dateWindow_=oe.dateWindow||null,this.annotations_=[],Y.innerHTML="",""===Y.style.width&&oe.width&&(Y.style.width=oe.width+"px"),""===Y.style.height&&oe.height&&(Y.style.height=oe.height+"px"),""===Y.style.height&&0===Y.clientHeight&&(Y.style.height=lt.DEFAULT_HEIGHT+"px",""===Y.style.width&&(Y.style.width=lt.DEFAULT_WIDTH+"px")),this.width_=Y.clientWidth||oe.width||0,this.height_=Y.clientHeight||oe.height||0,oe.stackedGraph&&(oe.fillGraph=!0),this.user_attrs_={},ne.update(this.user_attrs_,oe),this.attrs_={},ne.updateDeep(this.attrs_,C.default),this.boundaryIds_=[],this.setIndexByName_={},this.datasetIndex_=[],this.registeredEvents_=[],this.eventListeners_={},this.attributes_=new le.default(this),this.createInterface_(),this.plugins_=[];for(var $e=lt.PLUGINS.concat(this.getOption("plugins")),Ge=0;Ge<$e.length;Ge++){var ot,Rt=$e[Ge],Mt={plugin:ot=void 0!==Rt.activate?Rt:new Rt,events:{},options:{},pluginOptions:{}},jt=ot.activate(this);for(var Lt in jt)jt.hasOwnProperty(Lt)&&(Mt.events[Lt]=jt[Lt]);this.plugins_.push(Mt)}for(Ge=0;Ge<this.plugins_.length;Ge++){var yi=this.plugins_[Ge];for(var Lt in yi.events)if(yi.events.hasOwnProperty(Lt)){var Ce=[yi.plugin,yi.events[Lt]];Lt in this.eventListeners_?this.eventListeners_[Lt].push(Ce):this.eventListeners_[Lt]=[Ce]}}this.createDragInterface_(),this.start_()},lt.prototype.cascadeEvents_=function(Y,ue){if(!(Y in this.eventListeners_))return!1;var oe={dygraph:this,cancelable:!1,defaultPrevented:!1,preventDefault:function(){if(!oe.cancelable)throw"Cannot call preventDefault on non-cancelable event.";oe.defaultPrevented=!0},propagationStopped:!1,stopPropagation:function(){oe.propagationStopped=!0}};ne.update(oe,ue);var $e=this.eventListeners_[Y];if($e)for(var Ge=$e.length-1;Ge>=0&&($e[Ge][1].call($e[Ge][0],oe),!oe.propagationStopped);Ge--);return oe.defaultPrevented},lt.prototype.getPluginInstance_=function(Y){for(var ue=0;ue<this.plugins_.length;ue++){var oe=this.plugins_[ue];if(oe.plugin instanceof Y)return oe.plugin}return null},lt.prototype.isZoomed=function(Y){var ue=!!this.dateWindow_;if("x"===Y)return ue;var oe=this.axes_.map(function($e){return!!$e.valueRange}).indexOf(!0)>=0;if(null==Y)return ue||oe;if("y"===Y)return oe;throw new Error("axis parameter is ["+Y+"] must be null, 'x' or 'y'.")},lt.prototype.toString=function(){var Y=this.maindiv_;return"[Dygraph "+(Y&&Y.id?Y.id:Y)+"]"},lt.prototype.attr_=function(Y,ue){return ue?this.attributes_.getForSeries(Y,ue):this.attributes_.get(Y)},lt.prototype.getOption=function(Y,ue){return this.attr_(Y,ue)},lt.prototype.getNumericOption=function(Y,ue){return this.getOption(Y,ue)},lt.prototype.getStringOption=function(Y,ue){return this.getOption(Y,ue)},lt.prototype.getBooleanOption=function(Y,ue){return this.getOption(Y,ue)},lt.prototype.getFunctionOption=function(Y,ue){return this.getOption(Y,ue)},lt.prototype.getOptionForAxis=function(Y,ue){return this.attributes_.getForAxis(Y,ue)},lt.prototype.optionsViewForAxis_=function(Y){var ue=this;return function(oe){var $e=ue.user_attrs_.axes;return $e&&$e[Y]&&$e[Y].hasOwnProperty(oe)?$e[Y][oe]:("x"!==Y||"logscale"!==oe)&&(void 0!==ue.user_attrs_[oe]?ue.user_attrs_[oe]:($e=ue.attrs_.axes)&&$e[Y]&&$e[Y].hasOwnProperty(oe)?$e[Y][oe]:"y"==Y&&ue.axes_[0].hasOwnProperty(oe)?ue.axes_[0][oe]:"y2"==Y&&ue.axes_[1].hasOwnProperty(oe)?ue.axes_[1][oe]:ue.attr_(oe))}},lt.prototype.rollPeriod=function(){return this.rollPeriod_},lt.prototype.xAxisRange=function(){return this.dateWindow_?this.dateWindow_:this.xAxisExtremes()},lt.prototype.xAxisExtremes=function(){var Y=this.getNumericOption("xRangePad")/this.plotter_.area.w;if(0===this.numRows())return[0-Y,1+Y];var ue=this.rawData_[0][0],oe=this.rawData_[this.rawData_.length-1][0];if(Y){var $e=oe-ue;ue-=$e*Y,oe+=$e*Y}return[ue,oe]},lt.prototype.yAxisExtremes=function(){var Y=this.gatherDatasets_(this.rolledSeries_,null),oe=this.axes_;this.computeYAxisRanges_(Y.extremes);var $e=this.axes_;return this.axes_=oe,$e.map(function(Ge){return Ge.extremeRange})},lt.prototype.yAxisRange=function(Y){if(void 0===Y&&(Y=0),Y<0||Y>=this.axes_.length)return null;var ue=this.axes_[Y];return[ue.computedValueRange[0],ue.computedValueRange[1]]},lt.prototype.yAxisRanges=function(){for(var Y=[],ue=0;ue<this.axes_.length;ue++)Y.push(this.yAxisRange(ue));return Y},lt.prototype.toDomCoords=function(Y,ue,oe){return[this.toDomXCoord(Y),this.toDomYCoord(ue,oe)]},lt.prototype.toDomXCoord=function(Y){if(null===Y)return null;var ue=this.plotter_.area,oe=this.xAxisRange();return ue.x+(Y-oe[0])/(oe[1]-oe[0])*ue.w},lt.prototype.toDomYCoord=function(Y,ue){var oe=this.toPercentYCoord(Y,ue);if(null===oe)return null;var $e=this.plotter_.area;return $e.y+oe*$e.h},lt.prototype.toDataCoords=function(Y,ue,oe){return[this.toDataXCoord(Y),this.toDataYCoord(ue,oe)]},lt.prototype.toDataXCoord=function(Y){if(null===Y)return null;var ue=this.plotter_.area,oe=this.xAxisRange();return this.attributes_.getForAxis("logscale","x")?ne.logRangeFraction(oe[0],oe[1],(Y-ue.x)/ue.w):oe[0]+(Y-ue.x)/ue.w*(oe[1]-oe[0])},lt.prototype.toDataYCoord=function(Y,ue){if(null===Y)return null;var oe=this.plotter_.area,$e=this.yAxisRange(ue);return void 0===ue&&(ue=0),this.attributes_.getForAxis("logscale",ue)?ne.logRangeFraction($e[1],$e[0],(Y-oe.y)/oe.h):$e[0]+(oe.y+oe.h-Y)/oe.h*($e[1]-$e[0])},lt.prototype.toPercentYCoord=function(Y,ue){if(null===Y)return null;void 0===ue&&(ue=0);var oe,$e=this.yAxisRange(ue);if(this.attributes_.getForAxis("logscale",ue)){var Ge=ne.log10($e[0]),ot=ne.log10($e[1]);oe=(ot-ne.log10(Y))/(ot-Ge)}else oe=($e[1]-Y)/($e[1]-$e[0]);return oe},lt.prototype.toPercentXCoord=function(Y){if(null===Y)return null;var ue,oe=this.xAxisRange();if(!0===this.attributes_.getForAxis("logscale","x")){var $e=ne.log10(oe[0]),Ge=ne.log10(oe[1]);ue=(ne.log10(Y)-$e)/(Ge-$e)}else ue=(Y-oe[0])/(oe[1]-oe[0]);return ue},lt.prototype.numColumns=function(){return this.rawData_?this.rawData_[0]?this.rawData_[0].length:this.attr_("labels").length:0},lt.prototype.numRows=function(){return this.rawData_?this.rawData_.length:0},lt.prototype.getValue=function(Y,ue){return Y<0||Y>this.rawData_.length||ue<0||ue>this.rawData_[Y].length?null:this.rawData_[Y][ue]},lt.prototype.createInterface_=function(){var Y=this.maindiv_;this.graphDiv=document.createElement("div"),this.graphDiv.style.textAlign="left",this.graphDiv.style.position="relative",Y.appendChild(this.graphDiv),this.canvas_=ne.createCanvas(),this.canvas_.style.position="absolute",this.hidden_=this.createPlotKitCanvas_(this.canvas_),this.canvas_ctx_=ne.getContext(this.canvas_),this.hidden_ctx_=ne.getContext(this.hidden_),this.resizeElements_(),this.graphDiv.appendChild(this.hidden_),this.graphDiv.appendChild(this.canvas_),this.mouseEventElement_=this.createMouseEventElement_(),this.layout_=new k.default(this);var ue=this;this.mouseMoveHandler_=function(oe){ue.mouseMove_(oe)},this.mouseOutHandler_=function(oe){var Ge=oe.relatedTarget||oe.toElement;ne.isNodeContainedBy(oe.target||oe.fromElement,ue.graphDiv)&&!ne.isNodeContainedBy(Ge,ue.graphDiv)&&ue.mouseOut_(oe)},this.addAndTrackEvent(window,"mouseout",this.mouseOutHandler_),this.addAndTrackEvent(this.mouseEventElement_,"mousemove",this.mouseMoveHandler_),this.resizeHandler_||(this.resizeHandler_=function(oe){ue.resize()},this.addAndTrackEvent(window,"resize",this.resizeHandler_))},lt.prototype.resizeElements_=function(){this.graphDiv.style.width=this.width_+"px",this.graphDiv.style.height=this.height_+"px";var Y=this.getNumericOption("pixelRatio"),ue=Y||ne.getContextPixelRatio(this.canvas_ctx_);this.canvas_.width=this.width_*ue,this.canvas_.height=this.height_*ue,this.canvas_.style.width=this.width_+"px",this.canvas_.style.height=this.height_+"px",1!==ue&&this.canvas_ctx_.scale(ue,ue);var oe=Y||ne.getContextPixelRatio(this.hidden_ctx_);this.hidden_.width=this.width_*oe,this.hidden_.height=this.height_*oe,this.hidden_.style.width=this.width_+"px",this.hidden_.style.height=this.height_+"px",1!==oe&&this.hidden_ctx_.scale(oe,oe)},lt.prototype.destroy=function(){this.canvas_ctx_.restore(),this.hidden_ctx_.restore();for(var Y=this.plugins_.length-1;Y>=0;Y--){var ue=this.plugins_.pop();ue.plugin.destroy&&ue.plugin.destroy()}this.removeTrackedEvents_(),ne.removeEvent(window,"mouseout",this.mouseOutHandler_),ne.removeEvent(this.mouseEventElement_,"mousemove",this.mouseMoveHandler_),ne.removeEvent(window,"resize",this.resizeHandler_),this.resizeHandler_=null,function $e(Ge){for(;Ge.hasChildNodes();)$e(Ge.firstChild),Ge.removeChild(Ge.firstChild)}(this.maindiv_);var oe=function($e){for(var Ge in $e)"object"==typeof $e[Ge]&&($e[Ge]=null)};oe(this.layout_),oe(this.plotter_),oe(this)},lt.prototype.createPlotKitCanvas_=function(Y){var ue=ne.createCanvas();return ue.style.position="absolute",ue.style.top=Y.style.top,ue.style.left=Y.style.left,ue.width=this.width_,ue.height=this.height_,ue.style.width=this.width_+"px",ue.style.height=this.height_+"px",ue},lt.prototype.createMouseEventElement_=function(){return this.canvas_},lt.prototype.setColors_=function(){var Y=this.getLabels(),ue=Y.length-1;this.colors_=[],this.colorsMap_={};for(var oe=this.getNumericOption("colorSaturation")||1,$e=this.getNumericOption("colorValue")||.5,Ge=Math.ceil(ue/2),ot=this.getOption("colors"),Rt=this.visibility(),Mt=0;Mt<ue;Mt++)if(Rt[Mt]){var jt=Y[Mt+1],Lt=this.attributes_.getForSeries("color",jt);if(!Lt)if(ot)Lt=ot[Mt%ot.length];else{var yi=Mt%2?Ge+(Mt+1)/2:Math.ceil((Mt+1)/2);Lt=ne.hsvToRGB(1*yi/(1+ue),oe,$e)}this.colors_.push(Lt),this.colorsMap_[jt]=Lt}},lt.prototype.getColors=function(){return this.colors_},lt.prototype.getPropertiesForSeries=function(Y){for(var ue=-1,oe=this.getLabels(),$e=1;$e<oe.length;$e++)if(oe[$e]==Y){ue=$e;break}return-1==ue?null:{name:Y,column:ue,visible:this.visibility()[ue-1],color:this.colorsMap_[Y],axis:1+this.attributes_.axisForSeries(Y)}},lt.prototype.createRollInterface_=function(){var Y=this,ue=this.roller_;ue||(this.roller_=ue=document.createElement("input"),ue.type="text",ue.style.display="none",ue.className="dygraph-roller",this.graphDiv.appendChild(ue));var oe=this.getBooleanOption("showRoller")?"block":"none",$e=this.getArea(),Ge={top:$e.y+$e.h-25+"px",left:$e.x+1+"px",display:oe};ue.size="2",ue.value=this.rollPeriod_,ne.update(ue.style,Ge),ue.onchange=function(){return Y.adjustRoll(ue.value)}},lt.prototype.createDragInterface_=function(){var Y={isZooming:!1,isPanning:!1,is2DPan:!1,dragStartX:null,dragStartY:null,dragEndX:null,dragEndY:null,dragDirection:null,prevEndX:null,prevEndY:null,prevDragDirection:null,cancelNextDblclick:!1,initialLeftmostDate:null,xUnitsPerPixel:null,dateRange:null,px:0,py:0,boundedDates:null,boundedValues:null,tarp:new Wt.default,initializeMouseDown:function(ot,Rt,Mt){ot.preventDefault?ot.preventDefault():(ot.returnValue=!1,ot.cancelBubble=!0);var jt=ne.findPos(Rt.canvas_);Mt.px=jt.x,Mt.py=jt.y,Mt.dragStartX=ne.dragGetX_(ot,Mt),Mt.dragStartY=ne.dragGetY_(ot,Mt),Mt.cancelNextDblclick=!1,Mt.tarp.cover()},destroy:function(){var ot=this;if((ot.isZooming||ot.isPanning)&&(ot.isZooming=!1,ot.dragStartX=null,ot.dragStartY=null),ot.isPanning){ot.isPanning=!1,ot.draggingDate=null,ot.dateRange=null;for(var Rt=0;Rt<oe.axes_.length;Rt++)delete oe.axes_[Rt].draggingValue,delete oe.axes_[Rt].dragValueRange}ot.tarp.uncover()}},ue=this.getOption("interactionModel"),oe=this;for(var $e in ue)ue.hasOwnProperty($e)&&this.addAndTrackEvent(this.mouseEventElement_,$e,function(ot){return function(Rt){ot(Rt,oe,Y)}}(ue[$e]));ue.willDestroyContextMyself||this.addAndTrackEvent(document,"mouseup",function(ot){Y.destroy()})},lt.prototype.drawZoomRect_=function(Y,ue,oe,$e,Ge,ot,Rt,Mt){var jt=this.canvas_ctx_;ot==ne.HORIZONTAL?jt.clearRect(Math.min(ue,Rt),this.layout_.getPlotArea().y,Math.abs(ue-Rt),this.layout_.getPlotArea().h):ot==ne.VERTICAL&&jt.clearRect(this.layout_.getPlotArea().x,Math.min($e,Mt),this.layout_.getPlotArea().w,Math.abs($e-Mt)),Y==ne.HORIZONTAL?oe&&ue&&(jt.fillStyle="rgba(128,128,128,0.33)",jt.fillRect(Math.min(ue,oe),this.layout_.getPlotArea().y,Math.abs(oe-ue),this.layout_.getPlotArea().h)):Y==ne.VERTICAL&&Ge&&$e&&(jt.fillStyle="rgba(128,128,128,0.33)",jt.fillRect(this.layout_.getPlotArea().x,Math.min($e,Ge),this.layout_.getPlotArea().w,Math.abs(Ge-$e)))},lt.prototype.clearZoomRect_=function(){this.currentZoomRectArgs_=null,this.canvas_ctx_.clearRect(0,0,this.width_,this.height_)},lt.prototype.doZoomX_=function(Y,ue){this.currentZoomRectArgs_=null;var oe=this.toDataXCoord(Y),$e=this.toDataXCoord(ue);this.doZoomXDates_(oe,$e)},lt.prototype.doZoomXDates_=function(Y,ue){var oe=this,$e=this.xAxisRange(),Ge=[Y,ue],ot=this.getFunctionOption("zoomCallback");this.doAnimatedZoom($e,Ge,null,null,function(){ot&&ot.call(oe,Y,ue,oe.yAxisRanges())})},lt.prototype.doZoomY_=function(Y,ue){var oe=this;this.currentZoomRectArgs_=null;for(var $e=this.yAxisRanges(),Ge=[],ot=0;ot<this.axes_.length;ot++){var Rt=this.toDataYCoord(Y,ot),Mt=this.toDataYCoord(ue,ot);Ge.push([Mt,Rt])}var jt=this.getFunctionOption("zoomCallback");this.doAnimatedZoom(null,null,$e,Ge,function(){if(jt){var Lt=oe.xAxisRange(),yi=N(Lt,2);jt.call(oe,yi[0],yi[1],oe.yAxisRanges())}})},lt.zoomAnimationFunction=function(Y,ue){return(1-Math.pow(1.5,-Y))/(1-Math.pow(1.5,-ue))},lt.prototype.resetZoom=function(){var Y=this,ue=this.isZoomed("x"),oe=this.isZoomed("y"),$e=ue||oe;if(this.clearSelection(),$e){var Ge=this.xAxisExtremes(),ot=N(Ge,2),Rt=ot[0],Mt=ot[1],jt=this.getBooleanOption("animatedZooms"),Lt=this.getFunctionOption("zoomCallback");if(!jt)return this.dateWindow_=null,this.axes_.forEach(function(vt){vt.valueRange&&delete vt.valueRange}),this.drawGraph_(),void(Lt&&Lt.call(this,Rt,Mt,this.yAxisRanges()));var yi=null,ve=null,Ce=null,We=null;ue&&(yi=this.xAxisRange(),ve=[Rt,Mt]),oe&&(Ce=this.yAxisRanges(),We=this.yAxisExtremes()),this.doAnimatedZoom(yi,ve,Ce,We,function(){Y.dateWindow_=null,Y.axes_.forEach(function(vt){vt.valueRange&&delete vt.valueRange}),Lt&&Lt.call(Y,Rt,Mt,Y.yAxisRanges())})}},lt.prototype.doAnimatedZoom=function(Y,ue,oe,$e,Ge){var ot,Rt,Mt=this,jt=this.getBooleanOption("animatedZooms")?lt.ANIMATION_STEPS:1,Lt=[],yi=[];if(null!==Y&&null!==ue)for(ot=1;ot<=jt;ot++)Rt=lt.zoomAnimationFunction(ot,jt),Lt[ot-1]=[Y[0]*(1-Rt)+Rt*ue[0],Y[1]*(1-Rt)+Rt*ue[1]];if(null!==oe&&null!==$e)for(ot=1;ot<=jt;ot++){Rt=lt.zoomAnimationFunction(ot,jt);for(var ve=[],Ce=0;Ce<this.axes_.length;Ce++)ve.push([oe[Ce][0]*(1-Rt)+Rt*$e[Ce][0],oe[Ce][1]*(1-Rt)+Rt*$e[Ce][1]]);yi[ot-1]=ve}ne.repeatAndCleanup(function(We){if(yi.length)for(var vt=0;vt<Mt.axes_.length;vt++){var Bt=yi[We][vt];Mt.axes_[vt].valueRange=[Bt[0],Bt[1]]}Lt.length&&(Mt.dateWindow_=Lt[We]),Mt.drawGraph_()},jt,lt.ANIMATION_DURATION/jt,Ge)},lt.prototype.getArea=function(){return this.plotter_.area},lt.prototype.eventToDomCoords=function(Y){if(Y.offsetX&&Y.offsetY)return[Y.offsetX,Y.offsetY];var ue=ne.findPos(this.mouseEventElement_);return[ne.pageX(Y)-ue.x,ne.pageY(Y)-ue.y]},lt.prototype.findClosestRow=function(Y){for(var ue=1/0,oe=-1,$e=this.layout_.points,Ge=0;Ge<$e.length;Ge++)for(var ot=$e[Ge],Rt=ot.length,Mt=0;Mt<Rt;Mt++){var jt=ot[Mt];if(ne.isValidPoint(jt,!0)){var Lt=Math.abs(jt.canvasx-Y);Lt<ue&&(ue=Lt,oe=jt.idx)}}return oe},lt.prototype.findClosestPoint=function(Y,ue){for(var oe,$e,Ge,ot,Rt,Mt,jt,Lt=1/0,yi=this.layout_.points.length-1;yi>=0;--yi)for(var ve=this.layout_.points[yi],Ce=0;Ce<ve.length;++Ce)ne.isValidPoint(ot=ve[Ce])&&(oe=($e=ot.canvasx-Y)*$e+(Ge=ot.canvasy-ue)*Ge)<Lt&&(Lt=oe,Rt=ot,Mt=yi,jt=ot.idx);return{row:jt,seriesName:this.layout_.setNames[Mt],point:Rt}},lt.prototype.findStackedPoint=function(Y,ue){for(var oe,$e,Ge=this.findClosestRow(Y),ot=0;ot<this.layout_.points.length;++ot){var Mt=Ge-this.getLeftBoundary_(ot),jt=this.layout_.points[ot];if(!(Mt>=jt.length)){var Lt=jt[Mt];if(ne.isValidPoint(Lt)){var yi=Lt.canvasy;if(Y>Lt.canvasx&&Mt+1<jt.length){var ve=jt[Mt+1];ne.isValidPoint(ve)&&(Ce=ve.canvasx-Lt.canvasx)>0&&(yi+=(Y-Lt.canvasx)/Ce*(ve.canvasy-Lt.canvasy))}else if(Y<Lt.canvasx&&Mt>0){var Ce,vt=jt[Mt-1];ne.isValidPoint(vt)&&(Ce=Lt.canvasx-vt.canvasx)>0&&(yi+=(Lt.canvasx-Y)/Ce*(vt.canvasy-Lt.canvasy))}(0===ot||yi<ue)&&(oe=Lt,$e=ot)}}}return{row:Ge,seriesName:this.layout_.setNames[$e],point:oe}},lt.prototype.mouseMove_=function(Y){if(null!=this.layout_.points){var oe=this.eventToDomCoords(Y),$e=oe[0],Ge=oe[1],Rt=!1;if(this.getOption("highlightSeriesOpts")&&!this.isSeriesLocked()){var Mt;Mt=this.getBooleanOption("stackedGraph")?this.findStackedPoint($e,Ge):this.findClosestPoint($e,Ge),Rt=this.setSelection(Mt.row,Mt.seriesName)}else{var jt=this.findClosestRow($e);Rt=this.setSelection(jt)}var Lt=this.getFunctionOption("highlightCallback");Lt&&Rt&&Lt.call(this,Y,this.lastx_,this.selPoints_,this.lastRow_,this.highlightSet_)}},lt.prototype.getLeftBoundary_=function(Y){if(this.boundaryIds_[Y])return this.boundaryIds_[Y][0];for(var ue=0;ue<this.boundaryIds_.length;ue++)if(void 0!==this.boundaryIds_[ue])return this.boundaryIds_[ue][0];return 0},lt.prototype.animateSelection_=function(Y){void 0===this.fadeLevel&&(this.fadeLevel=0),void 0===this.animateId&&(this.animateId=0);var ue=this.fadeLevel,oe=Y<0?ue:10-ue;if(oe<=0)this.fadeLevel&&this.updateSelection_(1);else{var $e=++this.animateId,Ge=this;ne.repeatAndCleanup(function(Rt){Ge.animateId==$e&&(Ge.fadeLevel+=Y,0===Ge.fadeLevel?Ge.clearSelection():Ge.updateSelection_(Ge.fadeLevel/10))},oe,30,function(){0!==Ge.fadeLevel&&Y<0&&(Ge.fadeLevel=0,Ge.clearSelection())})}},lt.prototype.updateSelection_=function(Y){this.cascadeEvents_("select",{selectedRow:-1===this.lastRow_?void 0:this.lastRow_,selectedX:-1===this.lastx_?void 0:this.lastx_,selectedPoints:this.selPoints_});var ue,oe=this.canvas_ctx_;if(this.getOption("highlightSeriesOpts")){oe.clearRect(0,0,this.width_,this.height_);var $e=1-this.getNumericOption("highlightSeriesBackgroundAlpha"),Ge=ne.toRGB_(this.getOption("highlightSeriesBackgroundColor"));if($e){if(void 0===Y)return void this.animateSelection_(1);oe.fillStyle="rgba("+Ge.r+","+Ge.g+","+Ge.b+","+($e*=Y)+")",oe.fillRect(0,0,this.width_,this.height_)}this.plotter_._renderLineChart(this.highlightSet_,oe)}else if(this.previousVerticalX_>=0){var ot=0,Rt=this.attr_("labels");for(ue=1;ue<Rt.length;ue++){var Mt=this.getNumericOption("highlightCircleSize",Rt[ue]);Mt>ot&&(ot=Mt)}oe.clearRect(this.previousVerticalX_-ot-1,0,2*ot+2,this.height_)}if(this.selPoints_.length>0){var Lt=this.selPoints_[0].canvasx;for(oe.save(),ue=0;ue<this.selPoints_.length;ue++){var yi=this.selPoints_[ue];if(!isNaN(yi.canvasy)){var ve=this.getNumericOption("highlightCircleSize",yi.name),Ce=this.getFunctionOption("drawHighlightPointCallback",yi.name),We=this.plotter_.colors[yi.name];Ce||(Ce=ne.Circles.DEFAULT),oe.lineWidth=this.getNumericOption("strokeWidth",yi.name),oe.strokeStyle=We,oe.fillStyle=We,Ce.call(this,this,yi.name,oe,Lt,yi.canvasy,We,ve,yi.idx)}}oe.restore(),this.previousVerticalX_=Lt}},lt.prototype.setSelection=function(Y,ue,oe){this.selPoints_=[];var $e=!1;if(!1!==Y&&Y>=0){Y!=this.lastRow_&&($e=!0),this.lastRow_=Y;for(var Ge=0;Ge<this.layout_.points.length;++Ge){var ot=this.layout_.points[Ge],Rt=Y-this.getLeftBoundary_(Ge);if(Rt>=0&&Rt<ot.length&&ot[Rt].idx==Y)null!==(Mt=ot[Rt]).yval&&this.selPoints_.push(Mt);else for(var jt=0;jt<ot.length;++jt){var Mt;if((Mt=ot[jt]).idx==Y){null!==Mt.yval&&this.selPoints_.push(Mt);break}}}}else this.lastRow_>=0&&($e=!0),this.lastRow_=-1;return this.lastx_=this.selPoints_.length?this.selPoints_[0].xval:-1,void 0!==ue&&(this.highlightSet_!==ue&&($e=!0),this.highlightSet_=ue),void 0!==oe&&(this.lockedSet_=oe),$e&&this.updateSelection_(void 0),$e},lt.prototype.mouseOut_=function(Y){this.getFunctionOption("unhighlightCallback")&&this.getFunctionOption("unhighlightCallback").call(this,Y),this.getBooleanOption("hideOverlayOnMouseOut")&&!this.lockedSet_&&this.clearSelection()},lt.prototype.clearSelection=function(){this.cascadeEvents_("deselect",{}),this.lockedSet_=!1,this.fadeLevel?this.animateSelection_(-1):(this.canvas_ctx_.clearRect(0,0,this.width_,this.height_),this.fadeLevel=0,this.selPoints_=[],this.lastx_=-1,this.lastRow_=-1,this.highlightSet_=null)},lt.prototype.getSelection=function(){if(!this.selPoints_||this.selPoints_.length<1)return-1;for(var Y=0;Y<this.layout_.points.length;Y++)for(var ue=this.layout_.points[Y],oe=0;oe<ue.length;oe++)if(ue[oe].x==this.selPoints_[0].x)return ue[oe].idx;return-1},lt.prototype.getHighlightSeries=function(){return this.highlightSet_},lt.prototype.isSeriesLocked=function(){return this.lockedSet_},lt.prototype.loadedEvent_=function(Y){this.rawData_=this.parseCSV_(Y),this.cascadeDataDidUpdateEvent_(),this.predraw_()},lt.prototype.addXTicks_=function(){var Y;Y=this.dateWindow_?[this.dateWindow_[0],this.dateWindow_[1]]:this.xAxisExtremes();var ue=this.optionsViewForAxis_("x"),oe=ue("ticker")(Y[0],Y[1],this.plotter_.area.w,ue,this);this.layout_.setXTicks(oe)},lt.prototype.getHandlerClass_=function(){return this.attr_("dataHandler")?this.attr_("dataHandler"):this.fractions_?this.getBooleanOption("errorBars")?Pt.default:mi.default:this.getBooleanOption("customBars")?Ri.default:this.getBooleanOption("errorBars")?li.default:fi.default},lt.prototype.predraw_=function(){var Y=new Date;this.dataHandler_=new(this.getHandlerClass_()),this.layout_.computePlotArea(),this.computeYAxes_(),this.is_initial_draw_||(this.canvas_ctx_.restore(),this.hidden_ctx_.restore()),this.canvas_ctx_.save(),this.hidden_ctx_.save(),this.plotter_=new I.default(this,this.hidden_,this.hidden_ctx_,this.layout_),this.createRollInterface_(),this.cascadeEvents_("predraw"),this.rolledSeries_=[null];for(var ue=1;ue<this.numColumns();ue++){var oe=this.dataHandler_.extractSeries(this.rawData_,ue,this.attributes_);this.rollPeriod_>1&&(oe=this.dataHandler_.rollingAverage(oe,this.rollPeriod_,this.attributes_)),this.rolledSeries_.push(oe)}this.drawGraph_();var $e=new Date;this.drawingTimeMs_=$e-Y},lt.PointType=void 0,lt.stackPoints_=function(Y,ue,oe,$e){for(var Ge=null,ot=null,Rt=null,Mt=-1,jt=0;jt<Y.length;++jt){var Lt=Y[jt],yi=Lt.xval;void 0===ue[yi]&&(ue[yi]=0);var ve=Lt.yval;isNaN(ve)||null===ve?"none"==$e?ve=0:(function(We){if(!(Mt>=We))for(var vt=We;vt<Y.length;++vt)if(Rt=null,!isNaN(Y[vt].yval)&&null!==Y[vt].yval){Mt=vt,Rt=Y[vt];break}}(jt),ve=ot&&Rt&&"none"!=$e?ot.yval+(yi-ot.xval)/(Rt.xval-ot.xval)*(Rt.yval-ot.yval):ot&&"all"==$e?ot.yval:Rt&&"all"==$e?Rt.yval:0):ot=Lt;var Ce=ue[yi];Ge!=yi&&(ue[yi]=Ce+=ve),Ge=yi,Lt.yval_stacked=Ce,Ce>oe[1]&&(oe[1]=Ce),Ce<oe[0]&&(oe[0]=Ce)}},lt.prototype.gatherDatasets_=function(Y,ue){var oe,$e,Ge,ot,Rt,Mt,jt=[],Lt=[],yi=[],ve={};for(oe=Y.length-1;oe>=1;oe--)if(this.visibility()[oe-1]){if(ue){Mt=Y[oe];var We=ue[0],vt=ue[1];for(Ge=null,ot=null,$e=0;$e<Mt.length;$e++)Mt[$e][0]>=We&&null===Ge&&(Ge=$e),Mt[$e][0]<=vt&&(ot=$e);null===Ge&&(Ge=0);for(var Bt=Ge,Xt=!0;Xt&&Bt>0;)Xt=null===Mt[--Bt][1];null===ot&&(ot=Mt.length-1);var si=ot;for(Xt=!0;Xt&&si<Mt.length-1;)Xt=null===Mt[++si][1];Bt!==Ge&&(Ge=Bt),si!==ot&&(ot=si),jt[oe-1]=[Ge,ot],Mt=Mt.slice(Ge,ot+1)}else jt[oe-1]=[0,(Mt=Y[oe]).length-1];var W=this.attr_("labels")[oe],ye=this.dataHandler_.getExtremeYValues(Mt,ue,this.getBooleanOption("stepPlot",W)),Me=this.dataHandler_.seriesToPoints(Mt,W,jt[oe-1][0]);this.getBooleanOption("stackedGraph")&&(void 0===yi[Rt=this.attributes_.axisForSeries(W)]&&(yi[Rt]=[]),lt.stackPoints_(Me,yi[Rt],ye,this.getBooleanOption("stackedGraphNaNFill"))),ve[W]=ye,Lt[oe]=Me}return{points:Lt,extremes:ve,boundaryIds:jt}},lt.prototype.drawGraph_=function(){var Y=new Date,ue=this.is_initial_draw_;this.is_initial_draw_=!1,this.layout_.removeAllDatasets(),this.setColors_(),this.attrs_.pointSize=.5*this.getNumericOption("highlightCircleSize");var oe=this.gatherDatasets_(this.rolledSeries_,this.dateWindow_),$e=oe.points,Ge=oe.extremes;this.boundaryIds_=oe.boundaryIds,this.setIndexByName_={};for(var ot=this.attr_("labels"),Rt=0,Mt=1;Mt<$e.length;Mt++)this.visibility()[Mt-1]&&(this.layout_.addDataset(ot[Mt],$e[Mt]),this.datasetIndex_[Mt]=Rt++);for(Mt=0;Mt<ot.length;Mt++)this.setIndexByName_[ot[Mt]]=Mt;if(this.computeYAxisRanges_(Ge),this.layout_.setYAxes(this.axes_),this.addXTicks_(),this.layout_.evaluate(),this.renderGraph_(ue),this.getStringOption("timingName")){var jt=new Date;console.log(this.getStringOption("timingName")+" - drawGraph: "+(jt-Y)+"ms")}},lt.prototype.renderGraph_=function(Y){this.cascadeEvents_("clearChart"),this.plotter_.clear();var ue=this.getFunctionOption("underlayCallback");ue&&ue.call(this,this.hidden_ctx_,this.layout_.getPlotArea(),this,this);var oe={canvas:this.hidden_,drawingContext:this.hidden_ctx_};this.cascadeEvents_("willDrawChart",oe),this.plotter_.render(),this.cascadeEvents_("didDrawChart",oe),this.lastRow_=-1,this.canvas_.getContext("2d").clearRect(0,0,this.width_,this.height_);var $e=this.getFunctionOption("drawCallback");if(null!==$e&&$e.call(this,this,Y),Y)for(this.readyFired_=!0;this.readyFns_.length>0;)this.readyFns_.pop()(this)},lt.prototype.computeYAxes_=function(){var Y,ue,oe;for(this.axes_=[],Y=0;Y<this.attributes_.numAxes();Y++)ne.update(ue={g:this},this.attributes_.axisOptions(Y)),this.axes_[Y]=ue;for(Y=0;Y<this.axes_.length;Y++)if(0===Y)(oe=(ue=this.optionsViewForAxis_("y"+(Y?"2":"")))("valueRange"))&&(this.axes_[Y].valueRange=oe);else{var $e=this.user_attrs_.axes;$e&&$e.y2&&(oe=$e.y2.valueRange)&&(this.axes_[Y].valueRange=oe)}},lt.prototype.numAxes=function(){return this.attributes_.numAxes()},lt.prototype.axisPropertiesForSeries=function(Y){return this.axes_[this.attributes_.axisForSeries(Y)]},lt.prototype.computeYAxisRanges_=function(Y){for(var ue,oe,$e,Ge,ot,Rt=function(Z){return isNaN(parseFloat(Z))},Mt=this.attributes_.numAxes(),jt=0;jt<Mt;jt++){var Lt=this.axes_[jt],yi=this.attributes_.getForAxis("logscale",jt),ve=this.attributes_.getForAxis("includeZero",jt),Ce=this.attributes_.getForAxis("independentTicks",jt);$e=this.attributes_.seriesForAxis(jt),ue=!0,Ge=.1;var We=this.getNumericOption("yRangePad");if(null!==We&&(ue=!1,Ge=We/this.plotter_.area.h),0===$e.length)Lt.extremeRange=[0,1];else{for(var vt,Bt,Xt=1/0,si=-1/0,W=0;W<$e.length;W++)Y.hasOwnProperty($e[W])&&(null!==(vt=Y[$e[W]][0])&&(Xt=Math.min(vt,Xt)),null!==(Bt=Y[$e[W]][1])&&(si=Math.max(Bt,si)));ve&&!yi&&(Xt>0&&(Xt=0),si<0&&(si=0)),Xt==1/0&&(Xt=0),si==-1/0&&(si=1),0==(oe=si-Xt)&&(0!==si?oe=Math.abs(si):(si=1,oe=1));var ye=si,Me=Xt;ue&&(yi?(ye=si+Ge*oe,Me=Xt):((Me=Xt-Ge*oe)<0&&Xt>=0&&(Me=0),(ye=si+Ge*oe)>0&&si<=0&&(ye=0))),Lt.extremeRange=[Me,ye]}if(Lt.valueRange){var qe=Rt(Lt.valueRange[0])?Lt.extremeRange[0]:Lt.valueRange[0],gt=Rt(Lt.valueRange[1])?Lt.extremeRange[1]:Lt.valueRange[1];Lt.computedValueRange=[qe,gt]}else Lt.computedValueRange=Lt.extremeRange;if(!ue)if(yi){var ft=(Ge-1)/(2*Ge-1);Lt.computedValueRange[0]=ne.logRangeFraction(qe=Lt.computedValueRange[0],gt=Lt.computedValueRange[1],Ge/(2*Ge-1)),Lt.computedValueRange[1]=ne.logRangeFraction(qe,gt,ft)}else Lt.computedValueRange[0]=(qe=Lt.computedValueRange[0])-(oe=(gt=Lt.computedValueRange[1])-qe)*Ge,Lt.computedValueRange[1]=gt+oe*Ge;if(Ce){Lt.independentTicks=Ce;var ti=(Ut=this.optionsViewForAxis_("y"+(jt?"2":"")))("ticker");Lt.ticks=ti(Lt.computedValueRange[0],Lt.computedValueRange[1],this.plotter_.area.h,Ut,this),ot||(ot=Lt)}}if(void 0===ot)throw'Configuration Error: At least one axis has to have the "independentTicks" option activated.';for(jt=0;jt<Mt;jt++)if(!(Lt=this.axes_[jt]).independentTicks){ti=(Ut=this.optionsViewForAxis_("y"+(jt?"2":"")))("ticker");for(var Ut,Ci=ot.ticks,xi=ot.computedValueRange[1]-ot.computedValueRange[0],pi=Lt.computedValueRange[1]-Lt.computedValueRange[0],Ii=[],Gi=0;Gi<Ci.length;Gi++)Ii.push(Lt.computedValueRange[0]+(Ci[Gi].v-ot.computedValueRange[0])/xi*pi);Lt.ticks=ti(Lt.computedValueRange[0],Lt.computedValueRange[1],this.plotter_.area.h,Ut,this,Ii)}},lt.prototype.detectTypeFromString_=function(Y){var ue=!1,oe=Y.indexOf("-");(oe>0&&"e"!=Y[oe-1]&&"E"!=Y[oe-1]||Y.indexOf("/")>=0||isNaN(parseFloat(Y))||8==Y.length&&Y>"19700101"&&Y<"20371231")&&(ue=!0),this.setXAxisOptions_(ue)},lt.prototype.setXAxisOptions_=function(Y){Y?(this.attrs_.xValueParser=ne.dateParser,this.attrs_.axes.x.valueFormatter=ne.dateValueFormatter,this.attrs_.axes.x.ticker=Se.dateTicker,this.attrs_.axes.x.axisLabelFormatter=ne.dateAxisLabelFormatter):(this.attrs_.xValueParser=function(ue){return parseFloat(ue)},this.attrs_.axes.x.valueFormatter=function(ue){return ue},this.attrs_.axes.x.ticker=Se.numericTicks,this.attrs_.axes.x.axisLabelFormatter=this.attrs_.axes.x.valueFormatter)},lt.prototype.parseCSV_=function(Y){var ue,oe,$e=[],Ge=ne.detectLineDelimiter(Y),ot=Y.split(Ge||"\n"),Rt=this.getStringOption("delimiter");-1==ot[0].indexOf(Rt)&&ot[0].indexOf("\t")>=0&&(Rt="\t");var Mt=0;"labels"in this.user_attrs_||(Mt=1,this.attrs_.labels=ot[0].split(Rt),this.attributes_.reparseSeries());for(var jt,Lt=!1,yi=this.attr_("labels").length,ve=!1,Ce=Mt;Ce<ot.length;Ce++){var We=ot[Ce];if(0!==We.length&&"#"!=We[0]){var vt=We.split(Rt);if(!(vt.length<2)){var Bt=[];if(Lt||(this.detectTypeFromString_(vt[0]),jt=this.getFunctionOption("xValueParser"),Lt=!0),Bt[0]=jt(vt[0],this),this.fractions_)for(oe=1;oe<vt.length;oe++)2!=(ue=vt[oe].split("/")).length?(console.error('Expected fractional "num/den" values in CSV data but found a value \''+vt[oe]+"' on line "+(1+Ce)+" ('"+We+"') which is not of this form."),Bt[oe]=[0,0]):Bt[oe]=[ne.parseFloat_(ue[0],Ce,We),ne.parseFloat_(ue[1],Ce,We)];else if(this.getBooleanOption("errorBars"))for(vt.length%2!=1&&console.error("Expected alternating (value, stdev.) pairs in CSV data but line "+(1+Ce)+" has an odd number of values ("+(vt.length-1)+"): '"+We+"'"),oe=1;oe<vt.length;oe+=2)Bt[(oe+1)/2]=[ne.parseFloat_(vt[oe],Ce,We),ne.parseFloat_(vt[oe+1],Ce,We)];else if(this.getBooleanOption("customBars"))for(oe=1;oe<vt.length;oe++){var Xt=vt[oe];/^ *$/.test(Xt)?Bt[oe]=[null,null,null]:3==(ue=Xt.split(";")).length?Bt[oe]=[ne.parseFloat_(ue[0],Ce,We),ne.parseFloat_(ue[1],Ce,We),ne.parseFloat_(ue[2],Ce,We)]:console.warn('When using customBars, values must be either blank or "low;center;high" tuples (got "'+Xt+'" on line '+(1+Ce))}else for(oe=1;oe<vt.length;oe++)Bt[oe]=ne.parseFloat_(vt[oe],Ce,We);if($e.length>0&&Bt[0]<$e[$e.length-1][0]&&(ve=!0),Bt.length!=yi&&console.error("Number of columns in line "+Ce+" ("+Bt.length+") does not agree with number of labels ("+yi+") "+We),0===Ce&&this.attr_("labels")){var si=!0;for(oe=0;si&&oe<Bt.length;oe++)Bt[oe]&&(si=!1);if(si){console.warn("The dygraphs 'labels' option is set, but the first row of CSV data ('"+We+"') appears to also contain labels. Will drop the CSV labels and use the option labels.");continue}}$e.push(Bt)}}}return ve&&(console.warn("CSV is out of order; order it correctly to speed loading."),$e.sort(function(W,ye){return W[0]-ye[0]})),$e},lt.prototype.parseArray_=function(Y){if(0===Y.length)return console.error("Can't plot empty data set"),null;if(0===Y[0].length)return console.error("Data set cannot contain an empty row"),null;var ue;if(function D(Y){var ue=Y[0],oe=ue[0];if("number"!=typeof oe&&!ne.isDateLike(oe))throw new Error("Expected number or date but got "+typeof oe+": "+oe+".");for(var $e=1;$e<ue.length;$e++){var Ge=ue[$e];if(null!=Ge&&"number"!=typeof Ge&&!ne.isArrayLike(Ge))throw new Error("Expected number or array but got "+typeof Ge+": "+Ge+".")}}(Y),null===this.attr_("labels")){for(console.warn("Using default labels. Set labels explicitly via 'labels' in the options parameter"),this.attrs_.labels=["X"],ue=1;ue<Y[0].length;ue++)this.attrs_.labels.push("Y"+ue);this.attributes_.reparseSeries()}else{var oe=this.attr_("labels");if(oe.length!=Y[0].length)return console.error("Mismatch between number of labels ("+oe+") and number of columns in array ("+Y[0].length+")"),null}if(ne.isDateLike(Y[0][0])){this.attrs_.axes.x.valueFormatter=ne.dateValueFormatter,this.attrs_.axes.x.ticker=Se.dateTicker,this.attrs_.axes.x.axisLabelFormatter=ne.dateAxisLabelFormatter;var $e=ne.clone(Y);for(ue=0;ue<Y.length;ue++){if(0===$e[ue].length)return console.error("Row "+(1+ue)+" of data is empty"),null;if(null===$e[ue][0]||"function"!=typeof $e[ue][0].getTime||isNaN($e[ue][0].getTime()))return console.error("x value in row "+(1+ue)+" is not a Date"),null;$e[ue][0]=$e[ue][0].getTime()}return $e}return this.attrs_.axes.x.valueFormatter=function(Ge){return Ge},this.attrs_.axes.x.ticker=Se.numericTicks,this.attrs_.axes.x.axisLabelFormatter=ne.numberAxisLabelFormatter,Y},lt.prototype.parseDataTable_=function(Y){var ue=Y.getNumberOfColumns(),oe=Y.getNumberOfRows(),$e=Y.getColumnType(0);if("date"==$e||"datetime"==$e)this.attrs_.xValueParser=ne.dateParser,this.attrs_.axes.x.valueFormatter=ne.dateValueFormatter,this.attrs_.axes.x.ticker=Se.dateTicker,this.attrs_.axes.x.axisLabelFormatter=ne.dateAxisLabelFormatter;else{if("number"!=$e)throw new Error("only 'date', 'datetime' and 'number' types are supported for column 1 of DataTable input (Got '"+$e+"')");this.attrs_.xValueParser=function(ye){return parseFloat(ye)},this.attrs_.axes.x.valueFormatter=function(ye){return ye},this.attrs_.axes.x.ticker=Se.numericTicks,this.attrs_.axes.x.axisLabelFormatter=this.attrs_.axes.x.valueFormatter}var Ge,ot,Rt=[],Mt={},jt=!1;for(Ge=1;Ge<ue;Ge++){var Lt=Y.getColumnType(Ge);if("number"==Lt)Rt.push(Ge);else{if("string"!=Lt||!this.getBooleanOption("displayAnnotations"))throw new Error("Only 'number' is supported as a dependent type with Gviz. 'string' is only supported if displayAnnotations is true");var yi=Rt[Rt.length-1];Mt.hasOwnProperty(yi)?Mt[yi].push(Ge):Mt[yi]=[Ge],jt=!0}}var ve=[Y.getColumnLabel(0)];for(Ge=0;Ge<Rt.length;Ge++)ve.push(Y.getColumnLabel(Rt[Ge])),this.getBooleanOption("errorBars")&&(Ge+=1);this.attrs_.labels=ve,ue=ve.length;var Ce=[],We=!1,vt=[];for(Ge=0;Ge<oe;Ge++){var Bt=[];if(void 0!==Y.getValue(Ge,0)&&null!==Y.getValue(Ge,0)){if(Bt.push("date"==$e||"datetime"==$e?Y.getValue(Ge,0).getTime():Y.getValue(Ge,0)),this.getBooleanOption("errorBars"))for(ot=0;ot<ue-1;ot++)Bt.push([Y.getValue(Ge,1+2*ot),Y.getValue(Ge,2+2*ot)]);else{for(ot=0;ot<Rt.length;ot++){var Xt=Rt[ot];if(Bt.push(Y.getValue(Ge,Xt)),jt&&Mt.hasOwnProperty(Xt)&&null!==Y.getValue(Ge,Mt[Xt][0])){var si={};si.series=Y.getColumnLabel(Xt),si.xval=Bt[0],si.shortText=function(ye){var Me=String.fromCharCode(65+ye%26);for(ye=Math.floor(ye/26);ye>0;)Me=String.fromCharCode(65+(ye-1)%26)+Me.toLowerCase(),ye=Math.floor((ye-1)/26);return Me}(vt.length),si.text="";for(var W=0;W<Mt[Xt].length;W++)W&&(si.text+="\n"),si.text+=Y.getValue(Ge,Mt[Xt][W]);vt.push(si)}}for(ot=0;ot<Bt.length;ot++)isFinite(Bt[ot])||(Bt[ot]=null)}Ce.length>0&&Bt[0]<Ce[Ce.length-1][0]&&(We=!0),Ce.push(Bt)}else console.warn("Ignoring row "+Ge+" of DataTable because of undefined or null first column.")}We&&(console.warn("DataTable is out of order; order it correctly to speed loading."),Ce.sort(function(ye,Me){return ye[0]-Me[0]})),this.rawData_=Ce,vt.length>0&&this.setAnnotations(vt,!0),this.attributes_.reparseSeries()},lt.prototype.cascadeDataDidUpdateEvent_=function(){this.cascadeEvents_("dataDidUpdate",{})},lt.prototype.start_=function(){var Y=this.file_;if("function"==typeof Y&&(Y=Y()),ne.isArrayLike(Y))this.rawData_=this.parseArray_(Y),this.cascadeDataDidUpdateEvent_(),this.predraw_();else if("object"==typeof Y&&"function"==typeof Y.getColumnRange)this.parseDataTable_(Y),this.cascadeDataDidUpdateEvent_(),this.predraw_();else if("string"==typeof Y)if(ne.detectLineDelimiter(Y))this.loadedEvent_(Y);else{var oe;oe=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");var $e=this;oe.onreadystatechange=function(){4==oe.readyState&&(200!==oe.status&&0!==oe.status||$e.loadedEvent_(oe.responseText))},oe.open("GET",Y,!0),oe.send(null)}else console.error("Unknown data format: "+typeof Y)},lt.prototype.updateOptions=function(Y,ue){void 0===ue&&(ue=!1);var oe=Y.file,$e=lt.copyUserAttrs_(Y);"rollPeriod"in $e&&(this.rollPeriod_=$e.rollPeriod),"dateWindow"in $e&&(this.dateWindow_=$e.dateWindow);var Ge=ne.isPixelChangingOptionList(this.attr_("labels"),$e);ne.updateDeep(this.user_attrs_,$e),this.attributes_.reparseSeries(),oe?(this.cascadeEvents_("dataWillUpdate",{}),this.file_=oe,ue||this.start_()):ue||(Ge?this.predraw_():this.renderGraph_(!1))},lt.copyUserAttrs_=function(Y){var ue={};for(var oe in Y)Y.hasOwnProperty(oe)&&"file"!=oe&&Y.hasOwnProperty(oe)&&(ue[oe]=Y[oe]);return ue},lt.prototype.resize=function(Y,ue){if(!this.resize_lock){this.resize_lock=!0,null===Y!=(null===ue)&&(console.warn("Dygraph.resize() should be called with zero parameters or two non-NULL parameters. Pretending it was zero."),Y=ue=null);var oe=this.width_,$e=this.height_;Y?(this.maindiv_.style.width=Y+"px",this.maindiv_.style.height=ue+"px",this.width_=Y,this.height_=ue):(this.width_=this.maindiv_.clientWidth,this.height_=this.maindiv_.clientHeight),oe==this.width_&&$e==this.height_||(this.resizeElements_(),this.predraw_()),this.resize_lock=!1}},lt.prototype.adjustRoll=function(Y){this.rollPeriod_=Y,this.predraw_()},lt.prototype.visibility=function(){for(this.getOption("visibility")||(this.attrs_.visibility=[]);this.getOption("visibility").length<this.numColumns()-1;)this.attrs_.visibility.push(!0);return this.getOption("visibility")},lt.prototype.setVisibility=function(Y,ue){var oe=this.visibility(),$e=!1;if(Array.isArray(Y)||(null!==Y&&"object"==typeof Y?$e=!0:Y=[Y]),$e)for(var Ge in Y)Y.hasOwnProperty(Ge)&&(Ge<0||Ge>=oe.length?console.warn("Invalid series number in setVisibility: "+Ge):oe[Ge]=Y[Ge]);else for(Ge=0;Ge<Y.length;Ge++)"boolean"==typeof Y[Ge]?Ge>=oe.length?console.warn("Invalid series number in setVisibility: "+Ge):oe[Ge]=Y[Ge]:Y[Ge]<0||Y[Ge]>=oe.length?console.warn("Invalid series number in setVisibility: "+Y[Ge]):oe[Y[Ge]]=ue;this.predraw_()},lt.prototype.size=function(){return{width:this.width_,height:this.height_}},lt.prototype.setAnnotations=function(Y,ue){this.annotations_=Y,this.layout_?(this.layout_.setAnnotations(this.annotations_),ue||this.predraw_()):console.warn("Tried to setAnnotations before dygraph was ready. Try setting them in a ready() block. See dygraphs.com/tests/annotation.html")},lt.prototype.annotations=function(){return this.annotations_},lt.prototype.getLabels=function(){var Y=this.attr_("labels");return Y?Y.slice():null},lt.prototype.indexFromSetName=function(Y){return this.setIndexByName_[Y]},lt.prototype.getRowForX=function(Y){for(var ue=0,oe=this.numRows()-1;ue<=oe;){var $e=oe+ue>>1,Ge=this.getValue($e,0);if(Ge<Y)ue=$e+1;else if(Ge>Y)oe=$e-1;else{if(ue==$e)return $e;oe=$e}}return null},lt.prototype.ready=function(Y){this.is_initial_draw_?this.readyFns_.push(Y):Y.call(this,this)},lt.prototype.addAndTrackEvent=function(Y,ue,oe){ne.addEvent(Y,ue,oe),this.registeredEvents_.push({elem:Y,type:ue,fn:oe})},lt.prototype.removeTrackedEvents_=function(){if(this.registeredEvents_)for(var Y=0;Y<this.registeredEvents_.length;Y++){var ue=this.registeredEvents_[Y];ne.removeEvent(ue.elem,ue.type,ue.fn)}this.registeredEvents_=[]},lt.PLUGINS=[Ji.default,Bn.default,Xi.default,En.default,Si.default,vn.default],lt.GVizChart=Ai.default,lt.DASHED_LINE=ne.DASHED_LINE,lt.DOT_DASH_LINE=ne.DOT_DASH_LINE,lt.dateAxisLabelFormatter=ne.dateAxisLabelFormatter,lt.toRGB_=ne.toRGB_,lt.findPos=ne.findPos,lt.pageX=ne.pageX,lt.pageY=ne.pageY,lt.dateString_=ne.dateString_,lt.defaultInteractionModel=Be.default.defaultModel,lt.nonInteractiveModel=lt.nonInteractiveModel_=Be.default.nonInteractiveModel_,lt.Circles=ne.Circles,lt.Plugins={Legend:Ji.default,Axes:Bn.default,Annotations:Si.default,ChartLabels:En.default,Grid:vn.default,RangeSelector:Xi.default},lt.DataHandlers={DefaultHandler:fi.default,BarsHandler:ji.default,CustomBarsHandler:Ri.default,DefaultFractionHandler:mi.default,ErrorBarsHandler:li.default,FractionsBarsHandler:Pt.default},lt.startPan=Be.default.startPan,lt.startZoom=Be.default.startZoom,lt.movePan=Be.default.movePan,lt.moveZoom=Be.default.moveZoom,lt.endPan=Be.default.endPan,lt.endZoom=Be.default.endZoom,lt.numericLinearTicks=Se.numericLinearTicks,lt.numericTicks=Se.numericTicks,lt.dateTicker=Se.dateTicker,lt.Granularity=Se.Granularity,lt.getDateAxis=Se.getDateAxis,lt.floatFormat=ne.floatFormat,v.default=lt,Qe.exports=v.default}).call(this,Ae("_process"))},{"./datahandler/bars":5,"./datahandler/bars-custom":2,"./datahandler/bars-error":3,"./datahandler/bars-fractions":4,"./datahandler/default":8,"./datahandler/default-fractions":7,"./dygraph-canvas":9,"./dygraph-default-attrs":10,"./dygraph-gviz":11,"./dygraph-interaction-model":12,"./dygraph-layout":13,"./dygraph-options":15,"./dygraph-options-reference":14,"./dygraph-tickers":16,"./dygraph-utils":17,"./iframe-tarp":19,"./plugins/annotations":20,"./plugins/axes":21,"./plugins/chart-labels":22,"./plugins/grid":23,"./plugins/legend":24,"./plugins/range-selector":25,_process:1}],19:[function(Ae,Qe,v){"use strict";function $(){this.tarps=[]}Object.defineProperty(v,"__esModule",{value:!0});var o=function(D){if(D&&D.__esModule)return D;var N={};if(null!=D)for(var j in D)Object.prototype.hasOwnProperty.call(D,j)&&(N[j]=D[j]);return N.default=D,N}(Ae("./dygraph-utils"));$.prototype.cover=function(){for(var D=document.getElementsByTagName("iframe"),N=0;N<D.length;N++){var j=D[N],k=o.findPos(j),O=k.x,I=k.y,X=j.offsetWidth,le=j.offsetHeight,te=document.createElement("div");te.style.position="absolute",te.style.left=O+"px",te.style.top=I+"px",te.style.width=X+"px",te.style.height=le+"px",te.style.zIndex=999,document.body.appendChild(te),this.tarps.push(te)}},$.prototype.uncover=function(){for(var D=0;D<this.tarps.length;D++)this.tarps[D].parentNode.removeChild(this.tarps[D]);this.tarps=[]},v.default=$,Qe.exports=v.default},{"./dygraph-utils":17}],20:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var $=function(){this.annotations_=[]};$.prototype.toString=function(){return"Annotations Plugin"},$.prototype.activate=function(ae){return{clearChart:this.clearChart,didDrawChart:this.didDrawChart}},$.prototype.detachLabels=function(){for(var ae=0;ae<this.annotations_.length;ae++){var o=this.annotations_[ae];o.parentNode&&o.parentNode.removeChild(o),this.annotations_[ae]=null}this.annotations_=[]},$.prototype.clearChart=function(ae){this.detachLabels()},$.prototype.didDrawChart=function(ae){var o=ae.dygraph,D=o.layout_.annotated_points;if(D&&0!==D.length)for(var N=ae.canvas.parentNode,j=function(Wt,Nt,fi){return function($t){var li=fi.annotation;li.hasOwnProperty(Wt)?li[Wt](li,fi,o,$t):o.getOption(Nt)&&o.getOption(Nt)(li,fi,o,$t)}},k=ae.dygraph.getArea(),O={},I=0;I<D.length;I++){var X=D[I];if(!(X.canvasx<k.x||X.canvasx>k.x+k.w||X.canvasy<k.y||X.canvasy>k.y+k.h)){var le=X.annotation,te=6;le.hasOwnProperty("tickHeight")&&(te=le.tickHeight);var Be=document.createElement("div");Be.style.fontSize=o.getOption("axisLabelFontSize")+"px";var Ie="dygraph-annotation";le.hasOwnProperty("icon")||(Ie+=" dygraphDefaultAnnotation dygraph-default-annotation"),le.hasOwnProperty("cssClass")&&(Ie+=" "+le.cssClass),Be.className=Ie;var Se=le.hasOwnProperty("width")?le.width:16,Ke=le.hasOwnProperty("height")?le.height:16;if(le.hasOwnProperty("icon")){var ne=document.createElement("img");ne.src=le.icon,ne.width=Se,ne.height=Ke,Be.appendChild(ne)}else X.annotation.hasOwnProperty("shortText")&&Be.appendChild(document.createTextNode(X.annotation.shortText));var mt=X.canvasx-Se/2;Be.style.left=mt+"px";var C=0;if(le.attachAtBottom){var wt=k.y+k.h-Ke-te;O[mt]?wt-=O[mt]:O[mt]=0,O[mt]+=te+Ke,C=wt}else C=X.canvasy-Ke-te;Be.style.top=C+"px",Be.style.width=Se+"px",Be.style.height=Ke+"px",Be.title=X.annotation.text,Be.style.color=o.colorsMap_[X.name],Be.style.borderColor=o.colorsMap_[X.name],le.div=Be,o.addAndTrackEvent(Be,"click",j("clickHandler","annotationClickHandler",X)),o.addAndTrackEvent(Be,"mouseover",j("mouseOverHandler","annotationMouseOverHandler",X)),o.addAndTrackEvent(Be,"mouseout",j("mouseOutHandler","annotationMouseOutHandler",X)),o.addAndTrackEvent(Be,"dblclick",j("dblClickHandler","annotationDblClickHandler",X)),N.appendChild(Be),this.annotations_.push(Be);var xt=ae.drawingContext;xt.save(),xt.strokeStyle=le.hasOwnProperty("tickColor")?le.tickColor:o.colorsMap_[X.name],xt.lineWidth=le.hasOwnProperty("tickWidth")?le.tickWidth:o.getOption("strokeWidth"),xt.beginPath(),le.attachAtBottom?(xt.moveTo(X.canvasx,wt=C+Ke),xt.lineTo(X.canvasx,wt+te)):(xt.moveTo(X.canvasx,X.canvasy),xt.lineTo(X.canvasx,X.canvasy-2-te)),xt.closePath(),xt.stroke(),xt.restore()}}},$.prototype.destroy=function(){this.detachLabels()},v.default=$,Qe.exports=v.default},{}],21:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var ae=function(D){if(D&&D.__esModule)return D;var N={};if(null!=D)for(var j in D)Object.prototype.hasOwnProperty.call(D,j)&&(N[j]=D[j]);return N.default=D,N}(Ae("../dygraph-utils")),o=function(){this.xlabels_=[],this.ylabels_=[]};o.prototype.toString=function(){return"Axes Plugin"},o.prototype.activate=function(D){return{layout:this.layout,clearChart:this.clearChart,willDrawChart:this.willDrawChart}},o.prototype.layout=function(D){var k,N=D.dygraph;if(N.getOptionForAxis("drawAxis","y")){var j=N.getOptionForAxis("axisLabelWidth","y")+2*N.getOptionForAxis("axisTickSize","y");D.reserveSpaceLeft(j)}N.getOptionForAxis("drawAxis","x")&&(k=N.getOption("xAxisHeight")?N.getOption("xAxisHeight"):N.getOptionForAxis("axisLabelFontSize","x")+2*N.getOptionForAxis("axisTickSize","x"),D.reserveSpaceBottom(k)),2==N.numAxes()?N.getOptionForAxis("drawAxis","y2")&&(j=N.getOptionForAxis("axisLabelWidth","y2")+2*N.getOptionForAxis("axisTickSize","y2"),D.reserveSpaceRight(j)):N.numAxes()>2&&N.error("Only two y-axes are supported at this time. (Trying to use "+N.numAxes()+")")},o.prototype.detachLabels=function(){function D(N){for(var j=0;j<N.length;j++){var k=N[j];k.parentNode&&k.parentNode.removeChild(k)}}D(this.xlabels_),D(this.ylabels_),this.xlabels_=[],this.ylabels_=[]},o.prototype.clearChart=function(D){this.detachLabels()},o.prototype.willDrawChart=function(D){function N(mi){return Math.round(mi)+.5}function j(mi){return Math.round(mi)-.5}var k=this,O=D.dygraph;if(O.getOptionForAxis("drawAxis","x")||O.getOptionForAxis("drawAxis","y")||O.getOptionForAxis("drawAxis","y2")){var I,X,le,te=D.drawingContext,Be=D.canvas.parentNode,Ie=O.width_,Se=O.height_,Ke=function(mi){return{position:"absolute",fontSize:O.getOptionForAxis("axisLabelFontSize",mi)+"px",width:O.getOptionForAxis("axisLabelWidth",mi)+"px"}},ne={x:Ke("x"),y:Ke("y"),y2:Ke("y2")},mt=function(mi,tn,Pt){var wi=document.createElement("div");ae.update(wi.style,ne["y2"==Pt?"y2":tn]);var pt=document.createElement("div");return pt.className="dygraph-axis-label dygraph-axis-label-"+tn+(Pt?" dygraph-axis-label-"+Pt:""),pt.innerHTML=mi,wi.appendChild(pt),wi};te.save();var C=O.layout_,wt=D.dygraph.plotter_.area,xt=function(mi){return function(tn){return O.getOptionForAxis(tn,mi)}};if(O.getOptionForAxis("drawAxis","y")){if(C.yticks&&C.yticks.length>0){var Wt=O.numAxes(),Nt=[xt("y"),xt("y2")];C.yticks.forEach(function(mi){if(void 0!==mi.label){X=wt.x;var tn="y1",Pt=Nt[0];1==mi.axis&&(X=wt.x+wt.w,tn="y2",Pt=Nt[1]);var wi=Pt("axisLabelFontSize");le=wt.y+mi.pos*wt.h,I=mt(mi.label,"y",2==Wt?tn:null);var ji=le-wi/2;ji<0&&(ji=0),ji+wi+3>Se?I.style.bottom="0":I.style.top=ji+"px",0===mi.axis?(I.style.left=wt.x-Pt("axisLabelWidth")-Pt("axisTickSize")+"px",I.style.textAlign="right"):1==mi.axis&&(I.style.left=wt.x+wt.w+Pt("axisTickSize")+"px",I.style.textAlign="left"),I.style.width=Pt("axisLabelWidth")+"px",Be.appendChild(I),k.ylabels_.push(I)}});var fi=this.ylabels_[0],$t=O.getOptionForAxis("axisLabelFontSize","y");parseInt(fi.style.top,10)+$t>Se-$t&&(fi.style.top=parseInt(fi.style.top,10)-$t/2+"px")}var li;O.getOption("drawAxesAtZero")?(((qt=O.toPercentXCoord(0))>1||qt<0||isNaN(qt))&&(qt=0),li=N(wt.x+qt*wt.w)):li=N(wt.x),te.strokeStyle=O.getOptionForAxis("axisLineColor","y"),te.lineWidth=O.getOptionForAxis("axisLineWidth","y"),te.beginPath(),te.moveTo(li,j(wt.y)),te.lineTo(li,j(wt.y+wt.h)),te.closePath(),te.stroke(),2==O.numAxes()&&(te.strokeStyle=O.getOptionForAxis("axisLineColor","y2"),te.lineWidth=O.getOptionForAxis("axisLineWidth","y2"),te.beginPath(),te.moveTo(j(wt.x+wt.w),j(wt.y)),te.lineTo(j(wt.x+wt.w),j(wt.y+wt.h)),te.closePath(),te.stroke())}if(O.getOptionForAxis("drawAxis","x")){if(C.xticks){var Ri=xt("x");C.xticks.forEach(function(mi){if(void 0!==mi.label){X=wt.x+mi.pos*wt.w,le=wt.y+wt.h,(I=mt(mi.label,"x")).style.textAlign="center",I.style.top=le+Ri("axisTickSize")+"px";var tn=X-Ri("axisLabelWidth")/2;tn+Ri("axisLabelWidth")>Ie&&(tn=Ie-Ri("axisLabelWidth"),I.style.textAlign="right"),tn<0&&(tn=0,I.style.textAlign="left"),I.style.left=tn+"px",I.style.width=Ri("axisLabelWidth")+"px",Be.appendChild(I),k.xlabels_.push(I)}})}var Bi,qt;te.strokeStyle=O.getOptionForAxis("axisLineColor","x"),te.lineWidth=O.getOptionForAxis("axisLineWidth","x"),te.beginPath(),O.getOption("drawAxesAtZero")?(((qt=O.toPercentYCoord(0,0))>1||qt<0)&&(qt=1),Bi=j(wt.y+qt*wt.h)):Bi=j(wt.y+wt.h),te.moveTo(N(wt.x),Bi),te.lineTo(N(wt.x+wt.w),Bi),te.closePath(),te.stroke()}te.restore()}},v.default=o,Qe.exports=v.default},{"../dygraph-utils":17}],22:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var $=function(){this.title_div_=null,this.xlabel_div_=null,this.ylabel_div_=null,this.y2label_div_=null};$.prototype.toString=function(){return"ChartLabels Plugin"},$.prototype.activate=function(D){return{layout:this.layout,didDrawChart:this.didDrawChart}};var ae=function(D){var N=document.createElement("div");return N.style.position="absolute",N.style.left=D.x+"px",N.style.top=D.y+"px",N.style.width=D.w+"px",N.style.height=D.h+"px",N};$.prototype.detachLabels_=function(){for(var D=[this.title_div_,this.xlabel_div_,this.ylabel_div_,this.y2label_div_],N=0;N<D.length;N++){var j=D[N];j&&j.parentNode&&j.parentNode.removeChild(j)}this.title_div_=null,this.xlabel_div_=null,this.ylabel_div_=null,this.y2label_div_=null};var o=function(D,N,j,k,O){var I=document.createElement("div");I.style.position="absolute",I.style.left=1==j?"0px":N.x+"px",I.style.top=N.y+"px",I.style.width=N.w+"px",I.style.height=N.h+"px",I.style.fontSize=D.getOption("yLabelWidth")-2+"px";var X=document.createElement("div");X.style.position="absolute",X.style.width=N.h+"px",X.style.height=N.w+"px",X.style.top=N.h/2-N.w/2+"px",X.style.left=N.w/2-N.h/2+"px",X.className="dygraph-label-rotate-"+(1==j?"right":"left");var le=document.createElement("div");return le.className=k,le.innerHTML=O,X.appendChild(le),I.appendChild(X),I};$.prototype.layout=function(D){this.detachLabels_();var N=D.dygraph,j=D.chart_div;if(N.getOption("title")){var k=D.reserveSpaceTop(N.getOption("titleHeight"));this.title_div_=ae(k),this.title_div_.style.fontSize=N.getOption("titleHeight")-8+"px",(O=document.createElement("div")).className="dygraph-label dygraph-title",O.innerHTML=N.getOption("title"),this.title_div_.appendChild(O),j.appendChild(this.title_div_)}if(N.getOption("xlabel")){var O,I=D.reserveSpaceBottom(N.getOption("xLabelHeight"));this.xlabel_div_=ae(I),this.xlabel_div_.style.fontSize=N.getOption("xLabelHeight")-2+"px",(O=document.createElement("div")).className="dygraph-label dygraph-xlabel",O.innerHTML=N.getOption("xlabel"),this.xlabel_div_.appendChild(O),j.appendChild(this.xlabel_div_)}if(N.getOption("ylabel")){var X=D.reserveSpaceLeft(0);this.ylabel_div_=o(N,X,1,"dygraph-label dygraph-ylabel",N.getOption("ylabel")),j.appendChild(this.ylabel_div_)}if(N.getOption("y2label")&&2==N.numAxes()){var le=D.reserveSpaceRight(0);this.y2label_div_=o(N,le,2,"dygraph-label dygraph-y2label",N.getOption("y2label")),j.appendChild(this.y2label_div_)}},$.prototype.didDrawChart=function(D){var N=D.dygraph;this.title_div_&&(this.title_div_.children[0].innerHTML=N.getOption("title")),this.xlabel_div_&&(this.xlabel_div_.children[0].innerHTML=N.getOption("xlabel")),this.ylabel_div_&&(this.ylabel_div_.children[0].children[0].innerHTML=N.getOption("ylabel")),this.y2label_div_&&(this.y2label_div_.children[0].children[0].innerHTML=N.getOption("y2label"))},$.prototype.clearChart=function(){},$.prototype.destroy=function(){this.detachLabels_()},v.default=$,Qe.exports=v.default},{}],23:[function(Ae,Qe,v){"use strict";Object.defineProperty(v,"__esModule",{value:!0});var $=function(){};$.prototype.toString=function(){return"Gridline Plugin"},$.prototype.activate=function(ae){return{willDrawChart:this.willDrawChart}},$.prototype.willDrawChart=function(ae){function o(C){return Math.round(C)+.5}function D(C){return Math.round(C)-.5}var N,j,O,I=ae.dygraph,X=ae.drawingContext,le=I.layout_,te=ae.dygraph.plotter_.area;if(I.getOptionForAxis("drawGrid","y")){for(var Be=["y","y2"],Ie=[],Se=[],Ke=[],ne=[],mt=[],k=0;k<Be.length;k++)Ke[k]=I.getOptionForAxis("drawGrid",Be[k]),Ke[k]&&(Ie[k]=I.getOptionForAxis("gridLineColor",Be[k]),Se[k]=I.getOptionForAxis("gridLineWidth",Be[k]),mt[k]=I.getOptionForAxis("gridLinePattern",Be[k]),ne[k]=mt[k]&&mt[k].length>=2);O=le.yticks,X.save(),O.forEach(function(C){if(C.has_tick){var wt=C.axis;Ke[wt]&&(X.save(),ne[wt]&&X.setLineDash&&X.setLineDash(mt[wt]),X.strokeStyle=Ie[wt],X.lineWidth=Se[wt],N=o(te.x),j=D(te.y+C.pos*te.h),X.beginPath(),X.moveTo(N,j),X.lineTo(N+te.w,j),X.stroke(),X.restore())}}),X.restore()}I.getOptionForAxis("drawGrid","x")&&(O=le.xticks,X.save(),mt=I.getOptionForAxis("gridLinePattern","x"),(ne=mt&&mt.length>=2)&&X.setLineDash&&X.setLineDash(mt),X.strokeStyle=I.getOptionForAxis("gridLineColor","x"),X.lineWidth=I.getOptionForAxis("gridLineWidth","x"),O.forEach(function(xt){xt.has_tick&&(N=o(te.x+xt.pos*te.w),j=D(te.y+te.h),X.beginPath(),X.moveTo(N,j),X.lineTo(N,te.y),X.closePath(),X.stroke())}),ne&&X.setLineDash&&X.setLineDash([]),X.restore())},$.prototype.destroy=function(){},v.default=$,Qe.exports=v.default},{}],24:[function(Ae,Qe,v){"use strict";function $(k,O,I){if(!k||k.length<=1)return'<div class="dygraph-legend-line" style="border-bottom-color: '+O+';"></div>';var X,le,Ie,Se=0,Ke=0,ne=[];for(X=0;X<=k.length;X++)Se+=k[X%k.length];if((Ie=Math.floor(I/(Se-k[0])))>1){for(X=0;X<k.length;X++)ne[X]=k[X]/I;Ke=ne.length}else{for(Ie=1,X=0;X<k.length;X++)ne[X]=k[X]/Se;Ke=ne.length+1}var mt="";for(le=0;le<Ie;le++)for(X=0;X<Ke;X+=2)mt+='<div class="dygraph-legend-dash" style="margin-right: '+(X<k.length?ne[(X+1)%ne.length]:0)+"em; padding-left: "+ne[X%ne.length]+'em;"></div>';return mt}Object.defineProperty(v,"__esModule",{value:!0});var o=function(k){if(k&&k.__esModule)return k;var O={};if(null!=k)for(var I in k)Object.prototype.hasOwnProperty.call(k,I)&&(O[I]=k[I]);return O.default=k,O}(Ae("../dygraph-utils")),D=function(){this.legend_div_=null,this.is_generated_div_=!1};D.prototype.toString=function(){return"Legend Plugin"},D.prototype.activate=function(k){var O,I=k.getOption("labelsDiv");return I&&null!==I?O="string"==typeof I||I instanceof String?document.getElementById(I):I:((O=document.createElement("div")).className="dygraph-legend",k.graphDiv.appendChild(O),this.is_generated_div_=!0),this.legend_div_=O,this.one_em_width_=10,{select:this.select,deselect:this.deselect,predraw:this.predraw,didDrawChart:this.didDrawChart}};var j=function(k){return k.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};D.prototype.select=function(k){var O=k.selectedX,I=k.selectedPoints,X=k.selectedRow,le=k.dygraph.getOption("legend");if("never"!==le){if("follow"===le){var te=k.dygraph.plotter_.area,Be=this.legend_div_.offsetWidth,Ie=k.dygraph.getOptionForAxis("axisLabelWidth","y"),Se=I[0].x*te.w+50,Ke=I[0].y*te.h-50;Se+Be+1>te.w&&(Se=Se-100-Be-(Ie-te.x)),k.dygraph.graphDiv.appendChild(this.legend_div_),this.legend_div_.style.left=Ie+Se+"px",this.legend_div_.style.top=Ke+"px"}var ne=D.generateLegendHTML(k.dygraph,O,I,this.one_em_width_,X);this.legend_div_.innerHTML=ne,this.legend_div_.style.display=""}else this.legend_div_.style.display="none"},D.prototype.deselect=function(k){"always"!==k.dygraph.getOption("legend")&&(this.legend_div_.style.display="none");var O=function(k){var O=document.createElement("span");O.setAttribute("style","margin: 0; padding: 0 0 0 1em; border: 0;"),k.appendChild(O);var I=O.offsetWidth;return k.removeChild(O),I}(this.legend_div_);this.one_em_width_=O;var I=D.generateLegendHTML(k.dygraph,void 0,void 0,O,null);this.legend_div_.innerHTML=I},D.prototype.didDrawChart=function(k){this.deselect(k)},D.prototype.predraw=function(k){if(this.is_generated_div_){k.dygraph.graphDiv.appendChild(this.legend_div_);var O=k.dygraph.getArea();this.legend_div_.style.left=O.x+O.w-this.legend_div_.offsetWidth-1+"px",this.legend_div_.style.top=O.y+"px"}},D.prototype.destroy=function(){this.legend_div_=null},D.generateLegendHTML=function(k,O,I,X,le){var te={dygraph:k,x:O,series:[]},Be={},Ie=k.getLabels();if(Ie)for(var Se=1;Se<Ie.length;Se++){var Ke=k.getPropertiesForSeries(Ie[Se]),mt={dashHTML:$(k.getOption("strokePattern",Ie[Se]),Ke.color,X),label:Ie[Se],labelHTML:j(Ie[Se]),isVisible:Ke.visible,color:Ke.color};te.series.push(mt),Be[Ie[Se]]=mt}if(void 0!==O){var C=k.optionsViewForAxis_("x"),wt=C("valueFormatter");te.xHTML=wt.call(k,O,C,Ie[0],k,le,0);var xt=[],Wt=k.numAxes();for(Se=0;Se<Wt;Se++)xt[Se]=k.optionsViewForAxis_("y"+(Se?1+Se:""));var Nt=k.getOption("labelsShowZeroValues"),fi=k.getHighlightSeries();for(Se=0;Se<I.length;Se++){var $t=I[Se];if((mt=Be[$t.name]).y=$t.yval,0===$t.yval&&!Nt||isNaN($t.canvasy))mt.isVisible=!1;else{var li=xt[(Ke=k.getPropertiesForSeries($t.name)).axis-1],Ri=li("valueFormatter").call(k,$t.yval,li,$t.name,k,le,Ie.indexOf($t.name));o.update(mt,{yHTML:Ri}),$t.name==fi&&(mt.isHighlighted=!0)}}}return(k.getOption("legendFormatter")||D.defaultFormatter).call(k,te)},D.defaultFormatter=function(k){var O=k.dygraph;if(!0!==O.getOption("showLabelsOnHighlight"))return"";var I,X=O.getOption("labelsSeparateLines");if(void 0===k.x){if("always"!=O.getOption("legend"))return"";I="";for(var le=0;le<k.series.length;le++)(te=k.series[le]).isVisible&&(""!==I&&(I+=X?"<br/>":" "),I+="<span style='font-weight: bold; color: "+te.color+";'>"+te.dashHTML+" "+te.labelHTML+"</span>");return I}for(I=k.xHTML+":",le=0;le<k.series.length;le++){var te;(te=k.series[le]).isVisible&&(X&&(I+="<br>"),I+="<span"+(te.isHighlighted?' class="highlight"':"")+"> <b><span style='color: "+te.color+";'>"+te.labelHTML+"</span></b>:&#160;"+te.yHTML+"</span>")}return I},v.default=D,Qe.exports=v.default},{"../dygraph-utils":17}],25:[function(Ae,Qe,v){"use strict";function $(I){return I&&I.__esModule?I:{default:I}}Object.defineProperty(v,"__esModule",{value:!0});var o=function(I){if(I&&I.__esModule)return I;var X={};if(null!=I)for(var le in I)Object.prototype.hasOwnProperty.call(I,le)&&(X[le]=I[le]);return X.default=I,X}(Ae("../dygraph-utils")),N=$(Ae("../dygraph-interaction-model")),k=$(Ae("../iframe-tarp")),O=function(){this.hasTouchInterface_=typeof TouchEvent<"u",this.isMobileDevice_=/mobile|android/gi.test(navigator.appVersion),this.interfaceCreated_=!1};O.prototype.toString=function(){return"RangeSelector Plugin"},O.prototype.activate=function(I){return this.dygraph_=I,this.getOption_("showRangeSelector")&&this.createInterface_(),{layout:this.reserveSpace_,predraw:this.renderStaticLayer_,didDrawChart:this.renderInteractiveLayer_}},O.prototype.destroy=function(){this.bgcanvas_=null,this.fgcanvas_=null,this.leftZoomHandle_=null,this.rightZoomHandle_=null},O.prototype.getOption_=function(I,X){return this.dygraph_.getOption(I,X)},O.prototype.setDefaultOption_=function(I,X){this.dygraph_.attrs_[I]=X},O.prototype.createInterface_=function(){this.createCanvases_(),this.createZoomHandles_(),this.initInteraction_(),this.getOption_("animatedZooms")&&(console.warn("Animated zooms and range selector are not compatible; disabling animatedZooms."),this.dygraph_.updateOptions({animatedZooms:!1},!0)),this.interfaceCreated_=!0,this.addToGraph_()},O.prototype.addToGraph_=function(){var I=this.graphDiv_=this.dygraph_.graphDiv;I.appendChild(this.bgcanvas_),I.appendChild(this.fgcanvas_),I.appendChild(this.leftZoomHandle_),I.appendChild(this.rightZoomHandle_)},O.prototype.removeFromGraph_=function(){var I=this.graphDiv_;I.removeChild(this.bgcanvas_),I.removeChild(this.fgcanvas_),I.removeChild(this.leftZoomHandle_),I.removeChild(this.rightZoomHandle_),this.graphDiv_=null},O.prototype.reserveSpace_=function(I){this.getOption_("showRangeSelector")&&I.reserveSpaceBottom(this.getOption_("rangeSelectorHeight")+4)},O.prototype.renderStaticLayer_=function(){this.updateVisibility_()&&(this.resize_(),this.drawStaticLayer_())},O.prototype.renderInteractiveLayer_=function(){this.updateVisibility_()&&!this.isChangingRange_&&(this.placeZoomHandles_(),this.drawInteractiveLayer_())},O.prototype.updateVisibility_=function(){var I=this.getOption_("showRangeSelector");if(I)this.interfaceCreated_?this.graphDiv_&&this.graphDiv_.parentNode||this.addToGraph_():this.createInterface_();else if(this.graphDiv_){this.removeFromGraph_();var X=this.dygraph_;setTimeout(function(){X.width_=0,X.resize()},1)}return I},O.prototype.resize_=function(){function I(Be,Ie,Se,Ke){var ne=Ke||o.getContextPixelRatio(Ie);Be.style.top=Se.y+"px",Be.style.left=Se.x+"px",Be.width=Se.w*ne,Be.height=Se.h*ne,Be.style.width=Se.w+"px",Be.style.height=Se.h+"px",1!=ne&&Ie.scale(ne,ne)}var X=this.dygraph_.layout_.getPlotArea(),le=0;this.dygraph_.getOptionForAxis("drawAxis","x")&&(le=this.getOption_("xAxisHeight")||this.getOption_("axisLabelFontSize")+2*this.getOption_("axisTickSize")),this.canvasRect_={x:X.x,y:X.y+X.h+le+4,w:X.w,h:this.getOption_("rangeSelectorHeight")};var te=this.dygraph_.getNumericOption("pixelRatio");I(this.bgcanvas_,this.bgcanvas_ctx_,this.canvasRect_,te),I(this.fgcanvas_,this.fgcanvas_ctx_,this.canvasRect_,te)},O.prototype.createCanvases_=function(){this.bgcanvas_=o.createCanvas(),this.bgcanvas_.className="dygraph-rangesel-bgcanvas",this.bgcanvas_.style.position="absolute",this.bgcanvas_.style.zIndex=9,this.bgcanvas_ctx_=o.getContext(this.bgcanvas_),this.fgcanvas_=o.createCanvas(),this.fgcanvas_.className="dygraph-rangesel-fgcanvas",this.fgcanvas_.style.position="absolute",this.fgcanvas_.style.zIndex=9,this.fgcanvas_.style.cursor="default",this.fgcanvas_ctx_=o.getContext(this.fgcanvas_)},O.prototype.createZoomHandles_=function(){var I=new Image;I.className="dygraph-rangesel-zoomhandle",I.style.position="absolute",I.style.zIndex=10,I.style.visibility="hidden",I.style.cursor="col-resize",I.width=9,I.height=16,I.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAQCAYAAADESFVDAAAAAXNSR0IArs4c6QAAAAZiS0dEANAAzwDP4Z7KegAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAAd0SU1FB9sHGw0cMqdt1UwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAaElEQVQoz+3SsRFAQBCF4Z9WJM8KCDVwownl6YXsTmCUsyKGkZzcl7zkz3YLkypgAnreFmDEpHkIwVOMfpdi9CEEN2nGpFdwD03yEqDtOgCaun7sqSTDH32I1pQA2Pb9sZecAxc5r3IAb21d6878xsAAAAAASUVORK5CYII=",this.isMobileDevice_&&(I.width*=2,I.height*=2),this.leftZoomHandle_=I,this.rightZoomHandle_=I.cloneNode(!1)},O.prototype.initInteraction_=function(){var I,X,le,te,Be,Ie,Se,Ke,ne,mt,C,wt,xt,Wt,Nt=this,fi=document,$t=0,li=null,qt=!1,Ri=!1,Bi=!this.isMobileDevice_,mi=new k.default;I=function(Pt){var wi=Nt.dygraph_.xAxisExtremes(),ji=(wi[1]-wi[0])/Nt.canvasRect_.w;return[wi[0]+(Pt.leftHandlePos-Nt.canvasRect_.x)*ji,wi[0]+(Pt.rightHandlePos-Nt.canvasRect_.x)*ji]},X=function(Pt){return o.cancelEvent(Pt),qt=!0,$t=Pt.clientX,li=Pt.target?Pt.target:Pt.srcElement,"mousedown"!==Pt.type&&"dragstart"!==Pt.type||(o.addEvent(fi,"mousemove",le),o.addEvent(fi,"mouseup",te)),Nt.fgcanvas_.style.cursor="col-resize",mi.cover(),!0},le=function(Pt){if(!qt)return!1;o.cancelEvent(Pt);var wi=Pt.clientX-$t;if(Math.abs(wi)<4)return!0;$t=Pt.clientX;var ji,pt=Nt.getZoomHandleStatus_();return li==Nt.leftZoomHandle_?(ji=pt.leftHandlePos+wi,ji=Math.min(ji,pt.rightHandlePos-li.width-3),ji=Math.max(ji,Nt.canvasRect_.x)):(ji=pt.rightHandlePos+wi,ji=Math.min(ji,Nt.canvasRect_.x+Nt.canvasRect_.w),ji=Math.max(ji,pt.leftHandlePos+li.width+3)),li.style.left=ji-li.width/2+"px",Nt.drawInteractiveLayer_(),Bi&&Be(),!0},te=function(Pt){return!!qt&&(qt=!1,mi.uncover(),o.removeEvent(fi,"mousemove",le),o.removeEvent(fi,"mouseup",te),Nt.fgcanvas_.style.cursor="default",Bi||Be(),!0)},Be=function(){try{var Pt=Nt.getZoomHandleStatus_();if(Nt.isChangingRange_=!0,Pt.isZoomed){var wi=I(Pt);Nt.dygraph_.doZoomXDates_(wi[0],wi[1])}else Nt.dygraph_.resetZoom()}finally{Nt.isChangingRange_=!1}},Ie=function(Pt){var wi=Nt.leftZoomHandle_.getBoundingClientRect(),ji=wi.left+wi.width/2;return wi=Nt.rightZoomHandle_.getBoundingClientRect(),Pt.clientX>ji&&Pt.clientX<wi.left+wi.width/2},Se=function(Pt){return!(Ri||!Ie(Pt)||!Nt.getZoomHandleStatus_().isZoomed||(o.cancelEvent(Pt),Ri=!0,$t=Pt.clientX,"mousedown"===Pt.type&&(o.addEvent(fi,"mousemove",Ke),o.addEvent(fi,"mouseup",ne)),0))},Ke=function(Pt){if(!Ri)return!1;o.cancelEvent(Pt);var wi=Pt.clientX-$t;if(Math.abs(wi)<4)return!0;$t=Pt.clientX;var ji=Nt.getZoomHandleStatus_(),pt=ji.leftHandlePos,Si=ji.rightHandlePos,mn=Si-pt;pt+wi<=Nt.canvasRect_.x?Si=(pt=Nt.canvasRect_.x)+mn:Si+wi>=Nt.canvasRect_.x+Nt.canvasRect_.w?pt=(Si=Nt.canvasRect_.x+Nt.canvasRect_.w)-mn:(pt+=wi,Si+=wi);var Bn=Nt.leftZoomHandle_.width/2;return Nt.leftZoomHandle_.style.left=pt-Bn+"px",Nt.rightZoomHandle_.style.left=Si-Bn+"px",Nt.drawInteractiveLayer_(),Bi&&mt(),!0},ne=function(Pt){return!!Ri&&(Ri=!1,o.removeEvent(fi,"mousemove",Ke),o.removeEvent(fi,"mouseup",ne),Bi||mt(),!0)},mt=function(){try{Nt.isChangingRange_=!0,Nt.dygraph_.dateWindow_=I(Nt.getZoomHandleStatus_()),Nt.dygraph_.drawGraph_(!1)}finally{Nt.isChangingRange_=!1}},C=function(Pt){if(!qt&&!Ri){var wi=Ie(Pt)?"move":"default";wi!=Nt.fgcanvas_.style.cursor&&(Nt.fgcanvas_.style.cursor=wi)}},wt=function(Pt){"touchstart"==Pt.type&&1==Pt.targetTouches.length?X(Pt.targetTouches[0])&&o.cancelEvent(Pt):"touchmove"==Pt.type&&1==Pt.targetTouches.length?le(Pt.targetTouches[0])&&o.cancelEvent(Pt):te(Pt)},xt=function(Pt){"touchstart"==Pt.type&&1==Pt.targetTouches.length?Se(Pt.targetTouches[0])&&o.cancelEvent(Pt):"touchmove"==Pt.type&&1==Pt.targetTouches.length?Ke(Pt.targetTouches[0])&&o.cancelEvent(Pt):ne(Pt)},Wt=function(Pt,wi){for(var ji=["touchstart","touchend","touchmove","touchcancel"],pt=0;pt<ji.length;pt++)Nt.dygraph_.addAndTrackEvent(Pt,ji[pt],wi)},this.setDefaultOption_("interactionModel",N.default.dragIsPanInteractionModel),this.setDefaultOption_("panEdgeFraction",1e-4);var tn=window.opera?"mousedown":"dragstart";this.dygraph_.addAndTrackEvent(this.leftZoomHandle_,tn,X),this.dygraph_.addAndTrackEvent(this.rightZoomHandle_,tn,X),this.dygraph_.addAndTrackEvent(this.fgcanvas_,"mousedown",Se),this.dygraph_.addAndTrackEvent(this.fgcanvas_,"mousemove",C),this.hasTouchInterface_&&(Wt(this.leftZoomHandle_,wt),Wt(this.rightZoomHandle_,wt),Wt(this.fgcanvas_,xt))},O.prototype.drawStaticLayer_=function(){var I=this.bgcanvas_ctx_;I.clearRect(0,0,this.canvasRect_.w,this.canvasRect_.h);try{this.drawMiniPlot_()}catch(X){console.warn(X)}this.bgcanvas_ctx_.lineWidth=this.getOption_("rangeSelectorBackgroundLineWidth"),I.strokeStyle=this.getOption_("rangeSelectorBackgroundStrokeColor"),I.beginPath(),I.moveTo(.5,.5),I.lineTo(.5,this.canvasRect_.h-.5),I.lineTo(this.canvasRect_.w-.5,this.canvasRect_.h-.5),I.lineTo(this.canvasRect_.w-.5,.5),I.stroke()},O.prototype.drawMiniPlot_=function(){var I=this.getOption_("rangeSelectorPlotFillColor"),X=this.getOption_("rangeSelectorPlotFillGradientColor"),le=this.getOption_("rangeSelectorPlotStrokeColor");if(I||le){var te=this.getOption_("stepPlot"),Be=this.computeCombinedSeriesAndLimits_(),Ie=Be.yMax-Be.yMin,Se=this.bgcanvas_ctx_,Ke=this.dygraph_.xAxisExtremes(),ne=Math.max(Ke[1]-Ke[0],1e-30),mt=(this.canvasRect_.w-.5)/ne,C=(this.canvasRect_.h-.5)/Ie,wt=this.canvasRect_.w-.5,xt=this.canvasRect_.h-.5,Wt=null,Nt=null;Se.beginPath(),Se.moveTo(.5,xt);for(var fi=0;fi<Be.data.length;fi++){var $t=Be.data[fi],li=null!==$t[0]?($t[0]-Ke[0])*mt:NaN,qt=null!==$t[1]?xt-($t[1]-Be.yMin)*C:NaN;(te||null===Wt||Math.round(li)!=Math.round(Wt))&&(isFinite(li)&&isFinite(qt)?(null===Wt?Se.lineTo(li,xt):te&&Se.lineTo(li,Nt),Se.lineTo(li,qt),Wt=li,Nt=qt):(null!==Wt&&(te?(Se.lineTo(li,Nt),Se.lineTo(li,xt)):Se.lineTo(Wt,xt)),Wt=Nt=null))}if(Se.lineTo(wt,xt),Se.closePath(),I){var Ri=this.bgcanvas_ctx_.createLinearGradient(0,0,0,xt);X&&Ri.addColorStop(0,X),Ri.addColorStop(1,I),this.bgcanvas_ctx_.fillStyle=Ri,Se.fill()}le&&(this.bgcanvas_ctx_.strokeStyle=le,this.bgcanvas_ctx_.lineWidth=this.getOption_("rangeSelectorPlotLineWidth"),Se.stroke())}},O.prototype.computeCombinedSeriesAndLimits_=function(){var I,X=this.dygraph_,le=this.getOption_("logscale"),te=X.numColumns(),Be=X.getLabels(),Ie=new Array(te),Se=!1,Ke=X.visibility(),ne=[];for(I=1;I<te;I++){var mt=this.getOption_("showInRangeSelector",Be[I]);ne.push(mt),null!==mt&&(Se=!0)}if(Se)for(I=1;I<te;I++)Ie[I]=ne[I-1];else for(I=1;I<te;I++)Ie[I]=Ke[I-1];var C=[],wt=X.dataHandler_,xt=X.attributes_;for(I=1;I<X.numColumns();I++)if(Ie[I]){var Wt=wt.extractSeries(X.rawData_,I,xt);X.rollPeriod()>1&&(Wt=wt.rollingAverage(Wt,X.rollPeriod(),xt)),C.push(Wt)}var Nt=[];for(I=0;I<C[0].length;I++){for(var fi=0,$t=0,li=0;li<C.length;li++){var qt=C[li][I][1];null===qt||isNaN(qt)||($t++,fi+=qt)}Nt.push([C[0][I][0],fi/$t])}var Ri=Number.MAX_VALUE,Bi=-Number.MAX_VALUE;for(I=0;I<Nt.length;I++){var mi=Nt[I][1];null!==mi&&isFinite(mi)&&(!le||mi>0)&&(Ri=Math.min(Ri,mi),Bi=Math.max(Bi,mi))}if(le)for(Bi=o.log10(Bi),Bi+=.25*Bi,Ri=o.log10(Ri),I=0;I<Nt.length;I++)Nt[I][1]=o.log10(Nt[I][1]);else{var tn,Pt=Bi-Ri;Bi+=tn=Pt<=Number.MIN_VALUE?.25*Bi:.25*Pt,Ri-=tn}return{data:Nt,yMin:Ri,yMax:Bi}},O.prototype.placeZoomHandles_=function(){var I=this.dygraph_.xAxisExtremes(),X=this.dygraph_.xAxisRange(),le=I[1]-I[0],te=Math.max(0,(X[0]-I[0])/le),Be=Math.max(0,(I[1]-X[1])/le),Ie=this.canvasRect_.x+this.canvasRect_.w*te,Se=this.canvasRect_.x+this.canvasRect_.w*(1-Be),Ke=Math.max(this.canvasRect_.y,this.canvasRect_.y+(this.canvasRect_.h-this.leftZoomHandle_.height)/2),ne=this.leftZoomHandle_.width/2;this.leftZoomHandle_.style.left=Ie-ne+"px",this.leftZoomHandle_.style.top=Ke+"px",this.rightZoomHandle_.style.left=Se-ne+"px",this.rightZoomHandle_.style.top=this.leftZoomHandle_.style.top,this.leftZoomHandle_.style.visibility="visible",this.rightZoomHandle_.style.visibility="visible"},O.prototype.drawInteractiveLayer_=function(){var I=this.fgcanvas_ctx_;I.clearRect(0,0,this.canvasRect_.w,this.canvasRect_.h);var X=this.canvasRect_.w-1,le=this.canvasRect_.h-1,te=this.getZoomHandleStatus_();if(I.strokeStyle=this.getOption_("rangeSelectorForegroundStrokeColor"),I.lineWidth=this.getOption_("rangeSelectorForegroundLineWidth"),te.isZoomed){var Be=Math.max(1,te.leftHandlePos-this.canvasRect_.x),Ie=Math.min(X,te.rightHandlePos-this.canvasRect_.x);I.fillStyle="rgba(240, 240, 240, "+this.getOption_("rangeSelectorAlpha").toString()+")",I.fillRect(0,0,Be,this.canvasRect_.h),I.fillRect(Ie,0,this.canvasRect_.w-Ie,this.canvasRect_.h),I.beginPath(),I.moveTo(1,1),I.lineTo(Be,1),I.lineTo(Be,le),I.lineTo(Ie,le),I.lineTo(Ie,1),I.lineTo(X,1),I.stroke()}else I.beginPath(),I.moveTo(1,1),I.lineTo(1,le),I.lineTo(X,le),I.lineTo(X,1),I.stroke()},O.prototype.getZoomHandleStatus_=function(){var I=this.leftZoomHandle_.width/2,X=parseFloat(this.leftZoomHandle_.style.left)+I,le=parseFloat(this.rightZoomHandle_.style.left)+I;return{leftHandlePos:X,rightHandlePos:le,isZoomed:X-1>this.canvasRect_.x||le+1<this.canvasRect_.x+this.canvasRect_.w}},v.default=O,Qe.exports=v.default},{"../dygraph-interaction-model":12,"../dygraph-utils":17,"../iframe-tarp":19}]},{},[18])(18)}),function(Ae){"use strict";"function"==typeof define&&define.amd?define(["jquery"],Ae):typeof exports<"u"?module.exports=Ae(require("jquery")):Ae(jQuery)}(function(Ae){"use strict";var v,Qe=window;(v=0,Qe=function($,ae){var o,D=this;D.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:Ae($),appendDots:Ae($),arrows:!0,asNavFor:null,prevArrow:'<button class="slick-prev" aria-label="Previous" type="button">Previous</button>',nextArrow:'<button class="slick-next" aria-label="Next" type="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(N,j){return Ae('<button type="button" />').text(j+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,focusOnChange:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},D.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,scrolling:!1,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,swiping:!1,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},Ae.extend(D,D.initials),D.activeBreakpoint=null,D.animType=null,D.animProp=null,D.breakpoints=[],D.breakpointSettings=[],D.cssTransitions=!1,D.focussed=!1,D.interrupted=!1,D.hidden="hidden",D.paused=!0,D.positionProp=null,D.respondTo=null,D.rowCount=1,D.shouldClick=!0,D.$slider=Ae($),D.$slidesCache=null,D.transformType=null,D.transitionType=null,D.visibilityChange="visibilitychange",D.windowWidth=0,D.windowTimer=null,o=Ae($).data("slick")||{},D.options=Ae.extend({},D.defaults,ae,o),D.currentSlide=D.options.initialSlide,D.originalSettings=D.options,void 0!==document.mozHidden?(D.hidden="mozHidden",D.visibilityChange="mozvisibilitychange"):void 0!==document.webkitHidden&&(D.hidden="webkitHidden",D.visibilityChange="webkitvisibilitychange"),D.autoPlay=Ae.proxy(D.autoPlay,D),D.autoPlayClear=Ae.proxy(D.autoPlayClear,D),D.autoPlayIterator=Ae.proxy(D.autoPlayIterator,D),D.changeSlide=Ae.proxy(D.changeSlide,D),D.clickHandler=Ae.proxy(D.clickHandler,D),D.selectHandler=Ae.proxy(D.selectHandler,D),D.setPosition=Ae.proxy(D.setPosition,D),D.swipeHandler=Ae.proxy(D.swipeHandler,D),D.dragHandler=Ae.proxy(D.dragHandler,D),D.keyHandler=Ae.proxy(D.keyHandler,D),D.instanceUid=v++,D.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,D.registerBreakpoints(),D.init(!0)}).prototype.activateADA=function(){this.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},Qe.prototype.addSlide=Qe.prototype.slickAdd=function(v,$,ae){var o=this;if("boolean"==typeof $)ae=$,$=null;else if($<0||$>=o.slideCount)return!1;o.unload(),"number"==typeof $?0===$&&0===o.$slides.length?Ae(v).appendTo(o.$slideTrack):ae?Ae(v).insertBefore(o.$slides.eq($)):Ae(v).insertAfter(o.$slides.eq($)):!0===ae?Ae(v).prependTo(o.$slideTrack):Ae(v).appendTo(o.$slideTrack),o.$slides=o.$slideTrack.children(this.options.slide),o.$slideTrack.children(this.options.slide).detach(),o.$slideTrack.append(o.$slides),o.$slides.each(function(D,N){Ae(N).attr("data-slick-index",D)}),o.$slidesCache=o.$slides,o.reinit()},Qe.prototype.animateHeight=function(){var v=this;if(1===v.options.slidesToShow&&!0===v.options.adaptiveHeight&&!1===v.options.vertical){var $=v.$slides.eq(v.currentSlide).outerHeight(!0);v.$list.animate({height:$},v.options.speed)}},Qe.prototype.animateSlide=function(v,$){var ae={},o=this;o.animateHeight(),!0===o.options.rtl&&!1===o.options.vertical&&(v=-v),!1===o.transformsEnabled?o.$slideTrack.animate(!1===o.options.vertical?{left:v}:{top:v},o.options.speed,o.options.easing,$):!1===o.cssTransitions?(!0===o.options.rtl&&(o.currentLeft=-o.currentLeft),Ae({animStart:o.currentLeft}).animate({animStart:v},{duration:o.options.speed,easing:o.options.easing,step:function(D){D=Math.ceil(D),!1===o.options.vertical?(ae[o.animType]="translate("+D+"px, 0px)",o.$slideTrack.css(ae)):(ae[o.animType]="translate(0px,"+D+"px)",o.$slideTrack.css(ae))},complete:function(){$&&$.call()}})):(o.applyTransition(),v=Math.ceil(v),ae[o.animType]=!1===o.options.vertical?"translate3d("+v+"px, 0px, 0px)":"translate3d(0px,"+v+"px, 0px)",o.$slideTrack.css(ae),$&&setTimeout(function(){o.disableTransition(),$.call()},o.options.speed))},Qe.prototype.getNavTarget=function(){var $=this.options.asNavFor;return $&&null!==$&&($=Ae($).not(this.$slider)),$},Qe.prototype.asNavFor=function(v){var $=this.getNavTarget();null!==$&&"object"==typeof $&&$.each(function(){var ae=Ae(this).slick("getSlick");ae.unslicked||ae.slideHandler(v,!0)})},Qe.prototype.applyTransition=function(v){var $=this,ae={};ae[$.transitionType]=!1===$.options.fade?$.transformType+" "+$.options.speed+"ms "+$.options.cssEase:"opacity "+$.options.speed+"ms "+$.options.cssEase,!1===$.options.fade?$.$slideTrack.css(ae):$.$slides.eq(v).css(ae)},Qe.prototype.autoPlay=function(){var v=this;v.autoPlayClear(),v.slideCount>v.options.slidesToShow&&(v.autoPlayTimer=setInterval(v.autoPlayIterator,v.options.autoplaySpeed))},Qe.prototype.autoPlayClear=function(){this.autoPlayTimer&&clearInterval(this.autoPlayTimer)},Qe.prototype.autoPlayIterator=function(){var v=this,$=v.currentSlide+v.options.slidesToScroll;v.paused||v.interrupted||v.focussed||(!1===v.options.infinite&&(1===v.direction&&v.currentSlide+1===v.slideCount-1?v.direction=0:0===v.direction&&($=v.currentSlide-v.options.slidesToScroll,v.currentSlide-1==0&&(v.direction=1))),v.slideHandler($))},Qe.prototype.buildArrows=function(){var v=this;!0===v.options.arrows&&(v.$prevArrow=Ae(v.options.prevArrow).addClass("slick-arrow"),v.$nextArrow=Ae(v.options.nextArrow).addClass("slick-arrow"),v.slideCount>v.options.slidesToShow?(v.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),v.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),v.htmlExpr.test(v.options.prevArrow)&&v.$prevArrow.prependTo(v.options.appendArrows),v.htmlExpr.test(v.options.nextArrow)&&v.$nextArrow.appendTo(v.options.appendArrows),!0!==v.options.infinite&&v.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):v.$prevArrow.add(v.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},Qe.prototype.buildDots=function(){var v,$,ae=this;if(!0===ae.options.dots){for(ae.$slider.addClass("slick-dotted"),$=Ae("<ul />").addClass(ae.options.dotsClass),v=0;v<=ae.getDotCount();v+=1)$.append(Ae("<li />").append(ae.options.customPaging.call(this,ae,v)));ae.$dots=$.appendTo(ae.options.appendDots),ae.$dots.find("li").first().addClass("slick-active")}},Qe.prototype.buildOut=function(){var v=this;v.$slides=v.$slider.children(v.options.slide+":not(.slick-cloned)").addClass("slick-slide"),v.slideCount=v.$slides.length,v.$slides.each(function($,ae){Ae(ae).attr("data-slick-index",$).data("originalStyling",Ae(ae).attr("style")||"")}),v.$slider.addClass("slick-slider"),v.$slideTrack=0===v.slideCount?Ae('<div class="slick-track"/>').appendTo(v.$slider):v.$slides.wrapAll('<div class="slick-track"/>').parent(),v.$list=v.$slideTrack.wrap('<div class="slick-list"/>').parent(),v.$slideTrack.css("opacity",0),!0!==v.options.centerMode&&!0!==v.options.swipeToSlide||(v.options.slidesToScroll=1),Ae("img[data-lazy]",v.$slider).not("[src]").addClass("slick-loading"),v.setupInfinite(),v.buildArrows(),v.buildDots(),v.updateDots(),v.setSlideClasses("number"==typeof v.currentSlide?v.currentSlide:0),!0===v.options.draggable&&v.$list.addClass("draggable")},Qe.prototype.buildRows=function(){var v,$,ae,o,D,N,j,k=this;if(o=document.createDocumentFragment(),N=k.$slider.children(),k.options.rows>1){for(j=k.options.slidesPerRow*k.options.rows,D=Math.ceil(N.length/j),v=0;v<D;v++){var O=document.createElement("div");for($=0;$<k.options.rows;$++){var I=document.createElement("div");for(ae=0;ae<k.options.slidesPerRow;ae++){var X=v*j+($*k.options.slidesPerRow+ae);N.get(X)&&I.appendChild(N.get(X))}O.appendChild(I)}o.appendChild(O)}k.$slider.empty().append(o),k.$slider.children().children().children().css({width:100/k.options.slidesPerRow+"%",display:"inline-block"})}},Qe.prototype.checkResponsive=function(v,$){var ae,o,D,N=this,j=!1,k=N.$slider.width(),O=window.innerWidth||Ae(window).width();if("window"===N.respondTo?D=O:"slider"===N.respondTo?D=k:"min"===N.respondTo&&(D=Math.min(O,k)),N.options.responsive&&N.options.responsive.length&&null!==N.options.responsive){for(ae in o=null,N.breakpoints)N.breakpoints.hasOwnProperty(ae)&&(!1===N.originalSettings.mobileFirst?D<N.breakpoints[ae]&&(o=N.breakpoints[ae]):D>N.breakpoints[ae]&&(o=N.breakpoints[ae]));null!==o?null!==N.activeBreakpoint?(o!==N.activeBreakpoint||$)&&(N.activeBreakpoint=o,"unslick"===N.breakpointSettings[o]?N.unslick(o):(N.options=Ae.extend({},N.originalSettings,N.breakpointSettings[o]),!0===v&&(N.currentSlide=N.options.initialSlide),N.refresh(v)),j=o):(N.activeBreakpoint=o,"unslick"===N.breakpointSettings[o]?N.unslick(o):(N.options=Ae.extend({},N.originalSettings,N.breakpointSettings[o]),!0===v&&(N.currentSlide=N.options.initialSlide),N.refresh(v)),j=o):null!==N.activeBreakpoint&&(N.activeBreakpoint=null,N.options=N.originalSettings,!0===v&&(N.currentSlide=N.options.initialSlide),N.refresh(v),j=o),v||!1===j||N.$slider.trigger("breakpoint",[N,j])}},Qe.prototype.changeSlide=function(v,$){var ae,o,N=this,j=Ae(v.currentTarget);switch(j.is("a")&&v.preventDefault(),j.is("li")||(j=j.closest("li")),ae=N.slideCount%N.options.slidesToScroll!=0?0:(N.slideCount-N.currentSlide)%N.options.slidesToScroll,v.data.message){case"previous":o=0===ae?N.options.slidesToScroll:N.options.slidesToShow-ae,N.slideCount>N.options.slidesToShow&&N.slideHandler(N.currentSlide-o,!1,$);break;case"next":o=0===ae?N.options.slidesToScroll:ae,N.slideCount>N.options.slidesToShow&&N.slideHandler(N.currentSlide+o,!1,$);break;case"index":var k=0===v.data.index?0:v.data.index||j.index()*N.options.slidesToScroll;N.slideHandler(N.checkNavigable(k),!1,$),j.children().trigger("focus");break;default:return}},Qe.prototype.checkNavigable=function(v){var $,ae;if(ae=0,v>($=this.getNavigableIndexes())[$.length-1])v=$[$.length-1];else for(var o in $){if(v<$[o]){v=ae;break}ae=$[o]}return v},Qe.prototype.cleanUpEvents=function(){var v=this;v.options.dots&&null!==v.$dots&&(Ae("li",v.$dots).off("click.slick",v.changeSlide).off("mouseenter.slick",Ae.proxy(v.interrupt,v,!0)).off("mouseleave.slick",Ae.proxy(v.interrupt,v,!1)),!0===v.options.accessibility&&v.$dots.off("keydown.slick",v.keyHandler)),v.$slider.off("focus.slick blur.slick"),!0===v.options.arrows&&v.slideCount>v.options.slidesToShow&&(v.$prevArrow&&v.$prevArrow.off("click.slick",v.changeSlide),v.$nextArrow&&v.$nextArrow.off("click.slick",v.changeSlide),!0===v.options.accessibility&&(v.$prevArrow&&v.$prevArrow.off("keydown.slick",v.keyHandler),v.$nextArrow&&v.$nextArrow.off("keydown.slick",v.keyHandler))),v.$list.off("touchstart.slick mousedown.slick",v.swipeHandler),v.$list.off("touchmove.slick mousemove.slick",v.swipeHandler),v.$list.off("touchend.slick mouseup.slick",v.swipeHandler),v.$list.off("touchcancel.slick mouseleave.slick",v.swipeHandler),v.$list.off("click.slick",v.clickHandler),Ae(document).off(v.visibilityChange,v.visibility),v.cleanUpSlideEvents(),!0===v.options.accessibility&&v.$list.off("keydown.slick",v.keyHandler),!0===v.options.focusOnSelect&&Ae(v.$slideTrack).children().off("click.slick",v.selectHandler),Ae(window).off("orientationchange.slick.slick-"+v.instanceUid,v.orientationChange),Ae(window).off("resize.slick.slick-"+v.instanceUid,v.resize),Ae("[draggable!=true]",v.$slideTrack).off("dragstart",v.preventDefault),Ae(window).off("load.slick.slick-"+v.instanceUid,v.setPosition)},Qe.prototype.cleanUpSlideEvents=function(){var v=this;v.$list.off("mouseenter.slick",Ae.proxy(v.interrupt,v,!0)),v.$list.off("mouseleave.slick",Ae.proxy(v.interrupt,v,!1))},Qe.prototype.cleanUpRows=function(){var v,$=this;$.options.rows>1&&((v=$.$slides.children().children()).removeAttr("style"),$.$slider.empty().append(v))},Qe.prototype.clickHandler=function(v){!1===this.shouldClick&&(v.stopImmediatePropagation(),v.stopPropagation(),v.preventDefault())},Qe.prototype.destroy=function(v){var $=this;$.autoPlayClear(),$.touchObject={},$.cleanUpEvents(),Ae(".slick-cloned",$.$slider).detach(),$.$dots&&$.$dots.remove(),$.$prevArrow&&$.$prevArrow.length&&($.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),$.htmlExpr.test($.options.prevArrow)&&$.$prevArrow.remove()),$.$nextArrow&&$.$nextArrow.length&&($.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),$.htmlExpr.test($.options.nextArrow)&&$.$nextArrow.remove()),$.$slides&&($.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){Ae(this).attr("style",Ae(this).data("originalStyling"))}),$.$slideTrack.children(this.options.slide).detach(),$.$slideTrack.detach(),$.$list.detach(),$.$slider.append($.$slides)),$.cleanUpRows(),$.$slider.removeClass("slick-slider"),$.$slider.removeClass("slick-initialized"),$.$slider.removeClass("slick-dotted"),$.unslicked=!0,v||$.$slider.trigger("destroy",[$])},Qe.prototype.disableTransition=function(v){var $=this,ae={};ae[$.transitionType]="",!1===$.options.fade?$.$slideTrack.css(ae):$.$slides.eq(v).css(ae)},Qe.prototype.fadeSlide=function(v,$){var ae=this;!1===ae.cssTransitions?(ae.$slides.eq(v).css({zIndex:ae.options.zIndex}),ae.$slides.eq(v).animate({opacity:1},ae.options.speed,ae.options.easing,$)):(ae.applyTransition(v),ae.$slides.eq(v).css({opacity:1,zIndex:ae.options.zIndex}),$&&setTimeout(function(){ae.disableTransition(v),$.call()},ae.options.speed))},Qe.prototype.fadeSlideOut=function(v){var $=this;!1===$.cssTransitions?$.$slides.eq(v).animate({opacity:0,zIndex:$.options.zIndex-2},$.options.speed,$.options.easing):($.applyTransition(v),$.$slides.eq(v).css({opacity:0,zIndex:$.options.zIndex-2}))},Qe.prototype.filterSlides=Qe.prototype.slickFilter=function(v){var $=this;null!==v&&($.$slidesCache=$.$slides,$.unload(),$.$slideTrack.children(this.options.slide).detach(),$.$slidesCache.filter(v).appendTo($.$slideTrack),$.reinit())},Qe.prototype.focusHandler=function(){var v=this;v.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*",function($){$.stopImmediatePropagation();var ae=Ae(this);setTimeout(function(){v.options.pauseOnFocus&&(v.focussed=ae.is(":focus"),v.autoPlay())},0)})},Qe.prototype.getCurrent=Qe.prototype.slickCurrentSlide=function(){return this.currentSlide},Qe.prototype.getDotCount=function(){var v=this,$=0,ae=0,o=0;if(!0===v.options.infinite)if(v.slideCount<=v.options.slidesToShow)++o;else for(;$<v.slideCount;)++o,$=ae+v.options.slidesToScroll,ae+=v.options.slidesToScroll<=v.options.slidesToShow?v.options.slidesToScroll:v.options.slidesToShow;else if(!0===v.options.centerMode)o=v.slideCount;else if(v.options.asNavFor)for(;$<v.slideCount;)++o,$=ae+v.options.slidesToScroll,ae+=v.options.slidesToScroll<=v.options.slidesToShow?v.options.slidesToScroll:v.options.slidesToShow;else o=1+Math.ceil((v.slideCount-v.options.slidesToShow)/v.options.slidesToScroll);return o-1},Qe.prototype.getLeft=function(v){var $,ae,o,D,N=this,j=0;return N.slideOffset=0,ae=N.$slides.first().outerHeight(!0),!0===N.options.infinite?(N.slideCount>N.options.slidesToShow&&(N.slideOffset=N.slideWidth*N.options.slidesToShow*-1,D=-1,!0===N.options.vertical&&!0===N.options.centerMode&&(2===N.options.slidesToShow?D=-1.5:1===N.options.slidesToShow&&(D=-2)),j=ae*N.options.slidesToShow*D),N.slideCount%N.options.slidesToScroll!=0&&v+N.options.slidesToScroll>N.slideCount&&N.slideCount>N.options.slidesToShow&&(v>N.slideCount?(N.slideOffset=(N.options.slidesToShow-(v-N.slideCount))*N.slideWidth*-1,j=(N.options.slidesToShow-(v-N.slideCount))*ae*-1):(N.slideOffset=N.slideCount%N.options.slidesToScroll*N.slideWidth*-1,j=N.slideCount%N.options.slidesToScroll*ae*-1))):v+N.options.slidesToShow>N.slideCount&&(N.slideOffset=(v+N.options.slidesToShow-N.slideCount)*N.slideWidth,j=(v+N.options.slidesToShow-N.slideCount)*ae),N.slideCount<=N.options.slidesToShow&&(N.slideOffset=0,j=0),!0===N.options.centerMode&&N.slideCount<=N.options.slidesToShow?N.slideOffset=N.slideWidth*Math.floor(N.options.slidesToShow)/2-N.slideWidth*N.slideCount/2:!0===N.options.centerMode&&!0===N.options.infinite?N.slideOffset+=N.slideWidth*Math.floor(N.options.slidesToShow/2)-N.slideWidth:!0===N.options.centerMode&&(N.slideOffset=0,N.slideOffset+=N.slideWidth*Math.floor(N.options.slidesToShow/2)),$=!1===N.options.vertical?v*N.slideWidth*-1+N.slideOffset:v*ae*-1+j,!0===N.options.variableWidth&&(o=N.slideCount<=N.options.slidesToShow||!1===N.options.infinite?N.$slideTrack.children(".slick-slide").eq(v):N.$slideTrack.children(".slick-slide").eq(v+N.options.slidesToShow),$=!0===N.options.rtl?o[0]?-1*(N.$slideTrack.width()-o[0].offsetLeft-o.width()):0:o[0]?-1*o[0].offsetLeft:0,!0===N.options.centerMode&&(o=N.slideCount<=N.options.slidesToShow||!1===N.options.infinite?N.$slideTrack.children(".slick-slide").eq(v):N.$slideTrack.children(".slick-slide").eq(v+N.options.slidesToShow+1),$=!0===N.options.rtl?o[0]?-1*(N.$slideTrack.width()-o[0].offsetLeft-o.width()):0:o[0]?-1*o[0].offsetLeft:0,$+=(N.$list.width()-o.outerWidth())/2)),$},Qe.prototype.getOption=Qe.prototype.slickGetOption=function(v){return this.options[v]},Qe.prototype.getNavigableIndexes=function(){var v,$=this,ae=0,o=0,D=[];for(!1===$.options.infinite?v=$.slideCount:(ae=-1*$.options.slidesToScroll,o=-1*$.options.slidesToScroll,v=2*$.slideCount);ae<v;)D.push(ae),ae=o+$.options.slidesToScroll,o+=$.options.slidesToScroll<=$.options.slidesToShow?$.options.slidesToScroll:$.options.slidesToShow;return D},Qe.prototype.getSlick=function(){return this},Qe.prototype.getSlideCount=function(){var v,$,ae=this;return $=!0===ae.options.centerMode?ae.slideWidth*Math.floor(ae.options.slidesToShow/2):0,!0===ae.options.swipeToSlide?(ae.$slideTrack.find(".slick-slide").each(function(o,D){if(D.offsetLeft-$+Ae(D).outerWidth()/2>-1*ae.swipeLeft)return v=D,!1}),Math.abs(Ae(v).attr("data-slick-index")-ae.currentSlide)||1):ae.options.slidesToScroll},Qe.prototype.goTo=Qe.prototype.slickGoTo=function(v,$){this.changeSlide({data:{message:"index",index:parseInt(v)}},$)},Qe.prototype.init=function(v){var $=this;Ae($.$slider).hasClass("slick-initialized")||(Ae($.$slider).addClass("slick-initialized"),$.buildRows(),$.buildOut(),$.setProps(),$.startLoad(),$.loadSlider(),$.initializeEvents(),$.updateArrows(),$.updateDots(),$.checkResponsive(!0),$.focusHandler()),v&&$.$slider.trigger("init",[$]),!0===$.options.accessibility&&$.initADA(),$.options.autoplay&&($.paused=!1,$.autoPlay())},Qe.prototype.initADA=function(){var v=this,$=Math.ceil(v.slideCount/v.options.slidesToShow),ae=v.getNavigableIndexes().filter(function(N){return N>=0&&N<v.slideCount});v.$slides.add(v.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),null!==v.$dots&&(v.$slides.not(v.$slideTrack.find(".slick-cloned")).each(function(N){var j=ae.indexOf(N);Ae(this).attr({role:"tabpanel",id:"slick-slide"+v.instanceUid+N,tabindex:-1}),-1!==j&&Ae(this).attr({"aria-describedby":"slick-slide-control"+v.instanceUid+j})}),v.$dots.attr("role","tablist").find("li").each(function(N){var j=ae[N];Ae(this).attr({role:"presentation"}),Ae(this).find("button").first().attr({role:"tab",id:"slick-slide-control"+v.instanceUid+N,"aria-controls":"slick-slide"+v.instanceUid+j,"aria-label":N+1+" of "+$,"aria-selected":null,tabindex:"-1"})}).eq(v.currentSlide).find("button").attr({"aria-selected":"true",tabindex:"0"}).end());for(var o=v.currentSlide,D=o+v.options.slidesToShow;o<D;o++)v.$slides.eq(o).attr("tabindex",0);v.activateADA()},Qe.prototype.initArrowEvents=function(){var v=this;!0===v.options.arrows&&v.slideCount>v.options.slidesToShow&&(v.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},v.changeSlide),v.$nextArrow.off("click.slick").on("click.slick",{message:"next"},v.changeSlide),!0===v.options.accessibility&&(v.$prevArrow.on("keydown.slick",v.keyHandler),v.$nextArrow.on("keydown.slick",v.keyHandler)))},Qe.prototype.initDotEvents=function(){var v=this;!0===v.options.dots&&(Ae("li",v.$dots).on("click.slick",{message:"index"},v.changeSlide),!0===v.options.accessibility&&v.$dots.on("keydown.slick",v.keyHandler)),!0===v.options.dots&&!0===v.options.pauseOnDotsHover&&Ae("li",v.$dots).on("mouseenter.slick",Ae.proxy(v.interrupt,v,!0)).on("mouseleave.slick",Ae.proxy(v.interrupt,v,!1))},Qe.prototype.initSlideEvents=function(){var v=this;v.options.pauseOnHover&&(v.$list.on("mouseenter.slick",Ae.proxy(v.interrupt,v,!0)),v.$list.on("mouseleave.slick",Ae.proxy(v.interrupt,v,!1)))},Qe.prototype.initializeEvents=function(){var v=this;v.initArrowEvents(),v.initDotEvents(),v.initSlideEvents(),v.$list.on("touchstart.slick mousedown.slick",{action:"start"},v.swipeHandler),v.$list.on("touchmove.slick mousemove.slick",{action:"move"},v.swipeHandler),v.$list.on("touchend.slick mouseup.slick",{action:"end"},v.swipeHandler),v.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},v.swipeHandler),v.$list.on("click.slick",v.clickHandler),Ae(document).on(v.visibilityChange,Ae.proxy(v.visibility,v)),!0===v.options.accessibility&&v.$list.on("keydown.slick",v.keyHandler),!0===v.options.focusOnSelect&&Ae(v.$slideTrack).children().on("click.slick",v.selectHandler),Ae(window).on("orientationchange.slick.slick-"+v.instanceUid,Ae.proxy(v.orientationChange,v)),Ae(window).on("resize.slick.slick-"+v.instanceUid,Ae.proxy(v.resize,v)),Ae("[draggable!=true]",v.$slideTrack).on("dragstart",v.preventDefault),Ae(window).on("load.slick.slick-"+v.instanceUid,v.setPosition),Ae(v.setPosition)},Qe.prototype.initUI=function(){var v=this;!0===v.options.arrows&&v.slideCount>v.options.slidesToShow&&(v.$prevArrow.show(),v.$nextArrow.show()),!0===v.options.dots&&v.slideCount>v.options.slidesToShow&&v.$dots.show()},Qe.prototype.keyHandler=function(v){var $=this;v.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===v.keyCode&&!0===$.options.accessibility?$.changeSlide({data:{message:!0===$.options.rtl?"next":"previous"}}):39===v.keyCode&&!0===$.options.accessibility&&$.changeSlide({data:{message:!0===$.options.rtl?"previous":"next"}}))},Qe.prototype.lazyLoad=function(){function v(I){Ae("img[data-lazy]",I).each(function(){var X=Ae(this),le=Ae(this).attr("data-lazy"),te=Ae(this).attr("data-srcset"),Be=Ae(this).attr("data-sizes")||D.$slider.attr("data-sizes"),Ie=document.createElement("img");Ie.onload=function(){X.animate({opacity:0},100,function(){te&&(X.attr("srcset",te),Be&&X.attr("sizes",Be)),X.attr("src",le).animate({opacity:1},200,function(){X.removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading")}),D.$slider.trigger("lazyLoaded",[D,X,le])})},Ie.onerror=function(){X.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),D.$slider.trigger("lazyLoadError",[D,X,le])},Ie.src=le})}var $,ae,o,D=this;if(!0===D.options.centerMode?!0===D.options.infinite?o=(ae=D.currentSlide+(D.options.slidesToShow/2+1))+D.options.slidesToShow+2:(ae=Math.max(0,D.currentSlide-(D.options.slidesToShow/2+1)),o=D.options.slidesToShow/2+1+2+D.currentSlide):(ae=D.options.infinite?D.options.slidesToShow+D.currentSlide:D.currentSlide,o=Math.ceil(ae+D.options.slidesToShow),!0===D.options.fade&&(ae>0&&ae--,o<=D.slideCount&&o++)),$=D.$slider.find(".slick-slide").slice(ae,o),"anticipated"===D.options.lazyLoad)for(var N=ae-1,j=o,k=D.$slider.find(".slick-slide"),O=0;O<D.options.slidesToScroll;O++)N<0&&(N=D.slideCount-1),$=($=$.add(k.eq(N))).add(k.eq(j)),N--,j++;v($),D.slideCount<=D.options.slidesToShow?v(D.$slider.find(".slick-slide")):D.currentSlide>=D.slideCount-D.options.slidesToShow?v(D.$slider.find(".slick-cloned").slice(0,D.options.slidesToShow)):0===D.currentSlide&&v(D.$slider.find(".slick-cloned").slice(-1*D.options.slidesToShow))},Qe.prototype.loadSlider=function(){var v=this;v.setPosition(),v.$slideTrack.css({opacity:1}),v.$slider.removeClass("slick-loading"),v.initUI(),"progressive"===v.options.lazyLoad&&v.progressiveLazyLoad()},Qe.prototype.next=Qe.prototype.slickNext=function(){this.changeSlide({data:{message:"next"}})},Qe.prototype.orientationChange=function(){this.checkResponsive(),this.setPosition()},Qe.prototype.pause=Qe.prototype.slickPause=function(){this.autoPlayClear(),this.paused=!0},Qe.prototype.play=Qe.prototype.slickPlay=function(){var v=this;v.autoPlay(),v.options.autoplay=!0,v.paused=!1,v.focussed=!1,v.interrupted=!1},Qe.prototype.postSlide=function(v){var $=this;$.unslicked||($.$slider.trigger("afterChange",[$,v]),$.animating=!1,$.slideCount>$.options.slidesToShow&&$.setPosition(),$.swipeLeft=null,$.options.autoplay&&$.autoPlay(),!0===$.options.accessibility&&($.initADA(),$.options.focusOnChange&&Ae($.$slides.get($.currentSlide)).attr("tabindex",0).focus()))},Qe.prototype.prev=Qe.prototype.slickPrev=function(){this.changeSlide({data:{message:"previous"}})},Qe.prototype.preventDefault=function(v){v.preventDefault()},Qe.prototype.progressiveLazyLoad=function(v){v=v||1;var $,ae,o,D,N,j=this,k=Ae("img[data-lazy]",j.$slider);k.length?($=k.first(),ae=$.attr("data-lazy"),o=$.attr("data-srcset"),D=$.attr("data-sizes")||j.$slider.attr("data-sizes"),(N=document.createElement("img")).onload=function(){o&&($.attr("srcset",o),D&&$.attr("sizes",D)),$.attr("src",ae).removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading"),!0===j.options.adaptiveHeight&&j.setPosition(),j.$slider.trigger("lazyLoaded",[j,$,ae]),j.progressiveLazyLoad()},N.onerror=function(){v<3?setTimeout(function(){j.progressiveLazyLoad(v+1)},500):($.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),j.$slider.trigger("lazyLoadError",[j,$,ae]),j.progressiveLazyLoad())},N.src=ae):j.$slider.trigger("allImagesLoaded",[j])},Qe.prototype.refresh=function(v){var $,ae,o=this;ae=o.slideCount-o.options.slidesToShow,!o.options.infinite&&o.currentSlide>ae&&(o.currentSlide=ae),o.slideCount<=o.options.slidesToShow&&(o.currentSlide=0),$=o.currentSlide,o.destroy(!0),Ae.extend(o,o.initials,{currentSlide:$}),o.init(),v||o.changeSlide({data:{message:"index",index:$}},!1)},Qe.prototype.registerBreakpoints=function(){var v,$,ae,o=this,D=o.options.responsive||null;if("array"===Ae.type(D)&&D.length){for(v in o.respondTo=o.options.respondTo||"window",D)if(ae=o.breakpoints.length-1,D.hasOwnProperty(v)){for($=D[v].breakpoint;ae>=0;)o.breakpoints[ae]&&o.breakpoints[ae]===$&&o.breakpoints.splice(ae,1),ae--;o.breakpoints.push($),o.breakpointSettings[$]=D[v].settings}o.breakpoints.sort(function(N,j){return o.options.mobileFirst?N-j:j-N})}},Qe.prototype.reinit=function(){var v=this;v.$slides=v.$slideTrack.children(v.options.slide).addClass("slick-slide"),v.slideCount=v.$slides.length,v.currentSlide>=v.slideCount&&0!==v.currentSlide&&(v.currentSlide=v.currentSlide-v.options.slidesToScroll),v.slideCount<=v.options.slidesToShow&&(v.currentSlide=0),v.registerBreakpoints(),v.setProps(),v.setupInfinite(),v.buildArrows(),v.updateArrows(),v.initArrowEvents(),v.buildDots(),v.updateDots(),v.initDotEvents(),v.cleanUpSlideEvents(),v.initSlideEvents(),v.checkResponsive(!1,!0),!0===v.options.focusOnSelect&&Ae(v.$slideTrack).children().on("click.slick",v.selectHandler),v.setSlideClasses("number"==typeof v.currentSlide?v.currentSlide:0),v.setPosition(),v.focusHandler(),v.paused=!v.options.autoplay,v.autoPlay(),v.$slider.trigger("reInit",[v])},Qe.prototype.resize=function(){var v=this;Ae(window).width()!==v.windowWidth&&(clearTimeout(v.windowDelay),v.windowDelay=window.setTimeout(function(){v.windowWidth=Ae(window).width(),v.checkResponsive(),v.unslicked||v.setPosition()},50))},Qe.prototype.removeSlide=Qe.prototype.slickRemove=function(v,$,ae){var o=this;if(v="boolean"==typeof v?!0===($=v)?0:o.slideCount-1:!0===$?--v:v,o.slideCount<1||v<0||v>o.slideCount-1)return!1;o.unload(),!0===ae?o.$slideTrack.children().remove():o.$slideTrack.children(this.options.slide).eq(v).remove(),o.$slides=o.$slideTrack.children(this.options.slide),o.$slideTrack.children(this.options.slide).detach(),o.$slideTrack.append(o.$slides),o.$slidesCache=o.$slides,o.reinit()},Qe.prototype.setCSS=function(v){var $,ae,o=this,D={};!0===o.options.rtl&&(v=-v),$="left"==o.positionProp?Math.ceil(v)+"px":"0px",ae="top"==o.positionProp?Math.ceil(v)+"px":"0px",D[o.positionProp]=v,!1===o.transformsEnabled?o.$slideTrack.css(D):(D={},!1===o.cssTransitions?(D[o.animType]="translate("+$+", "+ae+")",o.$slideTrack.css(D)):(D[o.animType]="translate3d("+$+", "+ae+", 0px)",o.$slideTrack.css(D)))},Qe.prototype.setDimensions=function(){var v=this;!1===v.options.vertical?!0===v.options.centerMode&&v.$list.css({padding:"0px "+v.options.centerPadding}):(v.$list.height(v.$slides.first().outerHeight(!0)*v.options.slidesToShow),!0===v.options.centerMode&&v.$list.css({padding:v.options.centerPadding+" 0px"})),v.listWidth=v.$list.width(),v.listHeight=v.$list.height(),!1===v.options.vertical&&!1===v.options.variableWidth?(v.slideWidth=Math.ceil(v.listWidth/v.options.slidesToShow),v.$slideTrack.width(Math.ceil(v.slideWidth*v.$slideTrack.children(".slick-slide").length))):!0===v.options.variableWidth?v.$slideTrack.width(5e3*v.slideCount):(v.slideWidth=Math.ceil(v.listWidth),v.$slideTrack.height(Math.ceil(v.$slides.first().outerHeight(!0)*v.$slideTrack.children(".slick-slide").length)));var $=v.$slides.first().outerWidth(!0)-v.$slides.first().width();!1===v.options.variableWidth&&v.$slideTrack.children(".slick-slide").width(v.slideWidth-$)},Qe.prototype.setFade=function(){var v,$=this;$.$slides.each(function(ae,o){v=$.slideWidth*ae*-1,!0===$.options.rtl?Ae(o).css({position:"relative",right:v,top:0,zIndex:$.options.zIndex-2,opacity:0}):Ae(o).css({position:"relative",left:v,top:0,zIndex:$.options.zIndex-2,opacity:0})}),$.$slides.eq($.currentSlide).css({zIndex:$.options.zIndex-1,opacity:1})},Qe.prototype.setHeight=function(){var v=this;if(1===v.options.slidesToShow&&!0===v.options.adaptiveHeight&&!1===v.options.vertical){var $=v.$slides.eq(v.currentSlide).outerHeight(!0);v.$list.css("height",$)}},Qe.prototype.setOption=Qe.prototype.slickSetOption=function(){var v,$,ae,o,D,N=this,j=!1;if("object"===Ae.type(arguments[0])?(ae=arguments[0],j=arguments[1],D="multiple"):"string"===Ae.type(arguments[0])&&(ae=arguments[0],o=arguments[1],j=arguments[2],"responsive"===arguments[0]&&"array"===Ae.type(arguments[1])?D="responsive":void 0!==arguments[1]&&(D="single")),"single"===D)N.options[ae]=o;else if("multiple"===D)Ae.each(ae,function(k,O){N.options[k]=O});else if("responsive"===D)for($ in o)if("array"!==Ae.type(N.options.responsive))N.options.responsive=[o[$]];else{for(v=N.options.responsive.length-1;v>=0;)N.options.responsive[v].breakpoint===o[$].breakpoint&&N.options.responsive.splice(v,1),v--;N.options.responsive.push(o[$])}j&&(N.unload(),N.reinit())},Qe.prototype.setPosition=function(){var v=this;v.setDimensions(),v.setHeight(),!1===v.options.fade?v.setCSS(v.getLeft(v.currentSlide)):v.setFade(),v.$slider.trigger("setPosition",[v])},Qe.prototype.setProps=function(){var v=this,$=document.body.style;v.positionProp=!0===v.options.vertical?"top":"left","top"===v.positionProp?v.$slider.addClass("slick-vertical"):v.$slider.removeClass("slick-vertical"),void 0===$.WebkitTransition&&void 0===$.MozTransition&&void 0===$.msTransition||!0===v.options.useCSS&&(v.cssTransitions=!0),v.options.fade&&("number"==typeof v.options.zIndex?v.options.zIndex<3&&(v.options.zIndex=3):v.options.zIndex=v.defaults.zIndex),void 0!==$.OTransform&&(v.animType="OTransform",v.transformType="-o-transform",v.transitionType="OTransition",void 0===$.perspectiveProperty&&void 0===$.webkitPerspective&&(v.animType=!1)),void 0!==$.MozTransform&&(v.animType="MozTransform",v.transformType="-moz-transform",v.transitionType="MozTransition",void 0===$.perspectiveProperty&&void 0===$.MozPerspective&&(v.animType=!1)),void 0!==$.webkitTransform&&(v.animType="webkitTransform",v.transformType="-webkit-transform",v.transitionType="webkitTransition",void 0===$.perspectiveProperty&&void 0===$.webkitPerspective&&(v.animType=!1)),void 0!==$.msTransform&&(v.animType="msTransform",v.transformType="-ms-transform",v.transitionType="msTransition",void 0===$.msTransform&&(v.animType=!1)),void 0!==$.transform&&!1!==v.animType&&(v.animType="transform",v.transformType="transform",v.transitionType="transition"),v.transformsEnabled=v.options.useTransform&&null!==v.animType&&!1!==v.animType},Qe.prototype.setSlideClasses=function(v){var $,ae,o,D,N=this;if(ae=N.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),N.$slides.eq(v).addClass("slick-current"),!0===N.options.centerMode){var j=N.options.slidesToShow%2==0?1:0;$=Math.floor(N.options.slidesToShow/2),!0===N.options.infinite&&(v>=$&&v<=N.slideCount-1-$?N.$slides.slice(v-$+j,v+$+1).addClass("slick-active").attr("aria-hidden","false"):ae.slice((o=N.options.slidesToShow+v)-$+1+j,o+$+2).addClass("slick-active").attr("aria-hidden","false"),0===v?ae.eq(ae.length-1-N.options.slidesToShow).addClass("slick-center"):v===N.slideCount-1&&ae.eq(N.options.slidesToShow).addClass("slick-center")),N.$slides.eq(v).addClass("slick-center")}else v>=0&&v<=N.slideCount-N.options.slidesToShow?N.$slides.slice(v,v+N.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):ae.length<=N.options.slidesToShow?ae.addClass("slick-active").attr("aria-hidden","false"):(D=N.slideCount%N.options.slidesToShow,o=!0===N.options.infinite?N.options.slidesToShow+v:v,N.options.slidesToShow==N.options.slidesToScroll&&N.slideCount-v<N.options.slidesToShow?ae.slice(o-(N.options.slidesToShow-D),o+D).addClass("slick-active").attr("aria-hidden","false"):ae.slice(o,o+N.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"));"ondemand"!==N.options.lazyLoad&&"anticipated"!==N.options.lazyLoad||N.lazyLoad()},Qe.prototype.setupInfinite=function(){var v,$,ae,o=this;if(!0===o.options.fade&&(o.options.centerMode=!1),!0===o.options.infinite&&!1===o.options.fade&&($=null,o.slideCount>o.options.slidesToShow)){for(ae=!0===o.options.centerMode?o.options.slidesToShow+1:o.options.slidesToShow,v=o.slideCount;v>o.slideCount-ae;v-=1)Ae(o.$slides[$=v-1]).clone(!0).attr("id","").attr("data-slick-index",$-o.slideCount).prependTo(o.$slideTrack).addClass("slick-cloned");for(v=0;v<ae+o.slideCount;v+=1)Ae(o.$slides[$=v]).clone(!0).attr("id","").attr("data-slick-index",$+o.slideCount).appendTo(o.$slideTrack).addClass("slick-cloned");o.$slideTrack.find(".slick-cloned").find("[id]").each(function(){Ae(this).attr("id","")})}},Qe.prototype.interrupt=function(v){v||this.autoPlay(),this.interrupted=v},Qe.prototype.selectHandler=function(v){var $=this,ae=Ae(v.target).is(".slick-slide")?Ae(v.target):Ae(v.target).parents(".slick-slide"),o=parseInt(ae.attr("data-slick-index"));o||(o=0),$.slideCount<=$.options.slidesToShow?$.slideHandler(o,!1,!0):$.slideHandler(o)},Qe.prototype.slideHandler=function(v,$,ae){var o,D,N,j,k,O=null,I=this;if($=$||!1,!(!0===I.animating&&!0===I.options.waitForAnimate||!0===I.options.fade&&I.currentSlide===v))if(!1===$&&I.asNavFor(v),O=I.getLeft(o=v),j=I.getLeft(I.currentSlide),I.currentLeft=null===I.swipeLeft?j:I.swipeLeft,!1===I.options.infinite&&!1===I.options.centerMode&&(v<0||v>I.getDotCount()*I.options.slidesToScroll))!1===I.options.fade&&(o=I.currentSlide,!0!==ae?I.animateSlide(j,function(){I.postSlide(o)}):I.postSlide(o));else if(!1===I.options.infinite&&!0===I.options.centerMode&&(v<0||v>I.slideCount-I.options.slidesToScroll))!1===I.options.fade&&(o=I.currentSlide,!0!==ae?I.animateSlide(j,function(){I.postSlide(o)}):I.postSlide(o));else{if(I.options.autoplay&&clearInterval(I.autoPlayTimer),D=o<0?I.slideCount%I.options.slidesToScroll!=0?I.slideCount-I.slideCount%I.options.slidesToScroll:I.slideCount+o:o>=I.slideCount?I.slideCount%I.options.slidesToScroll!=0?0:o-I.slideCount:o,I.animating=!0,I.$slider.trigger("beforeChange",[I,I.currentSlide,D]),N=I.currentSlide,I.currentSlide=D,I.setSlideClasses(I.currentSlide),I.options.asNavFor&&(k=(k=I.getNavTarget()).slick("getSlick")).slideCount<=k.options.slidesToShow&&k.setSlideClasses(I.currentSlide),I.updateDots(),I.updateArrows(),!0===I.options.fade)return!0!==ae?(I.fadeSlideOut(N),I.fadeSlide(D,function(){I.postSlide(D)})):I.postSlide(D),void I.animateHeight();!0!==ae?I.animateSlide(O,function(){I.postSlide(D)}):I.postSlide(D)}},Qe.prototype.startLoad=function(){var v=this;!0===v.options.arrows&&v.slideCount>v.options.slidesToShow&&(v.$prevArrow.hide(),v.$nextArrow.hide()),!0===v.options.dots&&v.slideCount>v.options.slidesToShow&&v.$dots.hide(),v.$slider.addClass("slick-loading")},Qe.prototype.swipeDirection=function(){var ae,o,D=this;return ae=Math.atan2(D.touchObject.startY-D.touchObject.curY,D.touchObject.startX-D.touchObject.curX),(o=Math.round(180*ae/Math.PI))<0&&(o=360-Math.abs(o)),o<=45&&o>=0||o<=360&&o>=315?!1===D.options.rtl?"left":"right":o>=135&&o<=225?!1===D.options.rtl?"right":"left":!0===D.options.verticalSwiping?o>=35&&o<=135?"down":"up":"vertical"},Qe.prototype.swipeEnd=function(v){var $,ae,o=this;if(o.dragging=!1,o.swiping=!1,o.scrolling)return o.scrolling=!1,!1;if(o.interrupted=!1,o.shouldClick=!(o.touchObject.swipeLength>10),void 0===o.touchObject.curX)return!1;if(!0===o.touchObject.edgeHit&&o.$slider.trigger("edge",[o,o.swipeDirection()]),o.touchObject.swipeLength>=o.touchObject.minSwipe){switch(ae=o.swipeDirection()){case"left":case"down":$=o.options.swipeToSlide?o.checkNavigable(o.currentSlide+o.getSlideCount()):o.currentSlide+o.getSlideCount(),o.currentDirection=0;break;case"right":case"up":$=o.options.swipeToSlide?o.checkNavigable(o.currentSlide-o.getSlideCount()):o.currentSlide-o.getSlideCount(),o.currentDirection=1}"vertical"!=ae&&(o.slideHandler($),o.touchObject={},o.$slider.trigger("swipe",[o,ae]))}else o.touchObject.startX!==o.touchObject.curX&&(o.slideHandler(o.currentSlide),o.touchObject={})},Qe.prototype.swipeHandler=function(v){var $=this;if(!(!1===$.options.swipe||"ontouchend"in document&&!1===$.options.swipe||!1===$.options.draggable&&-1!==v.type.indexOf("mouse")))switch($.touchObject.fingerCount=v.originalEvent&&void 0!==v.originalEvent.touches?v.originalEvent.touches.length:1,$.touchObject.minSwipe=$.listWidth/$.options.touchThreshold,!0===$.options.verticalSwiping&&($.touchObject.minSwipe=$.listHeight/$.options.touchThreshold),v.data.action){case"start":$.swipeStart(v);break;case"move":$.swipeMove(v);break;case"end":$.swipeEnd(v)}},Qe.prototype.swipeMove=function(v){var $,ae,o,D,N,j,k=this;return N=void 0!==v.originalEvent?v.originalEvent.touches:null,!(!k.dragging||k.scrolling||N&&1!==N.length)&&($=k.getLeft(k.currentSlide),k.touchObject.curX=void 0!==N?N[0].pageX:v.clientX,k.touchObject.curY=void 0!==N?N[0].pageY:v.clientY,k.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(k.touchObject.curX-k.touchObject.startX,2))),j=Math.round(Math.sqrt(Math.pow(k.touchObject.curY-k.touchObject.startY,2))),!k.options.verticalSwiping&&!k.swiping&&j>4?(k.scrolling=!0,!1):(!0===k.options.verticalSwiping&&(k.touchObject.swipeLength=j),ae=k.swipeDirection(),void 0!==v.originalEvent&&k.touchObject.swipeLength>4&&(k.swiping=!0,v.preventDefault()),D=(!1===k.options.rtl?1:-1)*(k.touchObject.curX>k.touchObject.startX?1:-1),!0===k.options.verticalSwiping&&(D=k.touchObject.curY>k.touchObject.startY?1:-1),o=k.touchObject.swipeLength,k.touchObject.edgeHit=!1,!1===k.options.infinite&&(0===k.currentSlide&&"right"===ae||k.currentSlide>=k.getDotCount()&&"left"===ae)&&(o=k.touchObject.swipeLength*k.options.edgeFriction,k.touchObject.edgeHit=!0),k.swipeLeft=!1===k.options.vertical?$+o*D:$+o*(k.$list.height()/k.listWidth)*D,!0===k.options.verticalSwiping&&(k.swipeLeft=$+o*D),!0!==k.options.fade&&!1!==k.options.touchMove&&(!0===k.animating?(k.swipeLeft=null,!1):void k.setCSS(k.swipeLeft))))},Qe.prototype.swipeStart=function(v){var $,ae=this;if(ae.interrupted=!0,1!==ae.touchObject.fingerCount||ae.slideCount<=ae.options.slidesToShow)return ae.touchObject={},!1;void 0!==v.originalEvent&&void 0!==v.originalEvent.touches&&($=v.originalEvent.touches[0]),ae.touchObject.startX=ae.touchObject.curX=void 0!==$?$.pageX:v.clientX,ae.touchObject.startY=ae.touchObject.curY=void 0!==$?$.pageY:v.clientY,ae.dragging=!0},Qe.prototype.unfilterSlides=Qe.prototype.slickUnfilter=function(){var v=this;null!==v.$slidesCache&&(v.unload(),v.$slideTrack.children(this.options.slide).detach(),v.$slidesCache.appendTo(v.$slideTrack),v.reinit())},Qe.prototype.unload=function(){var v=this;Ae(".slick-cloned",v.$slider).remove(),v.$dots&&v.$dots.remove(),v.$prevArrow&&v.htmlExpr.test(v.options.prevArrow)&&v.$prevArrow.remove(),v.$nextArrow&&v.htmlExpr.test(v.options.nextArrow)&&v.$nextArrow.remove(),v.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},Qe.prototype.unslick=function(v){var $=this;$.$slider.trigger("unslick",[$,v]),$.destroy()},Qe.prototype.updateArrows=function(){var v=this;Math.floor(v.options.slidesToShow/2),!0===v.options.arrows&&v.slideCount>v.options.slidesToShow&&!v.options.infinite&&(v.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),v.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===v.currentSlide?(v.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),v.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):(v.currentSlide>=v.slideCount-v.options.slidesToShow&&!1===v.options.centerMode||v.currentSlide>=v.slideCount-1&&!0===v.options.centerMode)&&(v.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),v.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},Qe.prototype.updateDots=function(){var v=this;null!==v.$dots&&(v.$dots.find("li").removeClass("slick-active").end(),v.$dots.find("li").eq(Math.floor(v.currentSlide/v.options.slidesToScroll)).addClass("slick-active"))},Qe.prototype.visibility=function(){var v=this;v.options.autoplay&&(v.interrupted=!!document[v.hidden])},Ae.fn.slick=function(){var v,$,ae=this,o=arguments[0],D=Array.prototype.slice.call(arguments,1),N=ae.length;for(v=0;v<N;v++)if("object"==typeof o||void 0===o?ae[v].slick=new Qe(ae[v],o):$=ae[v].slick[o].apply(ae[v].slick,D),void 0!==$)return $;return ae}});